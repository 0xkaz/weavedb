CiAgdmFyIF9fY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTsKICB2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5OwogIHZhciBfX2dldE93blByb3BEZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcjsKICB2YXIgX19nZXRPd25Qcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lczsKICB2YXIgX19nZXRQcm90b09mID0gT2JqZWN0LmdldFByb3RvdHlwZU9mOwogIHZhciBfX2hhc093blByb3AgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogIHZhciBfX3JlcXVpcmUgPSAvKiBAX19QVVJFX18gKi8gKCh4KSA9PiB0eXBlb2YgcmVxdWlyZSAhPT0gInVuZGVmaW5lZCIgPyByZXF1aXJlIDogdHlwZW9mIFByb3h5ICE9PSAidW5kZWZpbmVkIiA_IG5ldyBQcm94eSh4LCB7CiAgICBnZXQ6IChhLCBiKSA9PiAodHlwZW9mIHJlcXVpcmUgIT09ICJ1bmRlZmluZWQiID8gcmVxdWlyZSA6IGEpW2JdCiAgfSkgOiB4KShmdW5jdGlvbih4KSB7CiAgICBpZiAodHlwZW9mIHJlcXVpcmUgIT09ICJ1bmRlZmluZWQiKQogICAgICByZXR1cm4gcmVxdWlyZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgdGhyb3cgbmV3IEVycm9yKCdEeW5hbWljIHJlcXVpcmUgb2YgIicgKyB4ICsgJyIgaXMgbm90IHN1cHBvcnRlZCcpOwogIH0pOwogIHZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0-IGZ1bmN0aW9uIF9fcmVxdWlyZTIoKSB7CiAgICByZXR1cm4gbW9kIHx8ICgwLCBjYltfX2dldE93blByb3BOYW1lcyhjYilbMF1dKSgobW9kID0geyBleHBvcnRzOiB7fSB9KS5leHBvcnRzLCBtb2QpLCBtb2QuZXhwb3J0czsKICB9OwogIHZhciBfX2NvcHlQcm9wcyA9ICh0bywgZnJvbSwgZXhjZXB0LCBkZXNjKSA9PiB7CiAgICBpZiAoZnJvbSAmJiB0eXBlb2YgZnJvbSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGZyb20gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICAgIGlmICghX19oYXNPd25Qcm9wLmNhbGwodG8sIGtleSkgJiYga2V5ICE9PSBleGNlcHQpCiAgICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0-IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7CiAgICB9CiAgICByZXR1cm4gdG87CiAgfTsKICB2YXIgX190b0VTTSA9IChtb2QsIGlzTm9kZU1vZGUsIHRhcmdldCkgPT4gKHRhcmdldCA9IG1vZCAhPSBudWxsID8gX19jcmVhdGUoX19nZXRQcm90b09mKG1vZCkpIDoge30sIF9fY29weVByb3BzKAogICAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA_IF9fZGVmUHJvcCh0YXJnZXQsICJkZWZhdWx0IiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LAogICAgbW9kCiAgKSk7CgogIC8vIG5vZGVfbW9kdWxlcy9qc29uLWxvZ2ljLWpzL2xvZ2ljLmpzCiAgdmFyIHJlcXVpcmVfbG9naWMgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvanNvbi1sb2dpYy1qcy9sb2dpYy5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgIChmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CiAgICAgICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgewogICAgICAgICAgZGVmaW5lKGZhY3RvcnkpOwogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcm9vdC5qc29uTG9naWMgPSBmYWN0b3J5KCk7CiAgICAgICAgfQogICAgICB9KShleHBvcnRzLCBmdW5jdGlvbigpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KSB7CiAgICAgICAgICBBcnJheS5pc0FycmF5ID0gZnVuY3Rpb24oYXJnKSB7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYXJnKSA9PT0gIltvYmplY3QgQXJyYXldIjsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGFycmF5VW5pcXVlKGFycmF5KSB7CiAgICAgICAgICB2YXIgYSA9IFtdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgaWYgKGEuaW5kZXhPZihhcnJheVtpXSkgPT09IC0xKSB7CiAgICAgICAgICAgICAgYS5wdXNoKGFycmF5W2ldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgfQogICAgICAgIHZhciBqc29uTG9naWMyID0ge307CiAgICAgICAgdmFyIG9wZXJhdGlvbnMgPSB7CiAgICAgICAgICAiPT0iOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhID09IGI7CiAgICAgICAgICB9LAogICAgICAgICAgIj09PSI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEgPT09IGI7CiAgICAgICAgICB9LAogICAgICAgICAgIiE9IjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSAhPSBiOwogICAgICAgICAgfSwKICAgICAgICAgICIhPT0iOiBmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhICE9PSBiOwogICAgICAgICAgfSwKICAgICAgICAgICI-IjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSA-IGI7CiAgICAgICAgICB9LAogICAgICAgICAgIj49IjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSA-PSBiOwogICAgICAgICAgfSwKICAgICAgICAgICI8IjogZnVuY3Rpb24oYSwgYiwgYykgewogICAgICAgICAgICByZXR1cm4gYyA9PT0gdm9pZCAwID8gYSA8IGIgOiBhIDwgYiAmJiBiIDwgYzsKICAgICAgICAgIH0sCiAgICAgICAgICAiPD0iOiBmdW5jdGlvbihhLCBiLCBjKSB7CiAgICAgICAgICAgIHJldHVybiBjID09PSB2b2lkIDAgPyBhIDw9IGIgOiBhIDw9IGIgJiYgYiA8PSBjOwogICAgICAgICAgfSwKICAgICAgICAgICIhISI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgcmV0dXJuIGpzb25Mb2dpYzIudHJ1dGh5KGEpOwogICAgICAgICAgfSwKICAgICAgICAgICIhIjogZnVuY3Rpb24oYSkgewogICAgICAgICAgICByZXR1cm4gIWpzb25Mb2dpYzIudHJ1dGh5KGEpOwogICAgICAgICAgfSwKICAgICAgICAgICIlIjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICByZXR1cm4gYSAlIGI7CiAgICAgICAgICB9LAogICAgICAgICAgImxvZyI6IGZ1bmN0aW9uKGEpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coYSk7CiAgICAgICAgICAgIHJldHVybiBhOwogICAgICAgICAgfSwKICAgICAgICAgICJpbiI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgaWYgKCFiIHx8IHR5cGVvZiBiLmluZGV4T2YgPT09ICJ1bmRlZmluZWQiKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIGIuaW5kZXhPZihhKSAhPT0gLTE7CiAgICAgICAgICB9LAogICAgICAgICAgImNhdCI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLmpvaW4uY2FsbChhcmd1bWVudHMsICIiKTsKICAgICAgICAgIH0sCiAgICAgICAgICAic3Vic3RyIjogZnVuY3Rpb24oc291cmNlLCBzdGFydCwgZW5kKSB7CiAgICAgICAgICAgIGlmIChlbmQgPCAwKSB7CiAgICAgICAgICAgICAgdmFyIHRlbXAgPSBTdHJpbmcoc291cmNlKS5zdWJzdHIoc3RhcnQpOwogICAgICAgICAgICAgIHJldHVybiB0ZW1wLnN1YnN0cigwLCB0ZW1wLmxlbmd0aCArIGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIFN0cmluZyhzb3VyY2UpLnN1YnN0cihzdGFydCwgZW5kKTsKICAgICAgICAgIH0sCiAgICAgICAgICAiKyI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnJlZHVjZS5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGEsIDEwKSArIHBhcnNlRmxvYXQoYiwgMTApOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICAgIH0sCiAgICAgICAgICAiKiI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnJlZHVjZS5jYWxsKGFyZ3VtZW50cywgZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGEsIDEwKSAqIHBhcnNlRmxvYXQoYiwgMTApOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sCiAgICAgICAgICAiLSI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgaWYgKGIgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHJldHVybiAtYTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gYSAtIGI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0sCiAgICAgICAgICAiLyI6IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEgLyBiOwogICAgICAgICAgfSwKICAgICAgICAgICJtaW4iOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9LAogICAgICAgICAgIm1heCI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5tYXguYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0sCiAgICAgICAgICAibWVyZ2UiOiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5yZWR1Y2UuY2FsbChhcmd1bWVudHMsIGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICByZXR1cm4gYS5jb25jYXQoYik7CiAgICAgICAgICAgIH0sIFtdKTsKICAgICAgICAgIH0sCiAgICAgICAgICAidmFyIjogZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICB2YXIgbm90X2ZvdW5kID0gYiA9PT0gdm9pZCAwID8gbnVsbCA6IGI7CiAgICAgICAgICAgIHZhciBkYXRhID0gdGhpczsKICAgICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAidW5kZWZpbmVkIiB8fCBhID09PSAiIiB8fCBhID09PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHN1Yl9wcm9wcyA9IFN0cmluZyhhKS5zcGxpdCgiLiIpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN1Yl9wcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmIChkYXRhID09PSBudWxsIHx8IGRhdGEgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5vdF9mb3VuZDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgZGF0YSA9IGRhdGFbc3ViX3Byb3BzW2ldXTsKICAgICAgICAgICAgICBpZiAoZGF0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbm90X2ZvdW5kOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgIH0sCiAgICAgICAgICAibWlzc2luZyI6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICB2YXIgbWlzc2luZyA9IFtdOwogICAgICAgICAgICB2YXIga2V5czQgPSBBcnJheS5pc0FycmF5KGFyZ3VtZW50c1swXSkgPyBhcmd1bWVudHNbMF0gOiBhcmd1bWVudHM7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5czQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICB2YXIga2V5ID0ga2V5czRbaV07CiAgICAgICAgICAgICAgdmFyIHZhbHVlID0ganNvbkxvZ2ljMi5hcHBseSh7ICJ2YXIiOiBrZXkgfSwgdGhpcyk7CiAgICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSAiIikgewogICAgICAgICAgICAgICAgbWlzc2luZy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBtaXNzaW5nOwogICAgICAgICAgfSwKICAgICAgICAgICJtaXNzaW5nX3NvbWUiOiBmdW5jdGlvbihuZWVkX2NvdW50LCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBhcmVfbWlzc2luZyA9IGpzb25Mb2dpYzIuYXBwbHkoeyAibWlzc2luZyI6IG9wdGlvbnMgfSwgdGhpcyk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmxlbmd0aCAtIGFyZV9taXNzaW5nLmxlbmd0aCA-PSBuZWVkX2NvdW50KSB7CiAgICAgICAgICAgICAgcmV0dXJuIFtdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBhcmVfbWlzc2luZzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAganNvbkxvZ2ljMi5pc19sb2dpYyA9IGZ1bmN0aW9uKGxvZ2ljKSB7CiAgICAgICAgICByZXR1cm4gdHlwZW9mIGxvZ2ljID09PSAib2JqZWN0IiAmJiBsb2dpYyAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheShsb2dpYykgJiYgT2JqZWN0LmtleXMobG9naWMpLmxlbmd0aCA9PT0gMTsKICAgICAgICB9OwogICAgICAgIGpzb25Mb2dpYzIudHJ1dGh5ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICEhdmFsdWU7CiAgICAgICAgfTsKICAgICAgICBqc29uTG9naWMyLmdldF9vcGVyYXRvciA9IGZ1bmN0aW9uKGxvZ2ljKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMobG9naWMpWzBdOwogICAgICAgIH07CiAgICAgICAganNvbkxvZ2ljMi5nZXRfdmFsdWVzID0gZnVuY3Rpb24obG9naWMpIHsKICAgICAgICAgIHJldHVybiBsb2dpY1tqc29uTG9naWMyLmdldF9vcGVyYXRvcihsb2dpYyldOwogICAgICAgIH07CiAgICAgICAganNvbkxvZ2ljMi5hcHBseSA9IGZ1bmN0aW9uKGxvZ2ljLCBkYXRhKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShsb2dpYykpIHsKICAgICAgICAgICAgcmV0dXJuIGxvZ2ljLm1hcChmdW5jdGlvbihsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGpzb25Mb2dpYzIuYXBwbHkobCwgZGF0YSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFqc29uTG9naWMyLmlzX2xvZ2ljKGxvZ2ljKSkgewogICAgICAgICAgICByZXR1cm4gbG9naWM7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgb3AgPSBqc29uTG9naWMyLmdldF9vcGVyYXRvcihsb2dpYyk7CiAgICAgICAgICB2YXIgdmFsdWVzID0gbG9naWNbb3BdOwogICAgICAgICAgdmFyIGk7CiAgICAgICAgICB2YXIgY3VycmVudDsKICAgICAgICAgIHZhciBzY29wZWRMb2dpYzsKICAgICAgICAgIHZhciBzY29wZWREYXRhOwogICAgICAgICAgdmFyIGluaXRpYWw7CiAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWVzKSkgewogICAgICAgICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChvcCA9PT0gImlmIiB8fCBvcCA9PSAiPzoiKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoIC0gMTsgaSArPSAyKSB7CiAgICAgICAgICAgICAgaWYgKGpzb25Mb2dpYzIudHJ1dGh5KGpzb25Mb2dpYzIuYXBwbHkodmFsdWVzW2ldLCBkYXRhKSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1tpICsgMV0sIGRhdGEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCA9PT0gaSArIDEpIHsKICAgICAgICAgICAgICByZXR1cm4ganNvbkxvZ2ljMi5hcHBseSh2YWx1ZXNbaV0sIGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gImFuZCIpIHsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgIGN1cnJlbnQgPSBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1tpXSwgZGF0YSk7CiAgICAgICAgICAgICAgaWYgKCFqc29uTG9naWMyLnRydXRoeShjdXJyZW50KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjdXJyZW50OwogICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gIm9yIikgewogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdmFsdWVzLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgY3VycmVudCA9IGpzb25Mb2dpYzIuYXBwbHkodmFsdWVzW2ldLCBkYXRhKTsKICAgICAgICAgICAgICBpZiAoanNvbkxvZ2ljMi50cnV0aHkoY3VycmVudCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY3VycmVudDsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPT09ICJmaWx0ZXIiKSB7CiAgICAgICAgICAgIHNjb3BlZERhdGEgPSBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1swXSwgZGF0YSk7CiAgICAgICAgICAgIHNjb3BlZExvZ2ljID0gdmFsdWVzWzFdOwogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NvcGVkRGF0YSkpIHsKICAgICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNjb3BlZERhdGEuZmlsdGVyKGZ1bmN0aW9uKGRhdHVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGpzb25Mb2dpYzIudHJ1dGh5KGpzb25Mb2dpYzIuYXBwbHkoc2NvcGVkTG9naWMsIGRhdHVtKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gIm1hcCIpIHsKICAgICAgICAgICAgc2NvcGVkRGF0YSA9IGpzb25Mb2dpYzIuYXBwbHkodmFsdWVzWzBdLCBkYXRhKTsKICAgICAgICAgICAgc2NvcGVkTG9naWMgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzY29wZWREYXRhKSkgewogICAgICAgICAgICAgIHJldHVybiBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2NvcGVkRGF0YS5tYXAoZnVuY3Rpb24oZGF0dW0pIHsKICAgICAgICAgICAgICByZXR1cm4ganNvbkxvZ2ljMi5hcHBseShzY29wZWRMb2dpYywgZGF0dW0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPT09ICJyZWR1Y2UiKSB7CiAgICAgICAgICAgIHNjb3BlZERhdGEgPSBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1swXSwgZGF0YSk7CiAgICAgICAgICAgIHNjb3BlZExvZ2ljID0gdmFsdWVzWzFdOwogICAgICAgICAgICBpbml0aWFsID0gdHlwZW9mIHZhbHVlc1syXSAhPT0gInVuZGVmaW5lZCIgPyB2YWx1ZXNbMl0gOiBudWxsOwogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NvcGVkRGF0YSkpIHsKICAgICAgICAgICAgICByZXR1cm4gaW5pdGlhbDsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2NvcGVkRGF0YS5yZWR1Y2UoCiAgICAgICAgICAgICAgZnVuY3Rpb24oYWNjdW11bGF0b3IsIGN1cnJlbnQyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbkxvZ2ljMi5hcHBseSgKICAgICAgICAgICAgICAgICAgc2NvcGVkTG9naWMsCiAgICAgICAgICAgICAgICAgIHsgY3VycmVudDogY3VycmVudDIsIGFjY3VtdWxhdG9yIH0KICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBpbml0aWFsCiAgICAgICAgICAgICk7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAiYWxsIikgewogICAgICAgICAgICBzY29wZWREYXRhID0ganNvbkxvZ2ljMi5hcHBseSh2YWx1ZXNbMF0sIGRhdGEpOwogICAgICAgICAgICBzY29wZWRMb2dpYyA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHNjb3BlZERhdGEpIHx8ICFzY29wZWREYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2NvcGVkRGF0YS5sZW5ndGg7IGkgKz0gMSkgewogICAgICAgICAgICAgIGlmICghanNvbkxvZ2ljMi50cnV0aHkoanNvbkxvZ2ljMi5hcHBseShzY29wZWRMb2dpYywgc2NvcGVkRGF0YVtpXSkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gIm5vbmUiKSB7CiAgICAgICAgICAgIHNjb3BlZERhdGEgPSBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1swXSwgZGF0YSk7CiAgICAgICAgICAgIHNjb3BlZExvZ2ljID0gdmFsdWVzWzFdOwogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NvcGVkRGF0YSkgfHwgIXNjb3BlZERhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNjb3BlZERhdGEubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICBpZiAoanNvbkxvZ2ljMi50cnV0aHkoanNvbkxvZ2ljMi5hcHBseShzY29wZWRMb2dpYywgc2NvcGVkRGF0YVtpXSkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gInNvbWUiKSB7CiAgICAgICAgICAgIHNjb3BlZERhdGEgPSBqc29uTG9naWMyLmFwcGx5KHZhbHVlc1swXSwgZGF0YSk7CiAgICAgICAgICAgIHNjb3BlZExvZ2ljID0gdmFsdWVzWzFdOwogICAgICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NvcGVkRGF0YSkgfHwgIXNjb3BlZERhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzY29wZWREYXRhLmxlbmd0aDsgaSArPSAxKSB7CiAgICAgICAgICAgICAgaWYgKGpzb25Mb2dpYzIudHJ1dGh5KGpzb25Mb2dpYzIuYXBwbHkoc2NvcGVkTG9naWMsIHNjb3BlZERhdGFbaV0pKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhbHVlcyA9IHZhbHVlcy5tYXAoZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICAgIHJldHVybiBqc29uTG9naWMyLmFwcGx5KHZhbCwgZGF0YSk7CiAgICAgICAgICB9KTsKICAgICAgICAgIGlmIChvcGVyYXRpb25zLmhhc093blByb3BlcnR5KG9wKSAmJiB0eXBlb2Ygb3BlcmF0aW9uc1tvcF0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgcmV0dXJuIG9wZXJhdGlvbnNbb3BdLmFwcGx5KGRhdGEsIHZhbHVlcyk7CiAgICAgICAgICB9IGVsc2UgaWYgKG9wLmluZGV4T2YoIi4iKSA-IDApIHsKICAgICAgICAgICAgdmFyIHN1Yl9vcHMgPSBTdHJpbmcob3ApLnNwbGl0KCIuIik7CiAgICAgICAgICAgIHZhciBvcGVyYXRpb24gPSBvcGVyYXRpb25zOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3ViX29wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICghb3BlcmF0aW9uLmhhc093blByb3BlcnR5KHN1Yl9vcHNbaV0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBvcGVyYXRpb24gIiArIG9wICsgIiAoZmFpbGVkIGF0ICIgKyBzdWJfb3BzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCIuIikgKyAiKSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBvcGVyYXRpb24gPSBvcGVyYXRpb25bc3ViX29wc1tpXV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIG9wZXJhdGlvbi5hcHBseShkYXRhLCB2YWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbnJlY29nbml6ZWQgb3BlcmF0aW9uICIgKyBvcCk7CiAgICAgICAgfTsKICAgICAgICBqc29uTG9naWMyLnVzZXNfZGF0YSA9IGZ1bmN0aW9uKGxvZ2ljKSB7CiAgICAgICAgICB2YXIgY29sbGVjdGlvbiA9IFtdOwogICAgICAgICAgaWYgKGpzb25Mb2dpYzIuaXNfbG9naWMobG9naWMpKSB7CiAgICAgICAgICAgIHZhciBvcCA9IGpzb25Mb2dpYzIuZ2V0X29wZXJhdG9yKGxvZ2ljKTsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGxvZ2ljW29wXTsKICAgICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlcykpIHsKICAgICAgICAgICAgICB2YWx1ZXMgPSBbdmFsdWVzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3AgPT09ICJ2YXIiKSB7CiAgICAgICAgICAgICAgY29sbGVjdGlvbi5wdXNoKHZhbHVlc1swXSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goZnVuY3Rpb24odmFsKSB7CiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uLnB1c2guYXBwbHkoY29sbGVjdGlvbiwganNvbkxvZ2ljMi51c2VzX2RhdGEodmFsKSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhcnJheVVuaXF1ZShjb2xsZWN0aW9uKTsKICAgICAgICB9OwogICAgICAgIGpzb25Mb2dpYzIuYWRkX29wZXJhdGlvbiA9IGZ1bmN0aW9uKG5hbWUsIGNvZGUpIHsKICAgICAgICAgIG9wZXJhdGlvbnNbbmFtZV0gPSBjb2RlOwogICAgICAgIH07CiAgICAgICAganNvbkxvZ2ljMi5ybV9vcGVyYXRpb24gPSBmdW5jdGlvbihuYW1lKSB7CiAgICAgICAgICBkZWxldGUgb3BlcmF0aW9uc1tuYW1lXTsKICAgICAgICB9OwogICAgICAgIGpzb25Mb2dpYzIucnVsZV9saWtlID0gZnVuY3Rpb24ocnVsZSwgcGF0dGVybikgewogICAgICAgICAgaWYgKHBhdHRlcm4gPT09IHJ1bGUpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGF0dGVybiA9PT0gIkAiKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHBhdHRlcm4gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcnVsZSA9PT0gIm51bWJlciI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocGF0dGVybiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBydWxlID09PSAic3RyaW5nIjsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChwYXR0ZXJuID09PSAiYXJyYXkiKSB7CiAgICAgICAgICAgIHJldHVybiBBcnJheS5pc0FycmF5KHJ1bGUpICYmICFqc29uTG9naWMyLmlzX2xvZ2ljKHJ1bGUpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGpzb25Mb2dpYzIuaXNfbG9naWMocGF0dGVybikpIHsKICAgICAgICAgICAgaWYgKGpzb25Mb2dpYzIuaXNfbG9naWMocnVsZSkpIHsKICAgICAgICAgICAgICB2YXIgcGF0dGVybl9vcCA9IGpzb25Mb2dpYzIuZ2V0X29wZXJhdG9yKHBhdHRlcm4pOwogICAgICAgICAgICAgIHZhciBydWxlX29wID0ganNvbkxvZ2ljMi5nZXRfb3BlcmF0b3IocnVsZSk7CiAgICAgICAgICAgICAgaWYgKHBhdHRlcm5fb3AgPT09ICJAIiB8fCBwYXR0ZXJuX29wID09PSBydWxlX29wKSB7CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbkxvZ2ljMi5ydWxlX2xpa2UoCiAgICAgICAgICAgICAgICAgIGpzb25Mb2dpYzIuZ2V0X3ZhbHVlcyhydWxlLCBmYWxzZSksCiAgICAgICAgICAgICAgICAgIGpzb25Mb2dpYzIuZ2V0X3ZhbHVlcyhwYXR0ZXJuLCBmYWxzZSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhdHRlcm4pKSB7CiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJ1bGUpKSB7CiAgICAgICAgICAgICAgaWYgKHBhdHRlcm4ubGVuZ3RoICE9PSBydWxlLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdHRlcm4ubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgICAgICAgICAgIGlmICghanNvbkxvZ2ljMi5ydWxlX2xpa2UocnVsZVtpXSwgcGF0dGVybltpXSkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIHJldHVybiBqc29uTG9naWMyOwogICAgICB9KTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3B1bnljb2RlL3B1bnljb2RlLmpzCiAgdmFyIHJlcXVpcmVfcHVueWNvZGUgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcHVueWNvZGUvcHVueWNvZGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAoZnVuY3Rpb24ocm9vdCkgewogICAgICAgIHZhciBmcmVlRXhwb3J0cyA9IHR5cGVvZiBleHBvcnRzID09ICJvYmplY3QiICYmIGV4cG9ydHMgJiYgIWV4cG9ydHMubm9kZVR5cGUgJiYgZXhwb3J0czsKICAgICAgICB2YXIgZnJlZU1vZHVsZSA9IHR5cGVvZiBtb2R1bGUgPT0gIm9iamVjdCIgJiYgbW9kdWxlICYmICFtb2R1bGUubm9kZVR5cGUgJiYgbW9kdWxlOwogICAgICAgIHZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAib2JqZWN0IiAmJiBnbG9iYWw7CiAgICAgICAgaWYgKGZyZWVHbG9iYWwuZ2xvYmFsID09PSBmcmVlR2xvYmFsIHx8IGZyZWVHbG9iYWwud2luZG93ID09PSBmcmVlR2xvYmFsIHx8IGZyZWVHbG9iYWwuc2VsZiA9PT0gZnJlZUdsb2JhbCkgewogICAgICAgICAgcm9vdCA9IGZyZWVHbG9iYWw7CiAgICAgICAgfQogICAgICAgIHZhciBwdW55Y29kZSwgbWF4SW50ID0gMjE0NzQ4MzY0NywgYmFzZSA9IDM2LCB0TWluID0gMSwgdE1heCA9IDI2LCBza2V3ID0gMzgsIGRhbXAgPSA3MDAsIGluaXRpYWxCaWFzID0gNzIsIGluaXRpYWxOID0gMTI4LCBkZWxpbWl0ZXIgPSAiLSIsIHJlZ2V4UHVueWNvZGUgPSAvXnhuLS0vLCByZWdleE5vbkFTQ0lJID0gL1teXHgyMC1ceDdFXS8sIHJlZ2V4U2VwYXJhdG9ycyA9IC9bXHgyRVx1MzAwMlx1RkYwRVx1RkY2MV0vZywgZXJyb3JzID0gewogICAgICAgICAgIm92ZXJmbG93IjogIk92ZXJmbG93OiBpbnB1dCBuZWVkcyB3aWRlciBpbnRlZ2VycyB0byBwcm9jZXNzIiwKICAgICAgICAgICJub3QtYmFzaWMiOiAiSWxsZWdhbCBpbnB1dCA-PSAweDgwIChub3QgYSBiYXNpYyBjb2RlIHBvaW50KSIsCiAgICAgICAgICAiaW52YWxpZC1pbnB1dCI6ICJJbnZhbGlkIGlucHV0IgogICAgICAgIH0sIGJhc2VNaW51c1RNaW4gPSBiYXNlIC0gdE1pbiwgZmxvb3IgPSBNYXRoLmZsb29yLCBzdHJpbmdGcm9tQ2hhckNvZGUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlLCBrZXk7CiAgICAgICAgZnVuY3Rpb24gZXJyb3IodHlwZTMpIHsKICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoZXJyb3JzW3R5cGUzXSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hcChhcnJheSwgZm4pIHsKICAgICAgICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7CiAgICAgICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgICAgICB3aGlsZSAobGVuZ3RoLS0pIHsKICAgICAgICAgICAgcmVzdWx0W2xlbmd0aF0gPSBmbihhcnJheVtsZW5ndGhdKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1hcERvbWFpbihzdHJpbmcsIGZuKSB7CiAgICAgICAgICB2YXIgcGFydHMgPSBzdHJpbmcuc3BsaXQoIkAiKTsKICAgICAgICAgIHZhciByZXN1bHQgPSAiIjsKICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHBhcnRzWzBdICsgIkAiOwogICAgICAgICAgICBzdHJpbmcgPSBwYXJ0c1sxXTsKICAgICAgICAgIH0KICAgICAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKHJlZ2V4U2VwYXJhdG9ycywgIi4iKTsKICAgICAgICAgIHZhciBsYWJlbHMgPSBzdHJpbmcuc3BsaXQoIi4iKTsKICAgICAgICAgIHZhciBlbmNvZGVkID0gbWFwKGxhYmVscywgZm4pLmpvaW4oIi4iKTsKICAgICAgICAgIHJldHVybiByZXN1bHQgKyBlbmNvZGVkOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1Y3MyZGVjb2RlKHN0cmluZykgewogICAgICAgICAgdmFyIG91dHB1dCA9IFtdLCBjb3VudGVyID0gMCwgbGVuZ3RoID0gc3RyaW5nLmxlbmd0aCwgdmFsdWUsIGV4dHJhOwogICAgICAgICAgd2hpbGUgKGNvdW50ZXIgPCBsZW5ndGgpIHsKICAgICAgICAgICAgdmFsdWUgPSBzdHJpbmcuY2hhckNvZGVBdChjb3VudGVyKyspOwogICAgICAgICAgICBpZiAodmFsdWUgPj0gNTUyOTYgJiYgdmFsdWUgPD0gNTYzMTkgJiYgY291bnRlciA8IGxlbmd0aCkgewogICAgICAgICAgICAgIGV4dHJhID0gc3RyaW5nLmNoYXJDb2RlQXQoY291bnRlcisrKTsKICAgICAgICAgICAgICBpZiAoKGV4dHJhICYgNjQ1MTIpID09IDU2MzIwKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCgoKHZhbHVlICYgMTAyMykgPDwgMTApICsgKGV4dHJhICYgMTAyMykgKyA2NTUzNik7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG91dHB1dC5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgICAgIGNvdW50ZXItLTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgb3V0cHV0LnB1c2godmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gb3V0cHV0OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB1Y3MyZW5jb2RlKGFycmF5KSB7CiAgICAgICAgICByZXR1cm4gbWFwKGFycmF5LCBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICB2YXIgb3V0cHV0ID0gIiI7CiAgICAgICAgICAgIGlmICh2YWx1ZSA-IDY1NTM1KSB7CiAgICAgICAgICAgICAgdmFsdWUgLT0gNjU1MzY7CiAgICAgICAgICAgICAgb3V0cHV0ICs9IHN0cmluZ0Zyb21DaGFyQ29kZSh2YWx1ZSA-Pj4gMTAgJiAxMDIzIHwgNTUyOTYpOwogICAgICAgICAgICAgIHZhbHVlID0gNTYzMjAgfCB2YWx1ZSAmIDEwMjM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0ICs9IHN0cmluZ0Zyb21DaGFyQ29kZSh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiBvdXRwdXQ7CiAgICAgICAgICB9KS5qb2luKCIiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYmFzaWNUb0RpZ2l0KGNvZGVQb2ludCkgewogICAgICAgICAgaWYgKGNvZGVQb2ludCAtIDQ4IDwgMTApIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGVQb2ludCAtIDIyOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvZGVQb2ludCAtIDY1IDwgMjYpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGVQb2ludCAtIDY1OwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvZGVQb2ludCAtIDk3IDwgMjYpIHsKICAgICAgICAgICAgcmV0dXJuIGNvZGVQb2ludCAtIDk3OwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGJhc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGRpZ2l0VG9CYXNpYyhkaWdpdCwgZmxhZykgewogICAgICAgICAgcmV0dXJuIGRpZ2l0ICsgMjIgKyA3NSAqIChkaWdpdCA8IDI2KSAtICgoZmxhZyAhPSAwKSA8PCA1KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gYWRhcHQoZGVsdGEsIG51bVBvaW50cywgZmlyc3RUaW1lKSB7CiAgICAgICAgICB2YXIgayA9IDA7CiAgICAgICAgICBkZWx0YSA9IGZpcnN0VGltZSA_IGZsb29yKGRlbHRhIC8gZGFtcCkgOiBkZWx0YSA-PiAxOwogICAgICAgICAgZGVsdGEgKz0gZmxvb3IoZGVsdGEgLyBudW1Qb2ludHMpOwogICAgICAgICAgZm9yICg7IGRlbHRhID4gYmFzZU1pbnVzVE1pbiAqIHRNYXggPj4gMTsgayArPSBiYXNlKSB7CiAgICAgICAgICAgIGRlbHRhID0gZmxvb3IoZGVsdGEgLyBiYXNlTWludXNUTWluKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmbG9vcihrICsgKGJhc2VNaW51c1RNaW4gKyAxKSAqIGRlbHRhIC8gKGRlbHRhICsgc2tldykpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBkZWNvZGUoaW5wdXQpIHsKICAgICAgICAgIHZhciBvdXRwdXQgPSBbXSwgaW5wdXRMZW5ndGggPSBpbnB1dC5sZW5ndGgsIG91dCwgaSA9IDAsIG4gPSBpbml0aWFsTiwgYmlhcyA9IGluaXRpYWxCaWFzLCBiYXNpYywgaiwgaW5kZXgsIG9sZGksIHcsIGssIGRpZ2l0LCB0LCBiYXNlTWludXNUOwogICAgICAgICAgYmFzaWMgPSBpbnB1dC5sYXN0SW5kZXhPZihkZWxpbWl0ZXIpOwogICAgICAgICAgaWYgKGJhc2ljIDwgMCkgewogICAgICAgICAgICBiYXNpYyA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgYmFzaWM7ICsraikgewogICAgICAgICAgICBpZiAoaW5wdXQuY2hhckNvZGVBdChqKSA-PSAxMjgpIHsKICAgICAgICAgICAgICBlcnJvcigibm90LWJhc2ljIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb3V0cHV0LnB1c2goaW5wdXQuY2hhckNvZGVBdChqKSk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGluZGV4ID0gYmFzaWMgPiAwID8gYmFzaWMgKyAxIDogMDsgaW5kZXggPCBpbnB1dExlbmd0aDsgKSB7CiAgICAgICAgICAgIGZvciAob2xkaSA9IGksIHcgPSAxLCBrID0gYmFzZTsgOyBrICs9IGJhc2UpIHsKICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gaW5wdXRMZW5ndGgpIHsKICAgICAgICAgICAgICAgIGVycm9yKCJpbnZhbGlkLWlucHV0Iik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRpZ2l0ID0gYmFzaWNUb0RpZ2l0KGlucHV0LmNoYXJDb2RlQXQoaW5kZXgrKykpOwogICAgICAgICAgICAgIGlmIChkaWdpdCA-PSBiYXNlIHx8IGRpZ2l0ID4gZmxvb3IoKG1heEludCAtIGkpIC8gdykpIHsKICAgICAgICAgICAgICAgIGVycm9yKCJvdmVyZmxvdyIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpICs9IGRpZ2l0ICogdzsKICAgICAgICAgICAgICB0ID0gayA8PSBiaWFzID8gdE1pbiA6IGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXM7CiAgICAgICAgICAgICAgaWYgKGRpZ2l0IDwgdCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJhc2VNaW51c1QgPSBiYXNlIC0gdDsKICAgICAgICAgICAgICBpZiAodyA-IGZsb29yKG1heEludCAvIGJhc2VNaW51c1QpKSB7CiAgICAgICAgICAgICAgICBlcnJvcigib3ZlcmZsb3ciKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdyAqPSBiYXNlTWludXNUOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG91dCA9IG91dHB1dC5sZW5ndGggKyAxOwogICAgICAgICAgICBiaWFzID0gYWRhcHQoaSAtIG9sZGksIG91dCwgb2xkaSA9PSAwKTsKICAgICAgICAgICAgaWYgKGZsb29yKGkgLyBvdXQpID4gbWF4SW50IC0gbikgewogICAgICAgICAgICAgIGVycm9yKCJvdmVyZmxvdyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG4gKz0gZmxvb3IoaSAvIG91dCk7CiAgICAgICAgICAgIGkgJT0gb3V0OwogICAgICAgICAgICBvdXRwdXQuc3BsaWNlKGkrKywgMCwgbik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdWNzMmVuY29kZShvdXRwdXQpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBlbmNvZGUoaW5wdXQpIHsKICAgICAgICAgIHZhciBuLCBkZWx0YSwgaGFuZGxlZENQQ291bnQsIGJhc2ljTGVuZ3RoLCBiaWFzLCBqLCBtLCBxLCBrLCB0LCBjdXJyZW50VmFsdWUsIG91dHB1dCA9IFtdLCBpbnB1dExlbmd0aCwgaGFuZGxlZENQQ291bnRQbHVzT25lLCBiYXNlTWludXNULCBxTWludXNUOwogICAgICAgICAgaW5wdXQgPSB1Y3MyZGVjb2RlKGlucHV0KTsKICAgICAgICAgIGlucHV0TGVuZ3RoID0gaW5wdXQubGVuZ3RoOwogICAgICAgICAgbiA9IGluaXRpYWxOOwogICAgICAgICAgZGVsdGEgPSAwOwogICAgICAgICAgYmlhcyA9IGluaXRpYWxCaWFzOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IGlucHV0TGVuZ3RoOyArK2opIHsKICAgICAgICAgICAgY3VycmVudFZhbHVlID0gaW5wdXRbal07CiAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPCAxMjgpIHsKICAgICAgICAgICAgICBvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoY3VycmVudFZhbHVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGhhbmRsZWRDUENvdW50ID0gYmFzaWNMZW5ndGggPSBvdXRwdXQubGVuZ3RoOwogICAgICAgICAgaWYgKGJhc2ljTGVuZ3RoKSB7CiAgICAgICAgICAgIG91dHB1dC5wdXNoKGRlbGltaXRlcik7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoaGFuZGxlZENQQ291bnQgPCBpbnB1dExlbmd0aCkgewogICAgICAgICAgICBmb3IgKG0gPSBtYXhJbnQsIGogPSAwOyBqIDwgaW5wdXRMZW5ndGg7ICsraikgewogICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IGlucHV0W2pdOwogICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPj0gbiAmJiBjdXJyZW50VmFsdWUgPCBtKSB7CiAgICAgICAgICAgICAgICBtID0gY3VycmVudFZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBoYW5kbGVkQ1BDb3VudFBsdXNPbmUgPSBoYW5kbGVkQ1BDb3VudCArIDE7CiAgICAgICAgICAgIGlmIChtIC0gbiA-IGZsb29yKChtYXhJbnQgLSBkZWx0YSkgLyBoYW5kbGVkQ1BDb3VudFBsdXNPbmUpKSB7CiAgICAgICAgICAgICAgZXJyb3IoIm92ZXJmbG93Iik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsdGEgKz0gKG0gLSBuKSAqIGhhbmRsZWRDUENvdW50UGx1c09uZTsKICAgICAgICAgICAgbiA9IG07CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBpbnB1dExlbmd0aDsgKytqKSB7CiAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gaW5wdXRbal07CiAgICAgICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZSA8IG4gJiYgKytkZWx0YSA-IG1heEludCkgewogICAgICAgICAgICAgICAgZXJyb3IoIm92ZXJmbG93Iik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPT0gbikgewogICAgICAgICAgICAgICAgZm9yIChxID0gZGVsdGEsIGsgPSBiYXNlOyA7IGsgKz0gYmFzZSkgewogICAgICAgICAgICAgICAgICB0ID0gayA8PSBiaWFzID8gdE1pbiA6IGsgPj0gYmlhcyArIHRNYXggPyB0TWF4IDogayAtIGJpYXM7CiAgICAgICAgICAgICAgICAgIGlmIChxIDwgdCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHFNaW51c1QgPSBxIC0gdDsKICAgICAgICAgICAgICAgICAgYmFzZU1pbnVzVCA9IGJhc2UgLSB0OwogICAgICAgICAgICAgICAgICBvdXRwdXQucHVzaCgKICAgICAgICAgICAgICAgICAgICBzdHJpbmdGcm9tQ2hhckNvZGUoZGlnaXRUb0Jhc2ljKHQgKyBxTWludXNUICUgYmFzZU1pbnVzVCwgMCkpCiAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgIHEgPSBmbG9vcihxTWludXNUIC8gYmFzZU1pbnVzVCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvdXRwdXQucHVzaChzdHJpbmdGcm9tQ2hhckNvZGUoZGlnaXRUb0Jhc2ljKHEsIDApKSk7CiAgICAgICAgICAgICAgICBiaWFzID0gYWRhcHQoZGVsdGEsIGhhbmRsZWRDUENvdW50UGx1c09uZSwgaGFuZGxlZENQQ291bnQgPT0gYmFzaWNMZW5ndGgpOwogICAgICAgICAgICAgICAgZGVsdGEgPSAwOwogICAgICAgICAgICAgICAgKytoYW5kbGVkQ1BDb3VudDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKytkZWx0YTsKICAgICAgICAgICAgKytuOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG91dHB1dC5qb2luKCIiKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdG9Vbmljb2RlKGlucHV0KSB7CiAgICAgICAgICByZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHJlZ2V4UHVueWNvZGUudGVzdChzdHJpbmcpID8gZGVjb2RlKHN0cmluZy5zbGljZSg0KS50b0xvd2VyQ2FzZSgpKSA6IHN0cmluZzsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiB0b0FTQ0lJKGlucHV0KSB7CiAgICAgICAgICByZXR1cm4gbWFwRG9tYWluKGlucHV0LCBmdW5jdGlvbihzdHJpbmcpIHsKICAgICAgICAgICAgcmV0dXJuIHJlZ2V4Tm9uQVNDSUkudGVzdChzdHJpbmcpID8gInhuLS0iICsgZW5jb2RlKHN0cmluZykgOiBzdHJpbmc7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcHVueWNvZGUgPSB7CiAgICAgICAgICAidmVyc2lvbiI6ICIxLjMuMiIsCiAgICAgICAgICAidWNzMiI6IHsKICAgICAgICAgICAgImRlY29kZSI6IHVjczJkZWNvZGUsCiAgICAgICAgICAgICJlbmNvZGUiOiB1Y3MyZW5jb2RlCiAgICAgICAgICB9LAogICAgICAgICAgImRlY29kZSI6IGRlY29kZSwKICAgICAgICAgICJlbmNvZGUiOiBlbmNvZGUsCiAgICAgICAgICAidG9BU0NJSSI6IHRvQVNDSUksCiAgICAgICAgICAidG9Vbmljb2RlIjogdG9Vbmljb2RlCiAgICAgICAgfTsKICAgICAgICBpZiAodHlwZW9mIGRlZmluZSA9PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBkZWZpbmUuYW1kID09ICJvYmplY3QiICYmIGRlZmluZS5hbWQpIHsKICAgICAgICAgIGRlZmluZSgicHVueWNvZGUiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHB1bnljb2RlOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmIChmcmVlRXhwb3J0cyAmJiBmcmVlTW9kdWxlKSB7CiAgICAgICAgICBpZiAobW9kdWxlLmV4cG9ydHMgPT0gZnJlZUV4cG9ydHMpIHsKICAgICAgICAgICAgZnJlZU1vZHVsZS5leHBvcnRzID0gcHVueWNvZGU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGtleSBpbiBwdW55Y29kZSkgewogICAgICAgICAgICAgIHB1bnljb2RlLmhhc093blByb3BlcnR5KGtleSkgJiYgKGZyZWVFeHBvcnRzW2tleV0gPSBwdW55Y29kZVtrZXldKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByb290LnB1bnljb2RlID0gcHVueWNvZGU7CiAgICAgICAgfQogICAgICB9KShleHBvcnRzKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3VybC91dGlsLmpzCiAgdmFyIHJlcXVpcmVfdXRpbCA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy91cmwvdXRpbC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7CiAgICAgICAgaXNTdHJpbmc6IGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICJzdHJpbmciOwogICAgICAgIH0sCiAgICAgICAgaXNPYmplY3Q6IGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBhcmcgPT09ICJvYmplY3QiICYmIGFyZyAhPT0gbnVsbDsKICAgICAgICB9LAogICAgICAgIGlzTnVsbDogZnVuY3Rpb24oYXJnKSB7CiAgICAgICAgICByZXR1cm4gYXJnID09PSBudWxsOwogICAgICAgIH0sCiAgICAgICAgaXNOdWxsT3JVbmRlZmluZWQ6IGZ1bmN0aW9uKGFyZykgewogICAgICAgICAgcmV0dXJuIGFyZyA9PSBudWxsOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3F1ZXJ5c3RyaW5nL2RlY29kZS5qcwogIHZhciByZXF1aXJlX2RlY29kZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9xdWVyeXN0cmluZy9kZWNvZGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIGZ1bmN0aW9uIGhhc093blByb3BlcnR5KG9iaiwgcHJvcCkgewogICAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsKICAgICAgfQogICAgICBtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHFzLCBzZXAsIGVxLCBvcHRpb25zKSB7CiAgICAgICAgc2VwID0gc2VwIHx8ICImIjsKICAgICAgICBlcSA9IGVxIHx8ICI9IjsKICAgICAgICB2YXIgb2JqID0ge307CiAgICAgICAgaWYgKHR5cGVvZiBxcyAhPT0gInN0cmluZyIgfHwgcXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgICAgICB2YXIgcmVnZXhwID0gL1wrL2c7CiAgICAgICAgcXMgPSBxcy5zcGxpdChzZXApOwogICAgICAgIHZhciBtYXhLZXlzID0gMWUzOwogICAgICAgIGlmIChvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zLm1heEtleXMgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICBtYXhLZXlzID0gb3B0aW9ucy5tYXhLZXlzOwogICAgICAgIH0KICAgICAgICB2YXIgbGVuID0gcXMubGVuZ3RoOwogICAgICAgIGlmIChtYXhLZXlzID4gMCAmJiBsZW4gPiBtYXhLZXlzKSB7CiAgICAgICAgICBsZW4gPSBtYXhLZXlzOwogICAgICAgIH0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7CiAgICAgICAgICB2YXIgeCA9IHFzW2ldLnJlcGxhY2UocmVnZXhwLCAiJTIwIiksIGlkeCA9IHguaW5kZXhPZihlcSksIGtzdHIsIHZzdHIsIGssIHY7CiAgICAgICAgICBpZiAoaWR4ID49IDApIHsKICAgICAgICAgICAga3N0ciA9IHguc3Vic3RyKDAsIGlkeCk7CiAgICAgICAgICAgIHZzdHIgPSB4LnN1YnN0cihpZHggKyAxKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGtzdHIgPSB4OwogICAgICAgICAgICB2c3RyID0gIiI7CiAgICAgICAgICB9CiAgICAgICAgICBrID0gZGVjb2RlVVJJQ29tcG9uZW50KGtzdHIpOwogICAgICAgICAgdiA9IGRlY29kZVVSSUNvbXBvbmVudCh2c3RyKTsKICAgICAgICAgIGlmICghaGFzT3duUHJvcGVydHkob2JqLCBrKSkgewogICAgICAgICAgICBvYmpba10gPSB2OwogICAgICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9ialtrXSkpIHsKICAgICAgICAgICAgb2JqW2tdLnB1c2godik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvYmpba10gPSBbb2JqW2tdLCB2XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3F1ZXJ5c3RyaW5nL2VuY29kZS5qcwogIHZhciByZXF1aXJlX2VuY29kZSA9IF9fY29tbW9uSlMoewogICAgIm5vZGVfbW9kdWxlcy9xdWVyeXN0cmluZy9lbmNvZGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBzdHJpbmdpZnlQcmltaXRpdmUgPSBmdW5jdGlvbih2KSB7CiAgICAgICAgc3dpdGNoICh0eXBlb2YgdikgewogICAgICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICAgICAgcmV0dXJuIHY7CiAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgcmV0dXJuIHYgPyAidHJ1ZSIgOiAiZmFsc2UiOwogICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgcmV0dXJuIGlzRmluaXRlKHYpID8gdiA6ICIiOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIH0KICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihvYmosIHNlcCwgZXEsIG5hbWUpIHsKICAgICAgICBzZXAgPSBzZXAgfHwgIiYiOwogICAgICAgIGVxID0gZXEgfHwgIj0iOwogICAgICAgIGlmIChvYmogPT09IG51bGwpIHsKICAgICAgICAgIG9iaiA9IHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBvYmogPT09ICJvYmplY3QiKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5tYXAoZnVuY3Rpb24oaykgewogICAgICAgICAgICB2YXIga3MgPSBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKGspKSArIGVxOwogICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmpba10pKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG9ialtrXS5tYXAoZnVuY3Rpb24odikgewogICAgICAgICAgICAgICAgcmV0dXJuIGtzICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZSh2KSk7CiAgICAgICAgICAgICAgfSkuam9pbihzZXApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJldHVybiBrcyArIGVuY29kZVVSSUNvbXBvbmVudChzdHJpbmdpZnlQcmltaXRpdmUob2JqW2tdKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pLmpvaW4oc2VwKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFuYW1lKQogICAgICAgICAgcmV0dXJuICIiOwogICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQoc3RyaW5naWZ5UHJpbWl0aXZlKG5hbWUpKSArIGVxICsgZW5jb2RlVVJJQ29tcG9uZW50KHN0cmluZ2lmeVByaW1pdGl2ZShvYmopKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3F1ZXJ5c3RyaW5nL2luZGV4LmpzCiAgdmFyIHJlcXVpcmVfcXVlcnlzdHJpbmcgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvcXVlcnlzdHJpbmcvaW5kZXguanMiKGV4cG9ydHMpIHsKICAgICAgInVzZSBzdHJpY3QiOwogICAgICBleHBvcnRzLmRlY29kZSA9IGV4cG9ydHMucGFyc2UgPSByZXF1aXJlX2RlY29kZSgpOwogICAgICBleHBvcnRzLmVuY29kZSA9IGV4cG9ydHMuc3RyaW5naWZ5ID0gcmVxdWlyZV9lbmNvZGUoKTsKICAgIH0KICB9KTsKCiAgLy8gbm9kZV9tb2R1bGVzL3VybC91cmwuanMKICB2YXIgcmVxdWlyZV91cmwgPSBfX2NvbW1vbkpTKHsKICAgICJub2RlX21vZHVsZXMvdXJsL3VybC5qcyIoZXhwb3J0cykgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBwdW55Y29kZSA9IHJlcXVpcmVfcHVueWNvZGUoKTsKICAgICAgdmFyIHV0aWwgPSByZXF1aXJlX3V0aWwoKTsKICAgICAgZXhwb3J0cy5wYXJzZSA9IHVybFBhcnNlOwogICAgICBleHBvcnRzLnJlc29sdmUgPSB1cmxSZXNvbHZlOwogICAgICBleHBvcnRzLnJlc29sdmVPYmplY3QgPSB1cmxSZXNvbHZlT2JqZWN0OwogICAgICBleHBvcnRzLmZvcm1hdCA9IHVybEZvcm1hdDsKICAgICAgZXhwb3J0cy5VcmwgPSBVcmw7CiAgICAgIGZ1bmN0aW9uIFVybCgpIHsKICAgICAgICB0aGlzLnByb3RvY29sID0gbnVsbDsKICAgICAgICB0aGlzLnNsYXNoZXMgPSBudWxsOwogICAgICAgIHRoaXMuYXV0aCA9IG51bGw7CiAgICAgICAgdGhpcy5ob3N0ID0gbnVsbDsKICAgICAgICB0aGlzLnBvcnQgPSBudWxsOwogICAgICAgIHRoaXMuaG9zdG5hbWUgPSBudWxsOwogICAgICAgIHRoaXMuaGFzaCA9IG51bGw7CiAgICAgICAgdGhpcy5zZWFyY2ggPSBudWxsOwogICAgICAgIHRoaXMucXVlcnkgPSBudWxsOwogICAgICAgIHRoaXMucGF0aG5hbWUgPSBudWxsOwogICAgICAgIHRoaXMucGF0aCA9IG51bGw7CiAgICAgICAgdGhpcy5ocmVmID0gbnVsbDsKICAgICAgfQogICAgICB2YXIgcHJvdG9jb2xQYXR0ZXJuID0gL14oW2EtejAtOS4rLV0rOikvaTsKICAgICAgdmFyIHBvcnRQYXR0ZXJuID0gLzpbMC05XSokLzsKICAgICAgdmFyIHNpbXBsZVBhdGhQYXR0ZXJuID0gL14oXC9cLz8oPyFcLylbXlw_XHNdKikoXD9bXlxzXSopPyQvOwogICAgICB2YXIgZGVsaW1zID0gWyI8IiwgIj4iLCAnIicsICJgIiwgIiAiLCAiXHIiLCAiXG4iLCAiCSJdOwogICAgICB2YXIgdW53aXNlID0gWyJ7IiwgIn0iLCAifCIsICJcXCIsICJeIiwgImAiXS5jb25jYXQoZGVsaW1zKTsKICAgICAgdmFyIGF1dG9Fc2NhcGUgPSBbIiciXS5jb25jYXQodW53aXNlKTsKICAgICAgdmFyIG5vbkhvc3RDaGFycyA9IFsiJSIsICIvIiwgIj8iLCAiOyIsICIjIl0uY29uY2F0KGF1dG9Fc2NhcGUpOwogICAgICB2YXIgaG9zdEVuZGluZ0NoYXJzID0gWyIvIiwgIj8iLCAiIyJdOwogICAgICB2YXIgaG9zdG5hbWVNYXhMZW4gPSAyNTU7CiAgICAgIHZhciBob3N0bmFtZVBhcnRQYXR0ZXJuID0gL15bK2EtejAtOUEtWl8tXXswLDYzfSQvOwogICAgICB2YXIgaG9zdG5hbWVQYXJ0U3RhcnQgPSAvXihbK2EtejAtOUEtWl8tXXswLDYzfSkoLiopJC87CiAgICAgIHZhciB1bnNhZmVQcm90b2NvbCA9IHsKICAgICAgICAiamF2YXNjcmlwdCI6IHRydWUsCiAgICAgICAgImphdmFzY3JpcHQ6IjogdHJ1ZQogICAgICB9OwogICAgICB2YXIgaG9zdGxlc3NQcm90b2NvbCA9IHsKICAgICAgICAiamF2YXNjcmlwdCI6IHRydWUsCiAgICAgICAgImphdmFzY3JpcHQ6IjogdHJ1ZQogICAgICB9OwogICAgICB2YXIgc2xhc2hlZFByb3RvY29sID0gewogICAgICAgICJodHRwIjogdHJ1ZSwKICAgICAgICAiaHR0cHMiOiB0cnVlLAogICAgICAgICJmdHAiOiB0cnVlLAogICAgICAgICJnb3BoZXIiOiB0cnVlLAogICAgICAgICJmaWxlIjogdHJ1ZSwKICAgICAgICAiaHR0cDoiOiB0cnVlLAogICAgICAgICJodHRwczoiOiB0cnVlLAogICAgICAgICJmdHA6IjogdHJ1ZSwKICAgICAgICAiZ29waGVyOiI6IHRydWUsCiAgICAgICAgImZpbGU6IjogdHJ1ZQogICAgICB9OwogICAgICB2YXIgcXVlcnlzdHJpbmcgPSByZXF1aXJlX3F1ZXJ5c3RyaW5nKCk7CiAgICAgIGZ1bmN0aW9uIHVybFBhcnNlKHVybCwgcGFyc2VRdWVyeVN0cmluZywgc2xhc2hlc0Rlbm90ZUhvc3QpIHsKICAgICAgICBpZiAodXJsICYmIHV0aWwuaXNPYmplY3QodXJsKSAmJiB1cmwgaW5zdGFuY2VvZiBVcmwpCiAgICAgICAgICByZXR1cm4gdXJsOwogICAgICAgIHZhciB1ID0gbmV3IFVybCgpOwogICAgICAgIHUucGFyc2UodXJsLCBwYXJzZVF1ZXJ5U3RyaW5nLCBzbGFzaGVzRGVub3RlSG9zdCk7CiAgICAgICAgcmV0dXJuIHU7CiAgICAgIH0KICAgICAgVXJsLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uKHVybCwgcGFyc2VRdWVyeVN0cmluZywgc2xhc2hlc0Rlbm90ZUhvc3QpIHsKICAgICAgICBpZiAoIXV0aWwuaXNTdHJpbmcodXJsKSkgewogICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiUGFyYW1ldGVyICd1cmwnIG11c3QgYmUgYSBzdHJpbmcsIG5vdCAiICsgdHlwZW9mIHVybCk7CiAgICAgICAgfQogICAgICAgIHZhciBxdWVyeUluZGV4ID0gdXJsLmluZGV4T2YoIj8iKSwgc3BsaXR0ZXIgPSBxdWVyeUluZGV4ICE9PSAtMSAmJiBxdWVyeUluZGV4IDwgdXJsLmluZGV4T2YoIiMiKSA_ICI_IiA6ICIjIiwgdVNwbGl0ID0gdXJsLnNwbGl0KHNwbGl0dGVyKSwgc2xhc2hSZWdleCA9IC9cXC9nOwogICAgICAgIHVTcGxpdFswXSA9IHVTcGxpdFswXS5yZXBsYWNlKHNsYXNoUmVnZXgsICIvIik7CiAgICAgICAgdXJsID0gdVNwbGl0LmpvaW4oc3BsaXR0ZXIpOwogICAgICAgIHZhciByZXN0ID0gdXJsOwogICAgICAgIHJlc3QgPSByZXN0LnRyaW0oKTsKICAgICAgICBpZiAoIXNsYXNoZXNEZW5vdGVIb3N0ICYmIHVybC5zcGxpdCgiIyIpLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgdmFyIHNpbXBsZVBhdGggPSBzaW1wbGVQYXRoUGF0dGVybi5leGVjKHJlc3QpOwogICAgICAgICAgaWYgKHNpbXBsZVBhdGgpIHsKICAgICAgICAgICAgdGhpcy5wYXRoID0gcmVzdDsKICAgICAgICAgICAgdGhpcy5ocmVmID0gcmVzdDsKICAgICAgICAgICAgdGhpcy5wYXRobmFtZSA9IHNpbXBsZVBhdGhbMV07CiAgICAgICAgICAgIGlmIChzaW1wbGVQYXRoWzJdKSB7CiAgICAgICAgICAgICAgdGhpcy5zZWFyY2ggPSBzaW1wbGVQYXRoWzJdOwogICAgICAgICAgICAgIGlmIChwYXJzZVF1ZXJ5U3RyaW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnF1ZXJ5ID0gcXVlcnlzdHJpbmcucGFyc2UodGhpcy5zZWFyY2guc3Vic3RyKDEpKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHRoaXMuc2VhcmNoLnN1YnN0cigxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGFyc2VRdWVyeVN0cmluZykgewogICAgICAgICAgICAgIHRoaXMuc2VhcmNoID0gIiI7CiAgICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHt9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgcHJvdG8gPSBwcm90b2NvbFBhdHRlcm4uZXhlYyhyZXN0KTsKICAgICAgICBpZiAocHJvdG8pIHsKICAgICAgICAgIHByb3RvID0gcHJvdG9bMF07CiAgICAgICAgICB2YXIgbG93ZXJQcm90byA9IHByb3RvLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICB0aGlzLnByb3RvY29sID0gbG93ZXJQcm90bzsKICAgICAgICAgIHJlc3QgPSByZXN0LnN1YnN0cihwcm90by5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBpZiAoc2xhc2hlc0Rlbm90ZUhvc3QgfHwgcHJvdG8gfHwgcmVzdC5tYXRjaCgvXlwvXC9bXkBcL10rQFteQFwvXSsvKSkgewogICAgICAgICAgdmFyIHNsYXNoZXMgPSByZXN0LnN1YnN0cigwLCAyKSA9PT0gIi8vIjsKICAgICAgICAgIGlmIChzbGFzaGVzICYmICEocHJvdG8gJiYgaG9zdGxlc3NQcm90b2NvbFtwcm90b10pKSB7CiAgICAgICAgICAgIHJlc3QgPSByZXN0LnN1YnN0cigyKTsKICAgICAgICAgICAgdGhpcy5zbGFzaGVzID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFob3N0bGVzc1Byb3RvY29sW3Byb3RvXSAmJiAoc2xhc2hlcyB8fCBwcm90byAmJiAhc2xhc2hlZFByb3RvY29sW3Byb3RvXSkpIHsKICAgICAgICAgIHZhciBob3N0RW5kID0gLTE7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhvc3RFbmRpbmdDaGFycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgaGVjID0gcmVzdC5pbmRleE9mKGhvc3RFbmRpbmdDaGFyc1tpXSk7CiAgICAgICAgICAgIGlmIChoZWMgIT09IC0xICYmIChob3N0RW5kID09PSAtMSB8fCBoZWMgPCBob3N0RW5kKSkKICAgICAgICAgICAgICBob3N0RW5kID0gaGVjOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGF1dGgsIGF0U2lnbjsKICAgICAgICAgIGlmIChob3N0RW5kID09PSAtMSkgewogICAgICAgICAgICBhdFNpZ24gPSByZXN0Lmxhc3RJbmRleE9mKCJAIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhdFNpZ24gPSByZXN0Lmxhc3RJbmRleE9mKCJAIiwgaG9zdEVuZCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXRTaWduICE9PSAtMSkgewogICAgICAgICAgICBhdXRoID0gcmVzdC5zbGljZSgwLCBhdFNpZ24pOwogICAgICAgICAgICByZXN0ID0gcmVzdC5zbGljZShhdFNpZ24gKyAxKTsKICAgICAgICAgICAgdGhpcy5hdXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KGF1dGgpOwogICAgICAgICAgfQogICAgICAgICAgaG9zdEVuZCA9IC0xOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub25Ib3N0Q2hhcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGhlYyA9IHJlc3QuaW5kZXhPZihub25Ib3N0Q2hhcnNbaV0pOwogICAgICAgICAgICBpZiAoaGVjICE9PSAtMSAmJiAoaG9zdEVuZCA9PT0gLTEgfHwgaGVjIDwgaG9zdEVuZCkpCiAgICAgICAgICAgICAgaG9zdEVuZCA9IGhlYzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChob3N0RW5kID09PSAtMSkKICAgICAgICAgICAgaG9zdEVuZCA9IHJlc3QubGVuZ3RoOwogICAgICAgICAgdGhpcy5ob3N0ID0gcmVzdC5zbGljZSgwLCBob3N0RW5kKTsKICAgICAgICAgIHJlc3QgPSByZXN0LnNsaWNlKGhvc3RFbmQpOwogICAgICAgICAgdGhpcy5wYXJzZUhvc3QoKTsKICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSB0aGlzLmhvc3RuYW1lIHx8ICIiOwogICAgICAgICAgdmFyIGlwdjZIb3N0bmFtZSA9IHRoaXMuaG9zdG5hbWVbMF0gPT09ICJbIiAmJiB0aGlzLmhvc3RuYW1lW3RoaXMuaG9zdG5hbWUubGVuZ3RoIC0gMV0gPT09ICJdIjsKICAgICAgICAgIGlmICghaXB2Nkhvc3RuYW1lKSB7CiAgICAgICAgICAgIHZhciBob3N0cGFydHMgPSB0aGlzLmhvc3RuYW1lLnNwbGl0KC9cLi8pOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGhvc3RwYXJ0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgICB2YXIgcGFydCA9IGhvc3RwYXJ0c1tpXTsKICAgICAgICAgICAgICBpZiAoIXBhcnQpCiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICBpZiAoIXBhcnQubWF0Y2goaG9zdG5hbWVQYXJ0UGF0dGVybikpIHsKICAgICAgICAgICAgICAgIHZhciBuZXdwYXJ0ID0gIiI7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgayA9IHBhcnQubGVuZ3RoOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0LmNoYXJDb2RlQXQoaikgPiAxMjcpIHsKICAgICAgICAgICAgICAgICAgICBuZXdwYXJ0ICs9ICJ4IjsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBuZXdwYXJ0ICs9IHBhcnRbal07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghbmV3cGFydC5tYXRjaChob3N0bmFtZVBhcnRQYXR0ZXJuKSkgewogICAgICAgICAgICAgICAgICB2YXIgdmFsaWRQYXJ0cyA9IGhvc3RwYXJ0cy5zbGljZSgwLCBpKTsKICAgICAgICAgICAgICAgICAgdmFyIG5vdEhvc3QgPSBob3N0cGFydHMuc2xpY2UoaSArIDEpOwogICAgICAgICAgICAgICAgICB2YXIgYml0ID0gcGFydC5tYXRjaChob3N0bmFtZVBhcnRTdGFydCk7CiAgICAgICAgICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZFBhcnRzLnB1c2goYml0WzFdKTsKICAgICAgICAgICAgICAgICAgICBub3RIb3N0LnVuc2hpZnQoYml0WzJdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAobm90SG9zdC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICByZXN0ID0gIi8iICsgbm90SG9zdC5qb2luKCIuIikgKyByZXN0OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMuaG9zdG5hbWUgPSB2YWxpZFBhcnRzLmpvaW4oIi4iKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5ob3N0bmFtZS5sZW5ndGggPiBob3N0bmFtZU1heExlbikgewogICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gIiI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gdGhpcy5ob3N0bmFtZS50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFpcHY2SG9zdG5hbWUpIHsKICAgICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IHB1bnljb2RlLnRvQVNDSUkodGhpcy5ob3N0bmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcCA9IHRoaXMucG9ydCA_ICI6IiArIHRoaXMucG9ydCA6ICIiOwogICAgICAgICAgdmFyIGggPSB0aGlzLmhvc3RuYW1lIHx8ICIiOwogICAgICAgICAgdGhpcy5ob3N0ID0gaCArIHA7CiAgICAgICAgICB0aGlzLmhyZWYgKz0gdGhpcy5ob3N0OwogICAgICAgICAgaWYgKGlwdjZIb3N0bmFtZSkgewogICAgICAgICAgICB0aGlzLmhvc3RuYW1lID0gdGhpcy5ob3N0bmFtZS5zdWJzdHIoMSwgdGhpcy5ob3N0bmFtZS5sZW5ndGggLSAyKTsKICAgICAgICAgICAgaWYgKHJlc3RbMF0gIT09ICIvIikgewogICAgICAgICAgICAgIHJlc3QgPSAiLyIgKyByZXN0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghdW5zYWZlUHJvdG9jb2xbbG93ZXJQcm90b10pIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gYXV0b0VzY2FwZS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICAgICAgdmFyIGFlID0gYXV0b0VzY2FwZVtpXTsKICAgICAgICAgICAgaWYgKHJlc3QuaW5kZXhPZihhZSkgPT09IC0xKQogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB2YXIgZXNjID0gZW5jb2RlVVJJQ29tcG9uZW50KGFlKTsKICAgICAgICAgICAgaWYgKGVzYyA9PT0gYWUpIHsKICAgICAgICAgICAgICBlc2MgPSBlc2NhcGUoYWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlc3QgPSByZXN0LnNwbGl0KGFlKS5qb2luKGVzYyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBoYXNoID0gcmVzdC5pbmRleE9mKCIjIik7CiAgICAgICAgaWYgKGhhc2ggIT09IC0xKSB7CiAgICAgICAgICB0aGlzLmhhc2ggPSByZXN0LnN1YnN0cihoYXNoKTsKICAgICAgICAgIHJlc3QgPSByZXN0LnNsaWNlKDAsIGhhc2gpOwogICAgICAgIH0KICAgICAgICB2YXIgcW0gPSByZXN0LmluZGV4T2YoIj8iKTsKICAgICAgICBpZiAocW0gIT09IC0xKSB7CiAgICAgICAgICB0aGlzLnNlYXJjaCA9IHJlc3Quc3Vic3RyKHFtKTsKICAgICAgICAgIHRoaXMucXVlcnkgPSByZXN0LnN1YnN0cihxbSArIDEpOwogICAgICAgICAgaWYgKHBhcnNlUXVlcnlTdHJpbmcpIHsKICAgICAgICAgICAgdGhpcy5xdWVyeSA9IHF1ZXJ5c3RyaW5nLnBhcnNlKHRoaXMucXVlcnkpOwogICAgICAgICAgfQogICAgICAgICAgcmVzdCA9IHJlc3Quc2xpY2UoMCwgcW0pOwogICAgICAgIH0gZWxzZSBpZiAocGFyc2VRdWVyeVN0cmluZykgewogICAgICAgICAgdGhpcy5zZWFyY2ggPSAiIjsKICAgICAgICAgIHRoaXMucXVlcnkgPSB7fTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlc3QpCiAgICAgICAgICB0aGlzLnBhdGhuYW1lID0gcmVzdDsKICAgICAgICBpZiAoc2xhc2hlZFByb3RvY29sW2xvd2VyUHJvdG9dICYmIHRoaXMuaG9zdG5hbWUgJiYgIXRoaXMucGF0aG5hbWUpIHsKICAgICAgICAgIHRoaXMucGF0aG5hbWUgPSAiLyI7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnBhdGhuYW1lIHx8IHRoaXMuc2VhcmNoKSB7CiAgICAgICAgICB2YXIgcCA9IHRoaXMucGF0aG5hbWUgfHwgIiI7CiAgICAgICAgICB2YXIgcyA9IHRoaXMuc2VhcmNoIHx8ICIiOwogICAgICAgICAgdGhpcy5wYXRoID0gcCArIHM7CiAgICAgICAgfQogICAgICAgIHRoaXMuaHJlZiA9IHRoaXMuZm9ybWF0KCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHVybEZvcm1hdChvYmopIHsKICAgICAgICBpZiAodXRpbC5pc1N0cmluZyhvYmopKQogICAgICAgICAgb2JqID0gdXJsUGFyc2Uob2JqKTsKICAgICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBVcmwpKQogICAgICAgICAgcmV0dXJuIFVybC5wcm90b3R5cGUuZm9ybWF0LmNhbGwob2JqKTsKICAgICAgICByZXR1cm4gb2JqLmZvcm1hdCgpOwogICAgICB9CiAgICAgIFVybC5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGF1dGggPSB0aGlzLmF1dGggfHwgIiI7CiAgICAgICAgaWYgKGF1dGgpIHsKICAgICAgICAgIGF1dGggPSBlbmNvZGVVUklDb21wb25lbnQoYXV0aCk7CiAgICAgICAgICBhdXRoID0gYXV0aC5yZXBsYWNlKC8lM0EvaSwgIjoiKTsKICAgICAgICAgIGF1dGggKz0gIkAiOwogICAgICAgIH0KICAgICAgICB2YXIgcHJvdG9jb2wgPSB0aGlzLnByb3RvY29sIHx8ICIiLCBwYXRobmFtZSA9IHRoaXMucGF0aG5hbWUgfHwgIiIsIGhhc2ggPSB0aGlzLmhhc2ggfHwgIiIsIGhvc3QgPSBmYWxzZSwgcXVlcnkgPSAiIjsKICAgICAgICBpZiAodGhpcy5ob3N0KSB7CiAgICAgICAgICBob3N0ID0gYXV0aCArIHRoaXMuaG9zdDsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaG9zdG5hbWUpIHsKICAgICAgICAgIGhvc3QgPSBhdXRoICsgKHRoaXMuaG9zdG5hbWUuaW5kZXhPZigiOiIpID09PSAtMSA_IHRoaXMuaG9zdG5hbWUgOiAiWyIgKyB0aGlzLmhvc3RuYW1lICsgIl0iKTsKICAgICAgICAgIGlmICh0aGlzLnBvcnQpIHsKICAgICAgICAgICAgaG9zdCArPSAiOiIgKyB0aGlzLnBvcnQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnF1ZXJ5ICYmIHV0aWwuaXNPYmplY3QodGhpcy5xdWVyeSkgJiYgT2JqZWN0LmtleXModGhpcy5xdWVyeSkubGVuZ3RoKSB7CiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5c3RyaW5nLnN0cmluZ2lmeSh0aGlzLnF1ZXJ5KTsKICAgICAgICB9CiAgICAgICAgdmFyIHNlYXJjaCA9IHRoaXMuc2VhcmNoIHx8IHF1ZXJ5ICYmICI_IiArIHF1ZXJ5IHx8ICIiOwogICAgICAgIGlmIChwcm90b2NvbCAmJiBwcm90b2NvbC5zdWJzdHIoLTEpICE9PSAiOiIpCiAgICAgICAgICBwcm90b2NvbCArPSAiOiI7CiAgICAgICAgaWYgKHRoaXMuc2xhc2hlcyB8fCAoIXByb3RvY29sIHx8IHNsYXNoZWRQcm90b2NvbFtwcm90b2NvbF0pICYmIGhvc3QgIT09IGZhbHNlKSB7CiAgICAgICAgICBob3N0ID0gIi8vIiArIChob3N0IHx8ICIiKTsKICAgICAgICAgIGlmIChwYXRobmFtZSAmJiBwYXRobmFtZS5jaGFyQXQoMCkgIT09ICIvIikKICAgICAgICAgICAgcGF0aG5hbWUgPSAiLyIgKyBwYXRobmFtZTsKICAgICAgICB9IGVsc2UgaWYgKCFob3N0KSB7CiAgICAgICAgICBob3N0ID0gIiI7CiAgICAgICAgfQogICAgICAgIGlmIChoYXNoICYmIGhhc2guY2hhckF0KDApICE9PSAiIyIpCiAgICAgICAgICBoYXNoID0gIiMiICsgaGFzaDsKICAgICAgICBpZiAoc2VhcmNoICYmIHNlYXJjaC5jaGFyQXQoMCkgIT09ICI_IikKICAgICAgICAgIHNlYXJjaCA9ICI_IiArIHNlYXJjaDsKICAgICAgICBwYXRobmFtZSA9IHBhdGhuYW1lLnJlcGxhY2UoL1s_I10vZywgZnVuY3Rpb24obWF0Y2gpIHsKICAgICAgICAgIHJldHVybiBlbmNvZGVVUklDb21wb25lbnQobWF0Y2gpOwogICAgICAgIH0pOwogICAgICAgIHNlYXJjaCA9IHNlYXJjaC5yZXBsYWNlKCIjIiwgIiUyMyIpOwogICAgICAgIHJldHVybiBwcm90b2NvbCArIGhvc3QgKyBwYXRobmFtZSArIHNlYXJjaCArIGhhc2g7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHVybFJlc29sdmUoc291cmNlLCByZWxhdGl2ZSkgewogICAgICAgIHJldHVybiB1cmxQYXJzZShzb3VyY2UsIGZhbHNlLCB0cnVlKS5yZXNvbHZlKHJlbGF0aXZlKTsKICAgICAgfQogICAgICBVcmwucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbihyZWxhdGl2ZSkgewogICAgICAgIHJldHVybiB0aGlzLnJlc29sdmVPYmplY3QodXJsUGFyc2UocmVsYXRpdmUsIGZhbHNlLCB0cnVlKSkuZm9ybWF0KCk7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHVybFJlc29sdmVPYmplY3Qoc291cmNlLCByZWxhdGl2ZSkgewogICAgICAgIGlmICghc291cmNlKQogICAgICAgICAgcmV0dXJuIHJlbGF0aXZlOwogICAgICAgIHJldHVybiB1cmxQYXJzZShzb3VyY2UsIGZhbHNlLCB0cnVlKS5yZXNvbHZlT2JqZWN0KHJlbGF0aXZlKTsKICAgICAgfQogICAgICBVcmwucHJvdG90eXBlLnJlc29sdmVPYmplY3QgPSBmdW5jdGlvbihyZWxhdGl2ZSkgewogICAgICAgIGlmICh1dGlsLmlzU3RyaW5nKHJlbGF0aXZlKSkgewogICAgICAgICAgdmFyIHJlbCA9IG5ldyBVcmwoKTsKICAgICAgICAgIHJlbC5wYXJzZShyZWxhdGl2ZSwgZmFsc2UsIHRydWUpOwogICAgICAgICAgcmVsYXRpdmUgPSByZWw7CiAgICAgICAgfQogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVXJsKCk7CiAgICAgICAgdmFyIHRrZXlzID0gT2JqZWN0LmtleXModGhpcyk7CiAgICAgICAgZm9yICh2YXIgdGsgPSAwOyB0ayA8IHRrZXlzLmxlbmd0aDsgdGsrKykgewogICAgICAgICAgdmFyIHRrZXkgPSB0a2V5c1t0a107CiAgICAgICAgICByZXN1bHRbdGtleV0gPSB0aGlzW3RrZXldOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaGFzaCA9IHJlbGF0aXZlLmhhc2g7CiAgICAgICAgaWYgKHJlbGF0aXZlLmhyZWYgPT09ICIiKSB7CiAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGlmIChyZWxhdGl2ZS5zbGFzaGVzICYmICFyZWxhdGl2ZS5wcm90b2NvbCkgewogICAgICAgICAgdmFyIHJrZXlzID0gT2JqZWN0LmtleXMocmVsYXRpdmUpOwogICAgICAgICAgZm9yICh2YXIgcmsgPSAwOyByayA8IHJrZXlzLmxlbmd0aDsgcmsrKykgewogICAgICAgICAgICB2YXIgcmtleSA9IHJrZXlzW3JrXTsKICAgICAgICAgICAgaWYgKHJrZXkgIT09ICJwcm90b2NvbCIpCiAgICAgICAgICAgICAgcmVzdWx0W3JrZXldID0gcmVsYXRpdmVbcmtleV07CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc2xhc2hlZFByb3RvY29sW3Jlc3VsdC5wcm90b2NvbF0gJiYgcmVzdWx0Lmhvc3RuYW1lICYmICFyZXN1bHQucGF0aG5hbWUpIHsKICAgICAgICAgICAgcmVzdWx0LnBhdGggPSByZXN1bHQucGF0aG5hbWUgPSAiLyI7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGlmIChyZWxhdGl2ZS5wcm90b2NvbCAmJiByZWxhdGl2ZS5wcm90b2NvbCAhPT0gcmVzdWx0LnByb3RvY29sKSB7CiAgICAgICAgICBpZiAoIXNsYXNoZWRQcm90b2NvbFtyZWxhdGl2ZS5wcm90b2NvbF0pIHsKICAgICAgICAgICAgdmFyIGtleXM0ID0gT2JqZWN0LmtleXMocmVsYXRpdmUpOwogICAgICAgICAgICBmb3IgKHZhciB2ID0gMDsgdiA8IGtleXM0Lmxlbmd0aDsgdisrKSB7CiAgICAgICAgICAgICAgdmFyIGsgPSBrZXlzNFt2XTsKICAgICAgICAgICAgICByZXN1bHRba10gPSByZWxhdGl2ZVtrXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdC5wcm90b2NvbCA9IHJlbGF0aXZlLnByb3RvY29sOwogICAgICAgICAgaWYgKCFyZWxhdGl2ZS5ob3N0ICYmICFob3N0bGVzc1Byb3RvY29sW3JlbGF0aXZlLnByb3RvY29sXSkgewogICAgICAgICAgICB2YXIgcmVsUGF0aCA9IChyZWxhdGl2ZS5wYXRobmFtZSB8fCAiIikuc3BsaXQoIi8iKTsKICAgICAgICAgICAgd2hpbGUgKHJlbFBhdGgubGVuZ3RoICYmICEocmVsYXRpdmUuaG9zdCA9IHJlbFBhdGguc2hpZnQoKSkpCiAgICAgICAgICAgICAgOwogICAgICAgICAgICBpZiAoIXJlbGF0aXZlLmhvc3QpCiAgICAgICAgICAgICAgcmVsYXRpdmUuaG9zdCA9ICIiOwogICAgICAgICAgICBpZiAoIXJlbGF0aXZlLmhvc3RuYW1lKQogICAgICAgICAgICAgIHJlbGF0aXZlLmhvc3RuYW1lID0gIiI7CiAgICAgICAgICAgIGlmIChyZWxQYXRoWzBdICE9PSAiIikKICAgICAgICAgICAgICByZWxQYXRoLnVuc2hpZnQoIiIpOwogICAgICAgICAgICBpZiAocmVsUGF0aC5sZW5ndGggPCAyKQogICAgICAgICAgICAgIHJlbFBhdGgudW5zaGlmdCgiIik7CiAgICAgICAgICAgIHJlc3VsdC5wYXRobmFtZSA9IHJlbFBhdGguam9pbigiLyIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0LnBhdGhuYW1lID0gcmVsYXRpdmUucGF0aG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuc2VhcmNoID0gcmVsYXRpdmUuc2VhcmNoOwogICAgICAgICAgcmVzdWx0LnF1ZXJ5ID0gcmVsYXRpdmUucXVlcnk7CiAgICAgICAgICByZXN1bHQuaG9zdCA9IHJlbGF0aXZlLmhvc3QgfHwgIiI7CiAgICAgICAgICByZXN1bHQuYXV0aCA9IHJlbGF0aXZlLmF1dGg7CiAgICAgICAgICByZXN1bHQuaG9zdG5hbWUgPSByZWxhdGl2ZS5ob3N0bmFtZSB8fCByZWxhdGl2ZS5ob3N0OwogICAgICAgICAgcmVzdWx0LnBvcnQgPSByZWxhdGl2ZS5wb3J0OwogICAgICAgICAgaWYgKHJlc3VsdC5wYXRobmFtZSB8fCByZXN1bHQuc2VhcmNoKSB7CiAgICAgICAgICAgIHZhciBwID0gcmVzdWx0LnBhdGhuYW1lIHx8ICIiOwogICAgICAgICAgICB2YXIgcyA9IHJlc3VsdC5zZWFyY2ggfHwgIiI7CiAgICAgICAgICAgIHJlc3VsdC5wYXRoID0gcCArIHM7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuc2xhc2hlcyA9IHJlc3VsdC5zbGFzaGVzIHx8IHJlbGF0aXZlLnNsYXNoZXM7CiAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBpc1NvdXJjZUFicyA9IHJlc3VsdC5wYXRobmFtZSAmJiByZXN1bHQucGF0aG5hbWUuY2hhckF0KDApID09PSAiLyIsIGlzUmVsQWJzID0gcmVsYXRpdmUuaG9zdCB8fCByZWxhdGl2ZS5wYXRobmFtZSAmJiByZWxhdGl2ZS5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgbXVzdEVuZEFicyA9IGlzUmVsQWJzIHx8IGlzU291cmNlQWJzIHx8IHJlc3VsdC5ob3N0ICYmIHJlbGF0aXZlLnBhdGhuYW1lLCByZW1vdmVBbGxEb3RzID0gbXVzdEVuZEFicywgc3JjUGF0aCA9IHJlc3VsdC5wYXRobmFtZSAmJiByZXN1bHQucGF0aG5hbWUuc3BsaXQoIi8iKSB8fCBbXSwgcmVsUGF0aCA9IHJlbGF0aXZlLnBhdGhuYW1lICYmIHJlbGF0aXZlLnBhdGhuYW1lLnNwbGl0KCIvIikgfHwgW10sIHBzeWNob3RpYyA9IHJlc3VsdC5wcm90b2NvbCAmJiAhc2xhc2hlZFByb3RvY29sW3Jlc3VsdC5wcm90b2NvbF07CiAgICAgICAgaWYgKHBzeWNob3RpYykgewogICAgICAgICAgcmVzdWx0Lmhvc3RuYW1lID0gIiI7CiAgICAgICAgICByZXN1bHQucG9ydCA9IG51bGw7CiAgICAgICAgICBpZiAocmVzdWx0Lmhvc3QpIHsKICAgICAgICAgICAgaWYgKHNyY1BhdGhbMF0gPT09ICIiKQogICAgICAgICAgICAgIHNyY1BhdGhbMF0gPSByZXN1bHQuaG9zdDsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgIHNyY1BhdGgudW5zaGlmdChyZXN1bHQuaG9zdCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuaG9zdCA9ICIiOwogICAgICAgICAgaWYgKHJlbGF0aXZlLnByb3RvY29sKSB7CiAgICAgICAgICAgIHJlbGF0aXZlLmhvc3RuYW1lID0gbnVsbDsKICAgICAgICAgICAgcmVsYXRpdmUucG9ydCA9IG51bGw7CiAgICAgICAgICAgIGlmIChyZWxhdGl2ZS5ob3N0KSB7CiAgICAgICAgICAgICAgaWYgKHJlbFBhdGhbMF0gPT09ICIiKQogICAgICAgICAgICAgICAgcmVsUGF0aFswXSA9IHJlbGF0aXZlLmhvc3Q7CiAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgcmVsUGF0aC51bnNoaWZ0KHJlbGF0aXZlLmhvc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlbGF0aXZlLmhvc3QgPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbXVzdEVuZEFicyA9IG11c3RFbmRBYnMgJiYgKHJlbFBhdGhbMF0gPT09ICIiIHx8IHNyY1BhdGhbMF0gPT09ICIiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzUmVsQWJzKSB7CiAgICAgICAgICByZXN1bHQuaG9zdCA9IHJlbGF0aXZlLmhvc3QgfHwgcmVsYXRpdmUuaG9zdCA9PT0gIiIgPyByZWxhdGl2ZS5ob3N0IDogcmVzdWx0Lmhvc3Q7CiAgICAgICAgICByZXN1bHQuaG9zdG5hbWUgPSByZWxhdGl2ZS5ob3N0bmFtZSB8fCByZWxhdGl2ZS5ob3N0bmFtZSA9PT0gIiIgPyByZWxhdGl2ZS5ob3N0bmFtZSA6IHJlc3VsdC5ob3N0bmFtZTsKICAgICAgICAgIHJlc3VsdC5zZWFyY2ggPSByZWxhdGl2ZS5zZWFyY2g7CiAgICAgICAgICByZXN1bHQucXVlcnkgPSByZWxhdGl2ZS5xdWVyeTsKICAgICAgICAgIHNyY1BhdGggPSByZWxQYXRoOwogICAgICAgIH0gZWxzZSBpZiAocmVsUGF0aC5sZW5ndGgpIHsKICAgICAgICAgIGlmICghc3JjUGF0aCkKICAgICAgICAgICAgc3JjUGF0aCA9IFtdOwogICAgICAgICAgc3JjUGF0aC5wb3AoKTsKICAgICAgICAgIHNyY1BhdGggPSBzcmNQYXRoLmNvbmNhdChyZWxQYXRoKTsKICAgICAgICAgIHJlc3VsdC5zZWFyY2ggPSByZWxhdGl2ZS5zZWFyY2g7CiAgICAgICAgICByZXN1bHQucXVlcnkgPSByZWxhdGl2ZS5xdWVyeTsKICAgICAgICB9IGVsc2UgaWYgKCF1dGlsLmlzTnVsbE9yVW5kZWZpbmVkKHJlbGF0aXZlLnNlYXJjaCkpIHsKICAgICAgICAgIGlmIChwc3ljaG90aWMpIHsKICAgICAgICAgICAgcmVzdWx0Lmhvc3RuYW1lID0gcmVzdWx0Lmhvc3QgPSBzcmNQYXRoLnNoaWZ0KCk7CiAgICAgICAgICAgIHZhciBhdXRoSW5Ib3N0ID0gcmVzdWx0Lmhvc3QgJiYgcmVzdWx0Lmhvc3QuaW5kZXhPZigiQCIpID4gMCA_IHJlc3VsdC5ob3N0LnNwbGl0KCJAIikgOiBmYWxzZTsKICAgICAgICAgICAgaWYgKGF1dGhJbkhvc3QpIHsKICAgICAgICAgICAgICByZXN1bHQuYXV0aCA9IGF1dGhJbkhvc3Quc2hpZnQoKTsKICAgICAgICAgICAgICByZXN1bHQuaG9zdCA9IHJlc3VsdC5ob3N0bmFtZSA9IGF1dGhJbkhvc3Quc2hpZnQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0LnNlYXJjaCA9IHJlbGF0aXZlLnNlYXJjaDsKICAgICAgICAgIHJlc3VsdC5xdWVyeSA9IHJlbGF0aXZlLnF1ZXJ5OwogICAgICAgICAgaWYgKCF1dGlsLmlzTnVsbChyZXN1bHQucGF0aG5hbWUpIHx8ICF1dGlsLmlzTnVsbChyZXN1bHQuc2VhcmNoKSkgewogICAgICAgICAgICByZXN1bHQucGF0aCA9IChyZXN1bHQucGF0aG5hbWUgPyByZXN1bHQucGF0aG5hbWUgOiAiIikgKyAocmVzdWx0LnNlYXJjaCA_IHJlc3VsdC5zZWFyY2ggOiAiIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIGlmICghc3JjUGF0aC5sZW5ndGgpIHsKICAgICAgICAgIHJlc3VsdC5wYXRobmFtZSA9IG51bGw7CiAgICAgICAgICBpZiAocmVzdWx0LnNlYXJjaCkgewogICAgICAgICAgICByZXN1bHQucGF0aCA9ICIvIiArIHJlc3VsdC5zZWFyY2g7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQucGF0aCA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuaHJlZiA9IHJlc3VsdC5mb3JtYXQoKTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQogICAgICAgIHZhciBsYXN0ID0gc3JjUGF0aC5zbGljZSgtMSlbMF07CiAgICAgICAgdmFyIGhhc1RyYWlsaW5nU2xhc2ggPSAocmVzdWx0Lmhvc3QgfHwgcmVsYXRpdmUuaG9zdCB8fCBzcmNQYXRoLmxlbmd0aCA-IDEpICYmIChsYXN0ID09PSAiLiIgfHwgbGFzdCA9PT0gIi4uIikgfHwgbGFzdCA9PT0gIiI7CiAgICAgICAgdmFyIHVwID0gMDsKICAgICAgICBmb3IgKHZhciBpID0gc3JjUGF0aC5sZW5ndGg7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICBsYXN0ID0gc3JjUGF0aFtpXTsKICAgICAgICAgIGlmIChsYXN0ID09PSAiLiIpIHsKICAgICAgICAgICAgc3JjUGF0aC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGxhc3QgPT09ICIuLiIpIHsKICAgICAgICAgICAgc3JjUGF0aC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIHVwKys7CiAgICAgICAgICB9IGVsc2UgaWYgKHVwKSB7CiAgICAgICAgICAgIHNyY1BhdGguc3BsaWNlKGksIDEpOwogICAgICAgICAgICB1cC0tOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIW11c3RFbmRBYnMgJiYgIXJlbW92ZUFsbERvdHMpIHsKICAgICAgICAgIGZvciAoOyB1cC0tOyB1cCkgewogICAgICAgICAgICBzcmNQYXRoLnVuc2hpZnQoIi4uIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChtdXN0RW5kQWJzICYmIHNyY1BhdGhbMF0gIT09ICIiICYmICghc3JjUGF0aFswXSB8fCBzcmNQYXRoWzBdLmNoYXJBdCgwKSAhPT0gIi8iKSkgewogICAgICAgICAgc3JjUGF0aC51bnNoaWZ0KCIiKTsKICAgICAgICB9CiAgICAgICAgaWYgKGhhc1RyYWlsaW5nU2xhc2ggJiYgc3JjUGF0aC5qb2luKCIvIikuc3Vic3RyKC0xKSAhPT0gIi8iKSB7CiAgICAgICAgICBzcmNQYXRoLnB1c2goIiIpOwogICAgICAgIH0KICAgICAgICB2YXIgaXNBYnNvbHV0ZSA9IHNyY1BhdGhbMF0gPT09ICIiIHx8IHNyY1BhdGhbMF0gJiYgc3JjUGF0aFswXS5jaGFyQXQoMCkgPT09ICIvIjsKICAgICAgICBpZiAocHN5Y2hvdGljKSB7CiAgICAgICAgICByZXN1bHQuaG9zdG5hbWUgPSByZXN1bHQuaG9zdCA9IGlzQWJzb2x1dGUgPyAiIiA6IHNyY1BhdGgubGVuZ3RoID8gc3JjUGF0aC5zaGlmdCgpIDogIiI7CiAgICAgICAgICB2YXIgYXV0aEluSG9zdCA9IHJlc3VsdC5ob3N0ICYmIHJlc3VsdC5ob3N0LmluZGV4T2YoIkAiKSA-IDAgPyByZXN1bHQuaG9zdC5zcGxpdCgiQCIpIDogZmFsc2U7CiAgICAgICAgICBpZiAoYXV0aEluSG9zdCkgewogICAgICAgICAgICByZXN1bHQuYXV0aCA9IGF1dGhJbkhvc3Quc2hpZnQoKTsKICAgICAgICAgICAgcmVzdWx0Lmhvc3QgPSByZXN1bHQuaG9zdG5hbWUgPSBhdXRoSW5Ib3N0LnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIG11c3RFbmRBYnMgPSBtdXN0RW5kQWJzIHx8IHJlc3VsdC5ob3N0ICYmIHNyY1BhdGgubGVuZ3RoOwogICAgICAgIGlmIChtdXN0RW5kQWJzICYmICFpc0Fic29sdXRlKSB7CiAgICAgICAgICBzcmNQYXRoLnVuc2hpZnQoIiIpOwogICAgICAgIH0KICAgICAgICBpZiAoIXNyY1BhdGgubGVuZ3RoKSB7CiAgICAgICAgICByZXN1bHQucGF0aG5hbWUgPSBudWxsOwogICAgICAgICAgcmVzdWx0LnBhdGggPSBudWxsOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQucGF0aG5hbWUgPSBzcmNQYXRoLmpvaW4oIi8iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCF1dGlsLmlzTnVsbChyZXN1bHQucGF0aG5hbWUpIHx8ICF1dGlsLmlzTnVsbChyZXN1bHQuc2VhcmNoKSkgewogICAgICAgICAgcmVzdWx0LnBhdGggPSAocmVzdWx0LnBhdGhuYW1lID8gcmVzdWx0LnBhdGhuYW1lIDogIiIpICsgKHJlc3VsdC5zZWFyY2ggPyByZXN1bHQuc2VhcmNoIDogIiIpOwogICAgICAgIH0KICAgICAgICByZXN1bHQuYXV0aCA9IHJlbGF0aXZlLmF1dGggfHwgcmVzdWx0LmF1dGg7CiAgICAgICAgcmVzdWx0LnNsYXNoZXMgPSByZXN1bHQuc2xhc2hlcyB8fCByZWxhdGl2ZS5zbGFzaGVzOwogICAgICAgIHJlc3VsdC5ocmVmID0gcmVzdWx0LmZvcm1hdCgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIFVybC5wcm90b3R5cGUucGFyc2VIb3N0ID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGhvc3QgPSB0aGlzLmhvc3Q7CiAgICAgICAgdmFyIHBvcnQgPSBwb3J0UGF0dGVybi5leGVjKGhvc3QpOwogICAgICAgIGlmIChwb3J0KSB7CiAgICAgICAgICBwb3J0ID0gcG9ydFswXTsKICAgICAgICAgIGlmIChwb3J0ICE9PSAiOiIpIHsKICAgICAgICAgICAgdGhpcy5wb3J0ID0gcG9ydC5zdWJzdHIoMSk7CiAgICAgICAgICB9CiAgICAgICAgICBob3N0ID0gaG9zdC5zdWJzdHIoMCwgaG9zdC5sZW5ndGggLSBwb3J0Lmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIGlmIChob3N0KQogICAgICAgICAgdGhpcy5ob3N0bmFtZSA9IGhvc3Q7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIHNyYy9jb21tb24vbGliL2pzb25zY2hlbWEvaGVscGVycy5qcwogIHZhciByZXF1aXJlX2hlbHBlcnMgPSBfX2NvbW1vbkpTKHsKICAgICJzcmMvY29tbW9uL2xpYi9qc29uc2NoZW1hL2hlbHBlcnMuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB1cmkgPSByZXF1aXJlX3VybCgpOwogICAgICB2YXIgVmFsaWRhdGlvbkVycm9yID0gZXhwb3J0cy5WYWxpZGF0aW9uRXJyb3IgPSBmdW5jdGlvbiBWYWxpZGF0aW9uRXJyb3IyKG1lc3NhZ2UsIGluc3RhbmNlLCBzY2hlbWEsIHBhdGgsIG5hbWUsIGFyZ3VtZW50KSB7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGF0aCkpIHsKICAgICAgICAgIHRoaXMucGF0aCA9IHBhdGg7CiAgICAgICAgICB0aGlzLnByb3BlcnR5ID0gcGF0aC5yZWR1Y2UoZnVuY3Rpb24oc3VtLCBpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBzdW0gKyBtYWtlU3VmZml4KGl0ZW0pOwogICAgICAgICAgfSwgImluc3RhbmNlIik7CiAgICAgICAgfSBlbHNlIGlmIChwYXRoICE9PSB2b2lkIDApIHsKICAgICAgICAgIHRoaXMucHJvcGVydHkgPSBwYXRoOwogICAgICAgIH0KICAgICAgICBpZiAobWVzc2FnZSkgewogICAgICAgICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgaWYgKHNjaGVtYSkgewogICAgICAgICAgdmFyIGlkID0gc2NoZW1hLiRpZCB8fCBzY2hlbWEuaWQ7CiAgICAgICAgICB0aGlzLnNjaGVtYSA9IGlkIHx8IHNjaGVtYTsKICAgICAgICB9CiAgICAgICAgaWYgKGluc3RhbmNlICE9PSB2b2lkIDApIHsKICAgICAgICAgIHRoaXMuaW5zdGFuY2UgPSBpbnN0YW5jZTsKICAgICAgICB9CiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICB0aGlzLmFyZ3VtZW50ID0gYXJndW1lbnQ7CiAgICAgICAgdGhpcy5zdGFjayA9IHRoaXMudG9TdHJpbmcoKTsKICAgICAgfTsKICAgICAgVmFsaWRhdGlvbkVycm9yLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nMigpIHsKICAgICAgICByZXR1cm4gdGhpcy5wcm9wZXJ0eSArICIgIiArIHRoaXMubWVzc2FnZTsKICAgICAgfTsKICAgICAgdmFyIFZhbGlkYXRvclJlc3VsdCA9IGV4cG9ydHMuVmFsaWRhdG9yUmVzdWx0ID0gZnVuY3Rpb24gVmFsaWRhdG9yUmVzdWx0MihpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICB0aGlzLmluc3RhbmNlID0gaW5zdGFuY2U7CiAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICB0aGlzLnBhdGggPSBjdHgucGF0aDsKICAgICAgICB0aGlzLnByb3BlcnR5UGF0aCA9IGN0eC5wcm9wZXJ0eVBhdGg7CiAgICAgICAgdGhpcy5lcnJvcnMgPSBbXTsKICAgICAgICB0aGlzLnRocm93RXJyb3IgPSBvcHRpb25zICYmIG9wdGlvbnMudGhyb3dFcnJvcjsKICAgICAgICB0aGlzLnRocm93Rmlyc3QgPSBvcHRpb25zICYmIG9wdGlvbnMudGhyb3dGaXJzdDsKICAgICAgICB0aGlzLnRocm93QWxsID0gb3B0aW9ucyAmJiBvcHRpb25zLnRocm93QWxsOwogICAgICAgIHRoaXMuZGlzYWJsZUZvcm1hdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5kaXNhYmxlRm9ybWF0ID09PSB0cnVlOwogICAgICB9OwogICAgICBWYWxpZGF0b3JSZXN1bHQucHJvdG90eXBlLmFkZEVycm9yID0gZnVuY3Rpb24gYWRkRXJyb3IoZGV0YWlsKSB7CiAgICAgICAgdmFyIGVycjI7CiAgICAgICAgaWYgKHR5cGVvZiBkZXRhaWwgPT0gInN0cmluZyIpIHsKICAgICAgICAgIGVycjIgPSBuZXcgVmFsaWRhdGlvbkVycm9yKGRldGFpbCwgdGhpcy5pbnN0YW5jZSwgdGhpcy5zY2hlbWEsIHRoaXMucGF0aCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghZGV0YWlsKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgZXJyb3IgZGV0YWlsIik7CiAgICAgICAgICBpZiAoIWRldGFpbC5tZXNzYWdlKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1pc3NpbmcgZXJyb3IgbWVzc2FnZSIpOwogICAgICAgICAgaWYgKCFkZXRhaWwubmFtZSkKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJNaXNzaW5nIHZhbGlkYXRvciB0eXBlIik7CiAgICAgICAgICBlcnIyID0gbmV3IFZhbGlkYXRpb25FcnJvcigKICAgICAgICAgICAgZGV0YWlsLm1lc3NhZ2UsCiAgICAgICAgICAgIHRoaXMuaW5zdGFuY2UsCiAgICAgICAgICAgIHRoaXMuc2NoZW1hLAogICAgICAgICAgICB0aGlzLnBhdGgsCiAgICAgICAgICAgIGRldGFpbC5uYW1lLAogICAgICAgICAgICBkZXRhaWwuYXJndW1lbnQKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZXJyb3JzLnB1c2goZXJyMik7CiAgICAgICAgaWYgKHRoaXMudGhyb3dGaXJzdCkgewogICAgICAgICAgdGhyb3cgbmV3IFZhbGlkYXRvclJlc3VsdEVycm9yKHRoaXMpOwogICAgICAgIH0gZWxzZSBpZiAodGhpcy50aHJvd0Vycm9yKSB7CiAgICAgICAgICB0aHJvdyBlcnIyOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZXJyMjsKICAgICAgfTsKICAgICAgVmFsaWRhdG9yUmVzdWx0LnByb3RvdHlwZS5pbXBvcnRFcnJvcnMgPSBmdW5jdGlvbiBpbXBvcnRFcnJvcnMocmVzKSB7CiAgICAgICAgaWYgKHR5cGVvZiByZXMgPT0gInN0cmluZyIgfHwgcmVzICYmIHJlcy52YWxpZGF0b3JUeXBlKSB7CiAgICAgICAgICB0aGlzLmFkZEVycm9yKHJlcyk7CiAgICAgICAgfSBlbHNlIGlmIChyZXMgJiYgcmVzLmVycm9ycykgewogICAgICAgICAgdGhpcy5lcnJvcnMgPSB0aGlzLmVycm9ycy5jb25jYXQocmVzLmVycm9ycyk7CiAgICAgICAgfQogICAgICB9OwogICAgICBmdW5jdGlvbiBzdHJpbmdpemVyKHYsIGkpIHsKICAgICAgICByZXR1cm4gaSArICI6ICIgKyB2LnRvU3RyaW5nKCkgKyAiXG4iOwogICAgICB9CiAgICAgIFZhbGlkYXRvclJlc3VsdC5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZzIocmVzKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZXJyb3JzLm1hcChzdHJpbmdpemVyKS5qb2luKCIiKTsKICAgICAgfTsKICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZhbGlkYXRvclJlc3VsdC5wcm90b3R5cGUsICJ2YWxpZCIsIHsKICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgcmV0dXJuICF0aGlzLmVycm9ycy5sZW5ndGg7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgbW9kdWxlLmV4cG9ydHMuVmFsaWRhdG9yUmVzdWx0RXJyb3IgPSBWYWxpZGF0b3JSZXN1bHRFcnJvcjsKICAgICAgZnVuY3Rpb24gVmFsaWRhdG9yUmVzdWx0RXJyb3IocmVzdWx0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgVmFsaWRhdG9yUmVzdWx0RXJyb3IpOwogICAgICAgIH0KICAgICAgICB0aGlzLmluc3RhbmNlID0gcmVzdWx0Lmluc3RhbmNlOwogICAgICAgIHRoaXMuc2NoZW1hID0gcmVzdWx0LnNjaGVtYTsKICAgICAgICB0aGlzLm9wdGlvbnMgPSByZXN1bHQub3B0aW9uczsKICAgICAgICB0aGlzLmVycm9ycyA9IHJlc3VsdC5lcnJvcnM7CiAgICAgIH0KICAgICAgVmFsaWRhdG9yUmVzdWx0RXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CiAgICAgIFZhbGlkYXRvclJlc3VsdEVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFZhbGlkYXRvclJlc3VsdEVycm9yOwogICAgICBWYWxpZGF0b3JSZXN1bHRFcnJvci5wcm90b3R5cGUubmFtZSA9ICJWYWxpZGF0aW9uIEVycm9yIjsKICAgICAgdmFyIFNjaGVtYUVycm9yID0gZXhwb3J0cy5TY2hlbWFFcnJvciA9IGZ1bmN0aW9uIFNjaGVtYUVycm9yMihtc2csIHNjaGVtYSkgewogICAgICAgIHRoaXMubWVzc2FnZSA9IG1zZzsKICAgICAgICB0aGlzLnNjaGVtYSA9IHNjaGVtYTsKICAgICAgICBFcnJvci5jYWxsKHRoaXMsIG1zZyk7CiAgICAgICAgaWYgKHR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgU2NoZW1hRXJyb3IyKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIFNjaGVtYUVycm9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoRXJyb3IucHJvdG90eXBlLCB7CiAgICAgICAgY29uc3RydWN0b3I6IHsgdmFsdWU6IFNjaGVtYUVycm9yLCBlbnVtZXJhYmxlOiBmYWxzZSB9LAogICAgICAgIG5hbWU6IHsgdmFsdWU6ICJTY2hlbWFFcnJvciIsIGVudW1lcmFibGU6IGZhbHNlIH0KICAgICAgfSk7CiAgICAgIHZhciBTY2hlbWFDb250ZXh0ID0gZXhwb3J0cy5TY2hlbWFDb250ZXh0ID0gZnVuY3Rpb24gU2NoZW1hQ29udGV4dDIoc2NoZW1hLCBvcHRpb25zLCBwYXRoLCBiYXNlLCBzY2hlbWFzKSB7CiAgICAgICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7CiAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXRoKSkgewogICAgICAgICAgdGhpcy5wYXRoID0gcGF0aDsKICAgICAgICAgIHRoaXMucHJvcGVydHlQYXRoID0gcGF0aC5yZWR1Y2UoZnVuY3Rpb24oc3VtLCBpdGVtKSB7CiAgICAgICAgICAgIHJldHVybiBzdW0gKyBtYWtlU3VmZml4KGl0ZW0pOwogICAgICAgICAgfSwgImluc3RhbmNlIik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMucHJvcGVydHlQYXRoID0gcGF0aDsKICAgICAgICB9CiAgICAgICAgdGhpcy5iYXNlID0gYmFzZTsKICAgICAgICB0aGlzLnNjaGVtYXMgPSBzY2hlbWFzOwogICAgICB9OwogICAgICBTY2hlbWFDb250ZXh0LnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gcmVzb2x2ZSh0YXJnZXQpIHsKICAgICAgICByZXR1cm4gdXJpLnJlc29sdmUodGhpcy5iYXNlLCB0YXJnZXQpOwogICAgICB9OwogICAgICBTY2hlbWFDb250ZXh0LnByb3RvdHlwZS5tYWtlQ2hpbGQgPSBmdW5jdGlvbiBtYWtlQ2hpbGQoc2NoZW1hLCBwcm9wZXJ0eU5hbWUpIHsKICAgICAgICB2YXIgcGF0aCA9IHByb3BlcnR5TmFtZSA9PT0gdm9pZCAwID8gdGhpcy5wYXRoIDogdGhpcy5wYXRoLmNvbmNhdChbcHJvcGVydHlOYW1lXSk7CiAgICAgICAgdmFyIGlkID0gc2NoZW1hLiRpZCB8fCBzY2hlbWEuaWQ7CiAgICAgICAgdmFyIGJhc2UgPSB1cmkucmVzb2x2ZSh0aGlzLmJhc2UsIGlkIHx8ICIiKTsKICAgICAgICB2YXIgY3R4ID0gbmV3IFNjaGVtYUNvbnRleHQoCiAgICAgICAgICBzY2hlbWEsCiAgICAgICAgICB0aGlzLm9wdGlvbnMsCiAgICAgICAgICBwYXRoLAogICAgICAgICAgYmFzZSwKICAgICAgICAgIE9iamVjdC5jcmVhdGUodGhpcy5zY2hlbWFzKQogICAgICAgICk7CiAgICAgICAgaWYgKGlkICYmICFjdHguc2NoZW1hc1tiYXNlXSkgewogICAgICAgICAgY3R4LnNjaGVtYXNbYmFzZV0gPSBzY2hlbWE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBjdHg7CiAgICAgIH07CiAgICAgIHZhciBGT1JNQVRfUkVHRVhQUyA9IGV4cG9ydHMuRk9STUFUX1JFR0VYUFMgPSB7CiAgICAgICAgImRhdGUtdGltZSI6IC9eXGR7NH0tKD86MFswLTldezF9fDFbMC0yXXsxfSktKDNbMDFdfDBbMS05XXxbMTJdWzAtOV0pW3RUIF0oMlswLTRdfFswMV1bMC05XSk6KFswLTVdWzAtOV0pOig2MHxbMC01XVswLTldKShcLlxkKyk_KFt6Wl18WystXShbMC01XVswLTldKTooNjB8WzAtNV1bMC05XSkpJC8sCiAgICAgICAgZGF0ZTogL15cZHs0fS0oPzowWzAtOV17MX18MVswLTJdezF9KS0oM1swMV18MFsxLTldfFsxMl1bMC05XSkkLywKICAgICAgICB0aW1lOiAvXigyWzAtNF18WzAxXVswLTldKTooWzAtNV1bMC05XSk6KDYwfFswLTVdWzAtOV0pJC8sCiAgICAgICAgZHVyYXRpb246IC9QKFRcZCsoSChcZCtNKFxkK1MpPyk_fE0oXGQrUyk_fFMpfFxkKyhEfE0oXGQrRCk_fFkoXGQrTShcZCtEKT8pPykoVFxkKyhIKFxkK00oXGQrUyk_KT98TShcZCtTKT98UykpP3xcZCtXKS9pLAogICAgICAgIGVtYWlsOiAvXig_Oltcd1whXCNcJFwlXCZcJ1wqXCtcLVwvXD1cP1xeXGBce1x8XH1cfl0rXC4pKltcd1whXCNcJFwlXCZcJ1wqXCtcLVwvXD1cP1xeXGBce1x8XH1cfl0rQCg_Oig_Oig_OlthLXpBLVowLTldKD86W2EtekEtWjAtOVwtXSg_IVwuKSl7MCw2MX1bYS16QS1aMC05XT9cLikrW2EtekEtWjAtOV0oPzpbYS16QS1aMC05XC1dKD8hJCkpezAsNjF9W2EtekEtWjAtOV0_KXwoPzpcWyg_Oig_OlswMV0_XGR7MSwyfXwyWzAtNF1cZHwyNVswLTVdKVwuKXszfSg_OlswMV0_XGR7MSwyfXwyWzAtNF1cZHwyNVswLTVdKVxdKSkkLywKICAgICAgICAiaWRuLWVtYWlsIjogL14oIig_OlshIy1cW1xdLVx1ezEwRkZGRn1dfFxcW1x0IC1cdXsxMEZGRkZ9XSkqInxbISMtJyorXC0vLTk9P0EtWlxeLVx1ezEwRkZGRn1dKD86XC4_WyEjLScqK1wtLy05PT9BLVpcXi1cdXsxMEZGRkZ9XSkqKUAoWyEjLScqK1wtLy05PT9BLVpcXi1cdXsxMEZGRkZ9XSg_OlwuP1shIy0nKitcLS8tOT0_QS1aXF4tXHV7MTBGRkZGfV0pKnxcW1shLVpcXi1cdXsxMEZGRkZ9XSpcXSkkL3UsCiAgICAgICAgImlwLWFkZHJlc3MiOiAvXig_Oig_OjI1WzAtNV18MlswLTRdWzAtOV18WzAxXT9bMC05XVswLTldPylcLil7M30oPzoyNVswLTVdfDJbMC00XVswLTldfFswMV0_WzAtOV1bMC05XT8pJC8sCiAgICAgICAgaXB2NjogL15ccyooKChbMC05QS1GYS1mXXsxLDR9Oil7N30oWzAtOUEtRmEtZl17MSw0fXw6KSl8KChbMC05QS1GYS1mXXsxLDR9Oil7Nn0oOlswLTlBLUZhLWZdezEsNH18KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXs1fSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDJ9KXw6KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXs0fSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDN9KXwoKDpbMC05QS1GYS1mXXsxLDR9KT86KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pKXw6KSl8KChbMC05QS1GYS1mXXsxLDR9Oil7M30oKCg6WzAtOUEtRmEtZl17MSw0fSl7MSw0fSl8KCg6WzAtOUEtRmEtZl17MSw0fSl7MCwyfTooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0_XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0_XGQpKXszfSkpfDopKXwoKFswLTlBLUZhLWZdezEsNH06KXsyfSgoKDpbMC05QS1GYS1mXXsxLDR9KXsxLDV9KXwoKDpbMC05QS1GYS1mXXsxLDR9KXswLDN9OigoMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkoXC4oMjVbMC01XXwyWzAtNF1cZHwxXGRcZHxbMS05XT9cZCkpezN9KSl8OikpfCgoWzAtOUEtRmEtZl17MSw0fTopezF9KCgoOlswLTlBLUZhLWZdezEsNH0pezEsNn0pfCgoOlswLTlBLUZhLWZdezEsNH0pezAsNH06KCgyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKShcLigyNVswLTVdfDJbMC00XVxkfDFcZFxkfFsxLTldP1xkKSl7M30pKXw6KSl8KDooKCg6WzAtOUEtRmEtZl17MSw0fSl7MSw3fSl8KCg6WzAtOUEtRmEtZl17MSw0fSl7MCw1fTooKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0_XGQpKFwuKDI1WzAtNV18MlswLTRdXGR8MVxkXGR8WzEtOV0_XGQpKXszfSkpfDopKSkoJS4rKT9ccyokLywKICAgICAgICB1cmk6IC9eW2EtekEtWl1bYS16QS1aMC05Ky4tXSo6W15cc10qJC8sCiAgICAgICAgInVyaS1yZWZlcmVuY2UiOiAvXigoKChbQS1aYS16XVsrXC0uMC05QS1aYS16XSooOiVbMC05QS1GYS1mXXsyfXw6WyEkJi0uMC07PT8tWl9hLXp-XXxbLz9dKXxcPykoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fl0pKnwoW0EtWmEtel1bK1wtLjAtOUEtWmEtel0qOj8pPyl8KFtBLVphLXpdWytcLS4wLTlBLVphLXpdKjopP1wvKCglWzAtOUEtRmEtZl17Mn18XC8oKCVbMC05QS1GYS1mXXsyfXxbISQmLS4wLTk7PUEtWl9hLXp-XSkrfChcWygoW1Z2XVswLTlBLUZhLWZdK1wuWyEkJi0uMC07PUEtWl9hLXp-XSspP3xbLjAtOkEtRmEtZl0rKVxdKT8pKDpcZCopP1svP118WyEkJi0uMC07PT8tWl9hLXp-XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fl0pKnwoXC8oKCVbMC05QS1GYS1mXXsyfXxbISQmLS4wLTk7PUEtWl9hLXp-XSkrfChcWygoW1Z2XVswLTlBLUZhLWZdK1wuWyEkJi0uMC07PUEtWl9hLXp-XSspP3xbLjAtOkEtRmEtZl0rKVxdKT8pKDpcZCopPyk_KSkjKCVbMC05QS1GYS1mXXsyfXxbISQmLTs9Py1aX2Eten5dKSp8KChbQS1aYS16XVsrXC0uMC05QS1aYS16XSopPyVbMC05QS1GYS1mXXsyfXxbISQmLS4wLTk7PUBffl18W0EtWmEtel1bK1wtLjAtOUEtWmEtel0qWyEkJi0qLDs9QF9-XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtLjAtOTs9QC1aX2Eten5dKSooKChbLz9dKCVbMC05QS1GYS1mXXsyfXxbISQmLTs9Py1aX2Eten5dKSopPyN8Wy8_XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fl0pKik_fChbQS1aYS16XVsrXC0uMC05QS1aYS16XSooOiVbMC05QS1GYS1mXXsyfXw6WyEkJi0uMC07PT8tWl9hLXp-XXxbLz9dKXxcPykoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fl0pKnwoW0EtWmEtel1bK1wtLjAtOUEtWmEtel0qOik_XC8oKCVbMC05QS1GYS1mXXsyfXxcLygoJVswLTlBLUZhLWZdezJ9fFshJCYtLjAtOTs9QS1aX2Eten5dKSt8KFxbKChbVnZdWzAtOUEtRmEtZl0rXC5bISQmLS4wLTs9QS1aX2Eten5dKyk_fFsuMC06QS1GYS1mXSspXF0pPykoOlxkKik_Wy8_XXxbISQmLS4wLTs9Py1aX2Eten5dKSglWzAtOUEtRmEtZl17Mn18WyEkJi07PT8tWl9hLXp-XSkqfFwvKCglWzAtOUEtRmEtZl17Mn18WyEkJi0uMC05Oz1BLVpfYS16fl0pKyg6XGQqKT98KFxbKChbVnZdWzAtOUEtRmEtZl0rXC5bISQmLS4wLTs9QS1aX2Eten5dKyk_fFsuMC06QS1GYS1mXSspXF0pPzpcZCp8XFsoKFtWdl1bMC05QS1GYS1mXStcLlshJCYtLjAtOz1BLVpfYS16fl0rKT98Wy4wLTpBLUZhLWZdKylcXSk_KT98W0EtWmEtel1bK1wtLjAtOUEtWmEtel0qOj8pPyQvLAogICAgICAgIGlyaTogL15bYS16QS1aXVthLXpBLVowLTkrLi1dKjpbXlxzXSokLywKICAgICAgICAiaXJpLXJlZmVyZW5jZSI6IC9eKCgoKFtBLVphLXpdWytcLS4wLTlBLVphLXpdKig6JVswLTlBLUZhLWZdezJ9fDpbISQmLS4wLTs9Py1aX2Eten4tXHV7MTBGRkZGfV18Wy8_XSl8XD8pKCVbMC05QS1GYS1mXXsyfXxbISQmLTs9Py1aX2Eten4tXHV7MTBGRkZGfV0pKnwoW0EtWmEtel1bK1wtLjAtOUEtWmEtel0qOj8pPyl8KFtBLVphLXpdWytcLS4wLTlBLVphLXpdKjopP1wvKCglWzAtOUEtRmEtZl17Mn18XC8oKCVbMC05QS1GYS1mXXsyfXxbISQmLS4wLTk7PUEtWl9hLXp-LVx1ezEwRkZGRn1dKSt8KFxbKChbVnZdWzAtOUEtRmEtZl0rXC5bISQmLS4wLTs9QS1aX2Eten4tXHV7MTBGRkZGfV0rKT98Wy4wLTpBLUZhLWZdKylcXSk_KSg6XGQqKT9bLz9dfFshJCYtLjAtOz0_LVpfYS16fi1cdXsxMEZGRkZ9XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fi1cdXsxMEZGRkZ9XSkqfChcLygoJVswLTlBLUZhLWZdezJ9fFshJCYtLjAtOTs9QS1aX2Eten4tXHV7MTBGRkZGfV0pK3woXFsoKFtWdl1bMC05QS1GYS1mXStcLlshJCYtLjAtOz1BLVpfYS16fi1cdXsxMEZGRkZ9XSspP3xbLjAtOkEtRmEtZl0rKVxdKT8pKDpcZCopPyk_KSkjKCVbMC05QS1GYS1mXXsyfXxbISQmLTs9Py1aX2Eten4tXHV7MTBGRkZGfV0pKnwoKFtBLVphLXpdWytcLS4wLTlBLVphLXpdKik_JVswLTlBLUZhLWZdezJ9fFshJCYtLjAtOTs9QF9-LVx1ezEwRkZGRn1dfFtBLVphLXpdWytcLS4wLTlBLVphLXpdKlshJCYtKiw7PUBffi1cdXsxMEZGRkZ9XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtLjAtOTs9QC1aX2Eten4tXHV7MTBGRkZGfV0pKigoKFsvP10oJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fi1cdXsxMEZGRkZ9XSkqKT8jfFsvP10pKCVbMC05QS1GYS1mXXsyfXxbISQmLTs9Py1aX2Eten4tXHV7MTBGRkZGfV0pKik_fChbQS1aYS16XVsrXC0uMC05QS1aYS16XSooOiVbMC05QS1GYS1mXXsyfXw6WyEkJi0uMC07PT8tWl9hLXp-LVx1ezEwRkZGRn1dfFsvP10pfFw_KSglWzAtOUEtRmEtZl17Mn18WyEkJi07PT8tWl9hLXp-LVx1ezEwRkZGRn1dKSp8KFtBLVphLXpdWytcLS4wLTlBLVphLXpdKjopP1wvKCglWzAtOUEtRmEtZl17Mn18XC8oKCVbMC05QS1GYS1mXXsyfXxbISQmLS4wLTk7PUEtWl9hLXp-LVx1ezEwRkZGRn1dKSt8KFxbKChbVnZdWzAtOUEtRmEtZl0rXC5bISQmLS4wLTs9QS1aX2Eten4tXHV7MTBGRkZGfV0rKT98Wy4wLTpBLUZhLWZdKylcXSk_KSg6XGQqKT9bLz9dfFshJCYtLjAtOz0_LVpfYS16fi1cdXsxMEZGRkZ9XSkoJVswLTlBLUZhLWZdezJ9fFshJCYtOz0_LVpfYS16fi1cdXsxMEZGRkZ9XSkqfFwvKCglWzAtOUEtRmEtZl17Mn18WyEkJi0uMC05Oz1BLVpfYS16fi1cdXsxMEZGRkZ9XSkrKDpcZCopP3woXFsoKFtWdl1bMC05QS1GYS1mXStcLlshJCYtLjAtOz1BLVpfYS16fi1cdXsxMEZGRkZ9XSspP3xbLjAtOkEtRmEtZl0rKVxdKT86XGQqfFxbKChbVnZdWzAtOUEtRmEtZl0rXC5bISQmLS4wLTs9QS1aX2Eten4tXHV7MTBGRkZGfV0rKT98Wy4wLTpBLUZhLWZdKylcXSk_KT98W0EtWmEtel1bK1wtLjAtOUEtWmEtel0qOj8pPyQvdSwKICAgICAgICB1dWlkOiAvXlswLTlBLUZdezh9LVswLTlBLUZdezR9LVswLTlBLUZdezR9LVswLTlBLUZdezR9LVswLTlBLUZdezEyfSQvaSwKICAgICAgICAidXJpLXRlbXBsYXRlIjogLyglWzAtOWEtZl17Mn18WyEjJCYoLTs9P0BcW1xdX2Eten5dfFx7WyEjJissLi87PT9AfF0_KCVbMC05YS1mXXsyfXxbMC05X2Etel0pKFwuPyglWzAtOWEtZl17Mn18WzAtOV9hLXpdKSkqKDpbMS05XVxkezAsM318XCopPygsKCVbMC05YS1mXXsyfXxbMC05X2Etel0pKFwuPyglWzAtOWEtZl17Mn18WzAtOV9hLXpdKSkqKDpbMS05XVxkezAsM318XCopPykqXH0pKi9pdSwKICAgICAgICAianNvbi1wb2ludGVyIjogL14oXC8oW1x4MDAtXHgyZTAtQFxbLX1ceDdmXXx-WzAxXSkqKSokL2l1LAogICAgICAgICJyZWxhdGl2ZS1qc29uLXBvaW50ZXIiOiAvXlxkKygjfChcLyhbXHgwMC1ceDJlMC1AXFstfVx4N2ZdfH5bMDFdKSopKikkL2l1LAogICAgICAgIGhvc3RuYW1lOiAvXig_PS57MSwyNTV9JClbMC05QS1aYS16XSg_Oig_OlswLTlBLVphLXpdfC0pezAsNjF9WzAtOUEtWmEtel0pPyg_OlwuWzAtOUEtWmEtel0oPzooPzpbMC05QS1aYS16XXwtKXswLDYxfVswLTlBLVphLXpdKT8pKlwuPyQvLAogICAgICAgICJob3N0LW5hbWUiOiAvXig_PS57MSwyNTV9JClbMC05QS1aYS16XSg_Oig_OlswLTlBLVphLXpdfC0pezAsNjF9WzAtOUEtWmEtel0pPyg_OlwuWzAtOUEtWmEtel0oPzooPzpbMC05QS1aYS16XXwtKXswLDYxfVswLTlBLVphLXpdKT8pKlwuPyQvLAogICAgICAgICJ1dGMtbWlsbGlzZWMiOiBmdW5jdGlvbihpbnB1dCkgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIgJiYgcGFyc2VGbG9hdChpbnB1dCkgPT09IHBhcnNlSW50KGlucHV0LCAxMCkgJiYgIWlzTmFOKGlucHV0KTsKICAgICAgICB9LAogICAgICAgIHJlZ2V4OiBmdW5jdGlvbihpbnB1dCkgewogICAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgUmVnRXhwKGlucHV0KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0sCiAgICAgICAgc3R5bGU6IC9bXHJcblx0IF0qW15cclxuXHQgXVteOl0qOltcclxuXHQgXSpbXlxyXG5cdCA7XSpbXHJcblx0IF0qOz8vLAogICAgICAgIGNvbG9yOiAvXigjPyhbMC05QS1GYS1mXXszfSl7MSwyfVxifGFxdWF8YmxhY2t8Ymx1ZXxmdWNoc2lhfGdyYXl8Z3JlZW58bGltZXxtYXJvb258bmF2eXxvbGl2ZXxvcmFuZ2V8cHVycGxlfHJlZHxzaWx2ZXJ8dGVhbHx3aGl0ZXx5ZWxsb3d8KHJnYlwoXHMqXGIoWzAtOV18WzEtOV1bMC05XXwxWzAtOV1bMC05XXwyWzAtNF1bMC05XXwyNVswLTVdKVxiXHMqLFxzKlxiKFswLTldfFsxLTldWzAtOV18MVswLTldWzAtOV18MlswLTRdWzAtOV18MjVbMC01XSlcYlxzKixccypcYihbMC05XXxbMS05XVswLTldfDFbMC05XVswLTldfDJbMC00XVswLTldfDI1WzAtNV0pXGJccypcKSl8KHJnYlwoXHMqKFxkP1xkJXwxMDAlKStccyosXHMqKFxkP1xkJXwxMDAlKStccyosXHMqKFxkP1xkJXwxMDAlKStccypcKSkpJC8sCiAgICAgICAgcGhvbmU6IC9eXCsoPzpbMC05XSA_KXs2LDE0fVswLTldJC8sCiAgICAgICAgYWxwaGE6IC9eW2EtekEtWl0rJC8sCiAgICAgICAgYWxwaGFudW1lcmljOiAvXlthLXpBLVowLTldKyQvCiAgICAgIH07CiAgICAgIEZPUk1BVF9SRUdFWFBTLnJlZ2V4cCA9IEZPUk1BVF9SRUdFWFBTLnJlZ2V4OwogICAgICBGT1JNQVRfUkVHRVhQUy5wYXR0ZXJuID0gRk9STUFUX1JFR0VYUFMucmVnZXg7CiAgICAgIEZPUk1BVF9SRUdFWFBTLmlwdjQgPSBGT1JNQVRfUkVHRVhQU1siaXAtYWRkcmVzcyJdOwogICAgICBleHBvcnRzLmlzRm9ybWF0ID0gZnVuY3Rpb24gaXNGb3JtYXQoaW5wdXQsIGZvcm1hdCwgdmFsaWRhdG9yMikgewogICAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09ICJzdHJpbmciICYmIEZPUk1BVF9SRUdFWFBTW2Zvcm1hdF0gIT09IHZvaWQgMCkgewogICAgICAgICAgaWYgKEZPUk1BVF9SRUdFWFBTW2Zvcm1hdF0gaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgcmV0dXJuIEZPUk1BVF9SRUdFWFBTW2Zvcm1hdF0udGVzdChpbnB1dCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodHlwZW9mIEZPUk1BVF9SRUdFWFBTW2Zvcm1hdF0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgcmV0dXJuIEZPUk1BVF9SRUdFWFBTW2Zvcm1hdF0oaW5wdXQpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdG9yMiAmJiB2YWxpZGF0b3IyLmN1c3RvbUZvcm1hdHMgJiYgdHlwZW9mIHZhbGlkYXRvcjIuY3VzdG9tRm9ybWF0c1tmb3JtYXRdID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICByZXR1cm4gdmFsaWRhdG9yMi5jdXN0b21Gb3JtYXRzW2Zvcm1hdF0oaW5wdXQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfTsKICAgICAgdmFyIG1ha2VTdWZmaXggPSBleHBvcnRzLm1ha2VTdWZmaXggPSBmdW5jdGlvbiBtYWtlU3VmZml4MihrZXkpIHsKICAgICAgICBrZXkgPSBrZXkudG9TdHJpbmcoKTsKICAgICAgICBpZiAoIWtleS5tYXRjaCgvWy5cc1xbXF1dLykgJiYgIWtleS5tYXRjaCgvXltcZF0vKSkgewogICAgICAgICAgcmV0dXJuICIuIiArIGtleTsKICAgICAgICB9CiAgICAgICAgaWYgKGtleS5tYXRjaCgvXlxkKyQvKSkgewogICAgICAgICAgcmV0dXJuICJbIiArIGtleSArICJdIjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICJbIiArIEpTT04uc3RyaW5naWZ5KGtleSkgKyAiXSI7CiAgICAgIH07CiAgICAgIGV4cG9ydHMuZGVlcENvbXBhcmVTdHJpY3QgPSBmdW5jdGlvbiBkZWVwQ29tcGFyZVN0cmljdChhLCBiKSB7CiAgICAgICAgaWYgKHR5cGVvZiBhICE9PSB0eXBlb2YgYikgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhKSkgewogICAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGIpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChhLmxlbmd0aCAhPT0gYi5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGEuZXZlcnkoZnVuY3Rpb24odiwgaSkgewogICAgICAgICAgICByZXR1cm4gZGVlcENvbXBhcmVTdHJpY3QoYVtpXSwgYltpXSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBhID09PSAib2JqZWN0IikgewogICAgICAgICAgaWYgKCFhIHx8ICFiKSB7CiAgICAgICAgICAgIHJldHVybiBhID09PSBiOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGFLZXlzID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgICB2YXIgYktleXMgPSBPYmplY3Qua2V5cyhiKTsKICAgICAgICAgIGlmIChhS2V5cy5sZW5ndGggIT09IGJLZXlzLmxlbmd0aCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gYUtleXMuZXZlcnkoZnVuY3Rpb24odikgewogICAgICAgICAgICByZXR1cm4gZGVlcENvbXBhcmVTdHJpY3QoYVt2XSwgYlt2XSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGEgPT09IGI7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIGRlZXBNZXJnZXIodGFyZ2V0LCBkc3QsIGUsIGkpIHsKICAgICAgICBpZiAodHlwZW9mIGUgPT09ICJvYmplY3QiKSB7CiAgICAgICAgICBkc3RbaV0gPSBkZWVwTWVyZ2UodGFyZ2V0W2ldLCBlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRhcmdldC5pbmRleE9mKGUpID09PSAtMSkgewogICAgICAgICAgICBkc3QucHVzaChlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gY29weWlzdChzcmMsIGRzdCwga2V5KSB7CiAgICAgICAgZHN0W2tleV0gPSBzcmNba2V5XTsKICAgICAgfQogICAgICBmdW5jdGlvbiBjb3B5aXN0V2l0aERlZXBNZXJnZSh0YXJnZXQsIHNyYywgZHN0LCBrZXkpIHsKICAgICAgICBpZiAodHlwZW9mIHNyY1trZXldICE9PSAib2JqZWN0IiB8fCAhc3JjW2tleV0pIHsKICAgICAgICAgIGRzdFtrZXldID0gc3JjW2tleV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghdGFyZ2V0W2tleV0pIHsKICAgICAgICAgICAgZHN0W2tleV0gPSBzcmNba2V5XTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRzdFtrZXldID0gZGVlcE1lcmdlKHRhcmdldFtrZXldLCBzcmNba2V5XSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGZ1bmN0aW9uIGRlZXBNZXJnZSh0YXJnZXQsIHNyYykgewogICAgICAgIHZhciBhcnJheSA9IEFycmF5LmlzQXJyYXkoc3JjKTsKICAgICAgICB2YXIgZHN0ID0gYXJyYXkgJiYgW10gfHwge307CiAgICAgICAgaWYgKGFycmF5KSB7CiAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQgfHwgW107CiAgICAgICAgICBkc3QgPSBkc3QuY29uY2F0KHRhcmdldCk7CiAgICAgICAgICBzcmMuZm9yRWFjaChkZWVwTWVyZ2VyLmJpbmQobnVsbCwgdGFyZ2V0LCBkc3QpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHRhcmdldCAmJiB0eXBlb2YgdGFyZ2V0ID09PSAib2JqZWN0IikgewogICAgICAgICAgICBPYmplY3Qua2V5cyh0YXJnZXQpLmZvckVhY2goY29weWlzdC5iaW5kKG51bGwsIHRhcmdldCwgZHN0KSk7CiAgICAgICAgICB9CiAgICAgICAgICBPYmplY3Qua2V5cyhzcmMpLmZvckVhY2goY29weWlzdFdpdGhEZWVwTWVyZ2UuYmluZChudWxsLCB0YXJnZXQsIHNyYywgZHN0KSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkc3Q7CiAgICAgIH0KICAgICAgbW9kdWxlLmV4cG9ydHMuZGVlcE1lcmdlID0gZGVlcE1lcmdlOwogICAgICBleHBvcnRzLm9iamVjdEdldFBhdGggPSBmdW5jdGlvbiBvYmplY3RHZXRQYXRoKG8sIHMpIHsKICAgICAgICB2YXIgcGFydHMgPSBzLnNwbGl0KCIvIikuc2xpY2UoMSk7CiAgICAgICAgdmFyIGs7CiAgICAgICAgd2hpbGUgKHR5cGVvZiAoayA9IHBhcnRzLnNoaWZ0KCkpID09ICJzdHJpbmciKSB7CiAgICAgICAgICB2YXIgbiA9IGRlY29kZVVSSUNvbXBvbmVudChrLnJlcGxhY2UoL34wLywgIn4iKS5yZXBsYWNlKC9-MS9nLCAiLyIpKTsKICAgICAgICAgIGlmICghKG4gaW4gbykpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIG8gPSBvW25dOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbzsKICAgICAgfTsKICAgICAgZnVuY3Rpb24gcGF0aEVuY29kZXIodikgewogICAgICAgIHJldHVybiAiLyIgKyBlbmNvZGVVUklDb21wb25lbnQodikucmVwbGFjZSgvfi9nLCAiJTdFIik7CiAgICAgIH0KICAgICAgZXhwb3J0cy5lbmNvZGVQYXRoID0gZnVuY3Rpb24gZW5jb2RlUG9pbnRlcihhKSB7CiAgICAgICAgcmV0dXJuIGEubWFwKHBhdGhFbmNvZGVyKS5qb2luKCIiKTsKICAgICAgfTsKICAgICAgZXhwb3J0cy5nZXREZWNpbWFsUGxhY2VzID0gZnVuY3Rpb24gZ2V0RGVjaW1hbFBsYWNlcyhudW1iZXIpIHsKICAgICAgICB2YXIgZGVjaW1hbFBsYWNlcyA9IDA7CiAgICAgICAgaWYgKGlzTmFOKG51bWJlcikpCiAgICAgICAgICByZXR1cm4gZGVjaW1hbFBsYWNlczsKICAgICAgICBpZiAodHlwZW9mIG51bWJlciAhPT0gIm51bWJlciIpIHsKICAgICAgICAgIG51bWJlciA9IE51bWJlcihudW1iZXIpOwogICAgICAgIH0KICAgICAgICB2YXIgcGFydHMgPSBudW1iZXIudG9TdHJpbmcoKS5zcGxpdCgiZSIpOwogICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPT09IDIpIHsKICAgICAgICAgIGlmIChwYXJ0c1sxXVswXSAhPT0gIi0iKSB7CiAgICAgICAgICAgIHJldHVybiBkZWNpbWFsUGxhY2VzOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZGVjaW1hbFBsYWNlcyA9IE51bWJlcihwYXJ0c1sxXS5zbGljZSgxKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhciBkZWNpbWFsUGFydHMgPSBwYXJ0c1swXS5zcGxpdCgiLiIpOwogICAgICAgIGlmIChkZWNpbWFsUGFydHMubGVuZ3RoID09PSAyKSB7CiAgICAgICAgICBkZWNpbWFsUGxhY2VzICs9IGRlY2ltYWxQYXJ0c1sxXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkZWNpbWFsUGxhY2VzOwogICAgICB9OwogICAgICBleHBvcnRzLmlzU2NoZW1hID0gZnVuY3Rpb24gaXNTY2hlbWEodmFsKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICJvYmplY3QiICYmIHZhbCB8fCB0eXBlb2YgdmFsID09PSAiYm9vbGVhbiI7CiAgICAgIH07CiAgICB9CiAgfSk7CgogIC8vIHNyYy9jb21tb24vbGliL2pzb25zY2hlbWEvYXR0cmlidXRlLmpzCiAgdmFyIHJlcXVpcmVfYXR0cmlidXRlID0gX19jb21tb25KUyh7CiAgICAic3JjL2NvbW1vbi9saWIvanNvbnNjaGVtYS9hdHRyaWJ1dGUuanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciBoZWxwZXJzID0gcmVxdWlyZV9oZWxwZXJzKCk7CiAgICAgIHZhciBWYWxpZGF0b3JSZXN1bHQgPSBoZWxwZXJzLlZhbGlkYXRvclJlc3VsdDsKICAgICAgdmFyIFNjaGVtYUVycm9yID0gaGVscGVycy5TY2hlbWFFcnJvcjsKICAgICAgdmFyIGF0dHJpYnV0ZSA9IHt9OwogICAgICBhdHRyaWJ1dGUuaWdub3JlUHJvcGVydGllcyA9IHsKICAgICAgICAiaWQiOiB0cnVlLAogICAgICAgICJkZWZhdWx0IjogdHJ1ZSwKICAgICAgICAiZGVzY3JpcHRpb24iOiB0cnVlLAogICAgICAgICJ0aXRsZSI6IHRydWUsCiAgICAgICAgImFkZGl0aW9uYWxJdGVtcyI6IHRydWUsCiAgICAgICAgInRoZW4iOiB0cnVlLAogICAgICAgICJlbHNlIjogdHJ1ZSwKICAgICAgICAiJHNjaGVtYSI6IHRydWUsCiAgICAgICAgIiRyZWYiOiB0cnVlLAogICAgICAgICJleHRlbmRzIjogdHJ1ZQogICAgICB9OwogICAgICB2YXIgdmFsaWRhdG9ycyA9IGF0dHJpYnV0ZS52YWxpZGF0b3JzID0ge307CiAgICAgIHZhbGlkYXRvcnMudHlwZSA9IGZ1bmN0aW9uIHZhbGlkYXRlVHlwZShpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoaW5zdGFuY2UgPT09IHZvaWQgMCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHR5cGVzID0gQXJyYXkuaXNBcnJheShzY2hlbWEudHlwZSkgPyBzY2hlbWEudHlwZSA6IFtzY2hlbWEudHlwZV07CiAgICAgICAgaWYgKCF0eXBlcy5zb21lKHRoaXMudGVzdFR5cGUuYmluZCh0aGlzLCBpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpKSkgewogICAgICAgICAgdmFyIGxpc3QgPSB0eXBlcy5tYXAoZnVuY3Rpb24odikgewogICAgICAgICAgICBpZiAoIXYpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB2YXIgaWQgPSB2LiRpZCB8fCB2LmlkOwogICAgICAgICAgICByZXR1cm4gaWQgPyAiPCIgKyBpZCArICI-IiA6IHYgKyAiIjsKICAgICAgICAgIH0pOwogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogInR5cGUiLAogICAgICAgICAgICBhcmd1bWVudDogbGlzdCwKICAgICAgICAgICAgbWVzc2FnZTogImlzIG5vdCBvZiBhIHR5cGUocykgIiArIGxpc3QKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBmdW5jdGlvbiB0ZXN0U2NoZW1hTm9UaHJvdyhpbnN0YW5jZSwgb3B0aW9ucywgY3R4LCBjYWxsYmFjaywgc2NoZW1hKSB7CiAgICAgICAgdmFyIHRocm93RXJyb3IgPSBvcHRpb25zLnRocm93RXJyb3I7CiAgICAgICAgdmFyIHRocm93QWxsID0gb3B0aW9ucy50aHJvd0FsbDsKICAgICAgICBvcHRpb25zLnRocm93RXJyb3IgPSBmYWxzZTsKICAgICAgICBvcHRpb25zLnRocm93QWxsID0gZmFsc2U7CiAgICAgICAgdmFyIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBvcHRpb25zLnRocm93RXJyb3IgPSB0aHJvd0Vycm9yOwogICAgICAgIG9wdGlvbnMudGhyb3dBbGwgPSB0aHJvd0FsbDsKICAgICAgICBpZiAoIXJlcy52YWxpZCAmJiBjYWxsYmFjayBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7CiAgICAgICAgICBjYWxsYmFjayhyZXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzLnZhbGlkOwogICAgICB9CiAgICAgIHZhbGlkYXRvcnMuYW55T2YgPSBmdW5jdGlvbiB2YWxpZGF0ZUFueU9mKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmIChpbnN0YW5jZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICB2YXIgaW5uZXIgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHNjaGVtYS5hbnlPZikpIHsKICAgICAgICAgIHRocm93IG5ldyBTY2hlbWFFcnJvcigiYW55T2YgbXVzdCBiZSBhbiBhcnJheSIpOwogICAgICAgIH0KICAgICAgICBpZiAoIXNjaGVtYS5hbnlPZi5zb21lKAogICAgICAgICAgdGVzdFNjaGVtYU5vVGhyb3cuYmluZCgKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgaW5zdGFuY2UsCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgIGN0eCwKICAgICAgICAgICAgZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgICAgICAgaW5uZXIuaW1wb3J0RXJyb3JzKHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICApKSB7CiAgICAgICAgICB2YXIgbGlzdCA9IHNjaGVtYS5hbnlPZi5tYXAoZnVuY3Rpb24odiwgaSkgewogICAgICAgICAgICB2YXIgaWQgPSB2LiRpZCB8fCB2LmlkOwogICAgICAgICAgICBpZiAoaWQpCiAgICAgICAgICAgICAgcmV0dXJuICI8IiArIGlkICsgIj4iOwogICAgICAgICAgICByZXR1cm4gdi50aXRsZSAmJiBKU09OLnN0cmluZ2lmeSh2LnRpdGxlKSB8fCB2WyIkcmVmIl0gJiYgIjwiICsgdlsiJHJlZiJdICsgIj4iIHx8ICJbc3Vic2NoZW1hICIgKyBpICsgIl0iOwogICAgICAgICAgfSk7CiAgICAgICAgICBpZiAob3B0aW9ucy5uZXN0ZWRFcnJvcnMpIHsKICAgICAgICAgICAgcmVzdWx0LmltcG9ydEVycm9ycyhpbm5lcik7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAiYW55T2YiLAogICAgICAgICAgICBhcmd1bWVudDogbGlzdCwKICAgICAgICAgICAgbWVzc2FnZTogImlzIG5vdCBhbnkgb2YgIiArIGxpc3Quam9pbigiLCIpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5hbGxPZiA9IGZ1bmN0aW9uIHZhbGlkYXRlQWxsT2YoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKGluc3RhbmNlID09PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NoZW1hLmFsbE9mKSkgewogICAgICAgICAgdGhyb3cgbmV3IFNjaGVtYUVycm9yKCJhbGxPZiBtdXN0IGJlIGFuIGFycmF5Iik7CiAgICAgICAgfQogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHNlbGYyID0gdGhpczsKICAgICAgICBzY2hlbWEuYWxsT2YuZm9yRWFjaChmdW5jdGlvbih2LCBpKSB7CiAgICAgICAgICB2YXIgdmFsaWQgPSBzZWxmMi52YWxpZGF0ZVNjaGVtYShpbnN0YW5jZSwgdiwgb3B0aW9ucywgY3R4KTsKICAgICAgICAgIGlmICghdmFsaWQudmFsaWQpIHsKICAgICAgICAgICAgdmFyIGlkID0gdi4kaWQgfHwgdi5pZDsKICAgICAgICAgICAgdmFyIG1zZyA9IGlkIHx8IHYudGl0bGUgJiYgSlNPTi5zdHJpbmdpZnkodi50aXRsZSkgfHwgdlsiJHJlZiJdICYmICI8IiArIHZbIiRyZWYiXSArICI-IiB8fCAiW3N1YnNjaGVtYSAiICsgaSArICJdIjsKICAgICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgICBuYW1lOiAiYWxsT2YiLAogICAgICAgICAgICAgIGFyZ3VtZW50OiB7IGlkOiBtc2csIGxlbmd0aDogdmFsaWQuZXJyb3JzLmxlbmd0aCwgdmFsaWQgfSwKICAgICAgICAgICAgICBtZXNzYWdlOiAiZG9lcyBub3QgbWF0Y2ggYWxsT2Ygc2NoZW1hICIgKyBtc2cgKyAiIHdpdGggIiArIHZhbGlkLmVycm9ycy5sZW5ndGggKyAiIGVycm9yW3NdOiIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJlc3VsdC5pbXBvcnRFcnJvcnModmFsaWQpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMub25lT2YgPSBmdW5jdGlvbiB2YWxpZGF0ZU9uZU9mKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmIChpbnN0YW5jZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHNjaGVtYS5vbmVPZikpIHsKICAgICAgICAgIHRocm93IG5ldyBTY2hlbWFFcnJvcigib25lT2YgbXVzdCBiZSBhbiBhcnJheSIpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIHZhciBpbm5lciA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICB2YXIgY291bnQgPSBzY2hlbWEub25lT2YuZmlsdGVyKAogICAgICAgICAgdGVzdFNjaGVtYU5vVGhyb3cuYmluZCgKICAgICAgICAgICAgdGhpcywKICAgICAgICAgICAgaW5zdGFuY2UsCiAgICAgICAgICAgIG9wdGlvbnMsCiAgICAgICAgICAgIGN0eCwKICAgICAgICAgICAgZnVuY3Rpb24ocmVzKSB7CiAgICAgICAgICAgICAgaW5uZXIuaW1wb3J0RXJyb3JzKHJlcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICkKICAgICAgICApLmxlbmd0aDsKICAgICAgICB2YXIgbGlzdCA9IHNjaGVtYS5vbmVPZi5tYXAoZnVuY3Rpb24odiwgaSkgewogICAgICAgICAgdmFyIGlkID0gdi4kaWQgfHwgdi5pZDsKICAgICAgICAgIHJldHVybiBpZCB8fCB2LnRpdGxlICYmIEpTT04uc3RyaW5naWZ5KHYudGl0bGUpIHx8IHZbIiRyZWYiXSAmJiAiPCIgKyB2WyIkcmVmIl0gKyAiPiIgfHwgIltzdWJzY2hlbWEgIiArIGkgKyAiXSI7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGNvdW50ICE9PSAxKSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5uZXN0ZWRFcnJvcnMpIHsKICAgICAgICAgICAgcmVzdWx0LmltcG9ydEVycm9ycyhpbm5lcik7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAib25lT2YiLAogICAgICAgICAgICBhcmd1bWVudDogbGlzdCwKICAgICAgICAgICAgbWVzc2FnZTogImlzIG5vdCBleGFjdGx5IG9uZSBmcm9tICIgKyBsaXN0LmpvaW4oIiwiKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMuaWYgPSBmdW5jdGlvbiB2YWxpZGF0ZUlmKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmIChpbnN0YW5jZSA9PT0gdm9pZCAwKQogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgaWYgKCFoZWxwZXJzLmlzU2NoZW1hKHNjaGVtYS5pZikpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkICJpZiIga2V5d29yZCB0byBiZSBhIHNjaGVtYScpOwogICAgICAgIHZhciBpZlZhbGlkID0gdGVzdFNjaGVtYU5vVGhyb3cuY2FsbCh0aGlzLCBpbnN0YW5jZSwgb3B0aW9ucywgY3R4LCBudWxsLCBzY2hlbWEuaWYpOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHJlczsKICAgICAgICBpZiAoaWZWYWxpZCkgewogICAgICAgICAgaWYgKHNjaGVtYS50aGVuID09PSB2b2lkIDApCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIGlmICghaGVscGVycy5pc1NjaGVtYShzY2hlbWEudGhlbikpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignRXhwZWN0ZWQgInRoZW4iIGtleXdvcmQgdG8gYmUgYSBzY2hlbWEnKTsKICAgICAgICAgIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEoaW5zdGFuY2UsIHNjaGVtYS50aGVuLCBvcHRpb25zLCBjdHgubWFrZUNoaWxkKHNjaGVtYS50aGVuKSk7CiAgICAgICAgICByZXN1bHQuaW1wb3J0RXJyb3JzKHJlcyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChzY2hlbWEuZWxzZSA9PT0gdm9pZCAwKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBpZiAoIWhlbHBlcnMuaXNTY2hlbWEoc2NoZW1hLmVsc2UpKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkICJlbHNlIiBrZXl3b3JkIHRvIGJlIGEgc2NoZW1hJyk7CiAgICAgICAgICByZXMgPSB0aGlzLnZhbGlkYXRlU2NoZW1hKGluc3RhbmNlLCBzY2hlbWEuZWxzZSwgb3B0aW9ucywgY3R4Lm1ha2VDaGlsZChzY2hlbWEuZWxzZSkpOwogICAgICAgICAgcmVzdWx0LmltcG9ydEVycm9ycyhyZXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBmdW5jdGlvbiBnZXRFbnVtZXJhYmxlUHJvcGVydHkob2JqZWN0LCBrZXkpIHsKICAgICAgICBpZiAoT2JqZWN0Lmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBrZXkpKQogICAgICAgICAgcmV0dXJuIG9iamVjdFtrZXldOwogICAgICAgIGlmICghKGtleSBpbiBvYmplY3QpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHdoaWxlIChvYmplY3QgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqZWN0KSkgewogICAgICAgICAgaWYgKE9iamVjdC5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKG9iamVjdCwga2V5KSkKICAgICAgICAgICAgcmV0dXJuIG9iamVjdFtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgICB2YWxpZGF0b3JzLnByb3BlcnR5TmFtZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZVByb3BlcnR5TmFtZXMoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKCF0aGlzLnR5cGVzLm9iamVjdChpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICB2YXIgc3Vic2NoZW1hID0gc2NoZW1hLnByb3BlcnR5TmFtZXMgIT09IHZvaWQgMCA_IHNjaGVtYS5wcm9wZXJ0eU5hbWVzIDoge307CiAgICAgICAgaWYgKCFoZWxwZXJzLmlzU2NoZW1hKHN1YnNjaGVtYSkpCiAgICAgICAgICB0aHJvdyBuZXcgU2NoZW1hRXJyb3IoJ0V4cGVjdGVkICJwcm9wZXJ0eU5hbWVzIiB0byBiZSBhIHNjaGVtYSAob2JqZWN0IG9yIGJvb2xlYW4pJyk7CiAgICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gaW5zdGFuY2UpIHsKICAgICAgICAgIGlmIChnZXRFbnVtZXJhYmxlUHJvcGVydHkoaW5zdGFuY2UsIHByb3BlcnR5KSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICAgIHZhciByZXMgPSB0aGlzLnZhbGlkYXRlU2NoZW1hKHByb3BlcnR5LCBzdWJzY2hlbWEsIG9wdGlvbnMsIGN0eC5tYWtlQ2hpbGQoc3Vic2NoZW1hKSk7CiAgICAgICAgICAgIHJlc3VsdC5pbXBvcnRFcnJvcnMocmVzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5wcm9wZXJ0aWVzID0gZnVuY3Rpb24gdmFsaWRhdGVQcm9wZXJ0aWVzKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5vYmplY3QoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBzY2hlbWEucHJvcGVydGllcyB8fCB7fTsKICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgICB2YXIgc3Vic2NoZW1hID0gcHJvcGVydGllc1twcm9wZXJ0eV07CiAgICAgICAgICBpZiAoc3Vic2NoZW1hID09PSB2b2lkIDApIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHN1YnNjaGVtYSA9PT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgU2NoZW1hRXJyb3IoJ1VuZXhwZWN0ZWQgbnVsbCwgZXhwZWN0ZWQgc2NoZW1hIGluICJwcm9wZXJ0aWVzIicpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnByZVZhbGlkYXRlUHJvcGVydHkgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICBvcHRpb25zLnByZVZhbGlkYXRlUHJvcGVydHkoaW5zdGFuY2UsIHByb3BlcnR5LCBzdWJzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcHJvcCA9IGdldEVudW1lcmFibGVQcm9wZXJ0eShpbnN0YW5jZSwgcHJvcGVydHkpOwogICAgICAgICAgdmFyIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEocHJvcCwgc3Vic2NoZW1hLCBvcHRpb25zLCBjdHgubWFrZUNoaWxkKHN1YnNjaGVtYSwgcHJvcGVydHkpKTsKICAgICAgICAgIGlmIChyZXMuaW5zdGFuY2UgIT09IHJlc3VsdC5pbnN0YW5jZVtwcm9wZXJ0eV0pCiAgICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZVtwcm9wZXJ0eV0gPSByZXMuaW5zdGFuY2U7CiAgICAgICAgICByZXN1bHQuaW1wb3J0RXJyb3JzKHJlcyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHRlc3RBZGRpdGlvbmFsUHJvcGVydHkoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4LCBwcm9wZXJ0eSwgcmVzdWx0KSB7CiAgICAgICAgaWYgKCF0aGlzLnR5cGVzLm9iamVjdChpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHNjaGVtYS5wcm9wZXJ0aWVzICYmIHNjaGVtYS5wcm9wZXJ0aWVzW3Byb3BlcnR5XSAhPT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChzY2hlbWEuYWRkaXRpb25hbFByb3BlcnRpZXMgPT09IGZhbHNlKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAiYWRkaXRpb25hbFByb3BlcnRpZXMiLAogICAgICAgICAgICBhcmd1bWVudDogcHJvcGVydHksCiAgICAgICAgICAgIG1lc3NhZ2U6ICJpcyBub3QgYWxsb3dlZCB0byBoYXZlIHRoZSBhZGRpdGlvbmFsIHByb3BlcnR5ICIgKyBKU09OLnN0cmluZ2lmeShwcm9wZXJ0eSkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgYWRkaXRpb25hbFByb3BlcnRpZXMgPSBzY2hlbWEuYWRkaXRpb25hbFByb3BlcnRpZXMgfHwge307CiAgICAgICAgICBpZiAodHlwZW9mIG9wdGlvbnMucHJlVmFsaWRhdGVQcm9wZXJ0eSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgIG9wdGlvbnMucHJlVmFsaWRhdGVQcm9wZXJ0eShpbnN0YW5jZSwgcHJvcGVydHksIGFkZGl0aW9uYWxQcm9wZXJ0aWVzLCBvcHRpb25zLCBjdHgpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEoaW5zdGFuY2VbcHJvcGVydHldLCBhZGRpdGlvbmFsUHJvcGVydGllcywgb3B0aW9ucywgY3R4Lm1ha2VDaGlsZChhZGRpdGlvbmFsUHJvcGVydGllcywgcHJvcGVydHkpKTsKICAgICAgICAgIGlmIChyZXMuaW5zdGFuY2UgIT09IHJlc3VsdC5pbnN0YW5jZVtwcm9wZXJ0eV0pCiAgICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZVtwcm9wZXJ0eV0gPSByZXMuaW5zdGFuY2U7CiAgICAgICAgICByZXN1bHQuaW1wb3J0RXJyb3JzKHJlcyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhbGlkYXRvcnMucGF0dGVyblByb3BlcnRpZXMgPSBmdW5jdGlvbiB2YWxpZGF0ZVBhdHRlcm5Qcm9wZXJ0aWVzKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5vYmplY3QoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHBhdHRlcm5Qcm9wZXJ0aWVzID0gc2NoZW1hLnBhdHRlcm5Qcm9wZXJ0aWVzIHx8IHt9OwogICAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIGluc3RhbmNlKSB7CiAgICAgICAgICB2YXIgdGVzdCA9IHRydWU7CiAgICAgICAgICBmb3IgKHZhciBwYXR0ZXJuIGluIHBhdHRlcm5Qcm9wZXJ0aWVzKSB7CiAgICAgICAgICAgIHZhciBzdWJzY2hlbWEgPSBwYXR0ZXJuUHJvcGVydGllc1twYXR0ZXJuXTsKICAgICAgICAgICAgaWYgKHN1YnNjaGVtYSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3Vic2NoZW1hID09PSBudWxsKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IFNjaGVtYUVycm9yKCdVbmV4cGVjdGVkIG51bGwsIGV4cGVjdGVkIHNjaGVtYSBpbiAicGF0dGVyblByb3BlcnRpZXMiJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgcmVnZXhwID0gbmV3IFJlZ0V4cChwYXR0ZXJuLCAidSIpOwogICAgICAgICAgICB9IGNhdGNoIChfZSkgewogICAgICAgICAgICAgIHJlZ2V4cCA9IG5ldyBSZWdFeHAocGF0dGVybik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFyZWdleHAudGVzdChwcm9wZXJ0eSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0ZXN0ID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5wcmVWYWxpZGF0ZVByb3BlcnR5ID09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBvcHRpb25zLnByZVZhbGlkYXRlUHJvcGVydHkoaW5zdGFuY2UsIHByb3BlcnR5LCBzdWJzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEoaW5zdGFuY2VbcHJvcGVydHldLCBzdWJzY2hlbWEsIG9wdGlvbnMsIGN0eC5tYWtlQ2hpbGQoc3Vic2NoZW1hLCBwcm9wZXJ0eSkpOwogICAgICAgICAgICBpZiAocmVzLmluc3RhbmNlICE9PSByZXN1bHQuaW5zdGFuY2VbcHJvcGVydHldKQogICAgICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZVtwcm9wZXJ0eV0gPSByZXMuaW5zdGFuY2U7CiAgICAgICAgICAgIHJlc3VsdC5pbXBvcnRFcnJvcnMocmVzKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0ZXN0KSB7CiAgICAgICAgICAgIHRlc3RBZGRpdGlvbmFsUHJvcGVydHkuY2FsbCh0aGlzLCBpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgsIHByb3BlcnR5LCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLmFkZGl0aW9uYWxQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdmFsaWRhdGVBZGRpdGlvbmFsUHJvcGVydGllcyhpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoIXRoaXMudHlwZXMub2JqZWN0KGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoc2NoZW1hLnBhdHRlcm5Qcm9wZXJ0aWVzKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBpbnN0YW5jZSkgewogICAgICAgICAgdGVzdEFkZGl0aW9uYWxQcm9wZXJ0eS5jYWxsKHRoaXMsIGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCwgcHJvcGVydHksIHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMubWluUHJvcGVydGllcyA9IGZ1bmN0aW9uIHZhbGlkYXRlTWluUHJvcGVydGllcyhpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoIXRoaXMudHlwZXMub2JqZWN0KGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIHZhciBrZXlzNCA9IE9iamVjdC5rZXlzKGluc3RhbmNlKTsKICAgICAgICBpZiAoIShrZXlzNC5sZW5ndGggPj0gc2NoZW1hLm1pblByb3BlcnRpZXMpKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAibWluUHJvcGVydGllcyIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWEubWluUHJvcGVydGllcywKICAgICAgICAgICAgbWVzc2FnZTogImRvZXMgbm90IG1lZXQgbWluaW11bSBwcm9wZXJ0eSBsZW5ndGggb2YgIiArIHNjaGVtYS5taW5Qcm9wZXJ0aWVzCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5tYXhQcm9wZXJ0aWVzID0gZnVuY3Rpb24gdmFsaWRhdGVNYXhQcm9wZXJ0aWVzKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5vYmplY3QoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIGtleXM0ID0gT2JqZWN0LmtleXMoaW5zdGFuY2UpOwogICAgICAgIGlmICghKGtleXM0Lmxlbmd0aCA8PSBzY2hlbWEubWF4UHJvcGVydGllcykpIHsKICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgIG5hbWU6ICJtYXhQcm9wZXJ0aWVzIiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5tYXhQcm9wZXJ0aWVzLAogICAgICAgICAgICBtZXNzYWdlOiAiZG9lcyBub3QgbWVldCBtYXhpbXVtIHByb3BlcnR5IGxlbmd0aCBvZiAiICsgc2NoZW1hLm1heFByb3BlcnRpZXMKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLml0ZW1zID0gZnVuY3Rpb24gdmFsaWRhdGVJdGVtcyhpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICB2YXIgc2VsZjIgPSB0aGlzOwogICAgICAgIGlmICghdGhpcy50eXBlcy5hcnJheShpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKHNjaGVtYS5pdGVtcyA9PT0gdm9pZCAwKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgaW5zdGFuY2UuZXZlcnkoZnVuY3Rpb24odmFsdWUsIGkpIHsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNjaGVtYS5pdGVtcykpIHsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gc2NoZW1hLml0ZW1zW2ldID09PSB2b2lkIDAgPyBzY2hlbWEuYWRkaXRpb25hbEl0ZW1zIDogc2NoZW1hLml0ZW1zW2ldOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGl0ZW1zID0gc2NoZW1hLml0ZW1zOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGl0ZW1zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaXRlbXMgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgICAgbmFtZTogIml0ZW1zIiwKICAgICAgICAgICAgICBtZXNzYWdlOiAiYWRkaXRpb25hbEl0ZW1zIG5vdCBwZXJtaXR0ZWQiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgcmVzID0gc2VsZjIudmFsaWRhdGVTY2hlbWEodmFsdWUsIGl0ZW1zLCBvcHRpb25zLCBjdHgubWFrZUNoaWxkKGl0ZW1zLCBpKSk7CiAgICAgICAgICBpZiAocmVzLmluc3RhbmNlICE9PSByZXN1bHQuaW5zdGFuY2VbaV0pCiAgICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZVtpXSA9IHJlcy5pbnN0YW5jZTsKICAgICAgICAgIHJlc3VsdC5pbXBvcnRFcnJvcnMocmVzKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMuY29udGFpbnMgPSBmdW5jdGlvbiB2YWxpZGF0ZUNvbnRhaW5zKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIHZhciBzZWxmMiA9IHRoaXM7CiAgICAgICAgaWYgKCF0aGlzLnR5cGVzLmFycmF5KGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoc2NoZW1hLmNvbnRhaW5zID09PSB2b2lkIDApCiAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKCFoZWxwZXJzLmlzU2NoZW1hKHNjaGVtYS5jb250YWlucykpCiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V4cGVjdGVkICJjb250YWlucyIga2V5d29yZCB0byBiZSBhIHNjaGVtYScpOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIGNvdW50ID0gaW5zdGFuY2Uuc29tZShmdW5jdGlvbih2YWx1ZSwgaSkgewogICAgICAgICAgdmFyIHJlcyA9IHNlbGYyLnZhbGlkYXRlU2NoZW1hKHZhbHVlLCBzY2hlbWEuY29udGFpbnMsIG9wdGlvbnMsIGN0eC5tYWtlQ2hpbGQoc2NoZW1hLmNvbnRhaW5zLCBpKSk7CiAgICAgICAgICByZXR1cm4gcmVzLmVycm9ycy5sZW5ndGggPT09IDA7CiAgICAgICAgfSk7CiAgICAgICAgaWYgKGNvdW50ID09PSBmYWxzZSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogImNvbnRhaW5zIiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5jb250YWlucywKICAgICAgICAgICAgbWVzc2FnZTogIm11c3QgY29udGFpbiBhbiBpdGVtIG1hdGNoaW5nIGdpdmVuIHNjaGVtYSIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLm1pbmltdW0gPSBmdW5jdGlvbiB2YWxpZGF0ZU1pbmltdW0oaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKCF0aGlzLnR5cGVzLm51bWJlcihpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBpZiAoc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW0gJiYgc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW0gPT09IHRydWUpIHsKICAgICAgICAgIGlmICghKGluc3RhbmNlID4gc2NoZW1hLm1pbmltdW0pKSB7CiAgICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgICAgbmFtZTogIm1pbmltdW0iLAogICAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWEubWluaW11bSwKICAgICAgICAgICAgICBtZXNzYWdlOiAibXVzdCBiZSBncmVhdGVyIHRoYW4gIiArIHNjaGVtYS5taW5pbXVtCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoIShpbnN0YW5jZSA-PSBzY2hlbWEubWluaW11bSkpIHsKICAgICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgICBuYW1lOiAibWluaW11bSIsCiAgICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5taW5pbXVtLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICJtdXN0IGJlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byAiICsgc2NoZW1hLm1pbmltdW0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMubWF4aW11bSA9IGZ1bmN0aW9uIHZhbGlkYXRlTWF4aW11bShpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoIXRoaXMudHlwZXMubnVtYmVyKGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIGlmIChzY2hlbWEuZXhjbHVzaXZlTWF4aW11bSAmJiBzY2hlbWEuZXhjbHVzaXZlTWF4aW11bSA9PT0gdHJ1ZSkgewogICAgICAgICAgaWYgKCEoaW5zdGFuY2UgPCBzY2hlbWEubWF4aW11bSkpIHsKICAgICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgICBuYW1lOiAibWF4aW11bSIsCiAgICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5tYXhpbXVtLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICJtdXN0IGJlIGxlc3MgdGhhbiAiICsgc2NoZW1hLm1heGltdW0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmICghKGluc3RhbmNlIDw9IHNjaGVtYS5tYXhpbXVtKSkgewogICAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICAgIG5hbWU6ICJtYXhpbXVtIiwKICAgICAgICAgICAgICBhcmd1bWVudDogc2NoZW1hLm1heGltdW0sCiAgICAgICAgICAgICAgbWVzc2FnZTogIm11c3QgYmUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvICIgKyBzY2hlbWEubWF4aW11bQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5leGNsdXNpdmVNaW5pbXVtID0gZnVuY3Rpb24gdmFsaWRhdGVFeGNsdXNpdmVNaW5pbXVtKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICh0eXBlb2Ygc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW0gPT09ICJib29sZWFuIikKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoIXRoaXMudHlwZXMubnVtYmVyKGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIHZhciB2YWxpZCA9IGluc3RhbmNlID4gc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW07CiAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogImV4Y2x1c2l2ZU1pbmltdW0iLAogICAgICAgICAgICBhcmd1bWVudDogc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW0sCiAgICAgICAgICAgIG1lc3NhZ2U6ICJtdXN0IGJlIHN0cmljdGx5IGdyZWF0ZXIgdGhhbiAiICsgc2NoZW1hLmV4Y2x1c2l2ZU1pbmltdW0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLmV4Y2x1c2l2ZU1heGltdW0gPSBmdW5jdGlvbiB2YWxpZGF0ZUV4Y2x1c2l2ZU1heGltdW0oaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKHR5cGVvZiBzY2hlbWEuZXhjbHVzaXZlTWF4aW11bSA9PT0gImJvb2xlYW4iKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGlmICghdGhpcy50eXBlcy5udW1iZXIoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHZhbGlkID0gaW5zdGFuY2UgPCBzY2hlbWEuZXhjbHVzaXZlTWF4aW11bTsKICAgICAgICBpZiAoIXZhbGlkKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAiZXhjbHVzaXZlTWF4aW11bSIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWEuZXhjbHVzaXZlTWF4aW11bSwKICAgICAgICAgICAgbWVzc2FnZTogIm11c3QgYmUgc3RyaWN0bHkgbGVzcyB0aGFuICIgKyBzY2hlbWEuZXhjbHVzaXZlTWF4aW11bQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhciB2YWxpZGF0ZU11bHRpcGxlT2ZPckRpdmlzYmxlQnkgPSBmdW5jdGlvbiB2YWxpZGF0ZU11bHRpcGxlT2ZPckRpdmlzYmxlQnkyKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCwgdmFsaWRhdGlvblR5cGUsIGVycm9yTWVzc2FnZSkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5udW1iZXIoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciB2YWxpZGF0aW9uQXJndW1lbnQgPSBzY2hlbWFbdmFsaWRhdGlvblR5cGVdOwogICAgICAgIGlmICh2YWxpZGF0aW9uQXJndW1lbnQgPT0gMCkgewogICAgICAgICAgdGhyb3cgbmV3IFNjaGVtYUVycm9yKHZhbGlkYXRpb25UeXBlICsgIiBjYW5ub3QgYmUgemVybyIpOwogICAgICAgIH0KICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIHZhciBpbnN0YW5jZURlY2ltYWxzID0gaGVscGVycy5nZXREZWNpbWFsUGxhY2VzKGluc3RhbmNlKTsKICAgICAgICB2YXIgZGl2aXNvckRlY2ltYWxzID0gaGVscGVycy5nZXREZWNpbWFsUGxhY2VzKHZhbGlkYXRpb25Bcmd1bWVudCk7CiAgICAgICAgdmFyIG1heERlY2ltYWxzID0gTWF0aC5tYXgoaW5zdGFuY2VEZWNpbWFscywgZGl2aXNvckRlY2ltYWxzKTsKICAgICAgICB2YXIgbXVsdGlwbGllciA9IE1hdGgucG93KDEwLCBtYXhEZWNpbWFscyk7CiAgICAgICAgaWYgKE1hdGgucm91bmQoaW5zdGFuY2UgKiBtdWx0aXBsaWVyKSAlIE1hdGgucm91bmQodmFsaWRhdGlvbkFyZ3VtZW50ICogbXVsdGlwbGllcikgIT09IDApIHsKICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgIG5hbWU6IHZhbGlkYXRpb25UeXBlLAogICAgICAgICAgICBhcmd1bWVudDogdmFsaWRhdGlvbkFyZ3VtZW50LAogICAgICAgICAgICBtZXNzYWdlOiBlcnJvck1lc3NhZ2UgKyBKU09OLnN0cmluZ2lmeSh2YWxpZGF0aW9uQXJndW1lbnQpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5tdWx0aXBsZU9mID0gZnVuY3Rpb24gdmFsaWRhdGVNdWx0aXBsZU9mKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIHJldHVybiB2YWxpZGF0ZU11bHRpcGxlT2ZPckRpdmlzYmxlQnkuY2FsbCh0aGlzLCBpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgsICJtdWx0aXBsZU9mIiwgImlzIG5vdCBhIG11bHRpcGxlIG9mIChkaXZpc2libGUgYnkpICIpOwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLmRpdmlzaWJsZUJ5ID0gZnVuY3Rpb24gdmFsaWRhdGVEaXZpc2libGVCeShpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICByZXR1cm4gdmFsaWRhdGVNdWx0aXBsZU9mT3JEaXZpc2JsZUJ5LmNhbGwodGhpcywgaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4LCAiZGl2aXNpYmxlQnkiLCAiaXMgbm90IGRpdmlzaWJsZSBieSAobXVsdGlwbGUgb2YpICIpOwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLnJlcXVpcmVkID0gZnVuY3Rpb24gdmFsaWRhdGVSZXF1aXJlZChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIGlmIChpbnN0YW5jZSA9PT0gdm9pZCAwICYmIHNjaGVtYS5yZXF1aXJlZCA9PT0gdHJ1ZSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogInJlcXVpcmVkIiwKICAgICAgICAgICAgbWVzc2FnZTogImlzIHJlcXVpcmVkIgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnR5cGVzLm9iamVjdChpbnN0YW5jZSkgJiYgQXJyYXkuaXNBcnJheShzY2hlbWEucmVxdWlyZWQpKSB7CiAgICAgICAgICBzY2hlbWEucmVxdWlyZWQuZm9yRWFjaChmdW5jdGlvbihuKSB7CiAgICAgICAgICAgIGlmIChnZXRFbnVtZXJhYmxlUHJvcGVydHkoaW5zdGFuY2UsIG4pID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICAgICAgbmFtZTogInJlcXVpcmVkIiwKICAgICAgICAgICAgICAgIGFyZ3VtZW50OiBuLAogICAgICAgICAgICAgICAgbWVzc2FnZTogInJlcXVpcmVzIHByb3BlcnR5ICIgKyBKU09OLnN0cmluZ2lmeShuKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5wYXR0ZXJuID0gZnVuY3Rpb24gdmFsaWRhdGVQYXR0ZXJuKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5zdHJpbmcoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIHBhdHRlcm4gPSBzY2hlbWEucGF0dGVybjsKICAgICAgICB0cnkgewogICAgICAgICAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAocGF0dGVybiwgInUiKTsKICAgICAgICB9IGNhdGNoIChfZSkgewogICAgICAgICAgcmVnZXhwID0gbmV3IFJlZ0V4cChwYXR0ZXJuKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpbnN0YW5jZS5tYXRjaChyZWdleHApKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAicGF0dGVybiIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWEucGF0dGVybiwKICAgICAgICAgICAgbWVzc2FnZTogImRvZXMgbm90IG1hdGNoIHBhdHRlcm4gIiArIEpTT04uc3RyaW5naWZ5KHNjaGVtYS5wYXR0ZXJuLnRvU3RyaW5nKCkpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5mb3JtYXQgPSBmdW5jdGlvbiB2YWxpZGF0ZUZvcm1hdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoaW5zdGFuY2UgPT09IHZvaWQgMCkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIGlmICghcmVzdWx0LmRpc2FibGVGb3JtYXQgJiYgIWhlbHBlcnMuaXNGb3JtYXQoaW5zdGFuY2UsIHNjaGVtYS5mb3JtYXQsIHRoaXMpKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAiZm9ybWF0IiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5mb3JtYXQsCiAgICAgICAgICAgIG1lc3NhZ2U6ICJkb2VzIG5vdCBjb25mb3JtIHRvIHRoZSAiICsgSlNPTi5zdHJpbmdpZnkoc2NoZW1hLmZvcm1hdCkgKyAiIGZvcm1hdCIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzLm1pbkxlbmd0aCA9IGZ1bmN0aW9uIHZhbGlkYXRlTWluTGVuZ3RoKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5zdHJpbmcoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIGhzcCA9IGluc3RhbmNlLm1hdGNoKC9bXHVEQzAwLVx1REZGRl0vZyk7CiAgICAgICAgdmFyIGxlbmd0aCA9IGluc3RhbmNlLmxlbmd0aCAtIChoc3AgPyBoc3AubGVuZ3RoIDogMCk7CiAgICAgICAgaWYgKCEobGVuZ3RoID49IHNjaGVtYS5taW5MZW5ndGgpKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAibWluTGVuZ3RoIiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5taW5MZW5ndGgsCiAgICAgICAgICAgIG1lc3NhZ2U6ICJkb2VzIG5vdCBtZWV0IG1pbmltdW0gbGVuZ3RoIG9mICIgKyBzY2hlbWEubWluTGVuZ3RoCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5tYXhMZW5ndGggPSBmdW5jdGlvbiB2YWxpZGF0ZU1heExlbmd0aChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpIHsKICAgICAgICBpZiAoIXRoaXMudHlwZXMuc3RyaW5nKGluc3RhbmNlKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRvclJlc3VsdChpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIHZhciBoc3AgPSBpbnN0YW5jZS5tYXRjaCgvW1x1REMwMC1cdURGRkZdL2cpOwogICAgICAgIHZhciBsZW5ndGggPSBpbnN0YW5jZS5sZW5ndGggLSAoaHNwID8gaHNwLmxlbmd0aCA6IDApOwogICAgICAgIGlmICghKGxlbmd0aCA8PSBzY2hlbWEubWF4TGVuZ3RoKSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogIm1heExlbmd0aCIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWEubWF4TGVuZ3RoLAogICAgICAgICAgICBtZXNzYWdlOiAiZG9lcyBub3QgbWVldCBtYXhpbXVtIGxlbmd0aCBvZiAiICsgc2NoZW1hLm1heExlbmd0aAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMubWluSXRlbXMgPSBmdW5jdGlvbiB2YWxpZGF0ZU1pbkl0ZW1zKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5hcnJheShpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBpZiAoIShpbnN0YW5jZS5sZW5ndGggPj0gc2NoZW1hLm1pbkl0ZW1zKSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogIm1pbkl0ZW1zIiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5taW5JdGVtcywKICAgICAgICAgICAgbWVzc2FnZTogImRvZXMgbm90IG1lZXQgbWluaW11bSBsZW5ndGggb2YgIiArIHNjaGVtYS5taW5JdGVtcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMubWF4SXRlbXMgPSBmdW5jdGlvbiB2YWxpZGF0ZU1heEl0ZW1zKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmICghdGhpcy50eXBlcy5hcnJheShpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBpZiAoIShpbnN0YW5jZS5sZW5ndGggPD0gc2NoZW1hLm1heEl0ZW1zKSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogIm1heEl0ZW1zIiwKICAgICAgICAgICAgYXJndW1lbnQ6IHNjaGVtYS5tYXhJdGVtcywKICAgICAgICAgICAgbWVzc2FnZTogImRvZXMgbm90IG1lZXQgbWF4aW11bSBsZW5ndGggb2YgIiArIHNjaGVtYS5tYXhJdGVtcwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIGZ1bmN0aW9uIHRlc3RBcnJheXModiwgaSwgYSkgewogICAgICAgIHZhciBqLCBsZW4gPSBhLmxlbmd0aDsKICAgICAgICBmb3IgKGogPSBpICsgMSwgbGVuOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICAgIGlmIChoZWxwZXJzLmRlZXBDb21wYXJlU3RyaWN0KHYsIGFbal0pKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgdmFsaWRhdG9ycy51bmlxdWVJdGVtcyA9IGZ1bmN0aW9uIHZhbGlkYXRlVW5pcXVlSXRlbXMoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKHNjaGVtYS51bmlxdWVJdGVtcyAhPT0gdHJ1ZSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBpZiAoIXRoaXMudHlwZXMuYXJyYXkoaW5zdGFuY2UpKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgaWYgKCFpbnN0YW5jZS5ldmVyeSh0ZXN0QXJyYXlzKSkgewogICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgbmFtZTogInVuaXF1ZUl0ZW1zIiwKICAgICAgICAgICAgbWVzc2FnZTogImNvbnRhaW5zIGR1cGxpY2F0ZSBpdGVtIgogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH07CiAgICAgIHZhbGlkYXRvcnMuZGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gdmFsaWRhdGVEZXBlbmRlbmNpZXMoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKCF0aGlzLnR5cGVzLm9iamVjdChpbnN0YW5jZSkpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzY2hlbWEuZGVwZW5kZW5jaWVzKSB7CiAgICAgICAgICBpZiAoaW5zdGFuY2VbcHJvcGVydHldID09PSB2b2lkIDApIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZGVwID0gc2NoZW1hLmRlcGVuZGVuY2llc1twcm9wZXJ0eV07CiAgICAgICAgICB2YXIgY2hpbGRDb250ZXh0ID0gY3R4Lm1ha2VDaGlsZChkZXAsIHByb3BlcnR5KTsKICAgICAgICAgIGlmICh0eXBlb2YgZGVwID09ICJzdHJpbmciKSB7CiAgICAgICAgICAgIGRlcCA9IFtkZXBdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoZGVwKSkgewogICAgICAgICAgICBkZXAuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7CiAgICAgICAgICAgICAgaWYgKGluc3RhbmNlW3Byb3BdID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgICAgICAgIG5hbWU6ICJkZXBlbmRlbmNpZXMiLAogICAgICAgICAgICAgICAgICBhcmd1bWVudDogY2hpbGRDb250ZXh0LnByb3BlcnR5UGF0aCwKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogInByb3BlcnR5ICIgKyBwcm9wICsgIiBub3QgZm91bmQsIHJlcXVpcmVkIGJ5ICIgKyBjaGlsZENvbnRleHQucHJvcGVydHlQYXRoCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIHJlcyA9IHRoaXMudmFsaWRhdGVTY2hlbWEoaW5zdGFuY2UsIGRlcCwgb3B0aW9ucywgY2hpbGRDb250ZXh0KTsKICAgICAgICAgICAgaWYgKHJlc3VsdC5pbnN0YW5jZSAhPT0gcmVzLmluc3RhbmNlKQogICAgICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZSA9IHJlcy5pbnN0YW5jZTsKICAgICAgICAgICAgaWYgKHJlcyAmJiByZXMuZXJyb3JzLmxlbmd0aCkgewogICAgICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgICAgICBuYW1lOiAiZGVwZW5kZW5jaWVzIiwKICAgICAgICAgICAgICAgIGFyZ3VtZW50OiBjaGlsZENvbnRleHQucHJvcGVydHlQYXRoLAogICAgICAgICAgICAgICAgbWVzc2FnZTogImRvZXMgbm90IG1lZXQgZGVwZW5kZW5jeSByZXF1aXJlZCBieSAiICsgY2hpbGRDb250ZXh0LnByb3BlcnR5UGF0aAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJlc3VsdC5pbXBvcnRFcnJvcnMocmVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzWyJlbnVtIl0gPSBmdW5jdGlvbiB2YWxpZGF0ZUVudW0oaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKGluc3RhbmNlID09PSB2b2lkIDApIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoc2NoZW1hWyJlbnVtIl0pKSB7CiAgICAgICAgICB0aHJvdyBuZXcgU2NoZW1hRXJyb3IoImVudW0gZXhwZWN0cyBhbiBhcnJheSIsIHNjaGVtYSk7CiAgICAgICAgfQogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgaWYgKCFzY2hlbWFbImVudW0iXS5zb21lKGhlbHBlcnMuZGVlcENvbXBhcmVTdHJpY3QuYmluZChudWxsLCBpbnN0YW5jZSkpKSB7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoewogICAgICAgICAgICBuYW1lOiAiZW51bSIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWFbImVudW0iXSwKICAgICAgICAgICAgbWVzc2FnZTogImlzIG5vdCBvbmUgb2YgZW51bSB2YWx1ZXM6ICIgKyBzY2hlbWFbImVudW0iXS5tYXAoU3RyaW5nKS5qb2luKCIsIikKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICB2YWxpZGF0b3JzWyJjb25zdCJdID0gZnVuY3Rpb24gdmFsaWRhdGVFbnVtKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIGlmIChpbnN0YW5jZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBWYWxpZGF0b3JSZXN1bHQoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICBpZiAoIWhlbHBlcnMuZGVlcENvbXBhcmVTdHJpY3Qoc2NoZW1hWyJjb25zdCJdLCBpbnN0YW5jZSkpIHsKICAgICAgICAgIHJlc3VsdC5hZGRFcnJvcih7CiAgICAgICAgICAgIG5hbWU6ICJjb25zdCIsCiAgICAgICAgICAgIGFyZ3VtZW50OiBzY2hlbWFbImNvbnN0Il0sCiAgICAgICAgICAgIG1lc3NhZ2U6ICJkb2VzIG5vdCBleGFjdGx5IG1hdGNoIGV4cGVjdGVkIGNvbnN0YW50OiAiICsgc2NoZW1hWyJjb25zdCJdCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgdmFsaWRhdG9ycy5ub3QgPSB2YWxpZGF0b3JzLmRpc2FsbG93ID0gZnVuY3Rpb24gdmFsaWRhdGVOb3QoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgdmFyIHNlbGYyID0gdGhpczsKICAgICAgICBpZiAoaW5zdGFuY2UgPT09IHZvaWQgMCkKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgdmFyIG5vdFR5cGVzID0gc2NoZW1hLm5vdCB8fCBzY2hlbWEuZGlzYWxsb3c7CiAgICAgICAgaWYgKCFub3RUeXBlcykKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShub3RUeXBlcykpCiAgICAgICAgICBub3RUeXBlcyA9IFtub3RUeXBlc107CiAgICAgICAgbm90VHlwZXMuZm9yRWFjaChmdW5jdGlvbih0eXBlMykgewogICAgICAgICAgaWYgKHNlbGYyLnRlc3RUeXBlKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCwgdHlwZTMpKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHR5cGUzICYmICh0eXBlMy4kaWQgfHwgdHlwZTMuaWQpOwogICAgICAgICAgICB2YXIgc2NoZW1hSWQgPSBpZCB8fCB0eXBlMzsKICAgICAgICAgICAgcmVzdWx0LmFkZEVycm9yKHsKICAgICAgICAgICAgICBuYW1lOiAibm90IiwKICAgICAgICAgICAgICBhcmd1bWVudDogc2NoZW1hSWQsCiAgICAgICAgICAgICAgbWVzc2FnZTogImlzIG9mIHByb2hpYml0ZWQgdHlwZSAiICsgc2NoZW1hSWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBhdHRyaWJ1dGU7CiAgICB9CiAgfSk7CgogIC8vIHNyYy9jb21tb24vbGliL2pzb25zY2hlbWEvc2Nhbi5qcwogIHZhciByZXF1aXJlX3NjYW4gPSBfX2NvbW1vbkpTKHsKICAgICJzcmMvY29tbW9uL2xpYi9qc29uc2NoZW1hL3NjYW4uanMiKGV4cG9ydHMsIG1vZHVsZSkgewogICAgICAidXNlIHN0cmljdCI7CiAgICAgIHZhciB1cmlsaWIgPSByZXF1aXJlX3VybCgpOwogICAgICB2YXIgaGVscGVycyA9IHJlcXVpcmVfaGVscGVycygpOwogICAgICBtb2R1bGUuZXhwb3J0cy5TY2hlbWFTY2FuUmVzdWx0ID0gU2NoZW1hU2NhblJlc3VsdDsKICAgICAgZnVuY3Rpb24gU2NoZW1hU2NhblJlc3VsdChmb3VuZCwgcmVmKSB7CiAgICAgICAgdGhpcy5pZCA9IGZvdW5kOwogICAgICAgIHRoaXMucmVmID0gcmVmOwogICAgICB9CiAgICAgIG1vZHVsZS5leHBvcnRzLnNjYW4gPSBmdW5jdGlvbiBzY2FuKGJhc2UsIHNjaGVtYSkgewogICAgICAgIGZ1bmN0aW9uIHNjYW5TY2hlbWEoYmFzZXVyaSwgc2NoZW1hMikgewogICAgICAgICAgaWYgKCFzY2hlbWEyIHx8IHR5cGVvZiBzY2hlbWEyICE9ICJvYmplY3QiKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBpZiAoc2NoZW1hMi4kcmVmKSB7CiAgICAgICAgICAgIHZhciByZXNvbHZlZFVyaSA9IHVyaWxpYi5yZXNvbHZlKGJhc2V1cmksIHNjaGVtYTIuJHJlZik7CiAgICAgICAgICAgIHJlZltyZXNvbHZlZFVyaV0gPSByZWZbcmVzb2x2ZWRVcmldID8gcmVmW3Jlc29sdmVkVXJpXSArIDEgOiAwOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaWQgPSBzY2hlbWEyLiRpZCB8fCBzY2hlbWEyLmlkOwogICAgICAgICAgdmFyIG91ckJhc2UgPSBpZCA_IHVyaWxpYi5yZXNvbHZlKGJhc2V1cmksIGlkKSA6IGJhc2V1cmk7CiAgICAgICAgICBpZiAob3VyQmFzZSkgewogICAgICAgICAgICBpZiAob3VyQmFzZS5pbmRleE9mKCIjIikgPCAwKQogICAgICAgICAgICAgIG91ckJhc2UgKz0gIiMiOwogICAgICAgICAgICBpZiAoZm91bmRbb3VyQmFzZV0pIHsKICAgICAgICAgICAgICBpZiAoIWhlbHBlcnMuZGVlcENvbXBhcmVTdHJpY3QoZm91bmRbb3VyQmFzZV0sIHNjaGVtYTIpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICAgICAgICAgICAgICJTY2hlbWEgPCIgKyBvdXJCYXNlICsgIj4gYWxyZWFkeSBleGlzdHMgd2l0aCBkaWZmZXJlbnQgZGVmaW5pdGlvbiIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybiBmb3VuZFtvdXJCYXNlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3VuZFtvdXJCYXNlXSA9IHNjaGVtYTI7CiAgICAgICAgICAgIGlmIChvdXJCYXNlW291ckJhc2UubGVuZ3RoIC0gMV0gPT0gIiMiKSB7CiAgICAgICAgICAgICAgZm91bmRbb3VyQmFzZS5zdWJzdHJpbmcoMCwgb3VyQmFzZS5sZW5ndGggLSAxKV0gPSBzY2hlbWEyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBzY2FuQXJyYXkoCiAgICAgICAgICAgIG91ckJhc2UgKyAiL2l0ZW1zIiwKICAgICAgICAgICAgQXJyYXkuaXNBcnJheShzY2hlbWEyLml0ZW1zKSA_IHNjaGVtYTIuaXRlbXMgOiBbc2NoZW1hMi5pdGVtc10KICAgICAgICAgICk7CiAgICAgICAgICBzY2FuQXJyYXkoCiAgICAgICAgICAgIG91ckJhc2UgKyAiL2V4dGVuZHMiLAogICAgICAgICAgICBBcnJheS5pc0FycmF5KHNjaGVtYTIuZXh0ZW5kcykgPyBzY2hlbWEyLmV4dGVuZHMgOiBbc2NoZW1hMi5leHRlbmRzXQogICAgICAgICAgKTsKICAgICAgICAgIHNjYW5TY2hlbWEob3VyQmFzZSArICIvYWRkaXRpb25hbEl0ZW1zIiwgc2NoZW1hMi5hZGRpdGlvbmFsSXRlbXMpOwogICAgICAgICAgc2Nhbk9iamVjdChvdXJCYXNlICsgIi9wcm9wZXJ0aWVzIiwgc2NoZW1hMi5wcm9wZXJ0aWVzKTsKICAgICAgICAgIHNjYW5TY2hlbWEob3VyQmFzZSArICIvYWRkaXRpb25hbFByb3BlcnRpZXMiLCBzY2hlbWEyLmFkZGl0aW9uYWxQcm9wZXJ0aWVzKTsKICAgICAgICAgIHNjYW5PYmplY3Qob3VyQmFzZSArICIvZGVmaW5pdGlvbnMiLCBzY2hlbWEyLmRlZmluaXRpb25zKTsKICAgICAgICAgIHNjYW5PYmplY3Qob3VyQmFzZSArICIvcGF0dGVyblByb3BlcnRpZXMiLCBzY2hlbWEyLnBhdHRlcm5Qcm9wZXJ0aWVzKTsKICAgICAgICAgIHNjYW5PYmplY3Qob3VyQmFzZSArICIvZGVwZW5kZW5jaWVzIiwgc2NoZW1hMi5kZXBlbmRlbmNpZXMpOwogICAgICAgICAgc2NhbkFycmF5KG91ckJhc2UgKyAiL2Rpc2FsbG93Iiwgc2NoZW1hMi5kaXNhbGxvdyk7CiAgICAgICAgICBzY2FuQXJyYXkob3VyQmFzZSArICIvYWxsT2YiLCBzY2hlbWEyLmFsbE9mKTsKICAgICAgICAgIHNjYW5BcnJheShvdXJCYXNlICsgIi9hbnlPZiIsIHNjaGVtYTIuYW55T2YpOwogICAgICAgICAgc2NhbkFycmF5KG91ckJhc2UgKyAiL29uZU9mIiwgc2NoZW1hMi5vbmVPZik7CiAgICAgICAgICBzY2FuU2NoZW1hKG91ckJhc2UgKyAiL25vdCIsIHNjaGVtYTIubm90KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2NhbkFycmF5KGJhc2V1cmksIHNjaGVtYXMpIHsKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzY2hlbWFzKSkKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY2hlbWFzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHNjYW5TY2hlbWEoYmFzZXVyaSArICIvIiArIGksIHNjaGVtYXNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzY2FuT2JqZWN0KGJhc2V1cmksIHNjaGVtYXMpIHsKICAgICAgICAgIGlmICghc2NoZW1hcyB8fCB0eXBlb2Ygc2NoZW1hcyAhPSAib2JqZWN0IikKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgZm9yICh2YXIgcCBpbiBzY2hlbWFzKSB7CiAgICAgICAgICAgIHNjYW5TY2hlbWEoYmFzZXVyaSArICIvIiArIHAsIHNjaGVtYXNbcF0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgZm91bmQgPSB7fTsKICAgICAgICB2YXIgcmVmID0ge307CiAgICAgICAgc2NhblNjaGVtYShiYXNlLCBzY2hlbWEpOwogICAgICAgIHJldHVybiBuZXcgU2NoZW1hU2NhblJlc3VsdChmb3VuZCwgcmVmKTsKICAgICAgfTsKICAgIH0KICB9KTsKCiAgLy8gc3JjL2NvbW1vbi9saWIvanNvbnNjaGVtYS92YWxpZGF0b3IuanMKICB2YXIgcmVxdWlyZV92YWxpZGF0b3IgPSBfX2NvbW1vbkpTKHsKICAgICJzcmMvY29tbW9uL2xpYi9qc29uc2NoZW1hL3ZhbGlkYXRvci5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIHVyaWxpYiA9IHJlcXVpcmVfdXJsKCk7CiAgICAgIHZhciBhdHRyaWJ1dGUgPSByZXF1aXJlX2F0dHJpYnV0ZSgpOwogICAgICB2YXIgaGVscGVycyA9IHJlcXVpcmVfaGVscGVycygpOwogICAgICB2YXIgc2NhblNjaGVtYSA9IHJlcXVpcmVfc2NhbigpLnNjYW47CiAgICAgIHZhciBWYWxpZGF0b3JSZXN1bHQgPSBoZWxwZXJzLlZhbGlkYXRvclJlc3VsdDsKICAgICAgdmFyIFZhbGlkYXRvclJlc3VsdEVycm9yID0gaGVscGVycy5WYWxpZGF0b3JSZXN1bHRFcnJvcjsKICAgICAgdmFyIFNjaGVtYUVycm9yID0gaGVscGVycy5TY2hlbWFFcnJvcjsKICAgICAgdmFyIFNjaGVtYUNvbnRleHQgPSBoZWxwZXJzLlNjaGVtYUNvbnRleHQ7CiAgICAgIHZhciBhbm9ueW1vdXNCYXNlID0gIi8iOwogICAgICB2YXIgVmFsaWRhdG9yID0gZnVuY3Rpb24gVmFsaWRhdG9yMigpIHsKICAgICAgICB0aGlzLmN1c3RvbUZvcm1hdHMgPSBPYmplY3QuY3JlYXRlKFZhbGlkYXRvcjIucHJvdG90eXBlLmN1c3RvbUZvcm1hdHMpOwogICAgICAgIHRoaXMuc2NoZW1hcyA9IHt9OwogICAgICAgIHRoaXMudW5yZXNvbHZlZFJlZnMgPSBbXTsKICAgICAgICB0aGlzLnR5cGVzID0gT2JqZWN0LmNyZWF0ZSh0eXBlcyk7CiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShhdHRyaWJ1dGUudmFsaWRhdG9ycyk7CiAgICAgIH07CiAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuY3VzdG9tRm9ybWF0cyA9IHt9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnNjaGVtYXMgPSBudWxsOwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnR5cGVzID0gbnVsbDsKICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5hdHRyaWJ1dGVzID0gbnVsbDsKICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS51bnJlc29sdmVkUmVmcyA9IG51bGw7CiAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUuYWRkU2NoZW1hID0gZnVuY3Rpb24gYWRkU2NoZW1hKHNjaGVtYSwgYmFzZSkgewogICAgICAgIHZhciBzZWxmMiA9IHRoaXM7CiAgICAgICAgaWYgKCFzY2hlbWEpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICB2YXIgc2NhbiA9IHNjYW5TY2hlbWEoYmFzZSB8fCBhbm9ueW1vdXNCYXNlLCBzY2hlbWEpOwogICAgICAgIHZhciBvdXJVcmkgPSBiYXNlIHx8IHNjaGVtYS4kaWQgfHwgc2NoZW1hLmlkOwogICAgICAgIGZvciAodmFyIHVyaSBpbiBzY2FuLmlkKSB7CiAgICAgICAgICB0aGlzLnNjaGVtYXNbdXJpXSA9IHNjYW4uaWRbdXJpXTsKICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgdXJpIGluIHNjYW4ucmVmKSB7CiAgICAgICAgICB0aGlzLnVucmVzb2x2ZWRSZWZzLnB1c2godXJpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy51bnJlc29sdmVkUmVmcyA9IHRoaXMudW5yZXNvbHZlZFJlZnMuZmlsdGVyKGZ1bmN0aW9uKHVyaTIpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2Ygc2VsZjIuc2NoZW1hc1t1cmkyXSA9PT0gInVuZGVmaW5lZCI7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXMuc2NoZW1hc1tvdXJVcmldOwogICAgICB9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmFkZFN1YlNjaGVtYUFycmF5ID0gZnVuY3Rpb24gYWRkU3ViU2NoZW1hQXJyYXkoYmFzZXVyaSwgc2NoZW1hcykgewogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzY2hlbWFzKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNjaGVtYXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHRoaXMuYWRkU3ViU2NoZW1hKGJhc2V1cmksIHNjaGVtYXNbaV0pOwogICAgICAgIH0KICAgICAgfTsKICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS5hZGRTdWJTY2hlbWFPYmplY3QgPSBmdW5jdGlvbiBhZGRTdWJTY2hlbWFBcnJheShiYXNldXJpLCBzY2hlbWFzKSB7CiAgICAgICAgaWYgKCFzY2hlbWFzIHx8IHR5cGVvZiBzY2hlbWFzICE9ICJvYmplY3QiKQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGZvciAodmFyIHAgaW4gc2NoZW1hcykgewogICAgICAgICAgdGhpcy5hZGRTdWJTY2hlbWEoYmFzZXVyaSwgc2NoZW1hc1twXSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnNldFNjaGVtYXMgPSBmdW5jdGlvbiBzZXRTY2hlbWFzKHNjaGVtYXMpIHsKICAgICAgICB0aGlzLnNjaGVtYXMgPSBzY2hlbWFzOwogICAgICB9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLmdldFNjaGVtYSA9IGZ1bmN0aW9uIGdldFNjaGVtYSh1cm4pIHsKICAgICAgICByZXR1cm4gdGhpcy5zY2hlbWFzW3Vybl07CiAgICAgIH07CiAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbiB2YWxpZGF0ZTIoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KSB7CiAgICAgICAgaWYgKHR5cGVvZiBzY2hlbWEgIT09ICJib29sZWFuIiAmJiB0eXBlb2Ygc2NoZW1hICE9PSAib2JqZWN0IiB8fCBzY2hlbWEgPT09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBTY2hlbWFFcnJvcigiRXhwZWN0ZWQgYHNjaGVtYWAgdG8gYmUgYW4gb2JqZWN0IG9yIGJvb2xlYW4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFvcHRpb25zKSB7CiAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgfQogICAgICAgIHZhciBpZCA9IHNjaGVtYS4kaWQgfHwgc2NoZW1hLmlkOwogICAgICAgIHZhciBiYXNlID0gdXJpbGliLnJlc29sdmUob3B0aW9ucy5iYXNlIHx8IGFub255bW91c0Jhc2UsIGlkIHx8ICIiKTsKICAgICAgICBpZiAoIWN0eCkgewogICAgICAgICAgY3R4ID0gbmV3IFNjaGVtYUNvbnRleHQoCiAgICAgICAgICAgIHNjaGVtYSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgW10sCiAgICAgICAgICAgIGJhc2UsCiAgICAgICAgICAgIE9iamVjdC5jcmVhdGUodGhpcy5zY2hlbWFzKQogICAgICAgICAgKTsKICAgICAgICAgIGlmICghY3R4LnNjaGVtYXNbYmFzZV0pIHsKICAgICAgICAgICAgY3R4LnNjaGVtYXNbYmFzZV0gPSBzY2hlbWE7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZm91bmQgPSBzY2FuU2NoZW1hKGJhc2UsIHNjaGVtYSk7CiAgICAgICAgICBmb3IgKHZhciBuIGluIGZvdW5kLmlkKSB7CiAgICAgICAgICAgIHZhciBzY2ggPSBmb3VuZC5pZFtuXTsKICAgICAgICAgICAgY3R4LnNjaGVtYXNbbl0gPSBzY2g7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChvcHRpb25zLnJlcXVpcmVkICYmIGluc3RhbmNlID09PSB2b2lkIDApIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgICByZXN1bHQuYWRkRXJyb3IoImlzIHJlcXVpcmVkLCBidXQgaXMgdW5kZWZpbmVkIik7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy52YWxpZGF0ZVNjaGVtYShpbnN0YW5jZSwgc2NoZW1hLCBvcHRpb25zLCBjdHgpOwogICAgICAgIGlmICghcmVzdWx0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlJlc3VsdCB1bmRlZmluZWQiKTsKICAgICAgICB9IGVsc2UgaWYgKG9wdGlvbnMudGhyb3dBbGwgJiYgcmVzdWx0LmVycm9ycy5sZW5ndGgpIHsKICAgICAgICAgIHRocm93IG5ldyBWYWxpZGF0b3JSZXN1bHRFcnJvcihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBmdW5jdGlvbiBzaG91bGRSZXNvbHZlKHNjaGVtYSkgewogICAgICAgIHZhciByZWYgPSB0eXBlb2Ygc2NoZW1hID09PSAic3RyaW5nIiA_IHNjaGVtYSA6IHNjaGVtYS4kcmVmOwogICAgICAgIGlmICh0eXBlb2YgcmVmID09ICJzdHJpbmciKQogICAgICAgICAgcmV0dXJuIHJlZjsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgVmFsaWRhdG9yLnByb3RvdHlwZS52YWxpZGF0ZVNjaGVtYSA9IGZ1bmN0aW9uIHZhbGlkYXRlU2NoZW1hKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCkgewogICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmFsaWRhdG9yUmVzdWx0KGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgaWYgKHR5cGVvZiBzY2hlbWEgPT09ICJib29sZWFuIikgewogICAgICAgICAgaWYgKHNjaGVtYSA9PT0gdHJ1ZSkgewogICAgICAgICAgICBzY2hlbWEgPSB7fTsKICAgICAgICAgIH0gZWxzZSBpZiAoc2NoZW1hID09PSBmYWxzZSkgewogICAgICAgICAgICBzY2hlbWEgPSB7IHR5cGU6IFtdIH07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghc2NoZW1hKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInNjaGVtYSBpcyB1bmRlZmluZWQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHNjaGVtYVsiZXh0ZW5kcyJdKSB7CiAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzY2hlbWFbImV4dGVuZHMiXSkpIHsKICAgICAgICAgICAgdmFyIHNjaGVtYW9iaiA9IHsgc2NoZW1hLCBjdHggfTsKICAgICAgICAgICAgc2NoZW1hWyJleHRlbmRzIl0uZm9yRWFjaCh0aGlzLnNjaGVtYVRyYXZlcnNlci5iaW5kKHRoaXMsIHNjaGVtYW9iaikpOwogICAgICAgICAgICBzY2hlbWEgPSBzY2hlbWFvYmouc2NoZW1hOwogICAgICAgICAgICBzY2hlbWFvYmouc2NoZW1hID0gbnVsbDsKICAgICAgICAgICAgc2NoZW1hb2JqLmN0eCA9IG51bGw7CiAgICAgICAgICAgIHNjaGVtYW9iaiA9IG51bGw7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzY2hlbWEgPSBoZWxwZXJzLmRlZXBNZXJnZSgKICAgICAgICAgICAgICBzY2hlbWEsCiAgICAgICAgICAgICAgdGhpcy5zdXBlclJlc29sdmUoc2NoZW1hWyJleHRlbmRzIl0sIGN0eCkKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdmFyIHN3aXRjaFNjaGVtYSA9IHNob3VsZFJlc29sdmUoc2NoZW1hKTsKICAgICAgICBpZiAoc3dpdGNoU2NoZW1hKSB7CiAgICAgICAgICB2YXIgcmVzb2x2ZWQgPSB0aGlzLnJlc29sdmUoc2NoZW1hLCBzd2l0Y2hTY2hlbWEsIGN0eCk7CiAgICAgICAgICB2YXIgc3ViY3R4ID0gbmV3IFNjaGVtYUNvbnRleHQoCiAgICAgICAgICAgIHJlc29sdmVkLnN1YnNjaGVtYSwKICAgICAgICAgICAgb3B0aW9ucywKICAgICAgICAgICAgY3R4LnBhdGgsCiAgICAgICAgICAgIHJlc29sdmVkLnN3aXRjaFNjaGVtYSwKICAgICAgICAgICAgY3R4LnNjaGVtYXMKICAgICAgICAgICk7CiAgICAgICAgICByZXR1cm4gdGhpcy52YWxpZGF0ZVNjaGVtYShpbnN0YW5jZSwgcmVzb2x2ZWQuc3Vic2NoZW1hLCBvcHRpb25zLCBzdWJjdHgpOwogICAgICAgIH0KICAgICAgICB2YXIgc2tpcEF0dHJpYnV0ZXMgPSBvcHRpb25zICYmIG9wdGlvbnMuc2tpcEF0dHJpYnV0ZXMgfHwgW107CiAgICAgICAgZm9yICh2YXIga2V5IGluIHNjaGVtYSkgewogICAgICAgICAgaWYgKCFhdHRyaWJ1dGUuaWdub3JlUHJvcGVydGllc1trZXldICYmIHNraXBBdHRyaWJ1dGVzLmluZGV4T2Yoa2V5KSA8IDApIHsKICAgICAgICAgICAgdmFyIHZhbGlkYXRvckVyciA9IG51bGw7CiAgICAgICAgICAgIHZhciB2YWxpZGF0b3IyID0gdGhpcy5hdHRyaWJ1dGVzW2tleV07CiAgICAgICAgICAgIGlmICh2YWxpZGF0b3IyKSB7CiAgICAgICAgICAgICAgdmFsaWRhdG9yRXJyID0gdmFsaWRhdG9yMi5jYWxsKHRoaXMsIGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMsIGN0eCk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5hbGxvd1Vua25vd25BdHRyaWJ1dGVzID09PSBmYWxzZSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBTY2hlbWFFcnJvcigiVW5zdXBwb3J0ZWQgYXR0cmlidXRlOiAiICsga2V5LCBzY2hlbWEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWxpZGF0b3JFcnIpIHsKICAgICAgICAgICAgICByZXN1bHQuaW1wb3J0RXJyb3JzKHZhbGlkYXRvckVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnJld3JpdGUgPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdmFyIHZhbHVlID0gb3B0aW9ucy5yZXdyaXRlLmNhbGwodGhpcywgaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4KTsKICAgICAgICAgIHJlc3VsdC5pbnN0YW5jZSA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnNjaGVtYVRyYXZlcnNlciA9IGZ1bmN0aW9uIHNjaGVtYVRyYXZlcnNlcihzY2hlbWFvYmosIHMpIHsKICAgICAgICBzY2hlbWFvYmouc2NoZW1hID0gaGVscGVycy5kZWVwTWVyZ2UoCiAgICAgICAgICBzY2hlbWFvYmouc2NoZW1hLAogICAgICAgICAgdGhpcy5zdXBlclJlc29sdmUocywgc2NoZW1hb2JqLmN0eCkKICAgICAgICApOwogICAgICB9OwogICAgICBWYWxpZGF0b3IucHJvdG90eXBlLnN1cGVyUmVzb2x2ZSA9IGZ1bmN0aW9uIHN1cGVyUmVzb2x2ZShzY2hlbWEsIGN0eCkgewogICAgICAgIHZhciByZWYgPSBzaG91bGRSZXNvbHZlKHNjaGVtYSk7CiAgICAgICAgaWYgKHJlZikgewogICAgICAgICAgcmV0dXJuIHRoaXMucmVzb2x2ZShzY2hlbWEsIHJlZiwgY3R4KS5zdWJzY2hlbWE7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzY2hlbWE7CiAgICAgIH07CiAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUucmVzb2x2ZSA9IGZ1bmN0aW9uIHJlc29sdmUoc2NoZW1hLCBzd2l0Y2hTY2hlbWEsIGN0eCkgewogICAgICAgIHN3aXRjaFNjaGVtYSA9IGN0eC5yZXNvbHZlKHN3aXRjaFNjaGVtYSk7CiAgICAgICAgaWYgKGN0eC5zY2hlbWFzW3N3aXRjaFNjaGVtYV0pIHsKICAgICAgICAgIHJldHVybiB7IHN1YnNjaGVtYTogY3R4LnNjaGVtYXNbc3dpdGNoU2NoZW1hXSwgc3dpdGNoU2NoZW1hIH07CiAgICAgICAgfQogICAgICAgIHZhciBwYXJzZWQgPSB1cmlsaWIucGFyc2Uoc3dpdGNoU2NoZW1hKTsKICAgICAgICB2YXIgZnJhZ21lbnQgPSBwYXJzZWQgJiYgcGFyc2VkLmhhc2g7CiAgICAgICAgdmFyIGRvY3VtZW50ID0gZnJhZ21lbnQgJiYgZnJhZ21lbnQubGVuZ3RoICYmIHN3aXRjaFNjaGVtYS5zdWJzdHIoMCwgc3dpdGNoU2NoZW1hLmxlbmd0aCAtIGZyYWdtZW50Lmxlbmd0aCk7CiAgICAgICAgaWYgKCFkb2N1bWVudCB8fCAhY3R4LnNjaGVtYXNbZG9jdW1lbnRdKSB7CiAgICAgICAgICB0aHJvdyBuZXcgU2NoZW1hRXJyb3IoIm5vIHN1Y2ggc2NoZW1hIDwiICsgc3dpdGNoU2NoZW1hICsgIj4iLCBzY2hlbWEpOwogICAgICAgIH0KICAgICAgICB2YXIgc3Vic2NoZW1hID0gaGVscGVycy5vYmplY3RHZXRQYXRoKAogICAgICAgICAgY3R4LnNjaGVtYXNbZG9jdW1lbnRdLAogICAgICAgICAgZnJhZ21lbnQuc3Vic3RyKDEpCiAgICAgICAgKTsKICAgICAgICBpZiAoc3Vic2NoZW1hID09PSB2b2lkIDApIHsKICAgICAgICAgIHRocm93IG5ldyBTY2hlbWFFcnJvcigKICAgICAgICAgICAgIm5vIHN1Y2ggc2NoZW1hICIgKyBmcmFnbWVudCArICIgbG9jYXRlZCBpbiA8IiArIGRvY3VtZW50ICsgIj4iLAogICAgICAgICAgICBzY2hlbWEKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7IHN1YnNjaGVtYSwgc3dpdGNoU2NoZW1hIH07CiAgICAgIH07CiAgICAgIFZhbGlkYXRvci5wcm90b3R5cGUudGVzdFR5cGUgPSBmdW5jdGlvbiB2YWxpZGF0ZVR5cGUoaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucywgY3R4LCB0eXBlMykgewogICAgICAgIGlmICh0eXBlMyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIGlmICh0eXBlMyA9PT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IFNjaGVtYUVycm9yKCdVbmV4cGVjdGVkIG51bGwgaW4gInR5cGUiIGtleXdvcmQnKTsKICAgICAgICB9CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnR5cGVzW3R5cGUzXSA9PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy50eXBlc1t0eXBlM10uY2FsbCh0aGlzLCBpbnN0YW5jZSk7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlMyAmJiB0eXBlb2YgdHlwZTMgPT0gIm9iamVjdCIpIHsKICAgICAgICAgIHZhciByZXMgPSB0aGlzLnZhbGlkYXRlU2NoZW1hKGluc3RhbmNlLCB0eXBlMywgb3B0aW9ucywgY3R4KTsKICAgICAgICAgIHJldHVybiByZXMgPT09IHZvaWQgMCB8fCAhKHJlcyAmJiByZXMuZXJyb3JzLmxlbmd0aCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgICB2YXIgdHlwZXMgPSBWYWxpZGF0b3IucHJvdG90eXBlLnR5cGVzID0ge307CiAgICAgIHR5cGVzLnN0cmluZyA9IGZ1bmN0aW9uIHRlc3RTdHJpbmcoaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGluc3RhbmNlID09ICJzdHJpbmciOwogICAgICB9OwogICAgICB0eXBlcy5udW1iZXIgPSBmdW5jdGlvbiB0ZXN0TnVtYmVyKGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIHR5cGVvZiBpbnN0YW5jZSA9PSAibnVtYmVyIiAmJiBpc0Zpbml0ZShpbnN0YW5jZSk7CiAgICAgIH07CiAgICAgIHR5cGVzLmludGVnZXIgPSBmdW5jdGlvbiB0ZXN0SW50ZWdlcihpbnN0YW5jZSkgewogICAgICAgIHJldHVybiB0eXBlb2YgaW5zdGFuY2UgPT0gIm51bWJlciIgJiYgaW5zdGFuY2UgJSAxID09PSAwOwogICAgICB9OwogICAgICB0eXBlcy5ib29sZWFuID0gZnVuY3Rpb24gdGVzdEJvb2xlYW4oaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gdHlwZW9mIGluc3RhbmNlID09ICJib29sZWFuIjsKICAgICAgfTsKICAgICAgdHlwZXMuYXJyYXkgPSBmdW5jdGlvbiB0ZXN0QXJyYXkoaW5zdGFuY2UpIHsKICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShpbnN0YW5jZSk7CiAgICAgIH07CiAgICAgIHR5cGVzWyJudWxsIl0gPSBmdW5jdGlvbiB0ZXN0TnVsbChpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZSA9PT0gbnVsbDsKICAgICAgfTsKICAgICAgdHlwZXMuZGF0ZSA9IGZ1bmN0aW9uIHRlc3REYXRlKGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlIGluc3RhbmNlb2YgRGF0ZTsKICAgICAgfTsKICAgICAgdHlwZXMuYW55ID0gZnVuY3Rpb24gdGVzdEFueShpbnN0YW5jZSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9OwogICAgICB0eXBlcy5vYmplY3QgPSBmdW5jdGlvbiB0ZXN0T2JqZWN0KGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlICYmIHR5cGVvZiBpbnN0YW5jZSA9PT0gIm9iamVjdCIgJiYgIUFycmF5LmlzQXJyYXkoaW5zdGFuY2UpICYmICEoaW5zdGFuY2UgaW5zdGFuY2VvZiBEYXRlKTsKICAgICAgfTsKICAgICAgbW9kdWxlLmV4cG9ydHMgPSBWYWxpZGF0b3I7CiAgICB9CiAgfSk7CgogIC8vIHNyYy9jb21tb24vbGliL2pzb25zY2hlbWEvaW5kZXguanMKICB2YXIgcmVxdWlyZV9qc29uc2NoZW1hID0gX19jb21tb25KUyh7CiAgICAic3JjL2NvbW1vbi9saWIvanNvbnNjaGVtYS9pbmRleC5qcyIoZXhwb3J0cywgbW9kdWxlKSB7CiAgICAgICJ1c2Ugc3RyaWN0IjsKICAgICAgdmFyIFZhbGlkYXRvciA9IG1vZHVsZS5leHBvcnRzLlZhbGlkYXRvciA9IHJlcXVpcmVfdmFsaWRhdG9yKCk7CiAgICAgIG1vZHVsZS5leHBvcnRzLlZhbGlkYXRvclJlc3VsdCA9IHJlcXVpcmVfaGVscGVycygpLlZhbGlkYXRvclJlc3VsdDsKICAgICAgbW9kdWxlLmV4cG9ydHMuVmFsaWRhdG9yUmVzdWx0RXJyb3IgPSByZXF1aXJlX2hlbHBlcnMoKS5WYWxpZGF0b3JSZXN1bHRFcnJvcjsKICAgICAgbW9kdWxlLmV4cG9ydHMuVmFsaWRhdGlvbkVycm9yID0gcmVxdWlyZV9oZWxwZXJzKCkuVmFsaWRhdGlvbkVycm9yOwogICAgICBtb2R1bGUuZXhwb3J0cy5TY2hlbWFFcnJvciA9IHJlcXVpcmVfaGVscGVycygpLlNjaGVtYUVycm9yOwogICAgICBtb2R1bGUuZXhwb3J0cy5TY2hlbWFTY2FuUmVzdWx0ID0gcmVxdWlyZV9zY2FuKCkuU2NoZW1hU2NhblJlc3VsdDsKICAgICAgbW9kdWxlLmV4cG9ydHMuc2NhbiA9IHJlcXVpcmVfc2NhbigpLnNjYW47CiAgICAgIG1vZHVsZS5leHBvcnRzLnZhbGlkYXRlID0gZnVuY3Rpb24oaW5zdGFuY2UsIHNjaGVtYSwgb3B0aW9ucykgewogICAgICAgIHZhciB2ID0gbmV3IFZhbGlkYXRvcigpOwogICAgICAgIHJldHVybiB2LnZhbGlkYXRlKGluc3RhbmNlLCBzY2hlbWEsIG9wdGlvbnMpOwogICAgICB9OwogICAgfQogIH0pOwoKICAvLyBzcmMvaW50ZXJuZXQtaWRlbnRpdHkvbGliL3R3ZWV0bmFjbC9pbmRleC5qcwogIHZhciByZXF1aXJlX3R3ZWV0bmFjbCA9IF9fY29tbW9uSlMoewogICAgInNyYy9pbnRlcm5ldC1pZGVudGl0eS9saWIvdHdlZXRuYWNsL2luZGV4LmpzIihleHBvcnRzLCBtb2R1bGUpIHsKICAgICAgKGZ1bmN0aW9uKG5hY2wpIHsKICAgICAgICAidXNlIHN0cmljdCI7CiAgICAgICAgdmFyIGdmID0gZnVuY3Rpb24oaW5pdCkgewogICAgICAgICAgdmFyIGksIHIgPSBuZXcgRmxvYXQ2NEFycmF5KDE2KTsKICAgICAgICAgIGlmIChpbml0KQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgaW5pdC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgICByW2ldID0gaW5pdFtpXTsKICAgICAgICAgIHJldHVybiByOwogICAgICAgIH07CiAgICAgICAgdmFyIHJhbmRvbWJ5dGVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIm5vIFBSTkciKTsKICAgICAgICB9OwogICAgICAgIHZhciBfMCA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICB2YXIgXzkgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgXzlbMF0gPSA5OwogICAgICAgIHZhciBnZjAgPSBnZigpLCBnZjEgPSBnZihbMV0pLCBfMTIxNjY1ID0gZ2YoWzU2MTI5LCAxXSksIEQgPSBnZihbCiAgICAgICAgICAzMDg4MywKICAgICAgICAgIDQ5NTMsCiAgICAgICAgICAxOTkxNCwKICAgICAgICAgIDMwMTg3LAogICAgICAgICAgNTU0NjcsCiAgICAgICAgICAxNjcwNSwKICAgICAgICAgIDI2MzcsCiAgICAgICAgICAxMTIsCiAgICAgICAgICA1OTU0NCwKICAgICAgICAgIDMwNTg1LAogICAgICAgICAgMTY1MDUsCiAgICAgICAgICAzNjAzOSwKICAgICAgICAgIDY1MTM5LAogICAgICAgICAgMTExMTksCiAgICAgICAgICAyNzg4NiwKICAgICAgICAgIDIwOTk1CiAgICAgICAgXSksIEQyID0gZ2YoWwogICAgICAgICAgNjE3ODUsCiAgICAgICAgICA5OTA2LAogICAgICAgICAgMzk4MjgsCiAgICAgICAgICA2MDM3NCwKICAgICAgICAgIDQ1Mzk4LAogICAgICAgICAgMzM0MTEsCiAgICAgICAgICA1Mjc0LAogICAgICAgICAgMjI0LAogICAgICAgICAgNTM1NTIsCiAgICAgICAgICA2MTE3MSwKICAgICAgICAgIDMzMDEwLAogICAgICAgICAgNjU0MiwKICAgICAgICAgIDY0NzQzLAogICAgICAgICAgMjIyMzksCiAgICAgICAgICA1NTc3MiwKICAgICAgICAgIDkyMjIKICAgICAgICBdKSwgWCA9IGdmKFsKICAgICAgICAgIDU0NTU0LAogICAgICAgICAgMzY2NDUsCiAgICAgICAgICAxMTYxNiwKICAgICAgICAgIDUxNTQyLAogICAgICAgICAgNDI5MzAsCiAgICAgICAgICAzODE4MSwKICAgICAgICAgIDUxMDQwLAogICAgICAgICAgMjY5MjQsCiAgICAgICAgICA1NjQxMiwKICAgICAgICAgIDY0OTgyLAogICAgICAgICAgNTc5MDUsCiAgICAgICAgICA0OTMxNiwKICAgICAgICAgIDIxNTAyLAogICAgICAgICAgNTI1OTAsCiAgICAgICAgICAxNDAzNSwKICAgICAgICAgIDg1NTMKICAgICAgICBdKSwgWSA9IGdmKFsKICAgICAgICAgIDI2MjAwLAogICAgICAgICAgMjYyMTQsCiAgICAgICAgICAyNjIxNCwKICAgICAgICAgIDI2MjE0LAogICAgICAgICAgMjYyMTQsCiAgICAgICAgICAyNjIxNCwKICAgICAgICAgIDI2MjE0LAogICAgICAgICAgMjYyMTQsCiAgICAgICAgICAyNjIxNCwKICAgICAgICAgIDI2MjE0LAogICAgICAgICAgMjYyMTQsCiAgICAgICAgICAyNjIxNCwKICAgICAgICAgIDI2MjE0LAogICAgICAgICAgMjYyMTQsCiAgICAgICAgICAyNjIxNCwKICAgICAgICAgIDI2MjE0CiAgICAgICAgXSksIEkgPSBnZihbCiAgICAgICAgICA0MTEzNiwKICAgICAgICAgIDE4OTU4LAogICAgICAgICAgNjk1MSwKICAgICAgICAgIDUwNDE0LAogICAgICAgICAgNTg0ODgsCiAgICAgICAgICA0NDMzNSwKICAgICAgICAgIDYxNTAsCiAgICAgICAgICAxMjA5OSwKICAgICAgICAgIDU1MjA3LAogICAgICAgICAgMTU4NjcsCiAgICAgICAgICAxNTMsCiAgICAgICAgICAxMTA4NSwKICAgICAgICAgIDU3MDk5LAogICAgICAgICAgMjA0MTcsCiAgICAgICAgICA5MzQ0LAogICAgICAgICAgMTExMzkKICAgICAgICBdKTsKICAgICAgICBmdW5jdGlvbiB0czY0KHgsIGksIGgsIGwpIHsKICAgICAgICAgIHhbaV0gPSBoID4-IDI0ICYgMjU1OwogICAgICAgICAgeFtpICsgMV0gPSBoID4-IDE2ICYgMjU1OwogICAgICAgICAgeFtpICsgMl0gPSBoID4-IDggJiAyNTU7CiAgICAgICAgICB4W2kgKyAzXSA9IGggJiAyNTU7CiAgICAgICAgICB4W2kgKyA0XSA9IGwgPj4gMjQgJiAyNTU7CiAgICAgICAgICB4W2kgKyA1XSA9IGwgPj4gMTYgJiAyNTU7CiAgICAgICAgICB4W2kgKyA2XSA9IGwgPj4gOCAmIDI1NTsKICAgICAgICAgIHhbaSArIDddID0gbCAmIDI1NTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdm4oeCwgeGksIHksIHlpLCBuKSB7CiAgICAgICAgICB2YXIgaSwgZCA9IDA7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKQogICAgICAgICAgICBkIHw9IHhbeGkgKyBpXSBeIHlbeWkgKyBpXTsKICAgICAgICAgIHJldHVybiAoMSAmIGQgLSAxID4-PiA4KSAtIDE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b192ZXJpZnlfMTYoeCwgeGksIHksIHlpKSB7CiAgICAgICAgICByZXR1cm4gdm4oeCwgeGksIHksIHlpLCAxNik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b192ZXJpZnlfMzIoeCwgeGksIHksIHlpKSB7CiAgICAgICAgICByZXR1cm4gdm4oeCwgeGksIHksIHlpLCAzMik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNvcmVfc2Fsc2EyMChvLCBwLCBrLCBjKSB7CiAgICAgICAgICB2YXIgajAgPSBjWzBdICYgMjU1IHwgKGNbMV0gJiAyNTUpIDw8IDggfCAoY1syXSAmIDI1NSkgPDwgMTYgfCAoY1szXSAmIDI1NSkgPDwgMjQsIGoxID0ga1swXSAmIDI1NSB8IChrWzFdICYgMjU1KSA8PCA4IHwgKGtbMl0gJiAyNTUpIDw8IDE2IHwgKGtbM10gJiAyNTUpIDw8IDI0LCBqMiA9IGtbNF0gJiAyNTUgfCAoa1s1XSAmIDI1NSkgPDwgOCB8IChrWzZdICYgMjU1KSA8PCAxNiB8IChrWzddICYgMjU1KSA8PCAyNCwgajMgPSBrWzhdICYgMjU1IHwgKGtbOV0gJiAyNTUpIDw8IDggfCAoa1sxMF0gJiAyNTUpIDw8IDE2IHwgKGtbMTFdICYgMjU1KSA8PCAyNCwgajQgPSBrWzEyXSAmIDI1NSB8IChrWzEzXSAmIDI1NSkgPDwgOCB8IChrWzE0XSAmIDI1NSkgPDwgMTYgfCAoa1sxNV0gJiAyNTUpIDw8IDI0LCBqNSA9IGNbNF0gJiAyNTUgfCAoY1s1XSAmIDI1NSkgPDwgOCB8IChjWzZdICYgMjU1KSA8PCAxNiB8IChjWzddICYgMjU1KSA8PCAyNCwgajYgPSBwWzBdICYgMjU1IHwgKHBbMV0gJiAyNTUpIDw8IDggfCAocFsyXSAmIDI1NSkgPDwgMTYgfCAocFszXSAmIDI1NSkgPDwgMjQsIGo3ID0gcFs0XSAmIDI1NSB8IChwWzVdICYgMjU1KSA8PCA4IHwgKHBbNl0gJiAyNTUpIDw8IDE2IHwgKHBbN10gJiAyNTUpIDw8IDI0LCBqOCA9IHBbOF0gJiAyNTUgfCAocFs5XSAmIDI1NSkgPDwgOCB8IChwWzEwXSAmIDI1NSkgPDwgMTYgfCAocFsxMV0gJiAyNTUpIDw8IDI0LCBqOSA9IHBbMTJdICYgMjU1IHwgKHBbMTNdICYgMjU1KSA8PCA4IHwgKHBbMTRdICYgMjU1KSA8PCAxNiB8IChwWzE1XSAmIDI1NSkgPDwgMjQsIGoxMCA9IGNbOF0gJiAyNTUgfCAoY1s5XSAmIDI1NSkgPDwgOCB8IChjWzEwXSAmIDI1NSkgPDwgMTYgfCAoY1sxMV0gJiAyNTUpIDw8IDI0LCBqMTEgPSBrWzE2XSAmIDI1NSB8IChrWzE3XSAmIDI1NSkgPDwgOCB8IChrWzE4XSAmIDI1NSkgPDwgMTYgfCAoa1sxOV0gJiAyNTUpIDw8IDI0LCBqMTIgPSBrWzIwXSAmIDI1NSB8IChrWzIxXSAmIDI1NSkgPDwgOCB8IChrWzIyXSAmIDI1NSkgPDwgMTYgfCAoa1syM10gJiAyNTUpIDw8IDI0LCBqMTMgPSBrWzI0XSAmIDI1NSB8IChrWzI1XSAmIDI1NSkgPDwgOCB8IChrWzI2XSAmIDI1NSkgPDwgMTYgfCAoa1syN10gJiAyNTUpIDw8IDI0LCBqMTQgPSBrWzI4XSAmIDI1NSB8IChrWzI5XSAmIDI1NSkgPDwgOCB8IChrWzMwXSAmIDI1NSkgPDwgMTYgfCAoa1szMV0gJiAyNTUpIDw8IDI0LCBqMTUgPSBjWzEyXSAmIDI1NSB8IChjWzEzXSAmIDI1NSkgPDwgOCB8IChjWzE0XSAmIDI1NSkgPDwgMTYgfCAoY1sxNV0gJiAyNTUpIDw8IDI0OwogICAgICAgICAgdmFyIHgwID0gajAsIHgxID0gajEsIHgyID0gajIsIHgzID0gajMsIHg0ID0gajQsIHg1ID0gajUsIHg2ID0gajYsIHg3ID0gajcsIHg4ID0gajgsIHg5ID0gajksIHgxMCA9IGoxMCwgeDExID0gajExLCB4MTIgPSBqMTIsIHgxMyA9IGoxMywgeDE0ID0gajE0LCB4MTUgPSBqMTUsIHU7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDIwOyBpICs9IDIpIHsKICAgICAgICAgICAgdSA9IHgwICsgeDEyIHwgMDsKICAgICAgICAgICAgeDQgXj0gdSA8PCA3IHwgdSA-Pj4gMzIgLSA3OwogICAgICAgICAgICB1ID0geDQgKyB4MCB8IDA7CiAgICAgICAgICAgIHg4IF49IHUgPDwgOSB8IHUgPj4-IDMyIC0gOTsKICAgICAgICAgICAgdSA9IHg4ICsgeDQgfCAwOwogICAgICAgICAgICB4MTIgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4MTIgKyB4OCB8IDA7CiAgICAgICAgICAgIHgwIF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgICB1ID0geDUgKyB4MSB8IDA7CiAgICAgICAgICAgIHg5IF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHg5ICsgeDUgfCAwOwogICAgICAgICAgICB4MTMgXj0gdSA8PCA5IHwgdSA-Pj4gMzIgLSA5OwogICAgICAgICAgICB1ID0geDEzICsgeDkgfCAwOwogICAgICAgICAgICB4MSBePSB1IDw8IDEzIHwgdSA-Pj4gMzIgLSAxMzsKICAgICAgICAgICAgdSA9IHgxICsgeDEzIHwgMDsKICAgICAgICAgICAgeDUgXj0gdSA8PCAxOCB8IHUgPj4-IDMyIC0gMTg7CiAgICAgICAgICAgIHUgPSB4MTAgKyB4NiB8IDA7CiAgICAgICAgICAgIHgxNCBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4MTQgKyB4MTAgfCAwOwogICAgICAgICAgICB4MiBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4MiArIHgxNCB8IDA7CiAgICAgICAgICAgIHg2IF49IHUgPDwgMTMgfCB1ID4-PiAzMiAtIDEzOwogICAgICAgICAgICB1ID0geDYgKyB4MiB8IDA7CiAgICAgICAgICAgIHgxMCBePSB1IDw8IDE4IHwgdSA-Pj4gMzIgLSAxODsKICAgICAgICAgICAgdSA9IHgxNSArIHgxMSB8IDA7CiAgICAgICAgICAgIHgzIF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHgzICsgeDE1IHwgMDsKICAgICAgICAgICAgeDcgXj0gdSA8PCA5IHwgdSA-Pj4gMzIgLSA5OwogICAgICAgICAgICB1ID0geDcgKyB4MyB8IDA7CiAgICAgICAgICAgIHgxMSBePSB1IDw8IDEzIHwgdSA-Pj4gMzIgLSAxMzsKICAgICAgICAgICAgdSA9IHgxMSArIHg3IHwgMDsKICAgICAgICAgICAgeDE1IF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgICB1ID0geDAgKyB4MyB8IDA7CiAgICAgICAgICAgIHgxIF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHgxICsgeDAgfCAwOwogICAgICAgICAgICB4MiBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4MiArIHgxIHwgMDsKICAgICAgICAgICAgeDMgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4MyArIHgyIHwgMDsKICAgICAgICAgICAgeDAgXj0gdSA8PCAxOCB8IHUgPj4-IDMyIC0gMTg7CiAgICAgICAgICAgIHUgPSB4NSArIHg0IHwgMDsKICAgICAgICAgICAgeDYgXj0gdSA8PCA3IHwgdSA-Pj4gMzIgLSA3OwogICAgICAgICAgICB1ID0geDYgKyB4NSB8IDA7CiAgICAgICAgICAgIHg3IF49IHUgPDwgOSB8IHUgPj4-IDMyIC0gOTsKICAgICAgICAgICAgdSA9IHg3ICsgeDYgfCAwOwogICAgICAgICAgICB4NCBePSB1IDw8IDEzIHwgdSA-Pj4gMzIgLSAxMzsKICAgICAgICAgICAgdSA9IHg0ICsgeDcgfCAwOwogICAgICAgICAgICB4NSBePSB1IDw8IDE4IHwgdSA-Pj4gMzIgLSAxODsKICAgICAgICAgICAgdSA9IHgxMCArIHg5IHwgMDsKICAgICAgICAgICAgeDExIF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHgxMSArIHgxMCB8IDA7CiAgICAgICAgICAgIHg4IF49IHUgPDwgOSB8IHUgPj4-IDMyIC0gOTsKICAgICAgICAgICAgdSA9IHg4ICsgeDExIHwgMDsKICAgICAgICAgICAgeDkgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4OSArIHg4IHwgMDsKICAgICAgICAgICAgeDEwIF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgICB1ID0geDE1ICsgeDE0IHwgMDsKICAgICAgICAgICAgeDEyIF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHgxMiArIHgxNSB8IDA7CiAgICAgICAgICAgIHgxMyBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4MTMgKyB4MTIgfCAwOwogICAgICAgICAgICB4MTQgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4MTQgKyB4MTMgfCAwOwogICAgICAgICAgICB4MTUgXj0gdSA8PCAxOCB8IHUgPj4-IDMyIC0gMTg7CiAgICAgICAgICB9CiAgICAgICAgICB4MCA9IHgwICsgajAgfCAwOwogICAgICAgICAgeDEgPSB4MSArIGoxIHwgMDsKICAgICAgICAgIHgyID0geDIgKyBqMiB8IDA7CiAgICAgICAgICB4MyA9IHgzICsgajMgfCAwOwogICAgICAgICAgeDQgPSB4NCArIGo0IHwgMDsKICAgICAgICAgIHg1ID0geDUgKyBqNSB8IDA7CiAgICAgICAgICB4NiA9IHg2ICsgajYgfCAwOwogICAgICAgICAgeDcgPSB4NyArIGo3IHwgMDsKICAgICAgICAgIHg4ID0geDggKyBqOCB8IDA7CiAgICAgICAgICB4OSA9IHg5ICsgajkgfCAwOwogICAgICAgICAgeDEwID0geDEwICsgajEwIHwgMDsKICAgICAgICAgIHgxMSA9IHgxMSArIGoxMSB8IDA7CiAgICAgICAgICB4MTIgPSB4MTIgKyBqMTIgfCAwOwogICAgICAgICAgeDEzID0geDEzICsgajEzIHwgMDsKICAgICAgICAgIHgxNCA9IHgxNCArIGoxNCB8IDA7CiAgICAgICAgICB4MTUgPSB4MTUgKyBqMTUgfCAwOwogICAgICAgICAgb1swXSA9IHgwID4-PiAwICYgMjU1OwogICAgICAgICAgb1sxXSA9IHgwID4-PiA4ICYgMjU1OwogICAgICAgICAgb1syXSA9IHgwID4-PiAxNiAmIDI1NTsKICAgICAgICAgIG9bM10gPSB4MCA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzRdID0geDEgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzVdID0geDEgPj4-IDggJiAyNTU7CiAgICAgICAgICBvWzZdID0geDEgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1s3XSA9IHgxID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bOF0gPSB4MiA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG9bOV0gPSB4MiA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMTBdID0geDIgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1sxMV0gPSB4MiA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzEyXSA9IHgzID4-PiAwICYgMjU1OwogICAgICAgICAgb1sxM10gPSB4MyA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMTRdID0geDMgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1sxNV0gPSB4MyA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzE2XSA9IHg0ID4-PiAwICYgMjU1OwogICAgICAgICAgb1sxN10gPSB4NCA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMThdID0geDQgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1sxOV0gPSB4NCA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzIwXSA9IHg1ID4-PiAwICYgMjU1OwogICAgICAgICAgb1syMV0gPSB4NSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMjJdID0geDUgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1syM10gPSB4NSA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzI0XSA9IHg2ID4-PiAwICYgMjU1OwogICAgICAgICAgb1syNV0gPSB4NiA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMjZdID0geDYgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1syN10gPSB4NiA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzI4XSA9IHg3ID4-PiAwICYgMjU1OwogICAgICAgICAgb1syOV0gPSB4NyA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMzBdID0geDcgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1szMV0gPSB4NyA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzMyXSA9IHg4ID4-PiAwICYgMjU1OwogICAgICAgICAgb1szM10gPSB4OCA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMzRdID0geDggPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1szNV0gPSB4OCA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzM2XSA9IHg5ID4-PiAwICYgMjU1OwogICAgICAgICAgb1szN10gPSB4OSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMzhdID0geDkgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1szOV0gPSB4OSA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzQwXSA9IHgxMCA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG9bNDFdID0geDEwID4-PiA4ICYgMjU1OwogICAgICAgICAgb1s0Ml0gPSB4MTAgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1s0M10gPSB4MTAgPj4-IDI0ICYgMjU1OwogICAgICAgICAgb1s0NF0gPSB4MTEgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzQ1XSA9IHgxMSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bNDZdID0geDExID4-PiAxNiAmIDI1NTsKICAgICAgICAgIG9bNDddID0geDExID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bNDhdID0geDEyID4-PiAwICYgMjU1OwogICAgICAgICAgb1s0OV0gPSB4MTIgPj4-IDggJiAyNTU7CiAgICAgICAgICBvWzUwXSA9IHgxMiA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzUxXSA9IHgxMiA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzUyXSA9IHgxMyA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG9bNTNdID0geDEzID4-PiA4ICYgMjU1OwogICAgICAgICAgb1s1NF0gPSB4MTMgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1s1NV0gPSB4MTMgPj4-IDI0ICYgMjU1OwogICAgICAgICAgb1s1Nl0gPSB4MTQgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzU3XSA9IHgxNCA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bNThdID0geDE0ID4-PiAxNiAmIDI1NTsKICAgICAgICAgIG9bNTldID0geDE0ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bNjBdID0geDE1ID4-PiAwICYgMjU1OwogICAgICAgICAgb1s2MV0gPSB4MTUgPj4-IDggJiAyNTU7CiAgICAgICAgICBvWzYyXSA9IHgxNSA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzYzXSA9IHgxNSA-Pj4gMjQgJiAyNTU7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNvcmVfaHNhbHNhMjAobywgcCwgaywgYykgewogICAgICAgICAgdmFyIGowID0gY1swXSAmIDI1NSB8IChjWzFdICYgMjU1KSA8PCA4IHwgKGNbMl0gJiAyNTUpIDw8IDE2IHwgKGNbM10gJiAyNTUpIDw8IDI0LCBqMSA9IGtbMF0gJiAyNTUgfCAoa1sxXSAmIDI1NSkgPDwgOCB8IChrWzJdICYgMjU1KSA8PCAxNiB8IChrWzNdICYgMjU1KSA8PCAyNCwgajIgPSBrWzRdICYgMjU1IHwgKGtbNV0gJiAyNTUpIDw8IDggfCAoa1s2XSAmIDI1NSkgPDwgMTYgfCAoa1s3XSAmIDI1NSkgPDwgMjQsIGozID0ga1s4XSAmIDI1NSB8IChrWzldICYgMjU1KSA8PCA4IHwgKGtbMTBdICYgMjU1KSA8PCAxNiB8IChrWzExXSAmIDI1NSkgPDwgMjQsIGo0ID0ga1sxMl0gJiAyNTUgfCAoa1sxM10gJiAyNTUpIDw8IDggfCAoa1sxNF0gJiAyNTUpIDw8IDE2IHwgKGtbMTVdICYgMjU1KSA8PCAyNCwgajUgPSBjWzRdICYgMjU1IHwgKGNbNV0gJiAyNTUpIDw8IDggfCAoY1s2XSAmIDI1NSkgPDwgMTYgfCAoY1s3XSAmIDI1NSkgPDwgMjQsIGo2ID0gcFswXSAmIDI1NSB8IChwWzFdICYgMjU1KSA8PCA4IHwgKHBbMl0gJiAyNTUpIDw8IDE2IHwgKHBbM10gJiAyNTUpIDw8IDI0LCBqNyA9IHBbNF0gJiAyNTUgfCAocFs1XSAmIDI1NSkgPDwgOCB8IChwWzZdICYgMjU1KSA8PCAxNiB8IChwWzddICYgMjU1KSA8PCAyNCwgajggPSBwWzhdICYgMjU1IHwgKHBbOV0gJiAyNTUpIDw8IDggfCAocFsxMF0gJiAyNTUpIDw8IDE2IHwgKHBbMTFdICYgMjU1KSA8PCAyNCwgajkgPSBwWzEyXSAmIDI1NSB8IChwWzEzXSAmIDI1NSkgPDwgOCB8IChwWzE0XSAmIDI1NSkgPDwgMTYgfCAocFsxNV0gJiAyNTUpIDw8IDI0LCBqMTAgPSBjWzhdICYgMjU1IHwgKGNbOV0gJiAyNTUpIDw8IDggfCAoY1sxMF0gJiAyNTUpIDw8IDE2IHwgKGNbMTFdICYgMjU1KSA8PCAyNCwgajExID0ga1sxNl0gJiAyNTUgfCAoa1sxN10gJiAyNTUpIDw8IDggfCAoa1sxOF0gJiAyNTUpIDw8IDE2IHwgKGtbMTldICYgMjU1KSA8PCAyNCwgajEyID0ga1syMF0gJiAyNTUgfCAoa1syMV0gJiAyNTUpIDw8IDggfCAoa1syMl0gJiAyNTUpIDw8IDE2IHwgKGtbMjNdICYgMjU1KSA8PCAyNCwgajEzID0ga1syNF0gJiAyNTUgfCAoa1syNV0gJiAyNTUpIDw8IDggfCAoa1syNl0gJiAyNTUpIDw8IDE2IHwgKGtbMjddICYgMjU1KSA8PCAyNCwgajE0ID0ga1syOF0gJiAyNTUgfCAoa1syOV0gJiAyNTUpIDw8IDggfCAoa1szMF0gJiAyNTUpIDw8IDE2IHwgKGtbMzFdICYgMjU1KSA8PCAyNCwgajE1ID0gY1sxMl0gJiAyNTUgfCAoY1sxM10gJiAyNTUpIDw8IDggfCAoY1sxNF0gJiAyNTUpIDw8IDE2IHwgKGNbMTVdICYgMjU1KSA8PCAyNDsKICAgICAgICAgIHZhciB4MCA9IGowLCB4MSA9IGoxLCB4MiA9IGoyLCB4MyA9IGozLCB4NCA9IGo0LCB4NSA9IGo1LCB4NiA9IGo2LCB4NyA9IGo3LCB4OCA9IGo4LCB4OSA9IGo5LCB4MTAgPSBqMTAsIHgxMSA9IGoxMSwgeDEyID0gajEyLCB4MTMgPSBqMTMsIHgxNCA9IGoxNCwgeDE1ID0gajE1LCB1OwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyMDsgaSArPSAyKSB7CiAgICAgICAgICAgIHUgPSB4MCArIHgxMiB8IDA7CiAgICAgICAgICAgIHg0IF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHg0ICsgeDAgfCAwOwogICAgICAgICAgICB4OCBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4OCArIHg0IHwgMDsKICAgICAgICAgICAgeDEyIF49IHUgPDwgMTMgfCB1ID4-PiAzMiAtIDEzOwogICAgICAgICAgICB1ID0geDEyICsgeDggfCAwOwogICAgICAgICAgICB4MCBePSB1IDw8IDE4IHwgdSA-Pj4gMzIgLSAxODsKICAgICAgICAgICAgdSA9IHg1ICsgeDEgfCAwOwogICAgICAgICAgICB4OSBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4OSArIHg1IHwgMDsKICAgICAgICAgICAgeDEzIF49IHUgPDwgOSB8IHUgPj4-IDMyIC0gOTsKICAgICAgICAgICAgdSA9IHgxMyArIHg5IHwgMDsKICAgICAgICAgICAgeDEgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4MSArIHgxMyB8IDA7CiAgICAgICAgICAgIHg1IF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgICB1ID0geDEwICsgeDYgfCAwOwogICAgICAgICAgICB4MTQgXj0gdSA8PCA3IHwgdSA-Pj4gMzIgLSA3OwogICAgICAgICAgICB1ID0geDE0ICsgeDEwIHwgMDsKICAgICAgICAgICAgeDIgXj0gdSA8PCA5IHwgdSA-Pj4gMzIgLSA5OwogICAgICAgICAgICB1ID0geDIgKyB4MTQgfCAwOwogICAgICAgICAgICB4NiBePSB1IDw8IDEzIHwgdSA-Pj4gMzIgLSAxMzsKICAgICAgICAgICAgdSA9IHg2ICsgeDIgfCAwOwogICAgICAgICAgICB4MTAgXj0gdSA8PCAxOCB8IHUgPj4-IDMyIC0gMTg7CiAgICAgICAgICAgIHUgPSB4MTUgKyB4MTEgfCAwOwogICAgICAgICAgICB4MyBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4MyArIHgxNSB8IDA7CiAgICAgICAgICAgIHg3IF49IHUgPDwgOSB8IHUgPj4-IDMyIC0gOTsKICAgICAgICAgICAgdSA9IHg3ICsgeDMgfCAwOwogICAgICAgICAgICB4MTEgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4MTEgKyB4NyB8IDA7CiAgICAgICAgICAgIHgxNSBePSB1IDw8IDE4IHwgdSA-Pj4gMzIgLSAxODsKICAgICAgICAgICAgdSA9IHgwICsgeDMgfCAwOwogICAgICAgICAgICB4MSBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4MSArIHgwIHwgMDsKICAgICAgICAgICAgeDIgXj0gdSA8PCA5IHwgdSA-Pj4gMzIgLSA5OwogICAgICAgICAgICB1ID0geDIgKyB4MSB8IDA7CiAgICAgICAgICAgIHgzIF49IHUgPDwgMTMgfCB1ID4-PiAzMiAtIDEzOwogICAgICAgICAgICB1ID0geDMgKyB4MiB8IDA7CiAgICAgICAgICAgIHgwIF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgICB1ID0geDUgKyB4NCB8IDA7CiAgICAgICAgICAgIHg2IF49IHUgPDwgNyB8IHUgPj4-IDMyIC0gNzsKICAgICAgICAgICAgdSA9IHg2ICsgeDUgfCAwOwogICAgICAgICAgICB4NyBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4NyArIHg2IHwgMDsKICAgICAgICAgICAgeDQgXj0gdSA8PCAxMyB8IHUgPj4-IDMyIC0gMTM7CiAgICAgICAgICAgIHUgPSB4NCArIHg3IHwgMDsKICAgICAgICAgICAgeDUgXj0gdSA8PCAxOCB8IHUgPj4-IDMyIC0gMTg7CiAgICAgICAgICAgIHUgPSB4MTAgKyB4OSB8IDA7CiAgICAgICAgICAgIHgxMSBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4MTEgKyB4MTAgfCAwOwogICAgICAgICAgICB4OCBePSB1IDw8IDkgfCB1ID4-PiAzMiAtIDk7CiAgICAgICAgICAgIHUgPSB4OCArIHgxMSB8IDA7CiAgICAgICAgICAgIHg5IF49IHUgPDwgMTMgfCB1ID4-PiAzMiAtIDEzOwogICAgICAgICAgICB1ID0geDkgKyB4OCB8IDA7CiAgICAgICAgICAgIHgxMCBePSB1IDw8IDE4IHwgdSA-Pj4gMzIgLSAxODsKICAgICAgICAgICAgdSA9IHgxNSArIHgxNCB8IDA7CiAgICAgICAgICAgIHgxMiBePSB1IDw8IDcgfCB1ID4-PiAzMiAtIDc7CiAgICAgICAgICAgIHUgPSB4MTIgKyB4MTUgfCAwOwogICAgICAgICAgICB4MTMgXj0gdSA8PCA5IHwgdSA-Pj4gMzIgLSA5OwogICAgICAgICAgICB1ID0geDEzICsgeDEyIHwgMDsKICAgICAgICAgICAgeDE0IF49IHUgPDwgMTMgfCB1ID4-PiAzMiAtIDEzOwogICAgICAgICAgICB1ID0geDE0ICsgeDEzIHwgMDsKICAgICAgICAgICAgeDE1IF49IHUgPDwgMTggfCB1ID4-PiAzMiAtIDE4OwogICAgICAgICAgfQogICAgICAgICAgb1swXSA9IHgwID4-PiAwICYgMjU1OwogICAgICAgICAgb1sxXSA9IHgwID4-PiA4ICYgMjU1OwogICAgICAgICAgb1syXSA9IHgwID4-PiAxNiAmIDI1NTsKICAgICAgICAgIG9bM10gPSB4MCA-Pj4gMjQgJiAyNTU7CiAgICAgICAgICBvWzRdID0geDUgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzVdID0geDUgPj4-IDggJiAyNTU7CiAgICAgICAgICBvWzZdID0geDUgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1s3XSA9IHg1ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bOF0gPSB4MTAgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzldID0geDEwID4-PiA4ICYgMjU1OwogICAgICAgICAgb1sxMF0gPSB4MTAgPj4-IDE2ICYgMjU1OwogICAgICAgICAgb1sxMV0gPSB4MTAgPj4-IDI0ICYgMjU1OwogICAgICAgICAgb1sxMl0gPSB4MTUgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzEzXSA9IHgxNSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG9bMTRdID0geDE1ID4-PiAxNiAmIDI1NTsKICAgICAgICAgIG9bMTVdID0geDE1ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bMTZdID0geDYgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzE3XSA9IHg2ID4-PiA4ICYgMjU1OwogICAgICAgICAgb1sxOF0gPSB4NiA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzE5XSA9IHg2ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bMjBdID0geDcgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzIxXSA9IHg3ID4-PiA4ICYgMjU1OwogICAgICAgICAgb1syMl0gPSB4NyA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzIzXSA9IHg3ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bMjRdID0geDggPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzI1XSA9IHg4ID4-PiA4ICYgMjU1OwogICAgICAgICAgb1syNl0gPSB4OCA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzI3XSA9IHg4ID4-PiAyNCAmIDI1NTsKICAgICAgICAgIG9bMjhdID0geDkgPj4-IDAgJiAyNTU7CiAgICAgICAgICBvWzI5XSA9IHg5ID4-PiA4ICYgMjU1OwogICAgICAgICAgb1szMF0gPSB4OSA-Pj4gMTYgJiAyNTU7CiAgICAgICAgICBvWzMxXSA9IHg5ID4-PiAyNCAmIDI1NTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX2NvcmVfc2Fsc2EyMChvdXQsIGlucCwgaywgYykgewogICAgICAgICAgY29yZV9zYWxzYTIwKG91dCwgaW5wLCBrLCBjKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX2NvcmVfaHNhbHNhMjAob3V0LCBpbnAsIGssIGMpIHsKICAgICAgICAgIGNvcmVfaHNhbHNhMjAob3V0LCBpbnAsIGssIGMpOwogICAgICAgIH0KICAgICAgICB2YXIgc2lnbWEgPSBuZXcgVWludDhBcnJheShbCiAgICAgICAgICAxMDEsCiAgICAgICAgICAxMjAsCiAgICAgICAgICAxMTIsCiAgICAgICAgICA5NywKICAgICAgICAgIDExMCwKICAgICAgICAgIDEwMCwKICAgICAgICAgIDMyLAogICAgICAgICAgNTEsCiAgICAgICAgICA1MCwKICAgICAgICAgIDQ1LAogICAgICAgICAgOTgsCiAgICAgICAgICAxMjEsCiAgICAgICAgICAxMTYsCiAgICAgICAgICAxMDEsCiAgICAgICAgICAzMiwKICAgICAgICAgIDEwNwogICAgICAgIF0pOwogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19zdHJlYW1fc2Fsc2EyMF94b3IoYywgY3BvcywgbSwgbXBvcywgYiwgbiwgaykgewogICAgICAgICAgdmFyIHogPSBuZXcgVWludDhBcnJheSgxNiksIHggPSBuZXcgVWludDhBcnJheSg2NCk7CiAgICAgICAgICB2YXIgdSwgaTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKQogICAgICAgICAgICB6W2ldID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgIHpbaV0gPSBuW2ldOwogICAgICAgICAgd2hpbGUgKGIgPj0gNjQpIHsKICAgICAgICAgICAgY3J5cHRvX2NvcmVfc2Fsc2EyMCh4LCB6LCBrLCBzaWdtYSk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQogICAgICAgICAgICAgIGNbY3BvcyArIGldID0gbVttcG9zICsgaV0gXiB4W2ldOwogICAgICAgICAgICB1ID0gMTsKICAgICAgICAgICAgZm9yIChpID0gODsgaSA8IDE2OyBpKyspIHsKICAgICAgICAgICAgICB1ID0gdSArICh6W2ldICYgMjU1KSB8IDA7CiAgICAgICAgICAgICAgeltpXSA9IHUgJiAyNTU7CiAgICAgICAgICAgICAgdSA-Pj49IDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYiAtPSA2NDsKICAgICAgICAgICAgY3BvcyArPSA2NDsKICAgICAgICAgICAgbXBvcyArPSA2NDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChiID4gMCkgewogICAgICAgICAgICBjcnlwdG9fY29yZV9zYWxzYTIwKHgsIHosIGssIHNpZ21hKTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGI7IGkrKykKICAgICAgICAgICAgICBjW2Nwb3MgKyBpXSA9IG1bbXBvcyArIGldIF4geFtpXTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fc3RyZWFtX3NhbHNhMjAoYywgY3BvcywgYiwgbiwgaykgewogICAgICAgICAgdmFyIHogPSBuZXcgVWludDhBcnJheSgxNiksIHggPSBuZXcgVWludDhBcnJheSg2NCk7CiAgICAgICAgICB2YXIgdSwgaTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKQogICAgICAgICAgICB6W2ldID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgIHpbaV0gPSBuW2ldOwogICAgICAgICAgd2hpbGUgKGIgPj0gNjQpIHsKICAgICAgICAgICAgY3J5cHRvX2NvcmVfc2Fsc2EyMCh4LCB6LCBrLCBzaWdtYSk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQogICAgICAgICAgICAgIGNbY3BvcyArIGldID0geFtpXTsKICAgICAgICAgICAgdSA9IDE7CiAgICAgICAgICAgIGZvciAoaSA9IDg7IGkgPCAxNjsgaSsrKSB7CiAgICAgICAgICAgICAgdSA9IHUgKyAoeltpXSAmIDI1NSkgfCAwOwogICAgICAgICAgICAgIHpbaV0gPSB1ICYgMjU1OwogICAgICAgICAgICAgIHUgPj4-PSA4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGIgLT0gNjQ7CiAgICAgICAgICAgIGNwb3MgKz0gNjQ7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYiA-IDApIHsKICAgICAgICAgICAgY3J5cHRvX2NvcmVfc2Fsc2EyMCh4LCB6LCBrLCBzaWdtYSk7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBiOyBpKyspCiAgICAgICAgICAgICAgY1tjcG9zICsgaV0gPSB4W2ldOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19zdHJlYW0oYywgY3BvcywgZCwgbiwgaykgewogICAgICAgICAgdmFyIHMgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgICBjcnlwdG9fY29yZV9oc2Fsc2EyMChzLCBuLCBrLCBzaWdtYSk7CiAgICAgICAgICB2YXIgc24gPSBuZXcgVWludDhBcnJheSg4KTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKQogICAgICAgICAgICBzbltpXSA9IG5baSArIDE2XTsKICAgICAgICAgIHJldHVybiBjcnlwdG9fc3RyZWFtX3NhbHNhMjAoYywgY3BvcywgZCwgc24sIHMpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fc3RyZWFtX3hvcihjLCBjcG9zLCBtLCBtcG9zLCBkLCBuLCBrKSB7CiAgICAgICAgICB2YXIgcyA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgICAgICAgIGNyeXB0b19jb3JlX2hzYWxzYTIwKHMsIG4sIGssIHNpZ21hKTsKICAgICAgICAgIHZhciBzbiA9IG5ldyBVaW50OEFycmF5KDgpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgIHNuW2ldID0gbltpICsgMTZdOwogICAgICAgICAgcmV0dXJuIGNyeXB0b19zdHJlYW1fc2Fsc2EyMF94b3IoYywgY3BvcywgbSwgbXBvcywgZCwgc24sIHMpOwogICAgICAgIH0KICAgICAgICB2YXIgcG9seTEzMDUgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICAgICAgdGhpcy5yID0gbmV3IFVpbnQxNkFycmF5KDEwKTsKICAgICAgICAgIHRoaXMuaCA9IG5ldyBVaW50MTZBcnJheSgxMCk7CiAgICAgICAgICB0aGlzLnBhZCA9IG5ldyBVaW50MTZBcnJheSg4KTsKICAgICAgICAgIHRoaXMubGVmdG92ZXIgPSAwOwogICAgICAgICAgdGhpcy5maW4gPSAwOwogICAgICAgICAgdmFyIHQwLCB0MSwgdDIsIHQzLCB0NCwgdDUsIHQ2LCB0NzsKICAgICAgICAgIHQwID0ga2V5WzBdICYgMjU1IHwgKGtleVsxXSAmIDI1NSkgPDwgODsKICAgICAgICAgIHRoaXMuclswXSA9IHQwICYgODE5MTsKICAgICAgICAgIHQxID0ga2V5WzJdICYgMjU1IHwgKGtleVszXSAmIDI1NSkgPDwgODsKICAgICAgICAgIHRoaXMuclsxXSA9ICh0MCA-Pj4gMTMgfCB0MSA8PCAzKSAmIDgxOTE7CiAgICAgICAgICB0MiA9IGtleVs0XSAmIDI1NSB8IChrZXlbNV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnJbMl0gPSAodDEgPj4-IDEwIHwgdDIgPDwgNikgJiA3OTM5OwogICAgICAgICAgdDMgPSBrZXlbNl0gJiAyNTUgfCAoa2V5WzddICYgMjU1KSA8PCA4OwogICAgICAgICAgdGhpcy5yWzNdID0gKHQyID4-PiA3IHwgdDMgPDwgOSkgJiA4MTkxOwogICAgICAgICAgdDQgPSBrZXlbOF0gJiAyNTUgfCAoa2V5WzldICYgMjU1KSA8PCA4OwogICAgICAgICAgdGhpcy5yWzRdID0gKHQzID4-PiA0IHwgdDQgPDwgMTIpICYgMjU1OwogICAgICAgICAgdGhpcy5yWzVdID0gdDQgPj4-IDEgJiA4MTkwOwogICAgICAgICAgdDUgPSBrZXlbMTBdICYgMjU1IHwgKGtleVsxMV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnJbNl0gPSAodDQgPj4-IDE0IHwgdDUgPDwgMikgJiA4MTkxOwogICAgICAgICAgdDYgPSBrZXlbMTJdICYgMjU1IHwgKGtleVsxM10gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnJbN10gPSAodDUgPj4-IDExIHwgdDYgPDwgNSkgJiA4MDY1OwogICAgICAgICAgdDcgPSBrZXlbMTRdICYgMjU1IHwgKGtleVsxNV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnJbOF0gPSAodDYgPj4-IDggfCB0NyA8PCA4KSAmIDgxOTE7CiAgICAgICAgICB0aGlzLnJbOV0gPSB0NyA-Pj4gNSAmIDEyNzsKICAgICAgICAgIHRoaXMucGFkWzBdID0ga2V5WzE2XSAmIDI1NSB8IChrZXlbMTddICYgMjU1KSA8PCA4OwogICAgICAgICAgdGhpcy5wYWRbMV0gPSBrZXlbMThdICYgMjU1IHwgKGtleVsxOV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnBhZFsyXSA9IGtleVsyMF0gJiAyNTUgfCAoa2V5WzIxXSAmIDI1NSkgPDwgODsKICAgICAgICAgIHRoaXMucGFkWzNdID0ga2V5WzIyXSAmIDI1NSB8IChrZXlbMjNdICYgMjU1KSA8PCA4OwogICAgICAgICAgdGhpcy5wYWRbNF0gPSBrZXlbMjRdICYgMjU1IHwgKGtleVsyNV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICB0aGlzLnBhZFs1XSA9IGtleVsyNl0gJiAyNTUgfCAoa2V5WzI3XSAmIDI1NSkgPDwgODsKICAgICAgICAgIHRoaXMucGFkWzZdID0ga2V5WzI4XSAmIDI1NSB8IChrZXlbMjldICYgMjU1KSA8PCA4OwogICAgICAgICAgdGhpcy5wYWRbN10gPSBrZXlbMzBdICYgMjU1IHwgKGtleVszMV0gJiAyNTUpIDw8IDg7CiAgICAgICAgfTsKICAgICAgICBwb2x5MTMwNS5wcm90b3R5cGUuYmxvY2tzID0gZnVuY3Rpb24obSwgbXBvcywgYnl0ZXMpIHsKICAgICAgICAgIHZhciBoaWJpdCA9IHRoaXMuZmluID8gMCA6IDEgPDwgMTE7CiAgICAgICAgICB2YXIgdDAsIHQxLCB0MiwgdDMsIHQ0LCB0NSwgdDYsIHQ3LCBjOwogICAgICAgICAgdmFyIGQwLCBkMSwgZDIsIGQzLCBkNCwgZDUsIGQ2LCBkNywgZDgsIGQ5OwogICAgICAgICAgdmFyIGgwID0gdGhpcy5oWzBdLCBoMSA9IHRoaXMuaFsxXSwgaDIgPSB0aGlzLmhbMl0sIGgzID0gdGhpcy5oWzNdLCBoNCA9IHRoaXMuaFs0XSwgaDUgPSB0aGlzLmhbNV0sIGg2ID0gdGhpcy5oWzZdLCBoNyA9IHRoaXMuaFs3XSwgaDggPSB0aGlzLmhbOF0sIGg5ID0gdGhpcy5oWzldOwogICAgICAgICAgdmFyIHIwID0gdGhpcy5yWzBdLCByMSA9IHRoaXMuclsxXSwgcjIgPSB0aGlzLnJbMl0sIHIzID0gdGhpcy5yWzNdLCByNCA9IHRoaXMucls0XSwgcjUgPSB0aGlzLnJbNV0sIHI2ID0gdGhpcy5yWzZdLCByNyA9IHRoaXMucls3XSwgcjggPSB0aGlzLnJbOF0sIHI5ID0gdGhpcy5yWzldOwogICAgICAgICAgd2hpbGUgKGJ5dGVzID49IDE2KSB7CiAgICAgICAgICAgIHQwID0gbVttcG9zICsgMF0gJiAyNTUgfCAobVttcG9zICsgMV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICAgIGgwICs9IHQwICYgODE5MTsKICAgICAgICAgICAgdDEgPSBtW21wb3MgKyAyXSAmIDI1NSB8IChtW21wb3MgKyAzXSAmIDI1NSkgPDwgODsKICAgICAgICAgICAgaDEgKz0gKHQwID4-PiAxMyB8IHQxIDw8IDMpICYgODE5MTsKICAgICAgICAgICAgdDIgPSBtW21wb3MgKyA0XSAmIDI1NSB8IChtW21wb3MgKyA1XSAmIDI1NSkgPDwgODsKICAgICAgICAgICAgaDIgKz0gKHQxID4-PiAxMCB8IHQyIDw8IDYpICYgODE5MTsKICAgICAgICAgICAgdDMgPSBtW21wb3MgKyA2XSAmIDI1NSB8IChtW21wb3MgKyA3XSAmIDI1NSkgPDwgODsKICAgICAgICAgICAgaDMgKz0gKHQyID4-PiA3IHwgdDMgPDwgOSkgJiA4MTkxOwogICAgICAgICAgICB0NCA9IG1bbXBvcyArIDhdICYgMjU1IHwgKG1bbXBvcyArIDldICYgMjU1KSA8PCA4OwogICAgICAgICAgICBoNCArPSAodDMgPj4-IDQgfCB0NCA8PCAxMikgJiA4MTkxOwogICAgICAgICAgICBoNSArPSB0NCA-Pj4gMSAmIDgxOTE7CiAgICAgICAgICAgIHQ1ID0gbVttcG9zICsgMTBdICYgMjU1IHwgKG1bbXBvcyArIDExXSAmIDI1NSkgPDwgODsKICAgICAgICAgICAgaDYgKz0gKHQ0ID4-PiAxNCB8IHQ1IDw8IDIpICYgODE5MTsKICAgICAgICAgICAgdDYgPSBtW21wb3MgKyAxMl0gJiAyNTUgfCAobVttcG9zICsgMTNdICYgMjU1KSA8PCA4OwogICAgICAgICAgICBoNyArPSAodDUgPj4-IDExIHwgdDYgPDwgNSkgJiA4MTkxOwogICAgICAgICAgICB0NyA9IG1bbXBvcyArIDE0XSAmIDI1NSB8IChtW21wb3MgKyAxNV0gJiAyNTUpIDw8IDg7CiAgICAgICAgICAgIGg4ICs9ICh0NiA-Pj4gOCB8IHQ3IDw8IDgpICYgODE5MTsKICAgICAgICAgICAgaDkgKz0gdDcgPj4-IDUgfCBoaWJpdDsKICAgICAgICAgICAgYyA9IDA7CiAgICAgICAgICAgIGQwID0gYzsKICAgICAgICAgICAgZDAgKz0gaDAgKiByMDsKICAgICAgICAgICAgZDAgKz0gaDEgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDAgKz0gaDIgKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDAgKz0gaDMgKiAoNSAqIHI3KTsKICAgICAgICAgICAgZDAgKz0gaDQgKiAoNSAqIHI2KTsKICAgICAgICAgICAgYyA9IGQwID4-PiAxMzsKICAgICAgICAgICAgZDAgJj0gODE5MTsKICAgICAgICAgICAgZDAgKz0gaDUgKiAoNSAqIHI1KTsKICAgICAgICAgICAgZDAgKz0gaDYgKiAoNSAqIHI0KTsKICAgICAgICAgICAgZDAgKz0gaDcgKiAoNSAqIHIzKTsKICAgICAgICAgICAgZDAgKz0gaDggKiAoNSAqIHIyKTsKICAgICAgICAgICAgZDAgKz0gaDkgKiAoNSAqIHIxKTsKICAgICAgICAgICAgYyArPSBkMCA-Pj4gMTM7CiAgICAgICAgICAgIGQwICY9IDgxOTE7CiAgICAgICAgICAgIGQxID0gYzsKICAgICAgICAgICAgZDEgKz0gaDAgKiByMTsKICAgICAgICAgICAgZDEgKz0gaDEgKiByMDsKICAgICAgICAgICAgZDEgKz0gaDIgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDEgKz0gaDMgKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDEgKz0gaDQgKiAoNSAqIHI3KTsKICAgICAgICAgICAgYyA9IGQxID4-PiAxMzsKICAgICAgICAgICAgZDEgJj0gODE5MTsKICAgICAgICAgICAgZDEgKz0gaDUgKiAoNSAqIHI2KTsKICAgICAgICAgICAgZDEgKz0gaDYgKiAoNSAqIHI1KTsKICAgICAgICAgICAgZDEgKz0gaDcgKiAoNSAqIHI0KTsKICAgICAgICAgICAgZDEgKz0gaDggKiAoNSAqIHIzKTsKICAgICAgICAgICAgZDEgKz0gaDkgKiAoNSAqIHIyKTsKICAgICAgICAgICAgYyArPSBkMSA-Pj4gMTM7CiAgICAgICAgICAgIGQxICY9IDgxOTE7CiAgICAgICAgICAgIGQyID0gYzsKICAgICAgICAgICAgZDIgKz0gaDAgKiByMjsKICAgICAgICAgICAgZDIgKz0gaDEgKiByMTsKICAgICAgICAgICAgZDIgKz0gaDIgKiByMDsKICAgICAgICAgICAgZDIgKz0gaDMgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDIgKz0gaDQgKiAoNSAqIHI4KTsKICAgICAgICAgICAgYyA9IGQyID4-PiAxMzsKICAgICAgICAgICAgZDIgJj0gODE5MTsKICAgICAgICAgICAgZDIgKz0gaDUgKiAoNSAqIHI3KTsKICAgICAgICAgICAgZDIgKz0gaDYgKiAoNSAqIHI2KTsKICAgICAgICAgICAgZDIgKz0gaDcgKiAoNSAqIHI1KTsKICAgICAgICAgICAgZDIgKz0gaDggKiAoNSAqIHI0KTsKICAgICAgICAgICAgZDIgKz0gaDkgKiAoNSAqIHIzKTsKICAgICAgICAgICAgYyArPSBkMiA-Pj4gMTM7CiAgICAgICAgICAgIGQyICY9IDgxOTE7CiAgICAgICAgICAgIGQzID0gYzsKICAgICAgICAgICAgZDMgKz0gaDAgKiByMzsKICAgICAgICAgICAgZDMgKz0gaDEgKiByMjsKICAgICAgICAgICAgZDMgKz0gaDIgKiByMTsKICAgICAgICAgICAgZDMgKz0gaDMgKiByMDsKICAgICAgICAgICAgZDMgKz0gaDQgKiAoNSAqIHI5KTsKICAgICAgICAgICAgYyA9IGQzID4-PiAxMzsKICAgICAgICAgICAgZDMgJj0gODE5MTsKICAgICAgICAgICAgZDMgKz0gaDUgKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDMgKz0gaDYgKiAoNSAqIHI3KTsKICAgICAgICAgICAgZDMgKz0gaDcgKiAoNSAqIHI2KTsKICAgICAgICAgICAgZDMgKz0gaDggKiAoNSAqIHI1KTsKICAgICAgICAgICAgZDMgKz0gaDkgKiAoNSAqIHI0KTsKICAgICAgICAgICAgYyArPSBkMyA-Pj4gMTM7CiAgICAgICAgICAgIGQzICY9IDgxOTE7CiAgICAgICAgICAgIGQ0ID0gYzsKICAgICAgICAgICAgZDQgKz0gaDAgKiByNDsKICAgICAgICAgICAgZDQgKz0gaDEgKiByMzsKICAgICAgICAgICAgZDQgKz0gaDIgKiByMjsKICAgICAgICAgICAgZDQgKz0gaDMgKiByMTsKICAgICAgICAgICAgZDQgKz0gaDQgKiByMDsKICAgICAgICAgICAgYyA9IGQ0ID4-PiAxMzsKICAgICAgICAgICAgZDQgJj0gODE5MTsKICAgICAgICAgICAgZDQgKz0gaDUgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDQgKz0gaDYgKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDQgKz0gaDcgKiAoNSAqIHI3KTsKICAgICAgICAgICAgZDQgKz0gaDggKiAoNSAqIHI2KTsKICAgICAgICAgICAgZDQgKz0gaDkgKiAoNSAqIHI1KTsKICAgICAgICAgICAgYyArPSBkNCA-Pj4gMTM7CiAgICAgICAgICAgIGQ0ICY9IDgxOTE7CiAgICAgICAgICAgIGQ1ID0gYzsKICAgICAgICAgICAgZDUgKz0gaDAgKiByNTsKICAgICAgICAgICAgZDUgKz0gaDEgKiByNDsKICAgICAgICAgICAgZDUgKz0gaDIgKiByMzsKICAgICAgICAgICAgZDUgKz0gaDMgKiByMjsKICAgICAgICAgICAgZDUgKz0gaDQgKiByMTsKICAgICAgICAgICAgYyA9IGQ1ID4-PiAxMzsKICAgICAgICAgICAgZDUgJj0gODE5MTsKICAgICAgICAgICAgZDUgKz0gaDUgKiByMDsKICAgICAgICAgICAgZDUgKz0gaDYgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDUgKz0gaDcgKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDUgKz0gaDggKiAoNSAqIHI3KTsKICAgICAgICAgICAgZDUgKz0gaDkgKiAoNSAqIHI2KTsKICAgICAgICAgICAgYyArPSBkNSA-Pj4gMTM7CiAgICAgICAgICAgIGQ1ICY9IDgxOTE7CiAgICAgICAgICAgIGQ2ID0gYzsKICAgICAgICAgICAgZDYgKz0gaDAgKiByNjsKICAgICAgICAgICAgZDYgKz0gaDEgKiByNTsKICAgICAgICAgICAgZDYgKz0gaDIgKiByNDsKICAgICAgICAgICAgZDYgKz0gaDMgKiByMzsKICAgICAgICAgICAgZDYgKz0gaDQgKiByMjsKICAgICAgICAgICAgYyA9IGQ2ID4-PiAxMzsKICAgICAgICAgICAgZDYgJj0gODE5MTsKICAgICAgICAgICAgZDYgKz0gaDUgKiByMTsKICAgICAgICAgICAgZDYgKz0gaDYgKiByMDsKICAgICAgICAgICAgZDYgKz0gaDcgKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDYgKz0gaDggKiAoNSAqIHI4KTsKICAgICAgICAgICAgZDYgKz0gaDkgKiAoNSAqIHI3KTsKICAgICAgICAgICAgYyArPSBkNiA-Pj4gMTM7CiAgICAgICAgICAgIGQ2ICY9IDgxOTE7CiAgICAgICAgICAgIGQ3ID0gYzsKICAgICAgICAgICAgZDcgKz0gaDAgKiByNzsKICAgICAgICAgICAgZDcgKz0gaDEgKiByNjsKICAgICAgICAgICAgZDcgKz0gaDIgKiByNTsKICAgICAgICAgICAgZDcgKz0gaDMgKiByNDsKICAgICAgICAgICAgZDcgKz0gaDQgKiByMzsKICAgICAgICAgICAgYyA9IGQ3ID4-PiAxMzsKICAgICAgICAgICAgZDcgJj0gODE5MTsKICAgICAgICAgICAgZDcgKz0gaDUgKiByMjsKICAgICAgICAgICAgZDcgKz0gaDYgKiByMTsKICAgICAgICAgICAgZDcgKz0gaDcgKiByMDsKICAgICAgICAgICAgZDcgKz0gaDggKiAoNSAqIHI5KTsKICAgICAgICAgICAgZDcgKz0gaDkgKiAoNSAqIHI4KTsKICAgICAgICAgICAgYyArPSBkNyA-Pj4gMTM7CiAgICAgICAgICAgIGQ3ICY9IDgxOTE7CiAgICAgICAgICAgIGQ4ID0gYzsKICAgICAgICAgICAgZDggKz0gaDAgKiByODsKICAgICAgICAgICAgZDggKz0gaDEgKiByNzsKICAgICAgICAgICAgZDggKz0gaDIgKiByNjsKICAgICAgICAgICAgZDggKz0gaDMgKiByNTsKICAgICAgICAgICAgZDggKz0gaDQgKiByNDsKICAgICAgICAgICAgYyA9IGQ4ID4-PiAxMzsKICAgICAgICAgICAgZDggJj0gODE5MTsKICAgICAgICAgICAgZDggKz0gaDUgKiByMzsKICAgICAgICAgICAgZDggKz0gaDYgKiByMjsKICAgICAgICAgICAgZDggKz0gaDcgKiByMTsKICAgICAgICAgICAgZDggKz0gaDggKiByMDsKICAgICAgICAgICAgZDggKz0gaDkgKiAoNSAqIHI5KTsKICAgICAgICAgICAgYyArPSBkOCA-Pj4gMTM7CiAgICAgICAgICAgIGQ4ICY9IDgxOTE7CiAgICAgICAgICAgIGQ5ID0gYzsKICAgICAgICAgICAgZDkgKz0gaDAgKiByOTsKICAgICAgICAgICAgZDkgKz0gaDEgKiByODsKICAgICAgICAgICAgZDkgKz0gaDIgKiByNzsKICAgICAgICAgICAgZDkgKz0gaDMgKiByNjsKICAgICAgICAgICAgZDkgKz0gaDQgKiByNTsKICAgICAgICAgICAgYyA9IGQ5ID4-PiAxMzsKICAgICAgICAgICAgZDkgJj0gODE5MTsKICAgICAgICAgICAgZDkgKz0gaDUgKiByNDsKICAgICAgICAgICAgZDkgKz0gaDYgKiByMzsKICAgICAgICAgICAgZDkgKz0gaDcgKiByMjsKICAgICAgICAgICAgZDkgKz0gaDggKiByMTsKICAgICAgICAgICAgZDkgKz0gaDkgKiByMDsKICAgICAgICAgICAgYyArPSBkOSA-Pj4gMTM7CiAgICAgICAgICAgIGQ5ICY9IDgxOTE7CiAgICAgICAgICAgIGMgPSAoYyA8PCAyKSArIGMgfCAwOwogICAgICAgICAgICBjID0gYyArIGQwIHwgMDsKICAgICAgICAgICAgZDAgPSBjICYgODE5MTsKICAgICAgICAgICAgYyA9IGMgPj4-IDEzOwogICAgICAgICAgICBkMSArPSBjOwogICAgICAgICAgICBoMCA9IGQwOwogICAgICAgICAgICBoMSA9IGQxOwogICAgICAgICAgICBoMiA9IGQyOwogICAgICAgICAgICBoMyA9IGQzOwogICAgICAgICAgICBoNCA9IGQ0OwogICAgICAgICAgICBoNSA9IGQ1OwogICAgICAgICAgICBoNiA9IGQ2OwogICAgICAgICAgICBoNyA9IGQ3OwogICAgICAgICAgICBoOCA9IGQ4OwogICAgICAgICAgICBoOSA9IGQ5OwogICAgICAgICAgICBtcG9zICs9IDE2OwogICAgICAgICAgICBieXRlcyAtPSAxNjsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuaFswXSA9IGgwOwogICAgICAgICAgdGhpcy5oWzFdID0gaDE7CiAgICAgICAgICB0aGlzLmhbMl0gPSBoMjsKICAgICAgICAgIHRoaXMuaFszXSA9IGgzOwogICAgICAgICAgdGhpcy5oWzRdID0gaDQ7CiAgICAgICAgICB0aGlzLmhbNV0gPSBoNTsKICAgICAgICAgIHRoaXMuaFs2XSA9IGg2OwogICAgICAgICAgdGhpcy5oWzddID0gaDc7CiAgICAgICAgICB0aGlzLmhbOF0gPSBoODsKICAgICAgICAgIHRoaXMuaFs5XSA9IGg5OwogICAgICAgIH07CiAgICAgICAgcG9seTEzMDUucHJvdG90eXBlLmZpbmlzaCA9IGZ1bmN0aW9uKG1hYywgbWFjcG9zKSB7CiAgICAgICAgICB2YXIgZzIgPSBuZXcgVWludDE2QXJyYXkoMTApOwogICAgICAgICAgdmFyIGMsIG1hc2ssIGYsIGk7CiAgICAgICAgICBpZiAodGhpcy5sZWZ0b3ZlcikgewogICAgICAgICAgICBpID0gdGhpcy5sZWZ0b3ZlcjsKICAgICAgICAgICAgdGhpcy5idWZmZXJbaSsrXSA9IDE7CiAgICAgICAgICAgIGZvciAoOyBpIDwgMTY7IGkrKykKICAgICAgICAgICAgICB0aGlzLmJ1ZmZlcltpXSA9IDA7CiAgICAgICAgICAgIHRoaXMuZmluID0gMTsKICAgICAgICAgICAgdGhpcy5ibG9ja3ModGhpcy5idWZmZXIsIDAsIDE2KTsKICAgICAgICAgIH0KICAgICAgICAgIGMgPSB0aGlzLmhbMV0gPj4-IDEzOwogICAgICAgICAgdGhpcy5oWzFdICY9IDgxOTE7CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICB0aGlzLmhbaV0gKz0gYzsKICAgICAgICAgICAgYyA9IHRoaXMuaFtpXSA-Pj4gMTM7CiAgICAgICAgICAgIHRoaXMuaFtpXSAmPSA4MTkxOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5oWzBdICs9IGMgKiA1OwogICAgICAgICAgYyA9IHRoaXMuaFswXSA-Pj4gMTM7CiAgICAgICAgICB0aGlzLmhbMF0gJj0gODE5MTsKICAgICAgICAgIHRoaXMuaFsxXSArPSBjOwogICAgICAgICAgYyA9IHRoaXMuaFsxXSA-Pj4gMTM7CiAgICAgICAgICB0aGlzLmhbMV0gJj0gODE5MTsKICAgICAgICAgIHRoaXMuaFsyXSArPSBjOwogICAgICAgICAgZzJbMF0gPSB0aGlzLmhbMF0gKyA1OwogICAgICAgICAgYyA9IGcyWzBdID4-PiAxMzsKICAgICAgICAgIGcyWzBdICY9IDgxOTE7CiAgICAgICAgICBmb3IgKGkgPSAxOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBnMltpXSA9IHRoaXMuaFtpXSArIGM7CiAgICAgICAgICAgIGMgPSBnMltpXSA-Pj4gMTM7CiAgICAgICAgICAgIGcyW2ldICY9IDgxOTE7CiAgICAgICAgICB9CiAgICAgICAgICBnMls5XSAtPSAxIDw8IDEzOwogICAgICAgICAgbWFzayA9IChjIF4gMSkgLSAxOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDEwOyBpKyspCiAgICAgICAgICAgIGcyW2ldICY9IG1hc2s7CiAgICAgICAgICBtYXNrID0gfm1hc2s7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTA7IGkrKykKICAgICAgICAgICAgdGhpcy5oW2ldID0gdGhpcy5oW2ldICYgbWFzayB8IGcyW2ldOwogICAgICAgICAgdGhpcy5oWzBdID0gKHRoaXMuaFswXSB8IHRoaXMuaFsxXSA8PCAxMykgJiA2NTUzNTsKICAgICAgICAgIHRoaXMuaFsxXSA9ICh0aGlzLmhbMV0gPj4-IDMgfCB0aGlzLmhbMl0gPDwgMTApICYgNjU1MzU7CiAgICAgICAgICB0aGlzLmhbMl0gPSAodGhpcy5oWzJdID4-PiA2IHwgdGhpcy5oWzNdIDw8IDcpICYgNjU1MzU7CiAgICAgICAgICB0aGlzLmhbM10gPSAodGhpcy5oWzNdID4-PiA5IHwgdGhpcy5oWzRdIDw8IDQpICYgNjU1MzU7CiAgICAgICAgICB0aGlzLmhbNF0gPSAodGhpcy5oWzRdID4-PiAxMiB8IHRoaXMuaFs1XSA8PCAxIHwgdGhpcy5oWzZdIDw8IDE0KSAmIDY1NTM1OwogICAgICAgICAgdGhpcy5oWzVdID0gKHRoaXMuaFs2XSA-Pj4gMiB8IHRoaXMuaFs3XSA8PCAxMSkgJiA2NTUzNTsKICAgICAgICAgIHRoaXMuaFs2XSA9ICh0aGlzLmhbN10gPj4-IDUgfCB0aGlzLmhbOF0gPDwgOCkgJiA2NTUzNTsKICAgICAgICAgIHRoaXMuaFs3XSA9ICh0aGlzLmhbOF0gPj4-IDggfCB0aGlzLmhbOV0gPDwgNSkgJiA2NTUzNTsKICAgICAgICAgIGYgPSB0aGlzLmhbMF0gKyB0aGlzLnBhZFswXTsKICAgICAgICAgIHRoaXMuaFswXSA9IGYgJiA2NTUzNTsKICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCA4OyBpKyspIHsKICAgICAgICAgICAgZiA9ICh0aGlzLmhbaV0gKyB0aGlzLnBhZFtpXSB8IDApICsgKGYgPj4-IDE2KSB8IDA7CiAgICAgICAgICAgIHRoaXMuaFtpXSA9IGYgJiA2NTUzNTsKICAgICAgICAgIH0KICAgICAgICAgIG1hY1ttYWNwb3MgKyAwXSA9IHRoaXMuaFswXSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyAxXSA9IHRoaXMuaFswXSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyAyXSA9IHRoaXMuaFsxXSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyAzXSA9IHRoaXMuaFsxXSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA0XSA9IHRoaXMuaFsyXSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA1XSA9IHRoaXMuaFsyXSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA2XSA9IHRoaXMuaFszXSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA3XSA9IHRoaXMuaFszXSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA4XSA9IHRoaXMuaFs0XSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyA5XSA9IHRoaXMuaFs0XSA-Pj4gOCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyAxMF0gPSB0aGlzLmhbNV0gPj4-IDAgJiAyNTU7CiAgICAgICAgICBtYWNbbWFjcG9zICsgMTFdID0gdGhpcy5oWzVdID4-PiA4ICYgMjU1OwogICAgICAgICAgbWFjW21hY3BvcyArIDEyXSA9IHRoaXMuaFs2XSA-Pj4gMCAmIDI1NTsKICAgICAgICAgIG1hY1ttYWNwb3MgKyAxM10gPSB0aGlzLmhbNl0gPj4-IDggJiAyNTU7CiAgICAgICAgICBtYWNbbWFjcG9zICsgMTRdID0gdGhpcy5oWzddID4-PiAwICYgMjU1OwogICAgICAgICAgbWFjW21hY3BvcyArIDE1XSA9IHRoaXMuaFs3XSA-Pj4gOCAmIDI1NTsKICAgICAgICB9OwogICAgICAgIHBvbHkxMzA1LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbihtLCBtcG9zLCBieXRlcykgewogICAgICAgICAgdmFyIGksIHdhbnQ7CiAgICAgICAgICBpZiAodGhpcy5sZWZ0b3ZlcikgewogICAgICAgICAgICB3YW50ID0gMTYgLSB0aGlzLmxlZnRvdmVyOwogICAgICAgICAgICBpZiAod2FudCA-IGJ5dGVzKQogICAgICAgICAgICAgIHdhbnQgPSBieXRlczsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHdhbnQ7IGkrKykKICAgICAgICAgICAgICB0aGlzLmJ1ZmZlclt0aGlzLmxlZnRvdmVyICsgaV0gPSBtW21wb3MgKyBpXTsKICAgICAgICAgICAgYnl0ZXMgLT0gd2FudDsKICAgICAgICAgICAgbXBvcyArPSB3YW50OwogICAgICAgICAgICB0aGlzLmxlZnRvdmVyICs9IHdhbnQ7CiAgICAgICAgICAgIGlmICh0aGlzLmxlZnRvdmVyIDwgMTYpCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB0aGlzLmJsb2Nrcyh0aGlzLmJ1ZmZlciwgMCwgMTYpOwogICAgICAgICAgICB0aGlzLmxlZnRvdmVyID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChieXRlcyA-PSAxNikgewogICAgICAgICAgICB3YW50ID0gYnl0ZXMgLSBieXRlcyAlIDE2OwogICAgICAgICAgICB0aGlzLmJsb2NrcyhtLCBtcG9zLCB3YW50KTsKICAgICAgICAgICAgbXBvcyArPSB3YW50OwogICAgICAgICAgICBieXRlcyAtPSB3YW50OwogICAgICAgICAgfQogICAgICAgICAgaWYgKGJ5dGVzKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBieXRlczsgaSsrKQogICAgICAgICAgICAgIHRoaXMuYnVmZmVyW3RoaXMubGVmdG92ZXIgKyBpXSA9IG1bbXBvcyArIGldOwogICAgICAgICAgICB0aGlzLmxlZnRvdmVyICs9IGJ5dGVzOwogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX29uZXRpbWVhdXRoKG91dCwgb3V0cG9zLCBtLCBtcG9zLCBuLCBrKSB7CiAgICAgICAgICB2YXIgcyA9IG5ldyBwb2x5MTMwNShrKTsKICAgICAgICAgIHMudXBkYXRlKG0sIG1wb3MsIG4pOwogICAgICAgICAgcy5maW5pc2gob3V0LCBvdXRwb3MpOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19vbmV0aW1lYXV0aF92ZXJpZnkoaCwgaHBvcywgbSwgbXBvcywgbiwgaykgewogICAgICAgICAgdmFyIHggPSBuZXcgVWludDhBcnJheSgxNik7CiAgICAgICAgICBjcnlwdG9fb25ldGltZWF1dGgoeCwgMCwgbSwgbXBvcywgbiwgayk7CiAgICAgICAgICByZXR1cm4gY3J5cHRvX3ZlcmlmeV8xNihoLCBocG9zLCB4LCAwKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX3NlY3JldGJveChjLCBtLCBkLCBuLCBrKSB7CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIGlmIChkIDwgMzIpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGNyeXB0b19zdHJlYW1feG9yKGMsIDAsIG0sIDAsIGQsIG4sIGspOwogICAgICAgICAgY3J5cHRvX29uZXRpbWVhdXRoKGMsIDE2LCBjLCAzMiwgZCAtIDMyLCBjKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKQogICAgICAgICAgICBjW2ldID0gMDsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fc2VjcmV0Ym94X29wZW4obSwgYywgZCwgbiwgaykgewogICAgICAgICAgdmFyIGk7CiAgICAgICAgICB2YXIgeCA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgICAgICAgIGlmIChkIDwgMzIpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGNyeXB0b19zdHJlYW0oeCwgMCwgMzIsIG4sIGspOwogICAgICAgICAgaWYgKGNyeXB0b19vbmV0aW1lYXV0aF92ZXJpZnkoYywgMTYsIGMsIDMyLCBkIC0gMzIsIHgpICE9PSAwKQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICBjcnlwdG9fc3RyZWFtX3hvcihtLCAwLCBjLCAwLCBkLCBuLCBrKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAzMjsgaSsrKQogICAgICAgICAgICBtW2ldID0gMDsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzZXQyNTUxOShyLCBhKSB7CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKQogICAgICAgICAgICByW2ldID0gYVtpXSB8IDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNhcjI1NTE5KG8pIHsKICAgICAgICAgIHZhciBpLCB2LCBjID0gMTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAgICAgICAgICAgIHYgPSBvW2ldICsgYyArIDY1NTM1OwogICAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgICBvW2ldID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIH0KICAgICAgICAgIG9bMF0gKz0gYyAtIDEgKyAzNyAqIChjIC0gMSk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHNlbDI1NTE5KHAsIHEsIGIpIHsKICAgICAgICAgIHZhciB0LCBjID0gfihiIC0gMSk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIHsKICAgICAgICAgICAgdCA9IGMgJiAocFtpXSBeIHFbaV0pOwogICAgICAgICAgICBwW2ldIF49IHQ7CiAgICAgICAgICAgIHFbaV0gXj0gdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcGFjazI1NTE5KG8sIG4pIHsKICAgICAgICAgIHZhciBpLCBqLCBiOwogICAgICAgICAgdmFyIG0gPSBnZigpLCB0ID0gZ2YoKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKQogICAgICAgICAgICB0W2ldID0gbltpXTsKICAgICAgICAgIGNhcjI1NTE5KHQpOwogICAgICAgICAgY2FyMjU1MTkodCk7CiAgICAgICAgICBjYXIyNTUxOSh0KTsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCAyOyBqKyspIHsKICAgICAgICAgICAgbVswXSA9IHRbMF0gLSA2NTUxNzsKICAgICAgICAgICAgZm9yIChpID0gMTsgaSA8IDE1OyBpKyspIHsKICAgICAgICAgICAgICBtW2ldID0gdFtpXSAtIDY1NTM1IC0gKG1baSAtIDFdID4-IDE2ICYgMSk7CiAgICAgICAgICAgICAgbVtpIC0gMV0gJj0gNjU1MzU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbVsxNV0gPSB0WzE1XSAtIDMyNzY3IC0gKG1bMTRdID4-IDE2ICYgMSk7CiAgICAgICAgICAgIGIgPSBtWzE1XSA-PiAxNiAmIDE7CiAgICAgICAgICAgIG1bMTRdICY9IDY1NTM1OwogICAgICAgICAgICBzZWwyNTUxOSh0LCBtLCAxIC0gYik7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgICAgICBvWzIgKiBpXSA9IHRbaV0gJiAyNTU7CiAgICAgICAgICAgIG9bMiAqIGkgKyAxXSA9IHRbaV0gPj4gODsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gbmVxMjU1MTkoYSwgYikgewogICAgICAgICAgdmFyIGMgPSBuZXcgVWludDhBcnJheSgzMiksIGQgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgICBwYWNrMjU1MTkoYywgYSk7CiAgICAgICAgICBwYWNrMjU1MTkoZCwgYik7CiAgICAgICAgICByZXR1cm4gY3J5cHRvX3ZlcmlmeV8zMihjLCAwLCBkLCAwKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gcGFyMjU1MTkoYSkgewogICAgICAgICAgdmFyIGQgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgICBwYWNrMjU1MTkoZCwgYSk7CiAgICAgICAgICByZXR1cm4gZFswXSAmIDE7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIHVucGFjazI1NTE5KG8sIG4pIHsKICAgICAgICAgIHZhciBpOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpKyspCiAgICAgICAgICAgIG9baV0gPSBuWzIgKiBpXSArIChuWzIgKiBpICsgMV0gPDwgOCk7CiAgICAgICAgICBvWzE1XSAmPSAzMjc2NzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQShvLCBhLCBiKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspCiAgICAgICAgICAgIG9baV0gPSBhW2ldICsgYltpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gWihvLCBhLCBiKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDE2OyBpKyspCiAgICAgICAgICAgIG9baV0gPSBhW2ldIC0gYltpXTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gTShvLCBhLCBiKSB7CiAgICAgICAgICB2YXIgdiwgYywgdDAgPSAwLCB0MSA9IDAsIHQyID0gMCwgdDMgPSAwLCB0NCA9IDAsIHQ1ID0gMCwgdDYgPSAwLCB0NyA9IDAsIHQ4ID0gMCwgdDkgPSAwLCB0MTAgPSAwLCB0MTEgPSAwLCB0MTIgPSAwLCB0MTMgPSAwLCB0MTQgPSAwLCB0MTUgPSAwLCB0MTYgPSAwLCB0MTcgPSAwLCB0MTggPSAwLCB0MTkgPSAwLCB0MjAgPSAwLCB0MjEgPSAwLCB0MjIgPSAwLCB0MjMgPSAwLCB0MjQgPSAwLCB0MjUgPSAwLCB0MjYgPSAwLCB0MjcgPSAwLCB0MjggPSAwLCB0MjkgPSAwLCB0MzAgPSAwLCBiMCA9IGJbMF0sIGIxID0gYlsxXSwgYjIgPSBiWzJdLCBiMyA9IGJbM10sIGI0ID0gYls0XSwgYjUgPSBiWzVdLCBiNiA9IGJbNl0sIGI3ID0gYls3XSwgYjggPSBiWzhdLCBiOSA9IGJbOV0sIGIxMCA9IGJbMTBdLCBiMTEgPSBiWzExXSwgYjEyID0gYlsxMl0sIGIxMyA9IGJbMTNdLCBiMTQgPSBiWzE0XSwgYjE1ID0gYlsxNV07CiAgICAgICAgICB2ID0gYVswXTsKICAgICAgICAgIHQwICs9IHYgKiBiMDsKICAgICAgICAgIHQxICs9IHYgKiBiMTsKICAgICAgICAgIHQyICs9IHYgKiBiMjsKICAgICAgICAgIHQzICs9IHYgKiBiMzsKICAgICAgICAgIHQ0ICs9IHYgKiBiNDsKICAgICAgICAgIHQ1ICs9IHYgKiBiNTsKICAgICAgICAgIHQ2ICs9IHYgKiBiNjsKICAgICAgICAgIHQ3ICs9IHYgKiBiNzsKICAgICAgICAgIHQ4ICs9IHYgKiBiODsKICAgICAgICAgIHQ5ICs9IHYgKiBiOTsKICAgICAgICAgIHQxMCArPSB2ICogYjEwOwogICAgICAgICAgdDExICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTIgKz0gdiAqIGIxMjsKICAgICAgICAgIHQxMyArPSB2ICogYjEzOwogICAgICAgICAgdDE0ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MTUgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzFdOwogICAgICAgICAgdDEgKz0gdiAqIGIwOwogICAgICAgICAgdDIgKz0gdiAqIGIxOwogICAgICAgICAgdDMgKz0gdiAqIGIyOwogICAgICAgICAgdDQgKz0gdiAqIGIzOwogICAgICAgICAgdDUgKz0gdiAqIGI0OwogICAgICAgICAgdDYgKz0gdiAqIGI1OwogICAgICAgICAgdDcgKz0gdiAqIGI2OwogICAgICAgICAgdDggKz0gdiAqIGI3OwogICAgICAgICAgdDkgKz0gdiAqIGI4OwogICAgICAgICAgdDEwICs9IHYgKiBiOTsKICAgICAgICAgIHQxMSArPSB2ICogYjEwOwogICAgICAgICAgdDEyICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTMgKz0gdiAqIGIxMjsKICAgICAgICAgIHQxNCArPSB2ICogYjEzOwogICAgICAgICAgdDE1ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MTYgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzJdOwogICAgICAgICAgdDIgKz0gdiAqIGIwOwogICAgICAgICAgdDMgKz0gdiAqIGIxOwogICAgICAgICAgdDQgKz0gdiAqIGIyOwogICAgICAgICAgdDUgKz0gdiAqIGIzOwogICAgICAgICAgdDYgKz0gdiAqIGI0OwogICAgICAgICAgdDcgKz0gdiAqIGI1OwogICAgICAgICAgdDggKz0gdiAqIGI2OwogICAgICAgICAgdDkgKz0gdiAqIGI3OwogICAgICAgICAgdDEwICs9IHYgKiBiODsKICAgICAgICAgIHQxMSArPSB2ICogYjk7CiAgICAgICAgICB0MTIgKz0gdiAqIGIxMDsKICAgICAgICAgIHQxMyArPSB2ICogYjExOwogICAgICAgICAgdDE0ICs9IHYgKiBiMTI7CiAgICAgICAgICB0MTUgKz0gdiAqIGIxMzsKICAgICAgICAgIHQxNiArPSB2ICogYjE0OwogICAgICAgICAgdDE3ICs9IHYgKiBiMTU7CiAgICAgICAgICB2ID0gYVszXTsKICAgICAgICAgIHQzICs9IHYgKiBiMDsKICAgICAgICAgIHQ0ICs9IHYgKiBiMTsKICAgICAgICAgIHQ1ICs9IHYgKiBiMjsKICAgICAgICAgIHQ2ICs9IHYgKiBiMzsKICAgICAgICAgIHQ3ICs9IHYgKiBiNDsKICAgICAgICAgIHQ4ICs9IHYgKiBiNTsKICAgICAgICAgIHQ5ICs9IHYgKiBiNjsKICAgICAgICAgIHQxMCArPSB2ICogYjc7CiAgICAgICAgICB0MTEgKz0gdiAqIGI4OwogICAgICAgICAgdDEyICs9IHYgKiBiOTsKICAgICAgICAgIHQxMyArPSB2ICogYjEwOwogICAgICAgICAgdDE0ICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTUgKz0gdiAqIGIxMjsKICAgICAgICAgIHQxNiArPSB2ICogYjEzOwogICAgICAgICAgdDE3ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MTggKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzRdOwogICAgICAgICAgdDQgKz0gdiAqIGIwOwogICAgICAgICAgdDUgKz0gdiAqIGIxOwogICAgICAgICAgdDYgKz0gdiAqIGIyOwogICAgICAgICAgdDcgKz0gdiAqIGIzOwogICAgICAgICAgdDggKz0gdiAqIGI0OwogICAgICAgICAgdDkgKz0gdiAqIGI1OwogICAgICAgICAgdDEwICs9IHYgKiBiNjsKICAgICAgICAgIHQxMSArPSB2ICogYjc7CiAgICAgICAgICB0MTIgKz0gdiAqIGI4OwogICAgICAgICAgdDEzICs9IHYgKiBiOTsKICAgICAgICAgIHQxNCArPSB2ICogYjEwOwogICAgICAgICAgdDE1ICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTYgKz0gdiAqIGIxMjsKICAgICAgICAgIHQxNyArPSB2ICogYjEzOwogICAgICAgICAgdDE4ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MTkgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzVdOwogICAgICAgICAgdDUgKz0gdiAqIGIwOwogICAgICAgICAgdDYgKz0gdiAqIGIxOwogICAgICAgICAgdDcgKz0gdiAqIGIyOwogICAgICAgICAgdDggKz0gdiAqIGIzOwogICAgICAgICAgdDkgKz0gdiAqIGI0OwogICAgICAgICAgdDEwICs9IHYgKiBiNTsKICAgICAgICAgIHQxMSArPSB2ICogYjY7CiAgICAgICAgICB0MTIgKz0gdiAqIGI3OwogICAgICAgICAgdDEzICs9IHYgKiBiODsKICAgICAgICAgIHQxNCArPSB2ICogYjk7CiAgICAgICAgICB0MTUgKz0gdiAqIGIxMDsKICAgICAgICAgIHQxNiArPSB2ICogYjExOwogICAgICAgICAgdDE3ICs9IHYgKiBiMTI7CiAgICAgICAgICB0MTggKz0gdiAqIGIxMzsKICAgICAgICAgIHQxOSArPSB2ICogYjE0OwogICAgICAgICAgdDIwICs9IHYgKiBiMTU7CiAgICAgICAgICB2ID0gYVs2XTsKICAgICAgICAgIHQ2ICs9IHYgKiBiMDsKICAgICAgICAgIHQ3ICs9IHYgKiBiMTsKICAgICAgICAgIHQ4ICs9IHYgKiBiMjsKICAgICAgICAgIHQ5ICs9IHYgKiBiMzsKICAgICAgICAgIHQxMCArPSB2ICogYjQ7CiAgICAgICAgICB0MTEgKz0gdiAqIGI1OwogICAgICAgICAgdDEyICs9IHYgKiBiNjsKICAgICAgICAgIHQxMyArPSB2ICogYjc7CiAgICAgICAgICB0MTQgKz0gdiAqIGI4OwogICAgICAgICAgdDE1ICs9IHYgKiBiOTsKICAgICAgICAgIHQxNiArPSB2ICogYjEwOwogICAgICAgICAgdDE3ICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTggKz0gdiAqIGIxMjsKICAgICAgICAgIHQxOSArPSB2ICogYjEzOwogICAgICAgICAgdDIwICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MjEgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzddOwogICAgICAgICAgdDcgKz0gdiAqIGIwOwogICAgICAgICAgdDggKz0gdiAqIGIxOwogICAgICAgICAgdDkgKz0gdiAqIGIyOwogICAgICAgICAgdDEwICs9IHYgKiBiMzsKICAgICAgICAgIHQxMSArPSB2ICogYjQ7CiAgICAgICAgICB0MTIgKz0gdiAqIGI1OwogICAgICAgICAgdDEzICs9IHYgKiBiNjsKICAgICAgICAgIHQxNCArPSB2ICogYjc7CiAgICAgICAgICB0MTUgKz0gdiAqIGI4OwogICAgICAgICAgdDE2ICs9IHYgKiBiOTsKICAgICAgICAgIHQxNyArPSB2ICogYjEwOwogICAgICAgICAgdDE4ICs9IHYgKiBiMTE7CiAgICAgICAgICB0MTkgKz0gdiAqIGIxMjsKICAgICAgICAgIHQyMCArPSB2ICogYjEzOwogICAgICAgICAgdDIxICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MjIgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzhdOwogICAgICAgICAgdDggKz0gdiAqIGIwOwogICAgICAgICAgdDkgKz0gdiAqIGIxOwogICAgICAgICAgdDEwICs9IHYgKiBiMjsKICAgICAgICAgIHQxMSArPSB2ICogYjM7CiAgICAgICAgICB0MTIgKz0gdiAqIGI0OwogICAgICAgICAgdDEzICs9IHYgKiBiNTsKICAgICAgICAgIHQxNCArPSB2ICogYjY7CiAgICAgICAgICB0MTUgKz0gdiAqIGI3OwogICAgICAgICAgdDE2ICs9IHYgKiBiODsKICAgICAgICAgIHQxNyArPSB2ICogYjk7CiAgICAgICAgICB0MTggKz0gdiAqIGIxMDsKICAgICAgICAgIHQxOSArPSB2ICogYjExOwogICAgICAgICAgdDIwICs9IHYgKiBiMTI7CiAgICAgICAgICB0MjEgKz0gdiAqIGIxMzsKICAgICAgICAgIHQyMiArPSB2ICogYjE0OwogICAgICAgICAgdDIzICs9IHYgKiBiMTU7CiAgICAgICAgICB2ID0gYVs5XTsKICAgICAgICAgIHQ5ICs9IHYgKiBiMDsKICAgICAgICAgIHQxMCArPSB2ICogYjE7CiAgICAgICAgICB0MTEgKz0gdiAqIGIyOwogICAgICAgICAgdDEyICs9IHYgKiBiMzsKICAgICAgICAgIHQxMyArPSB2ICogYjQ7CiAgICAgICAgICB0MTQgKz0gdiAqIGI1OwogICAgICAgICAgdDE1ICs9IHYgKiBiNjsKICAgICAgICAgIHQxNiArPSB2ICogYjc7CiAgICAgICAgICB0MTcgKz0gdiAqIGI4OwogICAgICAgICAgdDE4ICs9IHYgKiBiOTsKICAgICAgICAgIHQxOSArPSB2ICogYjEwOwogICAgICAgICAgdDIwICs9IHYgKiBiMTE7CiAgICAgICAgICB0MjEgKz0gdiAqIGIxMjsKICAgICAgICAgIHQyMiArPSB2ICogYjEzOwogICAgICAgICAgdDIzICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MjQgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzEwXTsKICAgICAgICAgIHQxMCArPSB2ICogYjA7CiAgICAgICAgICB0MTEgKz0gdiAqIGIxOwogICAgICAgICAgdDEyICs9IHYgKiBiMjsKICAgICAgICAgIHQxMyArPSB2ICogYjM7CiAgICAgICAgICB0MTQgKz0gdiAqIGI0OwogICAgICAgICAgdDE1ICs9IHYgKiBiNTsKICAgICAgICAgIHQxNiArPSB2ICogYjY7CiAgICAgICAgICB0MTcgKz0gdiAqIGI3OwogICAgICAgICAgdDE4ICs9IHYgKiBiODsKICAgICAgICAgIHQxOSArPSB2ICogYjk7CiAgICAgICAgICB0MjAgKz0gdiAqIGIxMDsKICAgICAgICAgIHQyMSArPSB2ICogYjExOwogICAgICAgICAgdDIyICs9IHYgKiBiMTI7CiAgICAgICAgICB0MjMgKz0gdiAqIGIxMzsKICAgICAgICAgIHQyNCArPSB2ICogYjE0OwogICAgICAgICAgdDI1ICs9IHYgKiBiMTU7CiAgICAgICAgICB2ID0gYVsxMV07CiAgICAgICAgICB0MTEgKz0gdiAqIGIwOwogICAgICAgICAgdDEyICs9IHYgKiBiMTsKICAgICAgICAgIHQxMyArPSB2ICogYjI7CiAgICAgICAgICB0MTQgKz0gdiAqIGIzOwogICAgICAgICAgdDE1ICs9IHYgKiBiNDsKICAgICAgICAgIHQxNiArPSB2ICogYjU7CiAgICAgICAgICB0MTcgKz0gdiAqIGI2OwogICAgICAgICAgdDE4ICs9IHYgKiBiNzsKICAgICAgICAgIHQxOSArPSB2ICogYjg7CiAgICAgICAgICB0MjAgKz0gdiAqIGI5OwogICAgICAgICAgdDIxICs9IHYgKiBiMTA7CiAgICAgICAgICB0MjIgKz0gdiAqIGIxMTsKICAgICAgICAgIHQyMyArPSB2ICogYjEyOwogICAgICAgICAgdDI0ICs9IHYgKiBiMTM7CiAgICAgICAgICB0MjUgKz0gdiAqIGIxNDsKICAgICAgICAgIHQyNiArPSB2ICogYjE1OwogICAgICAgICAgdiA9IGFbMTJdOwogICAgICAgICAgdDEyICs9IHYgKiBiMDsKICAgICAgICAgIHQxMyArPSB2ICogYjE7CiAgICAgICAgICB0MTQgKz0gdiAqIGIyOwogICAgICAgICAgdDE1ICs9IHYgKiBiMzsKICAgICAgICAgIHQxNiArPSB2ICogYjQ7CiAgICAgICAgICB0MTcgKz0gdiAqIGI1OwogICAgICAgICAgdDE4ICs9IHYgKiBiNjsKICAgICAgICAgIHQxOSArPSB2ICogYjc7CiAgICAgICAgICB0MjAgKz0gdiAqIGI4OwogICAgICAgICAgdDIxICs9IHYgKiBiOTsKICAgICAgICAgIHQyMiArPSB2ICogYjEwOwogICAgICAgICAgdDIzICs9IHYgKiBiMTE7CiAgICAgICAgICB0MjQgKz0gdiAqIGIxMjsKICAgICAgICAgIHQyNSArPSB2ICogYjEzOwogICAgICAgICAgdDI2ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MjcgKz0gdiAqIGIxNTsKICAgICAgICAgIHYgPSBhWzEzXTsKICAgICAgICAgIHQxMyArPSB2ICogYjA7CiAgICAgICAgICB0MTQgKz0gdiAqIGIxOwogICAgICAgICAgdDE1ICs9IHYgKiBiMjsKICAgICAgICAgIHQxNiArPSB2ICogYjM7CiAgICAgICAgICB0MTcgKz0gdiAqIGI0OwogICAgICAgICAgdDE4ICs9IHYgKiBiNTsKICAgICAgICAgIHQxOSArPSB2ICogYjY7CiAgICAgICAgICB0MjAgKz0gdiAqIGI3OwogICAgICAgICAgdDIxICs9IHYgKiBiODsKICAgICAgICAgIHQyMiArPSB2ICogYjk7CiAgICAgICAgICB0MjMgKz0gdiAqIGIxMDsKICAgICAgICAgIHQyNCArPSB2ICogYjExOwogICAgICAgICAgdDI1ICs9IHYgKiBiMTI7CiAgICAgICAgICB0MjYgKz0gdiAqIGIxMzsKICAgICAgICAgIHQyNyArPSB2ICogYjE0OwogICAgICAgICAgdDI4ICs9IHYgKiBiMTU7CiAgICAgICAgICB2ID0gYVsxNF07CiAgICAgICAgICB0MTQgKz0gdiAqIGIwOwogICAgICAgICAgdDE1ICs9IHYgKiBiMTsKICAgICAgICAgIHQxNiArPSB2ICogYjI7CiAgICAgICAgICB0MTcgKz0gdiAqIGIzOwogICAgICAgICAgdDE4ICs9IHYgKiBiNDsKICAgICAgICAgIHQxOSArPSB2ICogYjU7CiAgICAgICAgICB0MjAgKz0gdiAqIGI2OwogICAgICAgICAgdDIxICs9IHYgKiBiNzsKICAgICAgICAgIHQyMiArPSB2ICogYjg7CiAgICAgICAgICB0MjMgKz0gdiAqIGI5OwogICAgICAgICAgdDI0ICs9IHYgKiBiMTA7CiAgICAgICAgICB0MjUgKz0gdiAqIGIxMTsKICAgICAgICAgIHQyNiArPSB2ICogYjEyOwogICAgICAgICAgdDI3ICs9IHYgKiBiMTM7CiAgICAgICAgICB0MjggKz0gdiAqIGIxNDsKICAgICAgICAgIHQyOSArPSB2ICogYjE1OwogICAgICAgICAgdiA9IGFbMTVdOwogICAgICAgICAgdDE1ICs9IHYgKiBiMDsKICAgICAgICAgIHQxNiArPSB2ICogYjE7CiAgICAgICAgICB0MTcgKz0gdiAqIGIyOwogICAgICAgICAgdDE4ICs9IHYgKiBiMzsKICAgICAgICAgIHQxOSArPSB2ICogYjQ7CiAgICAgICAgICB0MjAgKz0gdiAqIGI1OwogICAgICAgICAgdDIxICs9IHYgKiBiNjsKICAgICAgICAgIHQyMiArPSB2ICogYjc7CiAgICAgICAgICB0MjMgKz0gdiAqIGI4OwogICAgICAgICAgdDI0ICs9IHYgKiBiOTsKICAgICAgICAgIHQyNSArPSB2ICogYjEwOwogICAgICAgICAgdDI2ICs9IHYgKiBiMTE7CiAgICAgICAgICB0MjcgKz0gdiAqIGIxMjsKICAgICAgICAgIHQyOCArPSB2ICogYjEzOwogICAgICAgICAgdDI5ICs9IHYgKiBiMTQ7CiAgICAgICAgICB0MzAgKz0gdiAqIGIxNTsKICAgICAgICAgIHQwICs9IDM4ICogdDE2OwogICAgICAgICAgdDEgKz0gMzggKiB0MTc7CiAgICAgICAgICB0MiArPSAzOCAqIHQxODsKICAgICAgICAgIHQzICs9IDM4ICogdDE5OwogICAgICAgICAgdDQgKz0gMzggKiB0MjA7CiAgICAgICAgICB0NSArPSAzOCAqIHQyMTsKICAgICAgICAgIHQ2ICs9IDM4ICogdDIyOwogICAgICAgICAgdDcgKz0gMzggKiB0MjM7CiAgICAgICAgICB0OCArPSAzOCAqIHQyNDsKICAgICAgICAgIHQ5ICs9IDM4ICogdDI1OwogICAgICAgICAgdDEwICs9IDM4ICogdDI2OwogICAgICAgICAgdDExICs9IDM4ICogdDI3OwogICAgICAgICAgdDEyICs9IDM4ICogdDI4OwogICAgICAgICAgdDEzICs9IDM4ICogdDI5OwogICAgICAgICAgdDE0ICs9IDM4ICogdDMwOwogICAgICAgICAgYyA9IDE7CiAgICAgICAgICB2ID0gdDAgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDAgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0MiArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MiA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDMgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDMgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQ0ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQ0ID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0NSArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0NSA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDYgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDYgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQ3ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQ3ID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0OCArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0OCA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDkgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDkgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxMCArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTAgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxMSArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTEgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxMiArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTIgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxMyArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTMgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxNCArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTQgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQxNSArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MTUgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdDAgKz0gYyAtIDEgKyAzNyAqIChjIC0gMSk7CiAgICAgICAgICBjID0gMTsKICAgICAgICAgIHYgPSB0MCArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MCA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDEgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDEgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQyICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQyID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0MyArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0MyA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDQgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDQgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQ1ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQ1ID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0NiArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0NiA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDcgKyBjICsgNjU1MzU7CiAgICAgICAgICBjID0gTWF0aC5mbG9vcih2IC8gNjU1MzYpOwogICAgICAgICAgdDcgPSB2IC0gYyAqIDY1NTM2OwogICAgICAgICAgdiA9IHQ4ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQ4ID0gdiAtIGMgKiA2NTUzNjsKICAgICAgICAgIHYgPSB0OSArIGMgKyA2NTUzNTsKICAgICAgICAgIGMgPSBNYXRoLmZsb29yKHYgLyA2NTUzNik7CiAgICAgICAgICB0OSA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDEwICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxMCA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDExICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxMSA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDEyICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxMiA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDEzICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxMyA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDE0ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxNCA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB2ID0gdDE1ICsgYyArIDY1NTM1OwogICAgICAgICAgYyA9IE1hdGguZmxvb3IodiAvIDY1NTM2KTsKICAgICAgICAgIHQxNSA9IHYgLSBjICogNjU1MzY7CiAgICAgICAgICB0MCArPSBjIC0gMSArIDM3ICogKGMgLSAxKTsKICAgICAgICAgIG9bMF0gPSB0MDsKICAgICAgICAgIG9bMV0gPSB0MTsKICAgICAgICAgIG9bMl0gPSB0MjsKICAgICAgICAgIG9bM10gPSB0MzsKICAgICAgICAgIG9bNF0gPSB0NDsKICAgICAgICAgIG9bNV0gPSB0NTsKICAgICAgICAgIG9bNl0gPSB0NjsKICAgICAgICAgIG9bN10gPSB0NzsKICAgICAgICAgIG9bOF0gPSB0ODsKICAgICAgICAgIG9bOV0gPSB0OTsKICAgICAgICAgIG9bMTBdID0gdDEwOwogICAgICAgICAgb1sxMV0gPSB0MTE7CiAgICAgICAgICBvWzEyXSA9IHQxMjsKICAgICAgICAgIG9bMTNdID0gdDEzOwogICAgICAgICAgb1sxNF0gPSB0MTQ7CiAgICAgICAgICBvWzE1XSA9IHQxNTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gUyhvLCBhKSB7CiAgICAgICAgICBNKG8sIGEsIGEpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBpbnYyNTUxOShvLCBpKSB7CiAgICAgICAgICB2YXIgYyA9IGdmKCk7CiAgICAgICAgICB2YXIgYTsKICAgICAgICAgIGZvciAoYSA9IDA7IGEgPCAxNjsgYSsrKQogICAgICAgICAgICBjW2FdID0gaVthXTsKICAgICAgICAgIGZvciAoYSA9IDI1MzsgYSA-PSAwOyBhLS0pIHsKICAgICAgICAgICAgUyhjLCBjKTsKICAgICAgICAgICAgaWYgKGEgIT09IDIgJiYgYSAhPT0gNCkKICAgICAgICAgICAgICBNKGMsIGMsIGkpOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChhID0gMDsgYSA8IDE2OyBhKyspCiAgICAgICAgICAgIG9bYV0gPSBjW2FdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwb3cyNTIzKG8sIGkpIHsKICAgICAgICAgIHZhciBjID0gZ2YoKTsKICAgICAgICAgIHZhciBhOwogICAgICAgICAgZm9yIChhID0gMDsgYSA8IDE2OyBhKyspCiAgICAgICAgICAgIGNbYV0gPSBpW2FdOwogICAgICAgICAgZm9yIChhID0gMjUwOyBhID49IDA7IGEtLSkgewogICAgICAgICAgICBTKGMsIGMpOwogICAgICAgICAgICBpZiAoYSAhPT0gMSkKICAgICAgICAgICAgICBNKGMsIGMsIGkpOwogICAgICAgICAgfQogICAgICAgICAgZm9yIChhID0gMDsgYSA8IDE2OyBhKyspCiAgICAgICAgICAgIG9bYV0gPSBjW2FdOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fc2NhbGFybXVsdChxLCBuLCBwKSB7CiAgICAgICAgICB2YXIgeiA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgICAgICAgIHZhciB4ID0gbmV3IEZsb2F0NjRBcnJheSg4MCksIHIsIGk7CiAgICAgICAgICB2YXIgYSA9IGdmKCksIGIgPSBnZigpLCBjID0gZ2YoKSwgZCA9IGdmKCksIGUgPSBnZigpLCBmID0gZ2YoKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAzMTsgaSsrKQogICAgICAgICAgICB6W2ldID0gbltpXTsKICAgICAgICAgIHpbMzFdID0gblszMV0gJiAxMjcgfCA2NDsKICAgICAgICAgIHpbMF0gJj0gMjQ4OwogICAgICAgICAgdW5wYWNrMjU1MTkoeCwgcCk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTY7IGkrKykgewogICAgICAgICAgICBiW2ldID0geFtpXTsKICAgICAgICAgICAgZFtpXSA9IGFbaV0gPSBjW2ldID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGFbMF0gPSBkWzBdID0gMTsKICAgICAgICAgIGZvciAoaSA9IDI1NDsgaSA-PSAwOyAtLWkpIHsKICAgICAgICAgICAgciA9IHpbaSA-Pj4gM10gPj4-IChpICYgNykgJiAxOwogICAgICAgICAgICBzZWwyNTUxOShhLCBiLCByKTsKICAgICAgICAgICAgc2VsMjU1MTkoYywgZCwgcik7CiAgICAgICAgICAgIEEoZSwgYSwgYyk7CiAgICAgICAgICAgIFooYSwgYSwgYyk7CiAgICAgICAgICAgIEEoYywgYiwgZCk7CiAgICAgICAgICAgIFooYiwgYiwgZCk7CiAgICAgICAgICAgIFMoZCwgZSk7CiAgICAgICAgICAgIFMoZiwgYSk7CiAgICAgICAgICAgIE0oYSwgYywgYSk7CiAgICAgICAgICAgIE0oYywgYiwgZSk7CiAgICAgICAgICAgIEEoZSwgYSwgYyk7CiAgICAgICAgICAgIFooYSwgYSwgYyk7CiAgICAgICAgICAgIFMoYiwgYSk7CiAgICAgICAgICAgIFooYywgZCwgZik7CiAgICAgICAgICAgIE0oYSwgYywgXzEyMTY2NSk7CiAgICAgICAgICAgIEEoYSwgYSwgZCk7CiAgICAgICAgICAgIE0oYywgYywgYSk7CiAgICAgICAgICAgIE0oYSwgZCwgZik7CiAgICAgICAgICAgIE0oZCwgYiwgeCk7CiAgICAgICAgICAgIFMoYiwgZSk7CiAgICAgICAgICAgIHNlbDI1NTE5KGEsIGIsIHIpOwogICAgICAgICAgICBzZWwyNTUxOShjLCBkLCByKTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAxNjsgaSsrKSB7CiAgICAgICAgICAgIHhbaSArIDE2XSA9IGFbaV07CiAgICAgICAgICAgIHhbaSArIDMyXSA9IGNbaV07CiAgICAgICAgICAgIHhbaSArIDQ4XSA9IGJbaV07CiAgICAgICAgICAgIHhbaSArIDY0XSA9IGRbaV07CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgeDMyID0geC5zdWJhcnJheSgzMik7CiAgICAgICAgICB2YXIgeDE2ID0geC5zdWJhcnJheSgxNik7CiAgICAgICAgICBpbnYyNTUxOSh4MzIsIHgzMik7CiAgICAgICAgICBNKHgxNiwgeDE2LCB4MzIpOwogICAgICAgICAgcGFjazI1NTE5KHEsIHgxNik7CiAgICAgICAgICByZXR1cm4gMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX3NjYWxhcm11bHRfYmFzZShxLCBuKSB7CiAgICAgICAgICByZXR1cm4gY3J5cHRvX3NjYWxhcm11bHQocSwgbiwgXzkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fYm94X2tleXBhaXIoeSwgeCkgewogICAgICAgICAgcmFuZG9tYnl0ZXMoeCwgMzIpOwogICAgICAgICAgcmV0dXJuIGNyeXB0b19zY2FsYXJtdWx0X2Jhc2UoeSwgeCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19ib3hfYmVmb3Jlbm0oaywgeSwgeCkgewogICAgICAgICAgdmFyIHMgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgICBjcnlwdG9fc2NhbGFybXVsdChzLCB4LCB5KTsKICAgICAgICAgIHJldHVybiBjcnlwdG9fY29yZV9oc2Fsc2EyMChrLCBfMCwgcywgc2lnbWEpOwogICAgICAgIH0KICAgICAgICB2YXIgY3J5cHRvX2JveF9hZnRlcm5tID0gY3J5cHRvX3NlY3JldGJveDsKICAgICAgICB2YXIgY3J5cHRvX2JveF9vcGVuX2FmdGVybm0gPSBjcnlwdG9fc2VjcmV0Ym94X29wZW47CiAgICAgICAgZnVuY3Rpb24gY3J5cHRvX2JveChjLCBtLCBkLCBuLCB5LCB4KSB7CiAgICAgICAgICB2YXIgayA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgICAgICAgIGNyeXB0b19ib3hfYmVmb3Jlbm0oaywgeSwgeCk7CiAgICAgICAgICByZXR1cm4gY3J5cHRvX2JveF9hZnRlcm5tKGMsIG0sIGQsIG4sIGspOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fYm94X29wZW4obSwgYywgZCwgbiwgeSwgeCkgewogICAgICAgICAgdmFyIGsgPSBuZXcgVWludDhBcnJheSgzMik7CiAgICAgICAgICBjcnlwdG9fYm94X2JlZm9yZW5tKGssIHksIHgpOwogICAgICAgICAgcmV0dXJuIGNyeXB0b19ib3hfb3Blbl9hZnRlcm5tKG0sIGMsIGQsIG4sIGspOwogICAgICAgIH0KICAgICAgICB2YXIgSyA9IFsKICAgICAgICAgIDExMTYzNTI0MDgsCiAgICAgICAgICAzNjA5NzY3NDU4LAogICAgICAgICAgMTg5OTQ0NzQ0MSwKICAgICAgICAgIDYwMjg5MTcyNSwKICAgICAgICAgIDMwNDkzMjM0NzEsCiAgICAgICAgICAzOTY0NDg0Mzk5LAogICAgICAgICAgMzkyMTAwOTU3MywKICAgICAgICAgIDIxNzMyOTU1NDgsCiAgICAgICAgICA5NjE5ODcxNjMsCiAgICAgICAgICA0MDgxNjI4NDcyLAogICAgICAgICAgMTUwODk3MDk5MywKICAgICAgICAgIDMwNTM4MzQyNjUsCiAgICAgICAgICAyNDUzNjM1NzQ4LAogICAgICAgICAgMjkzNzY3MTU3OSwKICAgICAgICAgIDI4NzA3NjMyMjEsCiAgICAgICAgICAzNjY0NjA5NTYwLAogICAgICAgICAgMzYyNDM4MTA4MCwKICAgICAgICAgIDI3MzQ4ODMzOTQsCiAgICAgICAgICAzMTA1OTg0MDEsCiAgICAgICAgICAxMTY0OTk2NTQyLAogICAgICAgICAgNjA3MjI1Mjc4LAogICAgICAgICAgMTMyMzYxMDc2NCwKICAgICAgICAgIDE0MjY4ODE5ODcsCiAgICAgICAgICAzNTkwMzA0OTk0LAogICAgICAgICAgMTkyNTA3ODM4OCwKICAgICAgICAgIDQwNjgxODIzODMsCiAgICAgICAgICAyMTYyMDc4MjA2LAogICAgICAgICAgOTkxMzM2MTEzLAogICAgICAgICAgMjYxNDg4ODEwMywKICAgICAgICAgIDYzMzgwMzMxNywKICAgICAgICAgIDMyNDgyMjI1ODAsCiAgICAgICAgICAzNDc5Nzc0ODY4LAogICAgICAgICAgMzgzNTM5MDQwMSwKICAgICAgICAgIDI2NjY2MTM0NTgsCiAgICAgICAgICA0MDIyMjI0Nzc0LAogICAgICAgICAgOTQ0NzExMTM5LAogICAgICAgICAgMjY0MzQ3MDc4LAogICAgICAgICAgMjM0MTI2Mjc3MywKICAgICAgICAgIDYwNDgwNzYyOCwKICAgICAgICAgIDIwMDc4MDA5MzMsCiAgICAgICAgICA3NzAyNTU5ODMsCiAgICAgICAgICAxNDk1OTkwOTAxLAogICAgICAgICAgMTI0OTE1MDEyMiwKICAgICAgICAgIDE4NTY0MzEyMzUsCiAgICAgICAgICAxNTU1MDgxNjkyLAogICAgICAgICAgMzE3NTIxODEzMiwKICAgICAgICAgIDE5OTYwNjQ5ODYsCiAgICAgICAgICAyMTk4OTUwODM3LAogICAgICAgICAgMjU1NDIyMDg4MiwKICAgICAgICAgIDM5OTk3MTkzMzksCiAgICAgICAgICAyODIxODM0MzQ5LAogICAgICAgICAgNzY2Nzg0MDE2LAogICAgICAgICAgMjk1Mjk5NjgwOCwKICAgICAgICAgIDI1NjY1OTQ4NzksCiAgICAgICAgICAzMjEwMzEzNjcxLAogICAgICAgICAgMzIwMzMzNzk1NiwKICAgICAgICAgIDMzMzY1NzE4OTEsCiAgICAgICAgICAxMDM0NDU3MDI2LAogICAgICAgICAgMzU4NDUyODcxMSwKICAgICAgICAgIDI0NjY5NDg5MDEsCiAgICAgICAgICAxMTM5MjY5OTMsCiAgICAgICAgICAzNzU4MzI2MzgzLAogICAgICAgICAgMzM4MjQxODk1LAogICAgICAgICAgMTY4NzE3OTM2LAogICAgICAgICAgNjY2MzA3MjA1LAogICAgICAgICAgMTE4ODE3OTk2NCwKICAgICAgICAgIDc3MzUyOTkxMiwKICAgICAgICAgIDE1NDYwNDU3MzQsCiAgICAgICAgICAxMjk0NzU3MzcyLAogICAgICAgICAgMTUyMjgwNTQ4NSwKICAgICAgICAgIDEzOTYxODIyOTEsCiAgICAgICAgICAyNjQzODMzODIzLAogICAgICAgICAgMTY5NTE4MzcwMCwKICAgICAgICAgIDIzNDM1MjczOTAsCiAgICAgICAgICAxOTg2NjYxMDUxLAogICAgICAgICAgMTAxNDQ3NzQ4MCwKICAgICAgICAgIDIxNzcwMjYzNTAsCiAgICAgICAgICAxMjA2NzU5MTQyLAogICAgICAgICAgMjQ1Njk1NjAzNywKICAgICAgICAgIDM0NDA3NzYyNywKICAgICAgICAgIDI3MzA0ODU5MjEsCiAgICAgICAgICAxMjkwODYzNDYwLAogICAgICAgICAgMjgyMDMwMjQxMSwKICAgICAgICAgIDMxNTg0NTQyNzMsCiAgICAgICAgICAzMjU5NzMwODAwLAogICAgICAgICAgMzUwNTk1MjY1NywKICAgICAgICAgIDMzNDU3NjQ3NzEsCiAgICAgICAgICAxMDYyMTcwMDgsCiAgICAgICAgICAzNTE2MDY1ODE3LAogICAgICAgICAgMzYwNjAwODM0NCwKICAgICAgICAgIDM2MDAzNTI4MDQsCiAgICAgICAgICAxNDMyNzI1Nzc2LAogICAgICAgICAgNDA5NDU3MTkwOSwKICAgICAgICAgIDE0NjcwMzE1OTQsCiAgICAgICAgICAyNzU0MjMzNDQsCiAgICAgICAgICA4NTExNjk3MjAsCiAgICAgICAgICA0MzAyMjc3MzQsCiAgICAgICAgICAzMTAwODIzNzUyLAogICAgICAgICAgNTA2OTQ4NjE2LAogICAgICAgICAgMTM2MzI1ODE5NSwKICAgICAgICAgIDY1OTA2MDU1NiwKICAgICAgICAgIDM3NTA2ODU1OTMsCiAgICAgICAgICA4ODM5OTc4NzcsCiAgICAgICAgICAzNzg1MDUwMjgwLAogICAgICAgICAgOTU4MTM5NTcxLAogICAgICAgICAgMzMxODMwNzQyNywKICAgICAgICAgIDEzMjI4MjIyMTgsCiAgICAgICAgICAzODEyNzIzNDAzLAogICAgICAgICAgMTUzNzAwMjA2MywKICAgICAgICAgIDIwMDMwMzQ5OTUsCiAgICAgICAgICAxNzQ3ODczNzc5LAogICAgICAgICAgMzYwMjAzNjg5OSwKICAgICAgICAgIDE5NTU1NjIyMjIsCiAgICAgICAgICAxNTc1OTkwMDEyLAogICAgICAgICAgMjAyNDEwNDgxNSwKICAgICAgICAgIDExMjU1OTI5MjgsCiAgICAgICAgICAyMjI3NzMwNDUyLAogICAgICAgICAgMjcxNjkwNDMwNiwKICAgICAgICAgIDIzNjE4NTI0MjQsCiAgICAgICAgICA0NDI3NzYwNDQsCiAgICAgICAgICAyNDI4NDM2NDc0LAogICAgICAgICAgNTkzNjk4MzQ0LAogICAgICAgICAgMjc1NjczNDE4NywKICAgICAgICAgIDM3MzMxMTAyNDksCiAgICAgICAgICAzMjA0MDMxNDc5LAogICAgICAgICAgMjk5OTM1MTU3MywKICAgICAgICAgIDMzMjkzMjUyOTgsCiAgICAgICAgICAzODE1OTIwNDI3LAogICAgICAgICAgMzM5MTU2OTYxNCwKICAgICAgICAgIDM5MjgzODM5MDAsCiAgICAgICAgICAzNTE1MjY3MjcxLAogICAgICAgICAgNTY2MjgwNzExLAogICAgICAgICAgMzk0MDE4NzYwNiwKICAgICAgICAgIDM0NTQwNjk1MzQsCiAgICAgICAgICA0MTE4NjMwMjcxLAogICAgICAgICAgNDAwMDIzOTk5MiwKICAgICAgICAgIDExNjQxODQ3NCwKICAgICAgICAgIDE5MTQxMzg1NTQsCiAgICAgICAgICAxNzQyOTI0MjEsCiAgICAgICAgICAyNzMxMDU1MjcwLAogICAgICAgICAgMjg5MzgwMzU2LAogICAgICAgICAgMzIwMzk5MzAwNiwKICAgICAgICAgIDQ2MDM5MzI2OSwKICAgICAgICAgIDMyMDYyMDMxNSwKICAgICAgICAgIDY4NTQ3MTczMywKICAgICAgICAgIDU4NzQ5NjgzNiwKICAgICAgICAgIDg1MjE0Mjk3MSwKICAgICAgICAgIDEwODY3OTI4NTEsCiAgICAgICAgICAxMDE3MDM2Mjk4LAogICAgICAgICAgMzY1NTQzMTAwLAogICAgICAgICAgMTEyNjAwMDU4MCwKICAgICAgICAgIDI2MTgyOTc2NzYsCiAgICAgICAgICAxMjg4MDMzNDcwLAogICAgICAgICAgMzQwOTg1NTE1OCwKICAgICAgICAgIDE1MDE1MDU5NDgsCiAgICAgICAgICA0MjM0NTA5ODY2LAogICAgICAgICAgMTYwNzE2NzkxNSwKICAgICAgICAgIDk4NzE2NzQ2OCwKICAgICAgICAgIDE4MTY0MDIzMTYsCiAgICAgICAgICAxMjQ2MTg5NTkxCiAgICAgICAgXTsKICAgICAgICBmdW5jdGlvbiBjcnlwdG9faGFzaGJsb2Nrc19obChoaCwgaGwsIG0sIG4pIHsKICAgICAgICAgIHZhciB3aCA9IG5ldyBJbnQzMkFycmF5KDE2KSwgd2wgPSBuZXcgSW50MzJBcnJheSgxNiksIGJoMCwgYmgxLCBiaDIsIGJoMywgYmg0LCBiaDUsIGJoNiwgYmg3LCBibDAsIGJsMSwgYmwyLCBibDMsIGJsNCwgYmw1LCBibDYsIGJsNywgdGgsIHRsLCBpLCBqLCBoLCBsLCBhLCBiLCBjLCBkOwogICAgICAgICAgdmFyIGFoMCA9IGhoWzBdLCBhaDEgPSBoaFsxXSwgYWgyID0gaGhbMl0sIGFoMyA9IGhoWzNdLCBhaDQgPSBoaFs0XSwgYWg1ID0gaGhbNV0sIGFoNiA9IGhoWzZdLCBhaDcgPSBoaFs3XSwgYWwwID0gaGxbMF0sIGFsMSA9IGhsWzFdLCBhbDIgPSBobFsyXSwgYWwzID0gaGxbM10sIGFsNCA9IGhsWzRdLCBhbDUgPSBobFs1XSwgYWw2ID0gaGxbNl0sIGFsNyA9IGhsWzddOwogICAgICAgICAgdmFyIHBvcyA9IDA7CiAgICAgICAgICB3aGlsZSAobiA-PSAxMjgpIHsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDE2OyBpKyspIHsKICAgICAgICAgICAgICBqID0gOCAqIGkgKyBwb3M7CiAgICAgICAgICAgICAgd2hbaV0gPSBtW2ogKyAwXSA8PCAyNCB8IG1baiArIDFdIDw8IDE2IHwgbVtqICsgMl0gPDwgOCB8IG1baiArIDNdOwogICAgICAgICAgICAgIHdsW2ldID0gbVtqICsgNF0gPDwgMjQgfCBtW2ogKyA1XSA8PCAxNiB8IG1baiArIDZdIDw8IDggfCBtW2ogKyA3XTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgODA7IGkrKykgewogICAgICAgICAgICAgIGJoMCA9IGFoMDsKICAgICAgICAgICAgICBiaDEgPSBhaDE7CiAgICAgICAgICAgICAgYmgyID0gYWgyOwogICAgICAgICAgICAgIGJoMyA9IGFoMzsKICAgICAgICAgICAgICBiaDQgPSBhaDQ7CiAgICAgICAgICAgICAgYmg1ID0gYWg1OwogICAgICAgICAgICAgIGJoNiA9IGFoNjsKICAgICAgICAgICAgICBiaDcgPSBhaDc7CiAgICAgICAgICAgICAgYmwwID0gYWwwOwogICAgICAgICAgICAgIGJsMSA9IGFsMTsKICAgICAgICAgICAgICBibDIgPSBhbDI7CiAgICAgICAgICAgICAgYmwzID0gYWwzOwogICAgICAgICAgICAgIGJsNCA9IGFsNDsKICAgICAgICAgICAgICBibDUgPSBhbDU7CiAgICAgICAgICAgICAgYmw2ID0gYWw2OwogICAgICAgICAgICAgIGJsNyA9IGFsNzsKICAgICAgICAgICAgICBoID0gYWg3OwogICAgICAgICAgICAgIGwgPSBhbDc7CiAgICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICBiID0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgaCA9IChhaDQgPj4-IDE0IHwgYWw0IDw8IDMyIC0gMTQpIF4gKGFoNCA-Pj4gMTggfCBhbDQgPDwgMzIgLSAxOCkgXiAoYWw0ID4-PiA0MSAtIDMyIHwgYWg0IDw8IDMyIC0gKDQxIC0gMzIpKTsKICAgICAgICAgICAgICBsID0gKGFsNCA-Pj4gMTQgfCBhaDQgPDwgMzIgLSAxNCkgXiAoYWw0ID4-PiAxOCB8IGFoNCA8PCAzMiAtIDE4KSBeIChhaDQgPj4-IDQxIC0gMzIgfCBhbDQgPDwgMzIgLSAoNDEgLSAzMikpOwogICAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgICBoID0gYWg0ICYgYWg1IF4gfmFoNCAmIGFoNjsKICAgICAgICAgICAgICBsID0gYWw0ICYgYWw1IF4gfmFsNCAmIGFsNjsKICAgICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICAgIGMgKz0gaCAmIDY1NTM1OwogICAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgaCA9IEtbaSAqIDJdOwogICAgICAgICAgICAgIGwgPSBLW2kgKiAyICsgMV07CiAgICAgICAgICAgICAgYSArPSBsICYgNjU1MzU7CiAgICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgICBkICs9IGggPj4-IDE2OwogICAgICAgICAgICAgIGggPSB3aFtpICUgMTZdOwogICAgICAgICAgICAgIGwgPSB3bFtpICUgMTZdOwogICAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgICBiICs9IGEgPj4-IDE2OwogICAgICAgICAgICAgIGMgKz0gYiA-Pj4gMTY7CiAgICAgICAgICAgICAgZCArPSBjID4-PiAxNjsKICAgICAgICAgICAgICB0aCA9IGMgJiA2NTUzNSB8IGQgPDwgMTY7CiAgICAgICAgICAgICAgdGwgPSBhICYgNjU1MzUgfCBiIDw8IDE2OwogICAgICAgICAgICAgIGggPSB0aDsKICAgICAgICAgICAgICBsID0gdGw7CiAgICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICBiID0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgaCA9IChhaDAgPj4-IDI4IHwgYWwwIDw8IDMyIC0gMjgpIF4gKGFsMCA-Pj4gMzQgLSAzMiB8IGFoMCA8PCAzMiAtICgzNCAtIDMyKSkgXiAoYWwwID4-PiAzOSAtIDMyIHwgYWgwIDw8IDMyIC0gKDM5IC0gMzIpKTsKICAgICAgICAgICAgICBsID0gKGFsMCA-Pj4gMjggfCBhaDAgPDwgMzIgLSAyOCkgXiAoYWgwID4-PiAzNCAtIDMyIHwgYWwwIDw8IDMyIC0gKDM0IC0gMzIpKSBeIChhaDAgPj4-IDM5IC0gMzIgfCBhbDAgPDwgMzIgLSAoMzkgLSAzMikpOwogICAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgICBoID0gYWgwICYgYWgxIF4gYWgwICYgYWgyIF4gYWgxICYgYWgyOwogICAgICAgICAgICAgIGwgPSBhbDAgJiBhbDEgXiBhbDAgJiBhbDIgXiBhbDEgJiBhbDI7CiAgICAgICAgICAgICAgYSArPSBsICYgNjU1MzU7CiAgICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgICBkICs9IGggPj4-IDE2OwogICAgICAgICAgICAgIGIgKz0gYSA-Pj4gMTY7CiAgICAgICAgICAgICAgYyArPSBiID4-PiAxNjsKICAgICAgICAgICAgICBkICs9IGMgPj4-IDE2OwogICAgICAgICAgICAgIGJoNyA9IGMgJiA2NTUzNSB8IGQgPDwgMTY7CiAgICAgICAgICAgICAgYmw3ID0gYSAmIDY1NTM1IHwgYiA8PCAxNjsKICAgICAgICAgICAgICBoID0gYmgzOwogICAgICAgICAgICAgIGwgPSBibDM7CiAgICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICBiID0gbCA-Pj4gMTY7CiAgICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgaCA9IHRoOwogICAgICAgICAgICAgIGwgPSB0bDsKICAgICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICAgIGMgKz0gaCAmIDY1NTM1OwogICAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgYiArPSBhID4-PiAxNjsKICAgICAgICAgICAgICBjICs9IGIgPj4-IDE2OwogICAgICAgICAgICAgIGQgKz0gYyA-Pj4gMTY7CiAgICAgICAgICAgICAgYmgzID0gYyAmIDY1NTM1IHwgZCA8PCAxNjsKICAgICAgICAgICAgICBibDMgPSBhICYgNjU1MzUgfCBiIDw8IDE2OwogICAgICAgICAgICAgIGFoMSA9IGJoMDsKICAgICAgICAgICAgICBhaDIgPSBiaDE7CiAgICAgICAgICAgICAgYWgzID0gYmgyOwogICAgICAgICAgICAgIGFoNCA9IGJoMzsKICAgICAgICAgICAgICBhaDUgPSBiaDQ7CiAgICAgICAgICAgICAgYWg2ID0gYmg1OwogICAgICAgICAgICAgIGFoNyA9IGJoNjsKICAgICAgICAgICAgICBhaDAgPSBiaDc7CiAgICAgICAgICAgICAgYWwxID0gYmwwOwogICAgICAgICAgICAgIGFsMiA9IGJsMTsKICAgICAgICAgICAgICBhbDMgPSBibDI7CiAgICAgICAgICAgICAgYWw0ID0gYmwzOwogICAgICAgICAgICAgIGFsNSA9IGJsNDsKICAgICAgICAgICAgICBhbDYgPSBibDU7CiAgICAgICAgICAgICAgYWw3ID0gYmw2OwogICAgICAgICAgICAgIGFsMCA9IGJsNzsKICAgICAgICAgICAgICBpZiAoaSAlIDE2ID09PSAxNSkgewogICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IDE2OyBqKyspIHsKICAgICAgICAgICAgICAgICAgaCA9IHdoW2pdOwogICAgICAgICAgICAgICAgICBsID0gd2xbal07CiAgICAgICAgICAgICAgICAgIGEgPSBsICYgNjU1MzU7CiAgICAgICAgICAgICAgICAgIGIgPSBsID4-PiAxNjsKICAgICAgICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgZCA9IGggPj4-IDE2OwogICAgICAgICAgICAgICAgICBoID0gd2hbKGogKyA5KSAlIDE2XTsKICAgICAgICAgICAgICAgICAgbCA9IHdsWyhqICsgOSkgJSAxNl07CiAgICAgICAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgICAgICAgdGggPSB3aFsoaiArIDEpICUgMTZdOwogICAgICAgICAgICAgICAgICB0bCA9IHdsWyhqICsgMSkgJSAxNl07CiAgICAgICAgICAgICAgICAgIGggPSAodGggPj4-IDEgfCB0bCA8PCAzMiAtIDEpIF4gKHRoID4-PiA4IHwgdGwgPDwgMzIgLSA4KSBeIHRoID4-PiA3OwogICAgICAgICAgICAgICAgICBsID0gKHRsID4-PiAxIHwgdGggPDwgMzIgLSAxKSBeICh0bCA-Pj4gOCB8IHRoIDw8IDMyIC0gOCkgXiAodGwgPj4-IDcgfCB0aCA8PCAzMiAtIDcpOwogICAgICAgICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgICAgICAgIHRoID0gd2hbKGogKyAxNCkgJSAxNl07CiAgICAgICAgICAgICAgICAgIHRsID0gd2xbKGogKyAxNCkgJSAxNl07CiAgICAgICAgICAgICAgICAgIGggPSAodGggPj4-IDE5IHwgdGwgPDwgMzIgLSAxOSkgXiAodGwgPj4-IDYxIC0gMzIgfCB0aCA8PCAzMiAtICg2MSAtIDMyKSkgXiB0aCA-Pj4gNjsKICAgICAgICAgICAgICAgICAgbCA9ICh0bCA-Pj4gMTkgfCB0aCA8PCAzMiAtIDE5KSBeICh0aCA-Pj4gNjEgLSAzMiB8IHRsIDw8IDMyIC0gKDYxIC0gMzIpKSBeICh0bCA-Pj4gNiB8IHRoIDw8IDMyIC0gNik7CiAgICAgICAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgICAgICAgYiArPSBhID4-PiAxNjsKICAgICAgICAgICAgICAgICAgYyArPSBiID4-PiAxNjsKICAgICAgICAgICAgICAgICAgZCArPSBjID4-PiAxNjsKICAgICAgICAgICAgICAgICAgd2hbal0gPSBjICYgNjU1MzUgfCBkIDw8IDE2OwogICAgICAgICAgICAgICAgICB3bFtqXSA9IGEgJiA2NTUzNSB8IGIgPDwgMTY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGggPSBhaDA7CiAgICAgICAgICAgIGwgPSBhbDA7CiAgICAgICAgICAgIGEgPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgPSBsID4-PiAxNjsKICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgZCA9IGggPj4-IDE2OwogICAgICAgICAgICBoID0gaGhbMF07CiAgICAgICAgICAgIGwgPSBobFswXTsKICAgICAgICAgICAgYSArPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gaCAmIDY1NTM1OwogICAgICAgICAgICBkICs9IGggPj4-IDE2OwogICAgICAgICAgICBiICs9IGEgPj4-IDE2OwogICAgICAgICAgICBjICs9IGIgPj4-IDE2OwogICAgICAgICAgICBkICs9IGMgPj4-IDE2OwogICAgICAgICAgICBoaFswXSA9IGFoMCA9IGMgJiA2NTUzNSB8IGQgPDwgMTY7CiAgICAgICAgICAgIGhsWzBdID0gYWwwID0gYSAmIDY1NTM1IHwgYiA8PCAxNjsKICAgICAgICAgICAgaCA9IGFoMTsKICAgICAgICAgICAgbCA9IGFsMTsKICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiA9IGwgPj4-IDE2OwogICAgICAgICAgICBjID0gaCAmIDY1NTM1OwogICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGggPSBoaFsxXTsKICAgICAgICAgICAgbCA9IGhsWzFdOwogICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGIgKz0gYSA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gYiA-Pj4gMTY7CiAgICAgICAgICAgIGQgKz0gYyA-Pj4gMTY7CiAgICAgICAgICAgIGhoWzFdID0gYWgxID0gYyAmIDY1NTM1IHwgZCA8PCAxNjsKICAgICAgICAgICAgaGxbMV0gPSBhbDEgPSBhICYgNjU1MzUgfCBiIDw8IDE2OwogICAgICAgICAgICBoID0gYWgyOwogICAgICAgICAgICBsID0gYWwyOwogICAgICAgICAgICBhID0gbCAmIDY1NTM1OwogICAgICAgICAgICBiID0gbCA-Pj4gMTY7CiAgICAgICAgICAgIGMgPSBoICYgNjU1MzU7CiAgICAgICAgICAgIGQgPSBoID4-PiAxNjsKICAgICAgICAgICAgaCA9IGhoWzJdOwogICAgICAgICAgICBsID0gaGxbMl07CiAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgYiArPSBhID4-PiAxNjsKICAgICAgICAgICAgYyArPSBiID4-PiAxNjsKICAgICAgICAgICAgZCArPSBjID4-PiAxNjsKICAgICAgICAgICAgaGhbMl0gPSBhaDIgPSBjICYgNjU1MzUgfCBkIDw8IDE2OwogICAgICAgICAgICBobFsyXSA9IGFsMiA9IGEgJiA2NTUzNSB8IGIgPDwgMTY7CiAgICAgICAgICAgIGggPSBhaDM7CiAgICAgICAgICAgIGwgPSBhbDM7CiAgICAgICAgICAgIGEgPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgPSBsID4-PiAxNjsKICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgZCA9IGggPj4-IDE2OwogICAgICAgICAgICBoID0gaGhbM107CiAgICAgICAgICAgIGwgPSBobFszXTsKICAgICAgICAgICAgYSArPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gaCAmIDY1NTM1OwogICAgICAgICAgICBkICs9IGggPj4-IDE2OwogICAgICAgICAgICBiICs9IGEgPj4-IDE2OwogICAgICAgICAgICBjICs9IGIgPj4-IDE2OwogICAgICAgICAgICBkICs9IGMgPj4-IDE2OwogICAgICAgICAgICBoaFszXSA9IGFoMyA9IGMgJiA2NTUzNSB8IGQgPDwgMTY7CiAgICAgICAgICAgIGhsWzNdID0gYWwzID0gYSAmIDY1NTM1IHwgYiA8PCAxNjsKICAgICAgICAgICAgaCA9IGFoNDsKICAgICAgICAgICAgbCA9IGFsNDsKICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiA9IGwgPj4-IDE2OwogICAgICAgICAgICBjID0gaCAmIDY1NTM1OwogICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGggPSBoaFs0XTsKICAgICAgICAgICAgbCA9IGhsWzRdOwogICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGIgKz0gYSA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gYiA-Pj4gMTY7CiAgICAgICAgICAgIGQgKz0gYyA-Pj4gMTY7CiAgICAgICAgICAgIGhoWzRdID0gYWg0ID0gYyAmIDY1NTM1IHwgZCA8PCAxNjsKICAgICAgICAgICAgaGxbNF0gPSBhbDQgPSBhICYgNjU1MzUgfCBiIDw8IDE2OwogICAgICAgICAgICBoID0gYWg1OwogICAgICAgICAgICBsID0gYWw1OwogICAgICAgICAgICBhID0gbCAmIDY1NTM1OwogICAgICAgICAgICBiID0gbCA-Pj4gMTY7CiAgICAgICAgICAgIGMgPSBoICYgNjU1MzU7CiAgICAgICAgICAgIGQgPSBoID4-PiAxNjsKICAgICAgICAgICAgaCA9IGhoWzVdOwogICAgICAgICAgICBsID0gaGxbNV07CiAgICAgICAgICAgIGEgKz0gbCAmIDY1NTM1OwogICAgICAgICAgICBiICs9IGwgPj4-IDE2OwogICAgICAgICAgICBjICs9IGggJiA2NTUzNTsKICAgICAgICAgICAgZCArPSBoID4-PiAxNjsKICAgICAgICAgICAgYiArPSBhID4-PiAxNjsKICAgICAgICAgICAgYyArPSBiID4-PiAxNjsKICAgICAgICAgICAgZCArPSBjID4-PiAxNjsKICAgICAgICAgICAgaGhbNV0gPSBhaDUgPSBjICYgNjU1MzUgfCBkIDw8IDE2OwogICAgICAgICAgICBobFs1XSA9IGFsNSA9IGEgJiA2NTUzNSB8IGIgPDwgMTY7CiAgICAgICAgICAgIGggPSBhaDY7CiAgICAgICAgICAgIGwgPSBhbDY7CiAgICAgICAgICAgIGEgPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgPSBsID4-PiAxNjsKICAgICAgICAgICAgYyA9IGggJiA2NTUzNTsKICAgICAgICAgICAgZCA9IGggPj4-IDE2OwogICAgICAgICAgICBoID0gaGhbNl07CiAgICAgICAgICAgIGwgPSBobFs2XTsKICAgICAgICAgICAgYSArPSBsICYgNjU1MzU7CiAgICAgICAgICAgIGIgKz0gbCA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gaCAmIDY1NTM1OwogICAgICAgICAgICBkICs9IGggPj4-IDE2OwogICAgICAgICAgICBiICs9IGEgPj4-IDE2OwogICAgICAgICAgICBjICs9IGIgPj4-IDE2OwogICAgICAgICAgICBkICs9IGMgPj4-IDE2OwogICAgICAgICAgICBoaFs2XSA9IGFoNiA9IGMgJiA2NTUzNSB8IGQgPDwgMTY7CiAgICAgICAgICAgIGhsWzZdID0gYWw2ID0gYSAmIDY1NTM1IHwgYiA8PCAxNjsKICAgICAgICAgICAgaCA9IGFoNzsKICAgICAgICAgICAgbCA9IGFsNzsKICAgICAgICAgICAgYSA9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiA9IGwgPj4-IDE2OwogICAgICAgICAgICBjID0gaCAmIDY1NTM1OwogICAgICAgICAgICBkID0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGggPSBoaFs3XTsKICAgICAgICAgICAgbCA9IGhsWzddOwogICAgICAgICAgICBhICs9IGwgJiA2NTUzNTsKICAgICAgICAgICAgYiArPSBsID4-PiAxNjsKICAgICAgICAgICAgYyArPSBoICYgNjU1MzU7CiAgICAgICAgICAgIGQgKz0gaCA-Pj4gMTY7CiAgICAgICAgICAgIGIgKz0gYSA-Pj4gMTY7CiAgICAgICAgICAgIGMgKz0gYiA-Pj4gMTY7CiAgICAgICAgICAgIGQgKz0gYyA-Pj4gMTY7CiAgICAgICAgICAgIGhoWzddID0gYWg3ID0gYyAmIDY1NTM1IHwgZCA8PCAxNjsKICAgICAgICAgICAgaGxbN10gPSBhbDcgPSBhICYgNjU1MzUgfCBiIDw8IDE2OwogICAgICAgICAgICBwb3MgKz0gMTI4OwogICAgICAgICAgICBuIC09IDEyODsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9faGFzaChvdXQsIG0sIG4pIHsKICAgICAgICAgIHZhciBoaCA9IG5ldyBJbnQzMkFycmF5KDgpLCBobCA9IG5ldyBJbnQzMkFycmF5KDgpLCB4ID0gbmV3IFVpbnQ4QXJyYXkoMjU2KSwgaSwgYiA9IG47CiAgICAgICAgICBoaFswXSA9IDE3NzkwMzM3MDM7CiAgICAgICAgICBoaFsxXSA9IDMxNDQxMzQyNzc7CiAgICAgICAgICBoaFsyXSA9IDEwMTM5MDQyNDI7CiAgICAgICAgICBoaFszXSA9IDI3NzM0ODA3NjI7CiAgICAgICAgICBoaFs0XSA9IDEzNTk4OTMxMTk7CiAgICAgICAgICBoaFs1XSA9IDI2MDA4MjI5MjQ7CiAgICAgICAgICBoaFs2XSA9IDUyODczNDYzNTsKICAgICAgICAgIGhoWzddID0gMTU0MTQ1OTIyNTsKICAgICAgICAgIGhsWzBdID0gNDA4OTIzNTcyMDsKICAgICAgICAgIGhsWzFdID0gMjIyNzg3MzU5NTsKICAgICAgICAgIGhsWzJdID0gNDI3MTE3NTcyMzsKICAgICAgICAgIGhsWzNdID0gMTU5NTc1MDEyOTsKICAgICAgICAgIGhsWzRdID0gMjkxNzU2NTEzNzsKICAgICAgICAgIGhsWzVdID0gNzI1NTExMTk5OwogICAgICAgICAgaGxbNl0gPSA0MjE1Mzg5NTQ3OwogICAgICAgICAgaGxbN10gPSAzMjcwMzMyMDk7CiAgICAgICAgICBjcnlwdG9faGFzaGJsb2Nrc19obChoaCwgaGwsIG0sIG4pOwogICAgICAgICAgbiAlPSAxMjg7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKQogICAgICAgICAgICB4W2ldID0gbVtiIC0gbiArIGldOwogICAgICAgICAgeFtuXSA9IDEyODsKICAgICAgICAgIG4gPSAyNTYgLSAxMjggKiAobiA8IDExMiA_IDEgOiAwKTsKICAgICAgICAgIHhbbiAtIDldID0gMDsKICAgICAgICAgIHRzNjQoeCwgbiAtIDgsIGIgLyA1MzY4NzA5MTIgfCAwLCBiIDw8IDMpOwogICAgICAgICAgY3J5cHRvX2hhc2hibG9ja3NfaGwoaGgsIGhsLCB4LCBuKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA4OyBpKyspCiAgICAgICAgICAgIHRzNjQob3V0LCA4ICogaSwgaGhbaV0sIGhsW2ldKTsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBhZGQocCwgcSkgewogICAgICAgICAgdmFyIGEgPSBnZigpLCBiID0gZ2YoKSwgYyA9IGdmKCksIGQgPSBnZigpLCBlID0gZ2YoKSwgZiA9IGdmKCksIGcyID0gZ2YoKSwgaCA9IGdmKCksIHQgPSBnZigpOwogICAgICAgICAgWihhLCBwWzFdLCBwWzBdKTsKICAgICAgICAgIFoodCwgcVsxXSwgcVswXSk7CiAgICAgICAgICBNKGEsIGEsIHQpOwogICAgICAgICAgQShiLCBwWzBdLCBwWzFdKTsKICAgICAgICAgIEEodCwgcVswXSwgcVsxXSk7CiAgICAgICAgICBNKGIsIGIsIHQpOwogICAgICAgICAgTShjLCBwWzNdLCBxWzNdKTsKICAgICAgICAgIE0oYywgYywgRDIpOwogICAgICAgICAgTShkLCBwWzJdLCBxWzJdKTsKICAgICAgICAgIEEoZCwgZCwgZCk7CiAgICAgICAgICBaKGUsIGIsIGEpOwogICAgICAgICAgWihmLCBkLCBjKTsKICAgICAgICAgIEEoZzIsIGQsIGMpOwogICAgICAgICAgQShoLCBiLCBhKTsKICAgICAgICAgIE0ocFswXSwgZSwgZik7CiAgICAgICAgICBNKHBbMV0sIGgsIGcyKTsKICAgICAgICAgIE0ocFsyXSwgZzIsIGYpOwogICAgICAgICAgTShwWzNdLCBlLCBoKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY3N3YXAocCwgcSwgYikgewogICAgICAgICAgdmFyIGk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAgIHNlbDI1NTE5KHBbaV0sIHFbaV0sIGIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBwYWNrKHIsIHApIHsKICAgICAgICAgIHZhciB0eCA9IGdmKCksIHR5ID0gZ2YoKSwgemkgPSBnZigpOwogICAgICAgICAgaW52MjU1MTkoemksIHBbMl0pOwogICAgICAgICAgTSh0eCwgcFswXSwgemkpOwogICAgICAgICAgTSh0eSwgcFsxXSwgemkpOwogICAgICAgICAgcGFjazI1NTE5KHIsIHR5KTsKICAgICAgICAgIHJbMzFdIF49IHBhcjI1NTE5KHR4KSA8PCA3OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzY2FsYXJtdWx0KHAsIHEsIHMpIHsKICAgICAgICAgIHZhciBiLCBpOwogICAgICAgICAgc2V0MjU1MTkocFswXSwgZ2YwKTsKICAgICAgICAgIHNldDI1NTE5KHBbMV0sIGdmMSk7CiAgICAgICAgICBzZXQyNTUxOShwWzJdLCBnZjEpOwogICAgICAgICAgc2V0MjU1MTkocFszXSwgZ2YwKTsKICAgICAgICAgIGZvciAoaSA9IDI1NTsgaSA-PSAwOyAtLWkpIHsKICAgICAgICAgICAgYiA9IHNbaSAvIDggfCAwXSA-PiAoaSAmIDcpICYgMTsKICAgICAgICAgICAgY3N3YXAocCwgcSwgYik7CiAgICAgICAgICAgIGFkZChxLCBwKTsKICAgICAgICAgICAgYWRkKHAsIHApOwogICAgICAgICAgICBjc3dhcChwLCBxLCBiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gc2NhbGFyYmFzZShwLCBzKSB7CiAgICAgICAgICB2YXIgcSA9IFtnZigpLCBnZigpLCBnZigpLCBnZigpXTsKICAgICAgICAgIHNldDI1NTE5KHFbMF0sIFgpOwogICAgICAgICAgc2V0MjU1MTkocVsxXSwgWSk7CiAgICAgICAgICBzZXQyNTUxOShxWzJdLCBnZjEpOwogICAgICAgICAgTShxWzNdLCBYLCBZKTsKICAgICAgICAgIHNjYWxhcm11bHQocCwgcSwgcyk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19zaWduX2tleXBhaXIocGssIHNrLCBzZWVkZWQpIHsKICAgICAgICAgIHZhciBkID0gbmV3IFVpbnQ4QXJyYXkoNjQpOwogICAgICAgICAgdmFyIHAgPSBbZ2YoKSwgZ2YoKSwgZ2YoKSwgZ2YoKV07CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIGlmICghc2VlZGVkKQogICAgICAgICAgICByYW5kb21ieXRlcyhzaywgMzIpOwogICAgICAgICAgY3J5cHRvX2hhc2goZCwgc2ssIDMyKTsKICAgICAgICAgIGRbMF0gJj0gMjQ4OwogICAgICAgICAgZFszMV0gJj0gMTI3OwogICAgICAgICAgZFszMV0gfD0gNjQ7CiAgICAgICAgICBzY2FsYXJiYXNlKHAsIGQpOwogICAgICAgICAgcGFjayhwaywgcCk7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzI7IGkrKykKICAgICAgICAgICAgc2tbaSArIDMyXSA9IHBrW2ldOwogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHZhciBMID0gbmV3IEZsb2F0NjRBcnJheShbCiAgICAgICAgICAyMzcsCiAgICAgICAgICAyMTEsCiAgICAgICAgICAyNDUsCiAgICAgICAgICA5MiwKICAgICAgICAgIDI2LAogICAgICAgICAgOTksCiAgICAgICAgICAxOCwKICAgICAgICAgIDg4LAogICAgICAgICAgMjE0LAogICAgICAgICAgMTU2LAogICAgICAgICAgMjQ3LAogICAgICAgICAgMTYyLAogICAgICAgICAgMjIyLAogICAgICAgICAgMjQ5LAogICAgICAgICAgMjIyLAogICAgICAgICAgMjAsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAwLAogICAgICAgICAgMCwKICAgICAgICAgIDAsCiAgICAgICAgICAxNgogICAgICAgIF0pOwogICAgICAgIGZ1bmN0aW9uIG1vZEwociwgeCkgewogICAgICAgICAgdmFyIGNhcnJ5LCBpLCBqLCBrOwogICAgICAgICAgZm9yIChpID0gNjM7IGkgPj0gMzI7IC0taSkgewogICAgICAgICAgICBjYXJyeSA9IDA7CiAgICAgICAgICAgIGZvciAoaiA9IGkgLSAzMiwgayA9IGkgLSAxMjsgaiA8IGs7ICsraikgewogICAgICAgICAgICAgIHhbal0gKz0gY2FycnkgLSAxNiAqIHhbaV0gKiBMW2ogLSAoaSAtIDMyKV07CiAgICAgICAgICAgICAgY2FycnkgPSBNYXRoLmZsb29yKCh4W2pdICsgMTI4KSAvIDI1Nik7CiAgICAgICAgICAgICAgeFtqXSAtPSBjYXJyeSAqIDI1NjsKICAgICAgICAgICAgfQogICAgICAgICAgICB4W2pdICs9IGNhcnJ5OwogICAgICAgICAgICB4W2ldID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNhcnJ5ID0gMDsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCAzMjsgaisrKSB7CiAgICAgICAgICAgIHhbal0gKz0gY2FycnkgLSAoeFszMV0gPj4gNCkgKiBMW2pdOwogICAgICAgICAgICBjYXJyeSA9IHhbal0gPj4gODsKICAgICAgICAgICAgeFtqXSAmPSAyNTU7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMzI7IGorKykKICAgICAgICAgICAgeFtqXSAtPSBjYXJyeSAqIExbal07CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzI7IGkrKykgewogICAgICAgICAgICB4W2kgKyAxXSArPSB4W2ldID4-IDg7CiAgICAgICAgICAgIHJbaV0gPSB4W2ldICYgMjU1OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiByZWR1Y2UocikgewogICAgICAgICAgdmFyIHggPSBuZXcgRmxvYXQ2NEFycmF5KDY0KSwgaTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQogICAgICAgICAgICB4W2ldID0gcltpXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQogICAgICAgICAgICByW2ldID0gMDsKICAgICAgICAgIG1vZEwociwgeCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNyeXB0b19zaWduKHNtLCBtLCBuLCBzaykgewogICAgICAgICAgdmFyIGQgPSBuZXcgVWludDhBcnJheSg2NCksIGggPSBuZXcgVWludDhBcnJheSg2NCksIHIgPSBuZXcgVWludDhBcnJheSg2NCk7CiAgICAgICAgICB2YXIgaSwgaiwgeCA9IG5ldyBGbG9hdDY0QXJyYXkoNjQpOwogICAgICAgICAgdmFyIHAgPSBbZ2YoKSwgZ2YoKSwgZ2YoKSwgZ2YoKV07CiAgICAgICAgICBjcnlwdG9faGFzaChkLCBzaywgMzIpOwogICAgICAgICAgZFswXSAmPSAyNDg7CiAgICAgICAgICBkWzMxXSAmPSAxMjc7CiAgICAgICAgICBkWzMxXSB8PSA2NDsKICAgICAgICAgIHZhciBzbWxlbiA9IG4gKyA2NDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspCiAgICAgICAgICAgIHNtWzY0ICsgaV0gPSBtW2ldOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IDMyOyBpKyspCiAgICAgICAgICAgIHNtWzMyICsgaV0gPSBkWzMyICsgaV07CiAgICAgICAgICBjcnlwdG9faGFzaChyLCBzbS5zdWJhcnJheSgzMiksIG4gKyAzMik7CiAgICAgICAgICByZWR1Y2Uocik7CiAgICAgICAgICBzY2FsYXJiYXNlKHAsIHIpOwogICAgICAgICAgcGFjayhzbSwgcCk7CiAgICAgICAgICBmb3IgKGkgPSAzMjsgaSA8IDY0OyBpKyspCiAgICAgICAgICAgIHNtW2ldID0gc2tbaV07CiAgICAgICAgICBjcnlwdG9faGFzaChoLCBzbSwgbiArIDY0KTsKICAgICAgICAgIHJlZHVjZShoKTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSsrKQogICAgICAgICAgICB4W2ldID0gMDsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAzMjsgaSsrKQogICAgICAgICAgICB4W2ldID0gcltpXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAzMjsgaSsrKSB7CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCAzMjsgaisrKSB7CiAgICAgICAgICAgICAgeFtpICsgal0gKz0gaFtpXSAqIGRbal07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG1vZEwoc20uc3ViYXJyYXkoMzIpLCB4KTsKICAgICAgICAgIHJldHVybiBzbWxlbjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gdW5wYWNrbmVnKHIsIHApIHsKICAgICAgICAgIHZhciB0ID0gZ2YoKSwgY2hrID0gZ2YoKSwgbnVtID0gZ2YoKSwgZGVuID0gZ2YoKSwgZGVuMiA9IGdmKCksIGRlbjQgPSBnZigpLCBkZW42ID0gZ2YoKTsKICAgICAgICAgIHNldDI1NTE5KHJbMl0sIGdmMSk7CiAgICAgICAgICB1bnBhY2syNTUxOShyWzFdLCBwKTsKICAgICAgICAgIFMobnVtLCByWzFdKTsKICAgICAgICAgIE0oZGVuLCBudW0sIEQpOwogICAgICAgICAgWihudW0sIG51bSwgclsyXSk7CiAgICAgICAgICBBKGRlbiwgclsyXSwgZGVuKTsKICAgICAgICAgIFMoZGVuMiwgZGVuKTsKICAgICAgICAgIFMoZGVuNCwgZGVuMik7CiAgICAgICAgICBNKGRlbjYsIGRlbjQsIGRlbjIpOwogICAgICAgICAgTSh0LCBkZW42LCBudW0pOwogICAgICAgICAgTSh0LCB0LCBkZW4pOwogICAgICAgICAgcG93MjUyMyh0LCB0KTsKICAgICAgICAgIE0odCwgdCwgbnVtKTsKICAgICAgICAgIE0odCwgdCwgZGVuKTsKICAgICAgICAgIE0odCwgdCwgZGVuKTsKICAgICAgICAgIE0oclswXSwgdCwgZGVuKTsKICAgICAgICAgIFMoY2hrLCByWzBdKTsKICAgICAgICAgIE0oY2hrLCBjaGssIGRlbik7CiAgICAgICAgICBpZiAobmVxMjU1MTkoY2hrLCBudW0pKQogICAgICAgICAgICBNKHJbMF0sIHJbMF0sIEkpOwogICAgICAgICAgUyhjaGssIHJbMF0pOwogICAgICAgICAgTShjaGssIGNoaywgZGVuKTsKICAgICAgICAgIGlmIChuZXEyNTUxOShjaGssIG51bSkpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGlmIChwYXIyNTUxOShyWzBdKSA9PT0gcFszMV0gPj4gNykKICAgICAgICAgICAgWihyWzBdLCBnZjAsIHJbMF0pOwogICAgICAgICAgTShyWzNdLCByWzBdLCByWzFdKTsKICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBjcnlwdG9fc2lnbl9vcGVuKG0sIHNtLCBuLCBwaykgewogICAgICAgICAgdmFyIGk7CiAgICAgICAgICB2YXIgdCA9IG5ldyBVaW50OEFycmF5KDMyKSwgaCA9IG5ldyBVaW50OEFycmF5KDY0KTsKICAgICAgICAgIHZhciBwID0gW2dmKCksIGdmKCksIGdmKCksIGdmKCldLCBxID0gW2dmKCksIGdmKCksIGdmKCksIGdmKCldOwogICAgICAgICAgaWYgKG4gPCA2NCkKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgaWYgKHVucGFja25lZyhxLCBwaykpCiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspCiAgICAgICAgICAgIG1baV0gPSBzbVtpXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCAzMjsgaSsrKQogICAgICAgICAgICBtW2kgKyAzMl0gPSBwa1tpXTsKICAgICAgICAgIGNyeXB0b19oYXNoKGgsIG0sIG4pOwogICAgICAgICAgcmVkdWNlKGgpOwogICAgICAgICAgc2NhbGFybXVsdChwLCBxLCBoKTsKICAgICAgICAgIHNjYWxhcmJhc2UocSwgc20uc3ViYXJyYXkoMzIpKTsKICAgICAgICAgIGFkZChwLCBxKTsKICAgICAgICAgIHBhY2sodCwgcCk7CiAgICAgICAgICBuIC09IDY0OwogICAgICAgICAgaWYgKGNyeXB0b192ZXJpZnlfMzIoc20sIDAsIHQsIDApKSB7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspCiAgICAgICAgICAgICAgbVtpXSA9IDA7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspCiAgICAgICAgICAgIG1baV0gPSBzbVtpICsgNjRdOwogICAgICAgICAgcmV0dXJuIG47CiAgICAgICAgfQogICAgICAgIHZhciBjcnlwdG9fc2VjcmV0Ym94X0tFWUJZVEVTID0gMzIsIGNyeXB0b19zZWNyZXRib3hfTk9OQ0VCWVRFUyA9IDI0LCBjcnlwdG9fc2VjcmV0Ym94X1pFUk9CWVRFUyA9IDMyLCBjcnlwdG9fc2VjcmV0Ym94X0JPWFpFUk9CWVRFUyA9IDE2LCBjcnlwdG9fc2NhbGFybXVsdF9CWVRFUyA9IDMyLCBjcnlwdG9fc2NhbGFybXVsdF9TQ0FMQVJCWVRFUyA9IDMyLCBjcnlwdG9fYm94X1BVQkxJQ0tFWUJZVEVTID0gMzIsIGNyeXB0b19ib3hfU0VDUkVUS0VZQllURVMgPSAzMiwgY3J5cHRvX2JveF9CRUZPUkVOTUJZVEVTID0gMzIsIGNyeXB0b19ib3hfTk9OQ0VCWVRFUyA9IGNyeXB0b19zZWNyZXRib3hfTk9OQ0VCWVRFUywgY3J5cHRvX2JveF9aRVJPQllURVMgPSBjcnlwdG9fc2VjcmV0Ym94X1pFUk9CWVRFUywgY3J5cHRvX2JveF9CT1haRVJPQllURVMgPSBjcnlwdG9fc2VjcmV0Ym94X0JPWFpFUk9CWVRFUywgY3J5cHRvX3NpZ25fQllURVMgPSA2NCwgY3J5cHRvX3NpZ25fUFVCTElDS0VZQllURVMgPSAzMiwgY3J5cHRvX3NpZ25fU0VDUkVUS0VZQllURVMgPSA2NCwgY3J5cHRvX3NpZ25fU0VFREJZVEVTID0gMzIsIGNyeXB0b19oYXNoX0JZVEVTID0gNjQ7CiAgICAgICAgbmFjbC5sb3dsZXZlbCA9IHsKICAgICAgICAgIGNyeXB0b19jb3JlX2hzYWxzYTIwLAogICAgICAgICAgY3J5cHRvX3N0cmVhbV94b3IsCiAgICAgICAgICBjcnlwdG9fc3RyZWFtLAogICAgICAgICAgY3J5cHRvX3N0cmVhbV9zYWxzYTIwX3hvciwKICAgICAgICAgIGNyeXB0b19zdHJlYW1fc2Fsc2EyMCwKICAgICAgICAgIGNyeXB0b19vbmV0aW1lYXV0aCwKICAgICAgICAgIGNyeXB0b19vbmV0aW1lYXV0aF92ZXJpZnksCiAgICAgICAgICBjcnlwdG9fdmVyaWZ5XzE2LAogICAgICAgICAgY3J5cHRvX3ZlcmlmeV8zMiwKICAgICAgICAgIGNyeXB0b19zZWNyZXRib3gsCiAgICAgICAgICBjcnlwdG9fc2VjcmV0Ym94X29wZW4sCiAgICAgICAgICBjcnlwdG9fc2NhbGFybXVsdCwKICAgICAgICAgIGNyeXB0b19zY2FsYXJtdWx0X2Jhc2UsCiAgICAgICAgICBjcnlwdG9fYm94X2JlZm9yZW5tLAogICAgICAgICAgY3J5cHRvX2JveF9hZnRlcm5tLAogICAgICAgICAgY3J5cHRvX2JveCwKICAgICAgICAgIGNyeXB0b19ib3hfb3BlbiwKICAgICAgICAgIGNyeXB0b19ib3hfa2V5cGFpciwKICAgICAgICAgIGNyeXB0b19oYXNoLAogICAgICAgICAgY3J5cHRvX3NpZ24sCiAgICAgICAgICBjcnlwdG9fc2lnbl9rZXlwYWlyLAogICAgICAgICAgY3J5cHRvX3NpZ25fb3BlbiwKICAgICAgICAgIGNyeXB0b19zZWNyZXRib3hfS0VZQllURVMsCiAgICAgICAgICBjcnlwdG9fc2VjcmV0Ym94X05PTkNFQllURVMsCiAgICAgICAgICBjcnlwdG9fc2VjcmV0Ym94X1pFUk9CWVRFUywKICAgICAgICAgIGNyeXB0b19zZWNyZXRib3hfQk9YWkVST0JZVEVTLAogICAgICAgICAgY3J5cHRvX3NjYWxhcm11bHRfQllURVMsCiAgICAgICAgICBjcnlwdG9fc2NhbGFybXVsdF9TQ0FMQVJCWVRFUywKICAgICAgICAgIGNyeXB0b19ib3hfUFVCTElDS0VZQllURVMsCiAgICAgICAgICBjcnlwdG9fYm94X1NFQ1JFVEtFWUJZVEVTLAogICAgICAgICAgY3J5cHRvX2JveF9CRUZPUkVOTUJZVEVTLAogICAgICAgICAgY3J5cHRvX2JveF9OT05DRUJZVEVTLAogICAgICAgICAgY3J5cHRvX2JveF9aRVJPQllURVMsCiAgICAgICAgICBjcnlwdG9fYm94X0JPWFpFUk9CWVRFUywKICAgICAgICAgIGNyeXB0b19zaWduX0JZVEVTLAogICAgICAgICAgY3J5cHRvX3NpZ25fUFVCTElDS0VZQllURVMsCiAgICAgICAgICBjcnlwdG9fc2lnbl9TRUNSRVRLRVlCWVRFUywKICAgICAgICAgIGNyeXB0b19zaWduX1NFRURCWVRFUywKICAgICAgICAgIGNyeXB0b19oYXNoX0JZVEVTLAogICAgICAgICAgZ2YsCiAgICAgICAgICBELAogICAgICAgICAgTCwKICAgICAgICAgIHBhY2syNTUxOSwKICAgICAgICAgIHVucGFjazI1NTE5LAogICAgICAgICAgTSwKICAgICAgICAgIEEsCiAgICAgICAgICBTLAogICAgICAgICAgWiwKICAgICAgICAgIHBvdzI1MjMsCiAgICAgICAgICBhZGQsCiAgICAgICAgICBzZXQyNTUxOSwKICAgICAgICAgIG1vZEwsCiAgICAgICAgICBzY2FsYXJtdWx0LAogICAgICAgICAgc2NhbGFyYmFzZQogICAgICAgIH07CiAgICAgICAgZnVuY3Rpb24gY2hlY2tMZW5ndGhzKGssIG4pIHsKICAgICAgICAgIGlmIChrLmxlbmd0aCAhPT0gY3J5cHRvX3NlY3JldGJveF9LRVlCWVRFUykKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQga2V5IHNpemUiKTsKICAgICAgICAgIGlmIChuLmxlbmd0aCAhPT0gY3J5cHRvX3NlY3JldGJveF9OT05DRUJZVEVTKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhZCBub25jZSBzaXplIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNoZWNrQm94TGVuZ3Rocyhwaywgc2spIHsKICAgICAgICAgIGlmIChway5sZW5ndGggIT09IGNyeXB0b19ib3hfUFVCTElDS0VZQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIHB1YmxpYyBrZXkgc2l6ZSIpOwogICAgICAgICAgaWYgKHNrLmxlbmd0aCAhPT0gY3J5cHRvX2JveF9TRUNSRVRLRVlCWVRFUykKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQgc2VjcmV0IGtleSBzaXplIik7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGNoZWNrQXJyYXlUeXBlcygpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghKGFyZ3VtZW50c1tpXSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInVuZXhwZWN0ZWQgdHlwZSwgdXNlIFVpbnQ4QXJyYXkiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gY2xlYW51cChhcnIpIHsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBhcnJbaV0gPSAwOwogICAgICAgIH0KICAgICAgICBuYWNsLnJhbmRvbUJ5dGVzID0gZnVuY3Rpb24obikgewogICAgICAgICAgdmFyIGIgPSBuZXcgVWludDhBcnJheShuKTsKICAgICAgICAgIHJhbmRvbWJ5dGVzKGIsIG4pOwogICAgICAgICAgcmV0dXJuIGI7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNlY3JldGJveCA9IGZ1bmN0aW9uKG1zZywgbm9uY2UsIGtleSkgewogICAgICAgICAgY2hlY2tBcnJheVR5cGVzKG1zZywgbm9uY2UsIGtleSk7CiAgICAgICAgICBjaGVja0xlbmd0aHMoa2V5LCBub25jZSk7CiAgICAgICAgICB2YXIgbSA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19zZWNyZXRib3hfWkVST0JZVEVTICsgbXNnLmxlbmd0aCk7CiAgICAgICAgICB2YXIgYyA9IG5ldyBVaW50OEFycmF5KG0ubGVuZ3RoKTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXNnLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBtW2kgKyBjcnlwdG9fc2VjcmV0Ym94X1pFUk9CWVRFU10gPSBtc2dbaV07CiAgICAgICAgICBjcnlwdG9fc2VjcmV0Ym94KGMsIG0sIG0ubGVuZ3RoLCBub25jZSwga2V5KTsKICAgICAgICAgIHJldHVybiBjLnN1YmFycmF5KGNyeXB0b19zZWNyZXRib3hfQk9YWkVST0JZVEVTKTsKICAgICAgICB9OwogICAgICAgIG5hY2wuc2VjcmV0Ym94Lm9wZW4gPSBmdW5jdGlvbihib3gsIG5vbmNlLCBrZXkpIHsKICAgICAgICAgIGNoZWNrQXJyYXlUeXBlcyhib3gsIG5vbmNlLCBrZXkpOwogICAgICAgICAgY2hlY2tMZW5ndGhzKGtleSwgbm9uY2UpOwogICAgICAgICAgdmFyIGMgPSBuZXcgVWludDhBcnJheShjcnlwdG9fc2VjcmV0Ym94X0JPWFpFUk9CWVRFUyArIGJveC5sZW5ndGgpOwogICAgICAgICAgdmFyIG0gPSBuZXcgVWludDhBcnJheShjLmxlbmd0aCk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJveC5sZW5ndGg7IGkrKykKICAgICAgICAgICAgY1tpICsgY3J5cHRvX3NlY3JldGJveF9CT1haRVJPQllURVNdID0gYm94W2ldOwogICAgICAgICAgaWYgKGMubGVuZ3RoIDwgMzIpCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgaWYgKGNyeXB0b19zZWNyZXRib3hfb3BlbihtLCBjLCBjLmxlbmd0aCwgbm9uY2UsIGtleSkgIT09IDApCiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgcmV0dXJuIG0uc3ViYXJyYXkoY3J5cHRvX3NlY3JldGJveF9aRVJPQllURVMpOwogICAgICAgIH07CiAgICAgICAgbmFjbC5zZWNyZXRib3gua2V5TGVuZ3RoID0gY3J5cHRvX3NlY3JldGJveF9LRVlCWVRFUzsKICAgICAgICBuYWNsLnNlY3JldGJveC5ub25jZUxlbmd0aCA9IGNyeXB0b19zZWNyZXRib3hfTk9OQ0VCWVRFUzsKICAgICAgICBuYWNsLnNlY3JldGJveC5vdmVyaGVhZExlbmd0aCA9IGNyeXB0b19zZWNyZXRib3hfQk9YWkVST0JZVEVTOwogICAgICAgIG5hY2wuc2NhbGFyTXVsdCA9IGZ1bmN0aW9uKG4sIHApIHsKICAgICAgICAgIGNoZWNrQXJyYXlUeXBlcyhuLCBwKTsKICAgICAgICAgIGlmIChuLmxlbmd0aCAhPT0gY3J5cHRvX3NjYWxhcm11bHRfU0NBTEFSQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIG4gc2l6ZSIpOwogICAgICAgICAgaWYgKHAubGVuZ3RoICE9PSBjcnlwdG9fc2NhbGFybXVsdF9CWVRFUykKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQgcCBzaXplIik7CiAgICAgICAgICB2YXIgcSA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19zY2FsYXJtdWx0X0JZVEVTKTsKICAgICAgICAgIGNyeXB0b19zY2FsYXJtdWx0KHEsIG4sIHApOwogICAgICAgICAgcmV0dXJuIHE7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNjYWxhck11bHQuYmFzZSA9IGZ1bmN0aW9uKG4pIHsKICAgICAgICAgIGNoZWNrQXJyYXlUeXBlcyhuKTsKICAgICAgICAgIGlmIChuLmxlbmd0aCAhPT0gY3J5cHRvX3NjYWxhcm11bHRfU0NBTEFSQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIG4gc2l6ZSIpOwogICAgICAgICAgdmFyIHEgPSBuZXcgVWludDhBcnJheShjcnlwdG9fc2NhbGFybXVsdF9CWVRFUyk7CiAgICAgICAgICBjcnlwdG9fc2NhbGFybXVsdF9iYXNlKHEsIG4pOwogICAgICAgICAgcmV0dXJuIHE7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNjYWxhck11bHQuc2NhbGFyTGVuZ3RoID0gY3J5cHRvX3NjYWxhcm11bHRfU0NBTEFSQllURVM7CiAgICAgICAgbmFjbC5zY2FsYXJNdWx0Lmdyb3VwRWxlbWVudExlbmd0aCA9IGNyeXB0b19zY2FsYXJtdWx0X0JZVEVTOwogICAgICAgIG5hY2wuYm94ID0gZnVuY3Rpb24obXNnLCBub25jZSwgcHVibGljS2V5LCBzZWNyZXRLZXkpIHsKICAgICAgICAgIHZhciBrID0gbmFjbC5ib3guYmVmb3JlKHB1YmxpY0tleSwgc2VjcmV0S2V5KTsKICAgICAgICAgIHJldHVybiBuYWNsLnNlY3JldGJveChtc2csIG5vbmNlLCBrKTsKICAgICAgICB9OwogICAgICAgIG5hY2wuYm94LmJlZm9yZSA9IGZ1bmN0aW9uKHB1YmxpY0tleSwgc2VjcmV0S2V5KSB7CiAgICAgICAgICBjaGVja0FycmF5VHlwZXMocHVibGljS2V5LCBzZWNyZXRLZXkpOwogICAgICAgICAgY2hlY2tCb3hMZW5ndGhzKHB1YmxpY0tleSwgc2VjcmV0S2V5KTsKICAgICAgICAgIHZhciBrID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX2JveF9CRUZPUkVOTUJZVEVTKTsKICAgICAgICAgIGNyeXB0b19ib3hfYmVmb3Jlbm0oaywgcHVibGljS2V5LCBzZWNyZXRLZXkpOwogICAgICAgICAgcmV0dXJuIGs7CiAgICAgICAgfTsKICAgICAgICBuYWNsLmJveC5hZnRlciA9IG5hY2wuc2VjcmV0Ym94OwogICAgICAgIG5hY2wuYm94Lm9wZW4gPSBmdW5jdGlvbihtc2csIG5vbmNlLCBwdWJsaWNLZXksIHNlY3JldEtleSkgewogICAgICAgICAgdmFyIGsgPSBuYWNsLmJveC5iZWZvcmUocHVibGljS2V5LCBzZWNyZXRLZXkpOwogICAgICAgICAgcmV0dXJuIG5hY2wuc2VjcmV0Ym94Lm9wZW4obXNnLCBub25jZSwgayk7CiAgICAgICAgfTsKICAgICAgICBuYWNsLmJveC5vcGVuLmFmdGVyID0gbmFjbC5zZWNyZXRib3gub3BlbjsKICAgICAgICBuYWNsLmJveC5rZXlQYWlyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgcGsgPSBuZXcgVWludDhBcnJheShjcnlwdG9fYm94X1BVQkxJQ0tFWUJZVEVTKTsKICAgICAgICAgIHZhciBzayA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19ib3hfU0VDUkVUS0VZQllURVMpOwogICAgICAgICAgY3J5cHRvX2JveF9rZXlwYWlyKHBrLCBzayk7CiAgICAgICAgICByZXR1cm4geyBwdWJsaWNLZXk6IHBrLCBzZWNyZXRLZXk6IHNrIH07CiAgICAgICAgfTsKICAgICAgICBuYWNsLmJveC5rZXlQYWlyLmZyb21TZWNyZXRLZXkgPSBmdW5jdGlvbihzZWNyZXRLZXkpIHsKICAgICAgICAgIGNoZWNrQXJyYXlUeXBlcyhzZWNyZXRLZXkpOwogICAgICAgICAgaWYgKHNlY3JldEtleS5sZW5ndGggIT09IGNyeXB0b19ib3hfU0VDUkVUS0VZQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIHNlY3JldCBrZXkgc2l6ZSIpOwogICAgICAgICAgdmFyIHBrID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX2JveF9QVUJMSUNLRVlCWVRFUyk7CiAgICAgICAgICBjcnlwdG9fc2NhbGFybXVsdF9iYXNlKHBrLCBzZWNyZXRLZXkpOwogICAgICAgICAgcmV0dXJuIHsgcHVibGljS2V5OiBwaywgc2VjcmV0S2V5OiBuZXcgVWludDhBcnJheShzZWNyZXRLZXkpIH07CiAgICAgICAgfTsKICAgICAgICBuYWNsLmJveC5wdWJsaWNLZXlMZW5ndGggPSBjcnlwdG9fYm94X1BVQkxJQ0tFWUJZVEVTOwogICAgICAgIG5hY2wuYm94LnNlY3JldEtleUxlbmd0aCA9IGNyeXB0b19ib3hfU0VDUkVUS0VZQllURVM7CiAgICAgICAgbmFjbC5ib3guc2hhcmVkS2V5TGVuZ3RoID0gY3J5cHRvX2JveF9CRUZPUkVOTUJZVEVTOwogICAgICAgIG5hY2wuYm94Lm5vbmNlTGVuZ3RoID0gY3J5cHRvX2JveF9OT05DRUJZVEVTOwogICAgICAgIG5hY2wuYm94Lm92ZXJoZWFkTGVuZ3RoID0gbmFjbC5zZWNyZXRib3gub3ZlcmhlYWRMZW5ndGg7CiAgICAgICAgbmFjbC5zaWduID0gZnVuY3Rpb24obXNnLCBzZWNyZXRLZXkpIHsKICAgICAgICAgIGNoZWNrQXJyYXlUeXBlcyhtc2csIHNlY3JldEtleSk7CiAgICAgICAgICBpZiAoc2VjcmV0S2V5Lmxlbmd0aCAhPT0gY3J5cHRvX3NpZ25fU0VDUkVUS0VZQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIHNlY3JldCBrZXkgc2l6ZSIpOwogICAgICAgICAgdmFyIHNpZ25lZE1zZyA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19zaWduX0JZVEVTICsgbXNnLmxlbmd0aCk7CiAgICAgICAgICBjcnlwdG9fc2lnbihzaWduZWRNc2csIG1zZywgbXNnLmxlbmd0aCwgc2VjcmV0S2V5KTsKICAgICAgICAgIHJldHVybiBzaWduZWRNc2c7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNpZ24ub3BlbiA9IGZ1bmN0aW9uKHNpZ25lZE1zZywgcHVibGljS2V5KSB7CiAgICAgICAgICBjaGVja0FycmF5VHlwZXMoc2lnbmVkTXNnLCBwdWJsaWNLZXkpOwogICAgICAgICAgaWYgKHB1YmxpY0tleS5sZW5ndGggIT09IGNyeXB0b19zaWduX1BVQkxJQ0tFWUJZVEVTKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhZCBwdWJsaWMga2V5IHNpemUiKTsKICAgICAgICAgIHZhciB0bXAgPSBuZXcgVWludDhBcnJheShzaWduZWRNc2cubGVuZ3RoKTsKICAgICAgICAgIHZhciBtbGVuID0gY3J5cHRvX3NpZ25fb3Blbih0bXAsIHNpZ25lZE1zZywgc2lnbmVkTXNnLmxlbmd0aCwgcHVibGljS2V5KTsKICAgICAgICAgIGlmIChtbGVuIDwgMCkKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB2YXIgbSA9IG5ldyBVaW50OEFycmF5KG1sZW4pOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBtW2ldID0gdG1wW2ldOwogICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNpZ24uZGV0YWNoZWQgPSBmdW5jdGlvbihtc2csIHNlY3JldEtleSkgewogICAgICAgICAgdmFyIHNpZ25lZE1zZyA9IG5hY2wuc2lnbihtc2csIHNlY3JldEtleSk7CiAgICAgICAgICB2YXIgc2lnID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX3NpZ25fQllURVMpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWcubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHNpZ1tpXSA9IHNpZ25lZE1zZ1tpXTsKICAgICAgICAgIHJldHVybiBzaWc7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNpZ24uZGV0YWNoZWQudmVyaWZ5ID0gZnVuY3Rpb24obXNnLCBzaWcsIHB1YmxpY0tleSkgewogICAgICAgICAgY2hlY2tBcnJheVR5cGVzKG1zZywgc2lnLCBwdWJsaWNLZXkpOwogICAgICAgICAgaWYgKHNpZy5sZW5ndGggIT09IGNyeXB0b19zaWduX0JZVEVTKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhZCBzaWduYXR1cmUgc2l6ZSIpOwogICAgICAgICAgaWYgKHB1YmxpY0tleS5sZW5ndGggIT09IGNyeXB0b19zaWduX1BVQkxJQ0tFWUJZVEVTKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoImJhZCBwdWJsaWMga2V5IHNpemUiKTsKICAgICAgICAgIHZhciBzbSA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19zaWduX0JZVEVTICsgbXNnLmxlbmd0aCk7CiAgICAgICAgICB2YXIgbSA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19zaWduX0JZVEVTICsgbXNnLmxlbmd0aCk7CiAgICAgICAgICB2YXIgaTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjcnlwdG9fc2lnbl9CWVRFUzsgaSsrKQogICAgICAgICAgICBzbVtpXSA9IHNpZ1tpXTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBtc2cubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIHNtW2kgKyBjcnlwdG9fc2lnbl9CWVRFU10gPSBtc2dbaV07CiAgICAgICAgICByZXR1cm4gY3J5cHRvX3NpZ25fb3BlbihtLCBzbSwgc20ubGVuZ3RoLCBwdWJsaWNLZXkpID49IDA7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNpZ24ua2V5UGFpciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIHBrID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX3NpZ25fUFVCTElDS0VZQllURVMpOwogICAgICAgICAgdmFyIHNrID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX3NpZ25fU0VDUkVUS0VZQllURVMpOwogICAgICAgICAgY3J5cHRvX3NpZ25fa2V5cGFpcihwaywgc2spOwogICAgICAgICAgcmV0dXJuIHsgcHVibGljS2V5OiBwaywgc2VjcmV0S2V5OiBzayB9OwogICAgICAgIH07CiAgICAgICAgbmFjbC5zaWduLmtleVBhaXIuZnJvbVNlY3JldEtleSA9IGZ1bmN0aW9uKHNlY3JldEtleSkgewogICAgICAgICAgY2hlY2tBcnJheVR5cGVzKHNlY3JldEtleSk7CiAgICAgICAgICBpZiAoc2VjcmV0S2V5Lmxlbmd0aCAhPT0gY3J5cHRvX3NpZ25fU0VDUkVUS0VZQllURVMpCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiYmFkIHNlY3JldCBrZXkgc2l6ZSIpOwogICAgICAgICAgdmFyIHBrID0gbmV3IFVpbnQ4QXJyYXkoY3J5cHRvX3NpZ25fUFVCTElDS0VZQllURVMpOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBway5sZW5ndGg7IGkrKykKICAgICAgICAgICAgcGtbaV0gPSBzZWNyZXRLZXlbMzIgKyBpXTsKICAgICAgICAgIHJldHVybiB7IHB1YmxpY0tleTogcGssIHNlY3JldEtleTogbmV3IFVpbnQ4QXJyYXkoc2VjcmV0S2V5KSB9OwogICAgICAgIH07CiAgICAgICAgbmFjbC5zaWduLmtleVBhaXIuZnJvbVNlZWQgPSBmdW5jdGlvbihzZWVkKSB7CiAgICAgICAgICBjaGVja0FycmF5VHlwZXMoc2VlZCk7CiAgICAgICAgICBpZiAoc2VlZC5sZW5ndGggIT09IGNyeXB0b19zaWduX1NFRURCWVRFUykKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJiYWQgc2VlZCBzaXplIik7CiAgICAgICAgICB2YXIgcGsgPSBuZXcgVWludDhBcnJheShjcnlwdG9fc2lnbl9QVUJMSUNLRVlCWVRFUyk7CiAgICAgICAgICB2YXIgc2sgPSBuZXcgVWludDhBcnJheShjcnlwdG9fc2lnbl9TRUNSRVRLRVlCWVRFUyk7CiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDMyOyBpKyspCiAgICAgICAgICAgIHNrW2ldID0gc2VlZFtpXTsKICAgICAgICAgIGNyeXB0b19zaWduX2tleXBhaXIocGssIHNrLCB0cnVlKTsKICAgICAgICAgIHJldHVybiB7IHB1YmxpY0tleTogcGssIHNlY3JldEtleTogc2sgfTsKICAgICAgICB9OwogICAgICAgIG5hY2wuc2lnbi5wdWJsaWNLZXlMZW5ndGggPSBjcnlwdG9fc2lnbl9QVUJMSUNLRVlCWVRFUzsKICAgICAgICBuYWNsLnNpZ24uc2VjcmV0S2V5TGVuZ3RoID0gY3J5cHRvX3NpZ25fU0VDUkVUS0VZQllURVM7CiAgICAgICAgbmFjbC5zaWduLnNlZWRMZW5ndGggPSBjcnlwdG9fc2lnbl9TRUVEQllURVM7CiAgICAgICAgbmFjbC5zaWduLnNpZ25hdHVyZUxlbmd0aCA9IGNyeXB0b19zaWduX0JZVEVTOwogICAgICAgIG5hY2wuaGFzaCA9IGZ1bmN0aW9uKG1zZykgewogICAgICAgICAgY2hlY2tBcnJheVR5cGVzKG1zZyk7CiAgICAgICAgICB2YXIgaCA9IG5ldyBVaW50OEFycmF5KGNyeXB0b19oYXNoX0JZVEVTKTsKICAgICAgICAgIGNyeXB0b19oYXNoKGgsIG1zZywgbXNnLmxlbmd0aCk7CiAgICAgICAgICByZXR1cm4gaDsKICAgICAgICB9OwogICAgICAgIG5hY2wuaGFzaC5oYXNoTGVuZ3RoID0gY3J5cHRvX2hhc2hfQllURVM7CiAgICAgICAgbmFjbC52ZXJpZnkgPSBmdW5jdGlvbih4LCB5KSB7CiAgICAgICAgICBjaGVja0FycmF5VHlwZXMoeCwgeSk7CiAgICAgICAgICBpZiAoeC5sZW5ndGggPT09IDAgfHwgeS5sZW5ndGggPT09IDApCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIGlmICh4Lmxlbmd0aCAhPT0geS5sZW5ndGgpCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIHJldHVybiB2bih4LCAwLCB5LCAwLCB4Lmxlbmd0aCkgPT09IDAgPyB0cnVlIDogZmFsc2U7CiAgICAgICAgfTsKICAgICAgICBuYWNsLnNldFBSTkcgPSBmdW5jdGlvbihmbikgewogICAgICAgICAgcmFuZG9tYnl0ZXMgPSBmbjsKICAgICAgICB9OwogICAgICAgIGNvbnN0IF9mID0gKCkgPT4gewogICAgICAgICAgdmFyIGNyeXB0byA9IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA_IHNlbGYuY3J5cHRvIHx8IHNlbGYubXNDcnlwdG8gOiBudWxsOwogICAgICAgICAgaWYgKGNyeXB0byAmJiBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKSB7CiAgICAgICAgICAgIHZhciBRVU9UQSA9IDY1NTM2OwogICAgICAgICAgICBuYWNsLnNldFBSTkcoZnVuY3Rpb24oeCwgbikgewogICAgICAgICAgICAgIHZhciBpLCB2ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkgKz0gUVVPVEEpIHsKICAgICAgICAgICAgICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXModi5zdWJhcnJheShpLCBpICsgTWF0aC5taW4obiAtIGksIFFVT1RBKSkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKQogICAgICAgICAgICAgICAgeFtpXSA9IHZbaV07CiAgICAgICAgICAgICAgY2xlYW51cCh2KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBfX3JlcXVpcmUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgIGlmIChjcnlwdG8gJiYgY3J5cHRvLnJhbmRvbUJ5dGVzKSB7CiAgICAgICAgICAgICAgbmFjbC5zZXRQUk5HKGZ1bmN0aW9uKHgsIG4pIHsKICAgICAgICAgICAgICAgIHZhciBpLCB2ID0gY3J5cHRvLnJhbmRvbUJ5dGVzKG4pOwogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykKICAgICAgICAgICAgICAgICAgeFtpXSA9IHZbaV07CiAgICAgICAgICAgICAgICBjbGVhbnVwKHYpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBfZigpOwogICAgICB9KSgKICAgICAgICB0eXBlb2YgbW9kdWxlICE9PSAidW5kZWZpbmVkIiAmJiBtb2R1bGUuZXhwb3J0cyA_IG1vZHVsZS5leHBvcnRzIDogc2VsZi5uYWNsID0gc2VsZi5uYWNsIHx8IHt9CiAgICAgICk7CiAgICB9CiAgfSk7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9faXNQbGFjZWhvbGRlci5qcwogIGZ1bmN0aW9uIF9pc1BsYWNlaG9sZGVyKGEpIHsKICAgIHJldHVybiBhICE9IG51bGwgJiYgdHlwZW9mIGEgPT09ICJvYmplY3QiICYmIGFbIkBAZnVuY3Rpb25hbC9wbGFjZWhvbGRlciJdID09PSB0cnVlOwogIH0KCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2ludGVybmFsL19jdXJyeTEuanMKICBmdW5jdGlvbiBfY3VycnkxKGZuKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gZjEoYSkgewogICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCB8fCBfaXNQbGFjZWhvbGRlcihhKSkgewogICAgICAgIHJldHVybiBmMTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9fY3VycnkyLmpzCiAgZnVuY3Rpb24gX2N1cnJ5MihmbikgewogICAgcmV0dXJuIGZ1bmN0aW9uIGYyKGEsIGIpIHsKICAgICAgc3dpdGNoIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmV0dXJuIGYyOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJldHVybiBfaXNQbGFjZWhvbGRlcihhKSA_IGYyIDogX2N1cnJ5MShmdW5jdGlvbihfYikgewogICAgICAgICAgICByZXR1cm4gZm4oYSwgX2IpOwogICAgICAgICAgfSk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJldHVybiBfaXNQbGFjZWhvbGRlcihhKSAmJiBfaXNQbGFjZWhvbGRlcihiKSA_IGYyIDogX2lzUGxhY2Vob2xkZXIoYSkgPyBfY3VycnkxKGZ1bmN0aW9uKF9hKSB7CiAgICAgICAgICAgIHJldHVybiBmbihfYSwgYik7CiAgICAgICAgICB9KSA6IF9pc1BsYWNlaG9sZGVyKGIpID8gX2N1cnJ5MShmdW5jdGlvbihfYikgewogICAgICAgICAgICByZXR1cm4gZm4oYSwgX2IpOwogICAgICAgICAgfSkgOiBmbihhLCBiKTsKICAgICAgfQogICAgfTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9faXNBcnJheS5qcwogIHZhciBpc0FycmF5X2RlZmF1bHQgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIF9pc0FycmF5KHZhbCkgewogICAgcmV0dXJuIHZhbCAhPSBudWxsICYmIHZhbC5sZW5ndGggPj0gMCAmJiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKSA9PT0gIltvYmplY3QgQXJyYXldIjsKICB9OwoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvaW50ZXJuYWwvX2hhcy5qcwogIGZ1bmN0aW9uIF9oYXMocHJvcCwgb2JqKSB7CiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7CiAgfQoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvaW50ZXJuYWwvX2lzQXJndW1lbnRzLmpzCiAgdmFyIHRvU3RyaW5nID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZzsKICB2YXIgX2lzQXJndW1lbnRzID0gLyogQF9fUFVSRV9fICovIGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoYXJndW1lbnRzKSA9PT0gIltvYmplY3QgQXJndW1lbnRzXSIgPyBmdW5jdGlvbiBfaXNBcmd1bWVudHMyKHgpIHsKICAgICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwoeCkgPT09ICJbb2JqZWN0IEFyZ3VtZW50c10iOwogICAgfSA6IGZ1bmN0aW9uIF9pc0FyZ3VtZW50czIoeCkgewogICAgICByZXR1cm4gX2hhcygiY2FsbGVlIiwgeCk7CiAgICB9OwogIH0oKTsKICB2YXIgaXNBcmd1bWVudHNfZGVmYXVsdCA9IF9pc0FyZ3VtZW50czsKCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2tleXMuanMKICB2YXIgaGFzRW51bUJ1ZyA9ICEvKiBAX19QVVJFX18gKi8gewogICAgdG9TdHJpbmc6IG51bGwKICB9LnByb3BlcnR5SXNFbnVtZXJhYmxlKCJ0b1N0cmluZyIpOwogIHZhciBub25FbnVtZXJhYmxlUHJvcHMgPSBbImNvbnN0cnVjdG9yIiwgInZhbHVlT2YiLCAiaXNQcm90b3R5cGVPZiIsICJ0b1N0cmluZyIsICJwcm9wZXJ0eUlzRW51bWVyYWJsZSIsICJoYXNPd25Qcm9wZXJ0eSIsICJ0b0xvY2FsZVN0cmluZyJdOwogIHZhciBoYXNBcmdzRW51bUJ1ZyA9IC8qIEBfX1BVUkVfXyAqLyBmdW5jdGlvbigpIHsKICAgICJ1c2Ugc3RyaWN0IjsKICAgIHJldHVybiBhcmd1bWVudHMucHJvcGVydHlJc0VudW1lcmFibGUoImxlbmd0aCIpOwogIH0oKTsKICB2YXIgY29udGFpbnMgPSBmdW5jdGlvbiBjb250YWluczIobGlzdCwgaXRlbSkgewogICAgdmFyIGlkeCA9IDA7CiAgICB3aGlsZSAoaWR4IDwgbGlzdC5sZW5ndGgpIHsKICAgICAgaWYgKGxpc3RbaWR4XSA9PT0gaXRlbSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGlkeCArPSAxOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH07CiAgdmFyIGtleXMgPSB0eXBlb2YgT2JqZWN0LmtleXMgPT09ICJmdW5jdGlvbiIgJiYgIWhhc0FyZ3NFbnVtQnVnID8gLyogQF9fUFVSRV9fICovIF9jdXJyeTEoZnVuY3Rpb24ga2V5czIob2JqKSB7CiAgICByZXR1cm4gT2JqZWN0KG9iaikgIT09IG9iaiA_IFtdIDogT2JqZWN0LmtleXMob2JqKTsKICB9KSA6IC8qIEBfX1BVUkVfXyAqLyBfY3VycnkxKGZ1bmN0aW9uIGtleXMzKG9iaikgewogICAgaWYgKE9iamVjdChvYmopICE9PSBvYmopIHsKICAgICAgcmV0dXJuIFtdOwogICAgfQogICAgdmFyIHByb3AsIG5JZHg7CiAgICB2YXIga3MgPSBbXTsKICAgIHZhciBjaGVja0FyZ3NMZW5ndGggPSBoYXNBcmdzRW51bUJ1ZyAmJiBpc0FyZ3VtZW50c19kZWZhdWx0KG9iaik7CiAgICBmb3IgKHByb3AgaW4gb2JqKSB7CiAgICAgIGlmIChfaGFzKHByb3AsIG9iaikgJiYgKCFjaGVja0FyZ3NMZW5ndGggfHwgcHJvcCAhPT0gImxlbmd0aCIpKSB7CiAgICAgICAga3Nba3MubGVuZ3RoXSA9IHByb3A7CiAgICAgIH0KICAgIH0KICAgIGlmIChoYXNFbnVtQnVnKSB7CiAgICAgIG5JZHggPSBub25FbnVtZXJhYmxlUHJvcHMubGVuZ3RoIC0gMTsKICAgICAgd2hpbGUgKG5JZHggPj0gMCkgewogICAgICAgIHByb3AgPSBub25FbnVtZXJhYmxlUHJvcHNbbklkeF07CiAgICAgICAgaWYgKF9oYXMocHJvcCwgb2JqKSAmJiAhY29udGFpbnMoa3MsIHByb3ApKSB7CiAgICAgICAgICBrc1trcy5sZW5ndGhdID0gcHJvcDsKICAgICAgICB9CiAgICAgICAgbklkeCAtPSAxOwogICAgICB9CiAgICB9CiAgICByZXR1cm4ga3M7CiAgfSk7CiAgdmFyIGtleXNfZGVmYXVsdCA9IGtleXM7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9faXNJbnRlZ2VyLmpzCiAgdmFyIGlzSW50ZWdlcl9kZWZhdWx0ID0gTnVtYmVyLmlzSW50ZWdlciB8fCBmdW5jdGlvbiBfaXNJbnRlZ2VyKG4pIHsKICAgIHJldHVybiBuIDw8IDAgPT09IG47CiAgfTsKCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2lzTmlsLmpzCiAgdmFyIGlzTmlsID0gLyogQF9fUFVSRV9fICovIF9jdXJyeTEoZnVuY3Rpb24gaXNOaWwyKHgpIHsKICAgIHJldHVybiB4ID09IG51bGw7CiAgfSk7CiAgdmFyIGlzTmlsX2RlZmF1bHQgPSBpc05pbDsKCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL3R5cGUuanMKICB2YXIgdHlwZSA9IC8qIEBfX1BVUkVfXyAqLyBfY3VycnkxKGZ1bmN0aW9uIHR5cGUyKHZhbCkgewogICAgcmV0dXJuIHZhbCA9PT0gbnVsbCA_ICJOdWxsIiA6IHZhbCA9PT0gdm9pZCAwID8gIlVuZGVmaW5lZCIgOiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsKS5zbGljZSg4LCAtMSk7CiAgfSk7CiAgdmFyIHR5cGVfZGVmYXVsdCA9IHR5cGU7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9fYXJyYXlGcm9tSXRlcmF0b3IuanMKICBmdW5jdGlvbiBfYXJyYXlGcm9tSXRlcmF0b3IoaXRlcikgewogICAgdmFyIGxpc3QgPSBbXTsKICAgIHZhciBuZXh0OwogICAgd2hpbGUgKCEobmV4dCA9IGl0ZXIubmV4dCgpKS5kb25lKSB7CiAgICAgIGxpc3QucHVzaChuZXh0LnZhbHVlKTsKICAgIH0KICAgIHJldHVybiBsaXN0OwogIH0KCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2ludGVybmFsL19pbmNsdWRlc1dpdGguanMKICBmdW5jdGlvbiBfaW5jbHVkZXNXaXRoKHByZWQsIHgsIGxpc3QpIHsKICAgIHZhciBpZHggPSAwOwogICAgdmFyIGxlbiA9IGxpc3QubGVuZ3RoOwogICAgd2hpbGUgKGlkeCA8IGxlbikgewogICAgICBpZiAocHJlZCh4LCBsaXN0W2lkeF0pKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWR4ICs9IDE7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvaW50ZXJuYWwvX2Z1bmN0aW9uTmFtZS5qcwogIGZ1bmN0aW9uIF9mdW5jdGlvbk5hbWUoZikgewogICAgdmFyIG1hdGNoID0gU3RyaW5nKGYpLm1hdGNoKC9eZnVuY3Rpb24gKFx3KikvKTsKICAgIHJldHVybiBtYXRjaCA9PSBudWxsID8gIiIgOiBtYXRjaFsxXTsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9fb2JqZWN0SXMuanMKICBmdW5jdGlvbiBfb2JqZWN0SXMoYSwgYikgewogICAgaWYgKGEgPT09IGIpIHsKICAgICAgcmV0dXJuIGEgIT09IDAgfHwgMSAvIGEgPT09IDEgLyBiOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGEgIT09IGEgJiYgYiAhPT0gYjsKICAgIH0KICB9CiAgdmFyIG9iamVjdElzX2RlZmF1bHQgPSB0eXBlb2YgT2JqZWN0LmlzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmlzIDogX29iamVjdElzOwoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvaW50ZXJuYWwvX2VxdWFscy5qcwogIGZ1bmN0aW9uIF91bmlxQ29udGVudEVxdWFscyhhSXRlcmF0b3IsIGJJdGVyYXRvciwgc3RhY2tBLCBzdGFja0IpIHsKICAgIHZhciBhID0gX2FycmF5RnJvbUl0ZXJhdG9yKGFJdGVyYXRvcik7CiAgICB2YXIgYiA9IF9hcnJheUZyb21JdGVyYXRvcihiSXRlcmF0b3IpOwogICAgZnVuY3Rpb24gZXEoX2EsIF9iKSB7CiAgICAgIHJldHVybiBfZXF1YWxzKF9hLCBfYiwgc3RhY2tBLnNsaWNlKCksIHN0YWNrQi5zbGljZSgpKTsKICAgIH0KICAgIHJldHVybiAhX2luY2x1ZGVzV2l0aChmdW5jdGlvbihiMiwgYUl0ZW0pIHsKICAgICAgcmV0dXJuICFfaW5jbHVkZXNXaXRoKGVxLCBhSXRlbSwgYjIpOwogICAgfSwgYiwgYSk7CiAgfQogIGZ1bmN0aW9uIF9lcXVhbHMoYSwgYiwgc3RhY2tBLCBzdGFja0IpIHsKICAgIGlmIChvYmplY3RJc19kZWZhdWx0KGEsIGIpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdmFyIHR5cGVBID0gdHlwZV9kZWZhdWx0KGEpOwogICAgaWYgKHR5cGVBICE9PSB0eXBlX2RlZmF1bHQoYikpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHR5cGVvZiBhWyJmYW50YXN5LWxhbmQvZXF1YWxzIl0gPT09ICJmdW5jdGlvbiIgfHwgdHlwZW9mIGJbImZhbnRhc3ktbGFuZC9lcXVhbHMiXSA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gdHlwZW9mIGFbImZhbnRhc3ktbGFuZC9lcXVhbHMiXSA9PT0gImZ1bmN0aW9uIiAmJiBhWyJmYW50YXN5LWxhbmQvZXF1YWxzIl0oYikgJiYgdHlwZW9mIGJbImZhbnRhc3ktbGFuZC9lcXVhbHMiXSA9PT0gImZ1bmN0aW9uIiAmJiBiWyJmYW50YXN5LWxhbmQvZXF1YWxzIl0oYSk7CiAgICB9CiAgICBpZiAodHlwZW9mIGEuZXF1YWxzID09PSAiZnVuY3Rpb24iIHx8IHR5cGVvZiBiLmVxdWFscyA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gdHlwZW9mIGEuZXF1YWxzID09PSAiZnVuY3Rpb24iICYmIGEuZXF1YWxzKGIpICYmIHR5cGVvZiBiLmVxdWFscyA9PT0gImZ1bmN0aW9uIiAmJiBiLmVxdWFscyhhKTsKICAgIH0KICAgIHN3aXRjaCAodHlwZUEpIHsKICAgICAgY2FzZSAiQXJndW1lbnRzIjoKICAgICAgY2FzZSAiQXJyYXkiOgogICAgICBjYXNlICJPYmplY3QiOgogICAgICAgIGlmICh0eXBlb2YgYS5jb25zdHJ1Y3RvciA9PT0gImZ1bmN0aW9uIiAmJiBfZnVuY3Rpb25OYW1lKGEuY29uc3RydWN0b3IpID09PSAiUHJvbWlzZSIpIHsKICAgICAgICAgIHJldHVybiBhID09PSBiOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAiQm9vbGVhbiI6CiAgICAgIGNhc2UgIk51bWJlciI6CiAgICAgIGNhc2UgIlN0cmluZyI6CiAgICAgICAgaWYgKCEodHlwZW9mIGEgPT09IHR5cGVvZiBiICYmIG9iamVjdElzX2RlZmF1bHQoYS52YWx1ZU9mKCksIGIudmFsdWVPZigpKSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkRhdGUiOgogICAgICAgIGlmICghb2JqZWN0SXNfZGVmYXVsdChhLnZhbHVlT2YoKSwgYi52YWx1ZU9mKCkpKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJFcnJvciI6CiAgICAgICAgcmV0dXJuIGEubmFtZSA9PT0gYi5uYW1lICYmIGEubWVzc2FnZSA9PT0gYi5tZXNzYWdlOwogICAgICBjYXNlICJSZWdFeHAiOgogICAgICAgIGlmICghKGEuc291cmNlID09PSBiLnNvdXJjZSAmJiBhLmdsb2JhbCA9PT0gYi5nbG9iYWwgJiYgYS5pZ25vcmVDYXNlID09PSBiLmlnbm9yZUNhc2UgJiYgYS5tdWx0aWxpbmUgPT09IGIubXVsdGlsaW5lICYmIGEuc3RpY2t5ID09PSBiLnN0aWNreSAmJiBhLnVuaWNvZGUgPT09IGIudW5pY29kZSkpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICB2YXIgaWR4ID0gc3RhY2tBLmxlbmd0aCAtIDE7CiAgICB3aGlsZSAoaWR4ID49IDApIHsKICAgICAgaWYgKHN0YWNrQVtpZHhdID09PSBhKSB7CiAgICAgICAgcmV0dXJuIHN0YWNrQltpZHhdID09PSBiOwogICAgICB9CiAgICAgIGlkeCAtPSAxOwogICAgfQogICAgc3dpdGNoICh0eXBlQSkgewogICAgICBjYXNlICJNYXAiOgogICAgICAgIGlmIChhLnNpemUgIT09IGIuc2l6ZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3VuaXFDb250ZW50RXF1YWxzKGEuZW50cmllcygpLCBiLmVudHJpZXMoKSwgc3RhY2tBLmNvbmNhdChbYV0pLCBzdGFja0IuY29uY2F0KFtiXSkpOwogICAgICBjYXNlICJTZXQiOgogICAgICAgIGlmIChhLnNpemUgIT09IGIuc2l6ZSkgewogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3VuaXFDb250ZW50RXF1YWxzKGEudmFsdWVzKCksIGIudmFsdWVzKCksIHN0YWNrQS5jb25jYXQoW2FdKSwgc3RhY2tCLmNvbmNhdChbYl0pKTsKICAgICAgY2FzZSAiQXJndW1lbnRzIjoKICAgICAgY2FzZSAiQXJyYXkiOgogICAgICBjYXNlICJPYmplY3QiOgogICAgICBjYXNlICJCb29sZWFuIjoKICAgICAgY2FzZSAiTnVtYmVyIjoKICAgICAgY2FzZSAiU3RyaW5nIjoKICAgICAgY2FzZSAiRGF0ZSI6CiAgICAgIGNhc2UgIkVycm9yIjoKICAgICAgY2FzZSAiUmVnRXhwIjoKICAgICAgY2FzZSAiSW50OEFycmF5IjoKICAgICAgY2FzZSAiVWludDhBcnJheSI6CiAgICAgIGNhc2UgIlVpbnQ4Q2xhbXBlZEFycmF5IjoKICAgICAgY2FzZSAiSW50MTZBcnJheSI6CiAgICAgIGNhc2UgIlVpbnQxNkFycmF5IjoKICAgICAgY2FzZSAiSW50MzJBcnJheSI6CiAgICAgIGNhc2UgIlVpbnQzMkFycmF5IjoKICAgICAgY2FzZSAiRmxvYXQzMkFycmF5IjoKICAgICAgY2FzZSAiRmxvYXQ2NEFycmF5IjoKICAgICAgY2FzZSAiQXJyYXlCdWZmZXIiOgogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHZhciBrZXlzQSA9IGtleXNfZGVmYXVsdChhKTsKICAgIGlmIChrZXlzQS5sZW5ndGggIT09IGtleXNfZGVmYXVsdChiKS5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdmFyIGV4dGVuZGVkU3RhY2tBID0gc3RhY2tBLmNvbmNhdChbYV0pOwogICAgdmFyIGV4dGVuZGVkU3RhY2tCID0gc3RhY2tCLmNvbmNhdChbYl0pOwogICAgaWR4ID0ga2V5c0EubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChpZHggPj0gMCkgewogICAgICB2YXIga2V5ID0ga2V5c0FbaWR4XTsKICAgICAgaWYgKCEoX2hhcyhrZXksIGIpICYmIF9lcXVhbHMoYltrZXldLCBhW2tleV0sIGV4dGVuZGVkU3RhY2tBLCBleHRlbmRlZFN0YWNrQikpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlkeCAtPSAxOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvZXF1YWxzLmpzCiAgdmFyIGVxdWFscyA9IC8qIEBfX1BVUkVfXyAqLyBfY3VycnkyKGZ1bmN0aW9uIGVxdWFsczIoYSwgYikgewogICAgcmV0dXJuIF9lcXVhbHMoYSwgYiwgW10sIFtdKTsKICB9KTsKICB2YXIgZXF1YWxzX2RlZmF1bHQgPSBlcXVhbHM7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9faW5kZXhPZi5qcwogIGZ1bmN0aW9uIF9pbmRleE9mKGxpc3QsIGEsIGlkeCkgewogICAgdmFyIGluZiwgaXRlbTsKICAgIGlmICh0eXBlb2YgbGlzdC5pbmRleE9mID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHN3aXRjaCAodHlwZW9mIGEpIHsKICAgICAgICBjYXNlICJudW1iZXIiOgogICAgICAgICAgaWYgKGEgPT09IDApIHsKICAgICAgICAgICAgaW5mID0gMSAvIGE7CiAgICAgICAgICAgIHdoaWxlIChpZHggPCBsaXN0Lmxlbmd0aCkgewogICAgICAgICAgICAgIGl0ZW0gPSBsaXN0W2lkeF07CiAgICAgICAgICAgICAgaWYgKGl0ZW0gPT09IDAgJiYgMSAvIGl0ZW0gPT09IGluZikgewogICAgICAgICAgICAgICAgcmV0dXJuIGlkeDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWR4ICs9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAgfSBlbHNlIGlmIChhICE9PSBhKSB7CiAgICAgICAgICAgIHdoaWxlIChpZHggPCBsaXN0Lmxlbmd0aCkgewogICAgICAgICAgICAgIGl0ZW0gPSBsaXN0W2lkeF07CiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAibnVtYmVyIiAmJiBpdGVtICE9PSBpdGVtKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaWR4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZHggKz0gMTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbGlzdC5pbmRleE9mKGEsIGlkeCk7CiAgICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICBjYXNlICJmdW5jdGlvbiI6CiAgICAgICAgY2FzZSAidW5kZWZpbmVkIjoKICAgICAgICAgIHJldHVybiBsaXN0LmluZGV4T2YoYSwgaWR4KTsKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgaWYgKGEgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGxpc3QuaW5kZXhPZihhLCBpZHgpOwogICAgICAgICAgfQogICAgICB9CiAgICB9CiAgICB3aGlsZSAoaWR4IDwgbGlzdC5sZW5ndGgpIHsKICAgICAgaWYgKGVxdWFsc19kZWZhdWx0KGxpc3RbaWR4XSwgYSkpIHsKICAgICAgICByZXR1cm4gaWR4OwogICAgICB9CiAgICAgIGlkeCArPSAxOwogICAgfQogICAgcmV0dXJuIC0xOwogIH0KCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2ludGVybmFsL19pbmNsdWRlcy5qcwogIGZ1bmN0aW9uIF9pbmNsdWRlcyhhLCBsaXN0KSB7CiAgICByZXR1cm4gX2luZGV4T2YobGlzdCwgYSwgMCkgPj0gMDsKICB9CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbnRlcm5hbC9fdG9JU09TdHJpbmcuanMKICB2YXIgcGFkID0gZnVuY3Rpb24gcGFkMihuKSB7CiAgICByZXR1cm4gKG4gPCAxMCA_ICIwIiA6ICIiKSArIG47CiAgfTsKICB2YXIgX3RvSVNPU3RyaW5nID0gdHlwZW9mIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nID09PSAiZnVuY3Rpb24iID8gZnVuY3Rpb24gX3RvSVNPU3RyaW5nMihkKSB7CiAgICByZXR1cm4gZC50b0lTT1N0cmluZygpOwogIH0gOiBmdW5jdGlvbiBfdG9JU09TdHJpbmczKGQpIHsKICAgIHJldHVybiBkLmdldFVUQ0Z1bGxZZWFyKCkgKyAiLSIgKyBwYWQoZC5nZXRVVENNb250aCgpICsgMSkgKyAiLSIgKyBwYWQoZC5nZXRVVENEYXRlKCkpICsgIlQiICsgcGFkKGQuZ2V0VVRDSG91cnMoKSkgKyAiOiIgKyBwYWQoZC5nZXRVVENNaW51dGVzKCkpICsgIjoiICsgcGFkKGQuZ2V0VVRDU2Vjb25kcygpKSArICIuIiArIChkLmdldFVUQ01pbGxpc2Vjb25kcygpIC8gMWUzKS50b0ZpeGVkKDMpLnNsaWNlKDIsIDUpICsgIloiOwogIH07CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9pbmNsdWRlcy5qcwogIHZhciBpbmNsdWRlcyA9IC8qIEBfX1BVUkVfXyAqLyBfY3VycnkyKF9pbmNsdWRlcyk7CiAgdmFyIGluY2x1ZGVzX2RlZmF1bHQgPSBpbmNsdWRlczsKCiAgLy8gbm9kZV9tb2R1bGVzL3JhbWRhL2VzL2lzLmpzCiAgdmFyIGlzID0gLyogQF9fUFVSRV9fICovIF9jdXJyeTIoZnVuY3Rpb24gaXMyKEN0b3IsIHZhbCkgewogICAgcmV0dXJuIHZhbCBpbnN0YW5jZW9mIEN0b3IgfHwgdmFsICE9IG51bGwgJiYgKHZhbC5jb25zdHJ1Y3RvciA9PT0gQ3RvciB8fCBDdG9yLm5hbWUgPT09ICJPYmplY3QiICYmIHR5cGVvZiB2YWwgPT09ICJvYmplY3QiKTsKICB9KTsKICB2YXIgaXNfZGVmYXVsdCA9IGlzOwoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvaW50ZXJuYWwvX29mLmpzCiAgZnVuY3Rpb24gX29mKHgpIHsKICAgIHJldHVybiBbeF07CiAgfQoKICAvLyBub2RlX21vZHVsZXMvcmFtZGEvZXMvb2YuanMKICB2YXIgb2YgPSAvKiBAX19QVVJFX18gKi8gX2N1cnJ5MShfb2YpOwogIHZhciBvZl9kZWZhdWx0ID0gb2Y7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy9waWNrQWxsLmpzCiAgdmFyIHBpY2tBbGwgPSAvKiBAX19QVVJFX18gKi8gX2N1cnJ5MihmdW5jdGlvbiBwaWNrQWxsMihuYW1lcywgb2JqKSB7CiAgICB2YXIgcmVzdWx0ID0ge307CiAgICB2YXIgaWR4ID0gMDsKICAgIHZhciBsZW4gPSBuYW1lcy5sZW5ndGg7CiAgICB3aGlsZSAoaWR4IDwgbGVuKSB7CiAgICAgIHZhciBuYW1lID0gbmFtZXNbaWR4XTsKICAgICAgcmVzdWx0W25hbWVdID0gb2JqW25hbWVdOwogICAgICBpZHggKz0gMTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfSk7CiAgdmFyIHBpY2tBbGxfZGVmYXVsdCA9IHBpY2tBbGw7CgogIC8vIG5vZGVfbW9kdWxlcy9yYW1kYS9lcy90cmltLmpzCiAgdmFyIGhhc1Byb3RvVHJpbSA9IHR5cGVvZiBTdHJpbmcucHJvdG90eXBlLnRyaW0gPT09ICJmdW5jdGlvbiI7CgogIC8vIHNyYy9jb21tb24vbGliL3V0aWxzLmpzCiAgdmFyIGltcG9ydF9qc29uX2xvZ2ljX2pzID0gX190b0VTTShyZXF1aXJlX2xvZ2ljKCkpOwogIHZhciBpbXBvcnRfanNvbnNjaGVtYSA9IF9fdG9FU00ocmVxdWlyZV9qc29uc2NoZW1hKCkpOwogIHZhciBlcnIgPSAobXNnID0gYFRoZSB3cm9uZyBxdWVyeWAsIGNvbnRyYWN0RXJyID0gZmFsc2UpID0-IHsKICAgIGlmIChjb250cmFjdEVycikgewogICAgICBjb25zdCBlcnJvciA9IHR5cGVvZiBDb250cmFjdEVycm9yID09PSAidW5kZWZpbmVkIiA_IEVycm9yIDogQ29udHJhY3RFcnJvcjsKICAgICAgdGhyb3cgbmV3IGVycm9yKG1zZyk7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBtc2c7CiAgICB9CiAgfTsKICB2YXIgcmVhZCA9IGFzeW5jIChjb250cmFjdCwgcGFyYW0pID0-IHsKICAgIHJldHVybiAoYXdhaXQgU21hcnRXZWF2ZS5jb250cmFjdHMudmlld0NvbnRyYWN0U3RhdGUoY29udHJhY3QsIHBhcmFtKSkucmVzdWx0OwogIH07CgogIC8vIHNyYy9pbnRlcm5ldC1pZGVudGl0eS9hY3Rpb25zL3JlYWQvdmVyaWZ5SW50ZXJuZXRJZGVudGl0eS5qcwogIHZhciBpbXBvcnRfdHdlZXRuYWNsID0gX190b0VTTShyZXF1aXJlX3R3ZWV0bmFjbCgpKTsKICB2YXIgZGVjb2RlTGVuID0gKGJ1Ziwgb2Zmc2V0KSA9PiB7CiAgICBjb25zdCBsZW5CeXRlcyA9IGRlY29kZUxlbkJ5dGVzKGJ1Ziwgb2Zmc2V0KTsKICAgIGlmIChsZW5CeXRlcyA9PT0gMSkKICAgICAgcmV0dXJuIGJ1ZltvZmZzZXRdOwogICAgZWxzZSBpZiAobGVuQnl0ZXMgPT09IDIpCiAgICAgIHJldHVybiBidWZbb2Zmc2V0ICsgMV07CiAgICBlbHNlIGlmIChsZW5CeXRlcyA9PT0gMykKICAgICAgcmV0dXJuIChidWZbb2Zmc2V0ICsgMV0gPDwgOCkgKyBidWZbb2Zmc2V0ICsgMl07CiAgICBlbHNlIGlmIChsZW5CeXRlcyA9PT0gNCkKICAgICAgcmV0dXJuIChidWZbb2Zmc2V0ICsgMV0gPDwgMTYpICsgKGJ1ZltvZmZzZXQgKyAyXSA8PCA4KSArIGJ1ZltvZmZzZXQgKyAzXTsKICAgIHRocm93IG5ldyBFcnJvcigiTGVuZ3RoIHRvbyBsb25nICg-IDQgYnl0ZXMpIik7CiAgfTsKICB2YXIgYnVmRXF1YWxzID0gKGIxLCBiMikgPT4gewogICAgaWYgKGIxLmJ5dGVMZW5ndGggIT09IGIyLmJ5dGVMZW5ndGgpCiAgICAgIHJldHVybiBmYWxzZTsKICAgIGNvbnN0IHUxID0gbmV3IFVpbnQ4QXJyYXkoYjEpOwogICAgY29uc3QgdTIgPSBuZXcgVWludDhBcnJheShiMik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHUxLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmICh1MVtpXSAhPT0gdTJbaV0pCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKICB2YXIgZGVjb2RlTGVuQnl0ZXMgPSAoYnVmLCBvZmZzZXQpID0-IHsKICAgIGlmIChidWZbb2Zmc2V0XSA8IDEyOCkKICAgICAgcmV0dXJuIDE7CiAgICBpZiAoYnVmW29mZnNldF0gPT09IDEyOCkKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGxlbmd0aCAwIik7CiAgICBpZiAoYnVmW29mZnNldF0gPT09IDEyOSkKICAgICAgcmV0dXJuIDI7CiAgICBpZiAoYnVmW29mZnNldF0gPT09IDEzMCkKICAgICAgcmV0dXJuIDM7CiAgICBpZiAoYnVmW29mZnNldF0gPT09IDEzMSkKICAgICAgcmV0dXJuIDQ7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkxlbmd0aCB0b28gbG9uZyAoPiA0IGJ5dGVzKSIpOwogIH07CiAgdmFyIHVud3JhcERFUiA9IChkZXJFbmNvZGVkLCBvaWQpID0-IHsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgY29uc3QgZXhwZWN0ID0gKG4sIG1zZykgPT4gewogICAgICBpZiAoYnVmW29mZnNldCsrXSAhPT0gbikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiRXhwZWN0ZWQ6ICIgKyBtc2cpOwogICAgICB9CiAgICB9OwogICAgY29uc3QgYnVmID0gbmV3IFVpbnQ4QXJyYXkoZGVyRW5jb2RlZCk7CiAgICBleHBlY3QoNDgsICJzZXF1ZW5jZSIpOwogICAgb2Zmc2V0ICs9IGRlY29kZUxlbkJ5dGVzKGJ1Ziwgb2Zmc2V0KTsKICAgIGlmICghYnVmRXF1YWxzKGJ1Zi5zbGljZShvZmZzZXQsIG9mZnNldCArIG9pZC5ieXRlTGVuZ3RoKSwgb2lkKSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCB0aGUgZXhwZWN0ZWQgT0lELiIpOwogICAgfQogICAgb2Zmc2V0ICs9IG9pZC5ieXRlTGVuZ3RoOwogICAgZXhwZWN0KDMsICJiaXQgc3RyaW5nIik7CiAgICBjb25zdCBwYXlsb2FkTGVuID0gZGVjb2RlTGVuKGJ1Ziwgb2Zmc2V0KSAtIDE7CiAgICBvZmZzZXQgKz0gZGVjb2RlTGVuQnl0ZXMoYnVmLCBvZmZzZXQpOwogICAgZXhwZWN0KDAsICIwIHBhZGRpbmciKTsKICAgIGNvbnN0IHJlc3VsdCA9IGJ1Zi5zbGljZShvZmZzZXQpOwogICAgaWYgKHBheWxvYWRMZW4gIT09IHJlc3VsdC5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgIGBERVIgcGF5bG9hZCBtaXNtYXRjaDogRXhwZWN0ZWQgbGVuZ3RoICR7cGF5bG9hZExlbn0gYWN0dWFsIGxlbmd0aCAke3Jlc3VsdC5sZW5ndGh9YAogICAgICApOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwogIGZ1bmN0aW9uIGZyb21IZXhTdHJpbmcoaGV4U3RyaW5nKSB7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoCiAgICAgIChoZXhTdHJpbmcubWF0Y2goLy57MSwyfS9nKSA_PyBbXSkubWFwKChieXRlKSA9PiBwYXJzZUludChieXRlLCAxNikpCiAgICApLmJ1ZmZlcjsKICB9CiAgdmFyIEVEMjU1MTlfT0lEID0gVWludDhBcnJheS5mcm9tKFsKICAgIC4uLls0OCwgNV0sCiAgICAuLi5bNiwgM10sCiAgICAuLi5bNDMsIDEwMSwgMTEyXQogIF0pOwogIHZhciB2ZXJpZnlJbnRlcm5ldElkZW50aXR5X2RlZmF1bHQgPSBhc3luYyAoc3RhdGUsIGFjdGlvbikgPT4gewogICAgY29uc3QgeyBkYXRhLCBzaWduYXR1cmUsIHNpZ25lciB9ID0gYWN0aW9uLmlucHV0OwogICAgbGV0IGlzVmFsaWQgPSBmYWxzZTsKICAgIHRyeSB7CiAgICAgIGlmIChpbXBvcnRfdHdlZXRuYWNsLnNpZ24uZGV0YWNoZWQudmVyaWZ5KAogICAgICAgIG5ldyBVaW50OEFycmF5KEJ1ZmZlci5mcm9tKEpTT04uc3RyaW5naWZ5KGRhdGEpKSksCiAgICAgICAgbmV3IFVpbnQ4QXJyYXkoZnJvbUhleFN0cmluZyhzaWduYXR1cmUpKSwKICAgICAgICBuZXcgVWludDhBcnJheSh1bndyYXBERVIoZnJvbUhleFN0cmluZyhzaWduZXIpLCBFRDI1NTE5X09JRCkuYnVmZmVyKQogICAgICApKSB7CiAgICAgICAgaXNWYWxpZCA9IHRydWU7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5sb2coZSk7CiAgICB9CiAgICByZXR1cm4geyByZXN1bHQ6IHsgaXNWYWxpZCB9IH07CiAgfTsKCiAgLy8gc3JjL2NvbW1vbi9saWIvdmFsaWRhdGUuanMKICB2YXIgdmFsaWRhdGUgPSBhc3luYyAoc3RhdGUsIGFjdGlvbiwgZnVuYykgPT4gewogICAgY29uc3QgewogICAgICBxdWVyeSwKICAgICAgbm9uY2UsCiAgICAgIHNpZ25hdHVyZSwKICAgICAgY2FsbGVyLAogICAgICB0eXBlOiB0eXBlMyA9ICJzZWNwMjU2azEiLAogICAgICBwdWJLZXkKICAgIH0gPSBhY3Rpb24uaW5wdXQ7CiAgICBpZiAoIWluY2x1ZGVzX2RlZmF1bHQodHlwZTMpKAogICAgICBzdGF0ZS5hdXRoLmFsZ29yaXRobXMgfHwgWyJzZWNwMjU2azEiLCAic2VjcDI1NmsxLTIiLCAiZWQyNTUxOSIsICJyc2EyNTYiXQogICAgKSkgewogICAgICBlcnIoYFRoZSB3cm9uZyBhbGdvcml0aG1gKTsKICAgIH0KICAgIGxldCBfY2FsbGVyID0gY2FsbGVyOwogICAgY29uc3QgRUlQNzEyRG9tYWluID0gWwogICAgICB7IG5hbWU6ICJuYW1lIiwgdHlwZTogInN0cmluZyIgfSwKICAgICAgeyBuYW1lOiAidmVyc2lvbiIsIHR5cGU6ICJzdHJpbmciIH0sCiAgICAgIHsgbmFtZTogInZlcmlmeWluZ0NvbnRyYWN0IiwgdHlwZTogInN0cmluZyIgfQogICAgXTsKICAgIGNvbnN0IGRvbWFpbiA9IHsKICAgICAgbmFtZTogc3RhdGUuYXV0aC5uYW1lLAogICAgICB2ZXJzaW9uOiBzdGF0ZS5hdXRoLnZlcnNpb24sCiAgICAgIHZlcmlmeWluZ0NvbnRyYWN0OiBpc05pbF9kZWZhdWx0KFNtYXJ0V2VhdmUuY29udHJhY3QpID8gImV4bSIgOiBTbWFydFdlYXZlLmNvbnRyYWN0LmlkCiAgICB9OwogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgbm9uY2UsCiAgICAgIHF1ZXJ5OiBKU09OLnN0cmluZ2lmeSh7IGZ1bmMsIHF1ZXJ5IH0pCiAgICB9OwogICAgY29uc3QgX2RhdGEgPSB7CiAgICAgIHR5cGVzOiB7CiAgICAgICAgRUlQNzEyRG9tYWluLAogICAgICAgIFF1ZXJ5OiBbCiAgICAgICAgICB7IG5hbWU6ICJxdWVyeSIsIHR5cGU6ICJzdHJpbmciIH0sCiAgICAgICAgICB7IG5hbWU6ICJub25jZSIsIHR5cGU6ICJ1aW50MjU2IiB9CiAgICAgICAgXQogICAgICB9LAogICAgICBkb21haW4sCiAgICAgIHByaW1hcnlUeXBlOiAiUXVlcnkiLAogICAgICBtZXNzYWdlCiAgICB9OwogICAgbGV0IHNpZ25lciA9IG51bGw7CiAgICBpZiAodHlwZTMgPT09ICJlZDI1NTE5IikgewogICAgICBjb25zdCB7IGlzVmFsaWQgfSA9IGF3YWl0IHJlYWQoc3RhdGUuY29udHJhY3RzLmRmaW5pdHksIHsKICAgICAgICBmdW5jdGlvbjogInZlcmlmeSIsCiAgICAgICAgZGF0YTogX2RhdGEsCiAgICAgICAgc2lnbmF0dXJlLAogICAgICAgIHNpZ25lcjogY2FsbGVyCiAgICAgIH0pOwogICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgIHNpZ25lciA9IGNhbGxlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBlcnIoYFRoZSB3cm9uZyBzaWduYXR1cmVgKTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlMyA9PT0gInJzYTI1NiIpIHsKICAgICAgbGV0IGVuY29kZWRfZGF0YSA9IEpTT04uc3RyaW5naWZ5KF9kYXRhKTsKICAgICAgaWYgKHR5cGVvZiBUZXh0RW5jb2RlciAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBjb25zdCBlbmMgPSBuZXcgVGV4dEVuY29kZXIoKTsKICAgICAgICBlbmNvZGVkX2RhdGEgPSBlbmMuZW5jb2RlKGVuY29kZWRfZGF0YSk7CiAgICAgIH0KICAgICAgY29uc3QgX2NyeXB0byA9IFNtYXJ0V2VhdmUuYXJ3ZWF2ZS5jcnlwdG8gfHwgU21hcnRXZWF2ZS5hcndlYXZlLndhbGxldHMuY3J5cHRvOwogICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgX2NyeXB0by52ZXJpZnkoCiAgICAgICAgcHViS2V5LAogICAgICAgIGVuY29kZWRfZGF0YSwKICAgICAgICBCdWZmZXIuZnJvbShzaWduYXR1cmUsICJoZXgiKQogICAgICApOwogICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgIHNpZ25lciA9IGNhbGxlcjsKICAgICAgfSBlbHNlIHsKICAgICAgICBlcnIoYFRoZSB3cm9uZyBzaWduYXR1cmVgKTsKICAgICAgfQogICAgfSBlbHNlIGlmICh0eXBlMyA9PSAic2VjcDI1NmsxIikgewogICAgICBzaWduZXIgPSAoYXdhaXQgcmVhZChzdGF0ZS5jb250cmFjdHMuZXRoZXJldW0sIHsKICAgICAgICBmdW5jdGlvbjogInZlcmlmeTcxMiIsCiAgICAgICAgZGF0YTogX2RhdGEsCiAgICAgICAgc2lnbmF0dXJlCiAgICAgIH0pKS5zaWduZXI7CiAgICB9IGVsc2UgaWYgKHR5cGUzID09ICJzZWNwMjU2azEtMiIpIHsKICAgICAgc2lnbmVyID0gKGF3YWl0IHJlYWQoc3RhdGUuY29udHJhY3RzLmV0aGVyZXVtLCB7CiAgICAgICAgZnVuY3Rpb246ICJ2ZXJpZnkiLAogICAgICAgIGRhdGE6IF9kYXRhLAogICAgICAgIHNpZ25hdHVyZQogICAgICB9KSkuc2lnbmVyOwogICAgfQogICAgaWYgKGluY2x1ZGVzX2RlZmF1bHQodHlwZTMpKFsic2VjcDI1NmsxIiwgInNlY3AyNTZrMS0yIl0pKSB7CiAgICAgIGlmICgvXjB4Ly50ZXN0KHNpZ25lcikpCiAgICAgICAgc2lnbmVyID0gc2lnbmVyLnRvTG93ZXJDYXNlKCk7CiAgICAgIGlmICgvXjB4Ly50ZXN0KF9jYWxsZXIpKQogICAgICAgIF9jYWxsZXIgPSBfY2FsbGVyLnRvTG93ZXJDYXNlKCk7CiAgICB9CiAgICBsZXQgb3JpZ2luYWxfc2lnbmVyID0gc2lnbmVyOwogICAgbGV0IF9zaWduZXIgPSBzaWduZXI7CiAgICBjb25zdCBsaW5rID0gc3RhdGUuYXV0aC5saW5rc1tfc2lnbmVyXTsKICAgIGlmICghaXNOaWxfZGVmYXVsdChsaW5rKSkgewogICAgICBsZXQgX2FkZHJlc3MgPSBpc19kZWZhdWx0KE9iamVjdCwgbGluaykgPyBsaW5rLmFkZHJlc3MgOiBsaW5rOwogICAgICBsZXQgX2V4cGlyeSA9IGlzX2RlZmF1bHQoT2JqZWN0LCBsaW5rKSA_IGxpbmsuZXhwaXJ5IHx8IDAgOiAwOwogICAgICBpZiAoX2V4cGlyeSA9PT0gMCB8fCBTbWFydFdlYXZlLmJsb2NrLnRpbWVzdGFtcCA8PSBfZXhwaXJ5KSB7CiAgICAgICAgX3NpZ25lciA9IF9hZGRyZXNzOwogICAgICB9CiAgICB9CiAgICBpZiAoX3NpZ25lciAhPT0gX2NhbGxlcikKICAgICAgZXJyKGBzaWduZXIgaXMgbm90IGNhbGxlcmApOwogICAgaWYgKChzdGF0ZS5ub25jZXNbb3JpZ2luYWxfc2lnbmVyXSB8fCAwKSArIDEgIT09IG5vbmNlKSB7CiAgICAgIGVycihgVGhlIHdyb25nIG5vbmNlYCk7CiAgICB9CiAgICBpZiAoaXNOaWxfZGVmYXVsdChzdGF0ZS5ub25jZXNbb3JpZ2luYWxfc2lnbmVyXSkpCiAgICAgIHN0YXRlLm5vbmNlc1tvcmlnaW5hbF9zaWduZXJdID0gMDsKICAgIHN0YXRlLm5vbmNlc1tvcmlnaW5hbF9zaWduZXJdICs9IDE7CiAgICByZXR1cm4gX3NpZ25lcjsKICB9OwoKICAvLyBzcmMvY29tbW9uL3dhcnAvYWN0aW9ucy93cml0ZS9ldm9sdmUuanMKICB2YXIgZXZvbHZlID0gYXN5bmMgKHN0YXRlLCBhY3Rpb24sIHNpZ25lcikgPT4gewogICAgc2lnbmVyIHx8PSBhd2FpdCB2YWxpZGF0ZShzdGF0ZSwgYWN0aW9uLCAiZXZvbHZlIik7CiAgICBsZXQgb3duZXIgPSBzdGF0ZS5vd25lciB8fCBbXTsKICAgIGlmIChpc19kZWZhdWx0KFN0cmluZykob3duZXIpKQogICAgICBvd25lciA9IG9mX2RlZmF1bHQob3duZXIpOwogICAgaWYgKCFpbmNsdWRlc19kZWZhdWx0KHNpZ25lcikob3duZXIpKQogICAgICBlcnIoIlNpZ25lciBpcyBub3QgdGhlIG93bmVyLiIpOwogICAgaWYgKGFjdGlvbi5pbnB1dC52YWx1ZSAhPT0gYWN0aW9uLmlucHV0LnF1ZXJ5LnZhbHVlKSB7CiAgICAgIGVycigiVmFsdWVzIGRvbid0IG1hdGNoLiIpOwogICAgfQogICAgaWYgKHN0YXRlLmNhbkV2b2x2ZSkgewogICAgICBzdGF0ZS5ldm9sdmUgPSBhY3Rpb24uaW5wdXQudmFsdWU7CiAgICB9IGVsc2UgewogICAgICBlcnIoYFRoaXMgY29udHJhY3QgY2Fubm90IGV2b2x2ZS5gKTsKICAgIH0KICAgIHJldHVybiB7IHN0YXRlIH07CiAgfTsKCiAgLy8gc3JjL2NvbW1vbi9hY3Rpb25zL3dyaXRlL3NldENhbkV2b2x2ZS5qcwogIHZhciBzZXRDYW5Fdm9sdmUgPSBhc3luYyAoc3RhdGUsIGFjdGlvbiwgc2lnbmVyKSA9PiB7CiAgICBzaWduZXIgfHw9IGF3YWl0IHZhbGlkYXRlKHN0YXRlLCBhY3Rpb24sICJzZXRDYW5Fdm9sdmUiKTsKICAgIGxldCBvd25lciA9IHN0YXRlLm93bmVyIHx8IFtdOwogICAgaWYgKGlzX2RlZmF1bHQoU3RyaW5nKShvd25lcikpCiAgICAgIG93bmVyID0gb2ZfZGVmYXVsdChvd25lcik7CiAgICBpZiAoIWluY2x1ZGVzX2RlZmF1bHQoc2lnbmVyKShvd25lcikpCiAgICAgIGVycigiU2lnbmVyIGlzIG5vdCB0aGUgb3duZXIuIik7CiAgICBpZiAoIWlzX2RlZmF1bHQoQm9vbGVhbikoYWN0aW9uLmlucHV0LnF1ZXJ5LnZhbHVlKSkgewogICAgICBlcnIoIlZhbHVlIG11c3QgYmUgYSBib29sZWFuLiIpOwogICAgfQogICAgc3RhdGUuY2FuRXZvbHZlID0gYWN0aW9uLmlucHV0LnF1ZXJ5LnZhbHVlOwogICAgcmV0dXJuIHsgc3RhdGUgfTsKICB9OwoKICAvLyBzcmMvY29tbW9uL2FjdGlvbnMvcmVhZC9nZXRFdm9sdmUuanMKICB2YXIgZ2V0RXZvbHZlID0gYXN5bmMgKHN0YXRlLCBhY3Rpb24pID0-IHsKICAgIHJldHVybiB7CiAgICAgIHJlc3VsdDogcGlja0FsbF9kZWZhdWx0KFsiY2FuRXZvbHZlIiwgImV2b2x2ZSJdKShzdGF0ZSkKICAgIH07CiAgfTsKCiAgLy8gc3JjL2ludGVybmV0LWlkZW50aXR5L2lpLmpzCiAgYXN5bmMgZnVuY3Rpb24gaGFuZGxlKHN0YXRlLCBhY3Rpb24pIHsKICAgIHN3aXRjaCAoYWN0aW9uLmlucHV0LmZ1bmN0aW9uKSB7CiAgICAgIGNhc2UgInZlcmlmeSI6CiAgICAgICAgcmV0dXJuIGF3YWl0IHZlcmlmeUludGVybmV0SWRlbnRpdHlfZGVmYXVsdChzdGF0ZSwgYWN0aW9uKTsKICAgICAgY2FzZSAiZ2V0RXZvbHZlIjoKICAgICAgICByZXR1cm4gYXdhaXQgZ2V0RXZvbHZlKHN0YXRlLCBhY3Rpb24pOwogICAgICBjYXNlICJldm9sdmUiOgogICAgICAgIHJldHVybiBhd2FpdCBldm9sdmUoc3RhdGUsIGFjdGlvbik7CiAgICAgIGNhc2UgInNldENhbkV2b2x2ZSI6CiAgICAgICAgcmV0dXJuIGF3YWl0IHNldENhbkV2b2x2ZShzdGF0ZSwgYWN0aW9uKTsKICAgICAgZGVmYXVsdDoKICAgICAgICBlcnIoCiAgICAgICAgICBgTm8gZnVuY3Rpb24gc3VwcGxpZWQgb3IgZnVuY3Rpb24gbm90IHJlY29nbmlzZWQ6ICIke2FjdGlvbi5pbnB1dC5mdW5jdGlvbn0iYAogICAgICAgICk7CiAgICB9CiAgICByZXR1cm4geyBzdGF0ZSB9OwogIH0KCi8qISBodHRwczovL210aHMuYmUvcHVueWNvZGUgdjEuMy4yIGJ5IEBtYXRoaWFzICovCg